!function(){var e="b37d9400b8b494b067a438eba4573926";var t=false;function n(){function e(e){return!/^\d+(.\d+)*$/.test(e.stageId)||e.stageId.length>32?(console.warn("关卡stageId必须符合传参规则,请参考文档。"),!1):!("string"!==i(e.stageName)||e.stageName.length>32)||(console.warn("关卡名称为必传字段,且长度小于32个字符,请参考文档"),!1)}var t="",n="",r=0;this.onStart=function(a){if(e(a)){var s={};r=Date.now(),s.sid=a.stageId,s.snm=a.stageName,s.state="start",n=""+Date.now()+Math.floor(1e7*Math.random()),t=s,("string"===i(a.userId)&&a.userId)<32&&(this.uid=a.uid),this.request()}},this.onRunning=function(n){if(e(n)){var r={params:{}};if(("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),!i(n.event)&&E.join(",").indexOf(n.event+",")!=-1)return void E.join(",");if(r.event=n.event,"object"===i(n.params)){if("string"!==i(n.params.itemName)||n.params.itemName.length>32)return void console.warn("道具/商品名称为必传字段，且长度小于32个字符，详情请参考文档");r.params.itnm=n.params.itemName,"string"===i(n.params.itemId)&&n.params.itemId.length<32&&(r.params.itid=n.params.itemId),"number"===i(n.params.itemCount)&&n.params.itemCount.length<32?r.params.itco=n.params.itemCount:r.params.itco=1,n.event.indexOf("pay")!==-1&&("number"===i(n.params.itemMoney)&&n.params.itemMoney.length<32?r.params.money=n.params.itemMoney:r.params.money=0),"string"===i(n.params.desc)&&n.params.desc.length<64&&(r.params.desc=n.params.desc),r.state="running",r.sid=n.stageId,r.snm=n.stageName,t=r,this.request()}}},this.onEnd=function(n){if(e(n)){var a={};if(a.state="end",("string"===i(n.userId)&&n.userId)<32&&(this.uid=n.uid),!i(n.event)&&P.join(",").indexOf(n.event+",")!==-1)return void P.join(",");a.sid=n.stageId,a.snm=n.stageName,a.event=n.event,a.sdr=0!==r?Date.now()-r:"",a.params={},"object"===i(n.params)&&"string"===i(n.params.desc)&&n.params.desc.length<64&&(a.params.desc=n.params.desc),t=a,this.request()}},this.request=function(){var e=l(w);t.ss=n,e.ct=t,d(e,"screen")}}function r(){return new Promise(function(e,t){wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){k=h(t.userInfo.avatarUrl.split("/")),e(t)},fail:function(){e("")}}):e("")},fail:function(){e("")}})})}function a(){return new Promise(function(e,t){wx.getNetworkType({success:function(t){e(t)},fail:function(){e("")}})})}function s(){return new Promise(function(e,t){"1044"==q.scene?wx.getShareInfo({shareTicket:q.shareTicket,success:function(t){e(t)},fail:function(){e("")}}):e("")})}function o(){return new Promise(function(e,n){t?wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}):wx.getSetting({success:function(t){t.authSetting["scope.userLocation"]?(wx.getLocation({success:function(t){e(t)},fail:function(){e("")}}),e("")):e("")},fail:function(){e("")}})})}function i(e){function t(e){return Object.prototype.toString.call(e)}var n={};return"Boolean Number String Function Array Date RegExp Object Error Symbol".split(" ").forEach(function(e,t){n["[object "+e+"]"]=e.toLowerCase()}),function(){return null==e?e:"object"==typeof e||"function"==typeof e?n[t.call(e)]||"object":typeof e}()}function c(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+e()+e()+e()+e()+e()+e()}function u(){this.concurrency=4,this.queue=[],this.tasks=[],this.activeCount=0;var e=this;this.push=function(t){this.tasks.push(new Promise(function(n,r){var a=function(){e.activeCount++,t().then(function(e){n(e)}).then(function(){e.next()})};e.activeCount<e.concurrency?a():e.queue.push(a)}))},this.all=function(){return Promise.all(this.tasks)},this.next=function(){e.activeCount--,e.queue.length>0&&e.queue.shift()()}}function d(t,n){function r(){return new Promise(function(e,n){wx.request({url:"https://"+p+".aldwx.com/d.html",data:t,header:{se:_||"",op:y||"",img:k||""},method:"GET",fail:function(){e("")},success:function(t){e(200==t.statusCode?"":"status error")}})})}x++,t.as=M,t.at=I,t.rq_c=x,t.ifo=m,t.ak=e,t.uu=v,t.v=g,t.st=Date.now(),t.ev=n,t.wsr=q,""!==f(t.ufo)&&(t.ufo=t.ufo),t.ec=S,wx.Queue.push(r)}function f(e){if(void 0===e||""===e)return"";var t={};for(var n in e)"rawData"!=n&&"errMsg"!=n&&(t[n]=e[n]);return t}function l(e){var t={};for(var n in e)t[n]=e[n];return t}function h(e){for(var t="",n=0;n<e.length;n++)e[n].length>t.length&&(t=e[n]);return t}var g="2.0.0",p="glog";""===e&&console.error("请在配置文件中填写您的app_key"),e=e.replace(/\s/g,""),function(){wx.request({url:"https://"+p+".aldwx.com/config/app.json",method:"GET",success:function(e){200===e.statusCode&&(e.data.version!=g&&console.warn("您的SDK不是最新版本，请尽快升级！"),e.data.warn&&console.warn(e.data.warn),e.data.error&&console.error(e.data.error))}})}();var m="",v=function(){var e="";try{e=wx.getStorageSync("aldstat_uuid"),wx.setStorageSync("ald_ifo",!0)}catch(t){e="uuid_getstoragesync"}if(e)m=!1;else{e=c(),m=!0;try{wx.setStorageSync("aldstat_uuid",e)}catch(e){wx.setStorageSync("aldstat_uuid","uuid_getstoragesync")}}return e}(),w={},_="",y="",S=0,x="",q=wx.getLaunchOptionsSync(),b=Date.now(),I=""+Date.now()+Math.floor(1e7*Math.random()),M=""+Date.now()+Math.floor(1e7*Math.random()),O=0,j="",k="",D=!0,N=!1,C=["aldSendEvent","aldOnShareAppMessage","aldShareAppMessage","aldSendSession","aldSendOpenid","aldLevelEvent"],E=["payStart","paySuccess","payFail","die","revive","tools","award"],P=["complete","fail"];void 0===wx.Queue&&(wx.Queue=new u,wx.Queue.all()),function(){return Promise.all([r(),a(),o()])}().then(function(e){""!==e[2]?(w.lat=e[2].latitude||"",w.lng=e[2].longitude||"",w.spd=e[2].speed||""):(w.lat="",w.lng="",w.spd=""),""!==e[1]?w.nt=e[1].networkType||"":w.nt="";var t=l(w);""!==e[0]&&(t.ufo=e[0],j=e[0]),d(t,"init")}),wx.onShow(function(e){if(q=e,O=Date.now(),!D&&!N){I=""+Date.now()+Math.floor(1e7*Math.random()),m=!1;try{wx.setStorageSync("ald_ifo",!1)}catch(e){}}D=!1,N=!1;var t=l(w),n=l(w);t.sm=O-b,e.query.ald_share_src&&e.shareTicket&&"1044"===e.scene?(n.tp="ald_share_click",s().then(function(e){n.ct=e,d(n,"event")})):e.query.ald_share_src&&(n.tp="ald_share_click",n.ct="1",d(n,"event")),d(t,"show")}),wx.onHide(function(){var e=l(w);e.dr=Date.now()-O,""===j?wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(t){e.ufo=t,j=t,k=h(t.userInfo.avatarUrl.split("/")),d(e,"hide")}}):d(e,"hide")}}):d(e,"hide")}),wx.onError(function(e){var t=l(w);t.tp="ald_error_message",t.ct=e,S++,d(t,"event")});var A={aldSendEvent:function(e,t){var n=l(w);""!==e&&"string"==typeof e&&e.length<=255?(n.tp=e,"string"==typeof t&&t.length<=255?(n.ct=String(t),d(n,"event")):"object"==typeof t?(JSON.stringify(t).length>=255&&console.error("自定义事件参数不能超过255个字符"),n.ct=JSON.stringify(t),d(n,"event")):void 0===t||""===t?d(n,"event"):console.error("事件参数必须为String,Object类型,且参数长度不能超过255个字符")):console.error("事件名称必须为String类型且不能超过255个字符")},aldOnShareAppMessage:function(e){wx.onShareAppMessage(function(){N=!0;var t=e(),n="";n=void 0!==q.query.ald_share_src?void 0!==t.query?(q.query.ald_share_src.indexOf(v),t.query+"&ald_share_src="+q.query.ald_share_src+","+v):(q.query.ald_share_src.indexOf(v),"ald_share_src="+q.query.ald_share_src+","+v):void 0!==t.query?t.query+"&ald_share_src="+v:"ald_share_src="+v,"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n;var r=l(w);return r.ct=t,r.ct.sho=1,r.tp="ald_share_chain",d(r,"event"),t})},aldShareAppMessage:function(e){N=!0;var t=e,n="";n=void 0!==q.query.ald_share_src?void 0!==t.query?(q.query.ald_share_src.indexOf(v),t.query+"&ald_share_src="+q.query.ald_share_src+","+v):(q.query.ald_share_src.indexOf(v),"ald_share_src="+q.query.ald_share_src+","+v):void 0!==t.query?t.query+"&ald_share_src="+v:"ald_share_src="+v;var r=l(w);"undefined"!=i(t.ald_desc)&&(n+="&ald_desc="+t.ald_desc),t.query=n,r.ct=t,r.tp="ald_share_chain",d(r,"event"),wx.shareAppMessage(t)},aldSendSession:function(e){if(""===e||!e)return void console.error("请传入从后台获取的session_key");var t=l(w);t.tp="session",t.ct="session",_=e,""===j?wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?wx.getUserInfo({success:function(e){t.ufo=e,d(t,"event")}}):d(t,"event")}}):(t.ufo=j,""!==j&&(t.gid=""),d(t,"event"))},aldSendOpenid:function(e){if(""===e||!e)return void console.error("openID不能为空");y=e;var t=l(w);t.tp="openid",t.ct="openid",d(t,"event")}};wx.aldStage=new n;for(var L=0;L<C.length;L++)!function(e,t){Object.defineProperty(wx,e,{value:t,writable:!1,enumerable:!0,configurable:!0})}(C[L],A[C[L]]);try{var T=wx.getSystemInfoSync();w.br=T.brand||"",w.md=T.model,w.pr=T.pixelRatio,w.sw=T.screenWidth,w.sh=T.screenHeight,w.ww=T.windowWidth,w.wh=T.windowHeight,w.lang=T.language,w.wv=T.version,w.sv=T.system,w.wvv=T.platform,w.fs=T.fontSizeSetting,w.wsdk=T.SDKVersion,w.bh=T.benchmarkLevel||"",w.bt=T.battery||"",w.wf=T.wifiSignal||"",w.lng="",w.lat="",w.nt="",w.spd="",w.ufo=""}catch(n){}}();