var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();!function(){function e(t,a,n){function i(l,s){if(!a[l]){if(!t[l]){var r="function"==typeof require&&require;if(!s&&r)return r(l,!0);if(o)return o(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[l]={exports:{}};t[l][0].call(d.exports,function(e){return i(t[l][1][e]||e)},d,d.exports,e,t,a,n)}return a[l].exports}for(var o="function"==typeof require&&require,l=0;l<n.length;l++)i(n[l]);return i}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./script/runtime/CannonSelect"),i=e("./script/runtime/GameScene"),o=e("./script/runtime/HomeView"),l=e("./script/component/Reward"),s=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("script/runtime/CannonSelect.ts",n.default),e("script/runtime/GameScene.ts",i.default),e("script/runtime/HomeView.ts",o.default),e("script/component/Reward.ts",l.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="home/HomeView.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=s,s.init()},{"./script/component/Reward":8,"./script/runtime/CannonSelect":10,"./script/runtime/GameScene":11,"./script/runtime/HomeView":12}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameConfig"),i=e("./script/utils/wx");new(function(){function e(){if(Laya.Browser.onMiniGame){var e=i.default.getUpdateManager();e.onUpdateReady(function(){i.default.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(t){t.confirm&&e.applyUpdate()}})})}window.Laya3D?Laya3D.init(n.default.width,n.default.height):Laya.init(n.default.width,n.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n.default.scaleMode,Laya.stage.screenMode=n.default.screenMode,Laya.URL.exportSceneToJson=n.default.exportSceneToJson,(n.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.height=Math.round(n.default.width*Laya.Browser.height/Laya.Browser.width)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){n.default.startScene&&Laya.Scene.open(n.default.startScene)},e}())},{"./GameConfig":1,"./script/utils/wx":17}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.0.9",a.RewardPos={Cannon:"try_cannon",Bullet:"try_ball",Revive:"revive"},a.BannerPos={HomeView:"HomeView",GameScene:"HomeView",OverView:"HomeView",ReviveDialog:"HomeView"},a.ReviveCountdown=5;!function(e){e[e.START=1]="START",e[e.PAUSE=2]="PAUSE",e[e.OVER=3]="OVER"}(a.GameState||(a.GameState={})),a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_CannnonSelect="cannonSelect/CannonSelect.scene",a.URL_OverView="over/OverView.scene",a.CameraInitPos=new Laya.Vector3(0,.3,.2),a.CameraInitRotEuler=new Laya.Vector3(0,0,0),a.LightInitPos=new Laya.Vector3(0,5,0),a.LightInitRotEuler=new Laya.Vector3(-30,0,0),a.LightInitColor=new Laya.Vector3(1,1,1),a.StageTexUrl=["res/stage/out/materials/mutou_06.jpg","res/stage/out/materials/stack_texture.jpg","res/stage/out/materials/TNT.png"],a.StageResUrl="res/stage/out/",a.StageInitPos=new Laya.Vector3(0,0,0),a.StageInitRot=new Laya.Vector3(0,180,0),a.StageInitScale=new Laya.Vector3(20,20,20),a.StageNum=20,a.MaxWinCheckTime=30,a.SetKinematicWaitTime=10,a.BgResUrl=["res/scene/Scenes_02.lh","res/scene/Scenes_04.lh","res/scene/Scenes_07.lh"],a.GlassBrokenVelocity=10,a.GlassFallingBrokenVelocity=1,a.PieceResUrl="res/cube_piece.lm",a.PiecesNum=3,a.PiecesBrokenTime=120,a.CannonInitPos=new Laya.Vector3(0,.04,-.2),a.CannonInitRot=new Laya.Vector3(0,180,0),a.CannonInitScale=new Laya.Vector3(25,25,25),a.TurretInitLocalRot=new Laya.Vector3(0,0,0),a.CannonBallBoxUrl="res/ball_box/ball_box.lh",a.CannonBallInitPos=new Laya.Vector3(-.01,.05,-.13),a.CannonBallInitScale=new Laya.Vector3(25,25,25),a.cdnUrl="https://static.miniant.cn/cannon/res_v108.zip",a.soundUrl="res/audio/shoot.mp3",a.treasureUrl="res/treasure/treasure.lh",a.treasureAngleX=[-1.6,-1.4,-.8,.1,.6,1.2,1,-.8,-.45],a.treasureAngleZ=[0,.2,.5,.6,.3,.2,.1,0,.8],a.BulletMeshUrl="res/bullet/bullet.lm",a.BulletLightningUrl="res/bullet/lightning/lightning.lh",a.BulletRewardResUrl={1:"res/bullet/blackhole/blackhole.lh"},a.cannonEffectUrl={1:"res/cannon_effect/gunlightning.lh"},a.BulletRadius=.08,a.CannonSelectIconBgUrl="res/ui/cannonSelect/CannonIconBG.png",a.CannonSelectIconList=[{index:-1},{index:1,icon:"res/ui/cannonSelect/cannon_default.png"},{index:3,icon:"res/ui/cannonSelect/Cannon_10.png"},{index:7,icon:"res/ui/cannonSelect/cannon_dragon.png"},{index:2,icon:"res/ui/cannonSelect/Cannon_03.png"},{index:6,icon:"res/ui/cannonSelect/cannon_light.png"},{index:5,icon:"res/ui/cannonSelect/cannon_lion.png"},{index:4,icon:"res/ui/cannonSelect/Cannon_22.png"},{index:-1}],a.CannonSelectTextList={1:{name:"普通炮",feature:"普通的大炮，普通的威力，就很普通",unlockLvl:0},3:{name:"冰雪奇缘",feature:"更强的威力，将方块变成冰块",unlockLvl:5},7:{name:"龙门大炮",feature:"威力超强，拥有它，你就是龙的传人",unlockLvl:10},2:{name:"双重射击",feature:"两炮齐发，威力强大",unlockLvl:15},6:{name:"闪电风暴",feature:"威力无比，一发入魂",unlockLvl:20},5:{name:"黄金狮子头",feature:"河东狮吼，十分暴躁",unlockLvl:999},4:{name:"无敌散弹炮",feature:"终极武器，用一次爽一次",unlockLvl:999}},a.CannonResUrl={1:"res/cannon/Cannon_Default.lh",2:"res/cannon/Cannon_ShotgunX2.lh",3:"res/cannon/Cannon_Frozen.lh",4:"res/cannon/Cannon_Reward.lh",5:"res/cannon/Cannon_Lion.lh",6:"res/cannon/Cannon_Lightning.lh",7:"res/cannon/Cannon_Dragon.lh"},a.BulletTextureUrl={1:"res/bullet/ball_texture/ball_default.jpg",2:"res/bullet/ball_texture/shotgun.jpg",3:"res/bullet/ball_texture/ice.jpg",4:"res/bullet/ball_texture/shotgun.jpg",5:"res/bullet/ball_texture/boom.jpg",6:"res/bullet/ball_texture/lightning.jpg",7:"res/bullet/ball_texture/ball_default.jpg"},a.BulletScale={0:{1:1,2:1,3:1,4:1,5:1,6:1,7:1},1:{1:7}},a.BulletMass={0:{1:20,2:20,3:30,4:20,5:20,6:100,7:35},1:{1:100}},a.BulletVelocity={0:{1:30,2:30,3:30,4:30,5:30,6:30,7:30},1:{1:5}},a.BulletTrigger={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1},1:{1:!0}},a.BulletOverrideGravity={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1},1:{1:!0}}},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default={gameData:{musicEnabled:!0,soundEnabled:!0,vibrationEnabled:!0,updateTimestamp:0,videoCount:0,lastVideoTimestamp:0,shareCount:0,lastShareTimestamp:0,stageIndex:1,cannonType:1,cannonUnlockList:{default:!0,frozen:!1},tutorialStep:5},config:{skin_block:!1,share_first:!1,allow_share:!0,allow_video:!0,share_number:5,video_number:6,share_time:30,banner_time:180,share_delay:4,online:!0,debug:!1,allow_pay:!1,allow_revive:!0,banner_delay:1,banner_delay_ratio:.8,banner_delay_ratio1:.8,deny_banner:!1,share_fail:"'操作失败，请换个群'",distance_iphonex:50,banner_click_time:2,games:{},shares:{},videos:{},banners:{},try_cannon:1,try_ball:1,revive:1,bulletRewardType:1,cannonRewardType:4,hasTreasure:!0},user:{},audio:{volume:.5}}},{}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Map={Android:{1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:9,9:10,10:8,11:11,12:12,13:13,14:14,15:15,16:18,17:19,18:22,19:24,20:16,21:25,22:26,23:27,24:28,25:17,26:29,27:30,28:32,29:33,30:20,31:34,32:35,33:36,34:37,35:21,36:38,37:39,38:41,39:42,40:23,41:47,42:48,43:51,44:52,45:31,46:53,47:54,48:59,49:40,50:43,51:44,52:45,53:46,54:49,55:50,56:55,57:56,58:57},IOS:{1:1,2:2,3:5,4:7,5:6,6:9,7:10,8:3,9:12,10:8,11:14,12:16,13:19,14:23,15:11,16:25,17:26,18:27,19:29,20:30,21:30,22:3,23:4,24:32,25:16,26:25,27:26,28:27,29:29,30:20,31:3,32:4,33:37,34:39,35:17,36:41,37:42,38:45,39:48,40:18,41:6,42:8,43:11,44:30,45:38,46:16,47:20,48:17,49:23,50:40,51:25,52:26,53:27,54:29,55:22,56:30,57:3,58:4}},a.Stage={Android:{1:{1:{min:1,max:1,ball_add:10},2:{min:2,max:2,ball_add:8},3:{min:3,max:3,ball_add:8},4:{min:4,max:4,ball_add:8},5:{min:5,max:5,ball_add:6}},2:{1:{min:6,max:6,ball_add:6},2:{min:7,max:7,ball_add:5},3:{min:8,max:8,ball_add:5},4:{min:9,max:9,ball_add:5},5:{min:10,max:10,ball_add:4}},3:{1:{min:11,max:11,ball_add:5},2:{min:12,max:12,ball_add:5},3:{min:13,max:13,ball_add:4},4:{min:14,max:14,ball_add:4},5:{min:15,max:15,ball_add:2}},4:{1:{min:1,max:19,ball_add:4},2:{min:1,max:19,ball_add:4},3:{min:1,max:19,ball_add:3},4:{min:1,max:19,ball_add:3},5:{min:20,max:20,ball_add:2}},5:{1:{min:1,max:24,ball_add:3},2:{min:1,max:24,ball_add:3},3:{min:1,max:24,ball_add:3},4:{min:1,max:24,ball_add:3},5:{min:25,max:25,ball_add:2}},6:{1:{min:5,max:29,ball_add:3},2:{min:5,max:29,ball_add:3},3:{min:5,max:29,ball_add:3},4:{min:5,max:29,ball_add:3},5:{min:30,max:30,ball_add:1}},7:{1:{min:5,max:34,ball_add:2},2:{min:5,max:34,ball_add:2},3:{min:5,max:34,ball_add:2},4:{min:5,max:34,ball_add:2},5:{min:35,max:35,ball_add:1}},8:{1:{min:5,max:39,ball_add:2},2:{min:5,max:39,ball_add:2},3:{min:5,max:39,ball_add:2},4:{min:5,max:39,ball_add:2},5:{min:40,max:40,ball_add:1}},9:{1:{min:5,max:44,ball_add:2},2:{min:5,max:44,ball_add:2},3:{min:5,max:44,ball_add:2},4:{min:5,max:44,ball_add:2},5:{min:45,max:45,ball_add:1}},10:{1:{min:5,max:48,ball_add:2},2:{min:5,max:48,ball_add:2},3:{min:5,max:48,ball_add:2},4:{min:5,max:48,ball_add:2},5:{min:49,max:49,ball_add:1}},11:{1:{min:5,max:48,ball_add:2},2:{min:5,max:48,ball_add:2},3:{min:5,max:48,ball_add:2},4:{min:5,max:48,ball_add:2},5:{min:50,max:50,ball_add:1}},12:{1:{min:5,max:48,ball_add:2},2:{min:5,max:48,ball_add:2},3:{min:5,max:48,ball_add:2},4:{min:5,max:48,ball_add:2},5:{min:51,max:51,ball_add:1}},13:{1:{min:5,max:48,ball_add:2},2:{min:5,max:48,ball_add:2},3:{min:5,max:48,ball_add:2},4:{min:5,max:48,ball_add:2},5:{min:52,max:52,ball_add:1}},14:{1:{min:5,max:48,ball_add:2},2:{min:5,max:48,ball_add:2},3:{min:5,max:48,ball_add:2},4:{min:5,max:48,ball_add:2},5:{min:53,max:53,ball_add:1}},15:{1:{min:5,max:48,ball_add:1},2:{min:5,max:48,ball_add:1},3:{min:5,max:48,ball_add:1},4:{min:5,max:48,ball_add:1},5:{min:54,max:54,ball_add:0}},16:{1:{min:10,max:48,ball_add:1},2:{min:10,max:48,ball_add:1},3:{min:10,max:48,ball_add:1},4:{min:10,max:48,ball_add:1},5:{min:55,max:55,ball_add:0}},17:{1:{min:10,max:48,ball_add:1},2:{min:10,max:48,ball_add:1},3:{min:10,max:48,ball_add:1},4:{min:10,max:48,ball_add:1},5:{min:56,max:56,ball_add:0}},18:{1:{min:10,max:48,ball_add:1},2:{min:10,max:48,ball_add:1},3:{min:10,max:48,ball_add:1},4:{min:10,max:48,ball_add:1},5:{min:57,max:57,ball_add:0}},19:{1:{min:10,max:48,ball_add:1},2:{min:10,max:48,ball_add:1},3:{min:10,max:48,ball_add:1},4:{min:10,max:48,ball_add:1},5:{min:58,max:58,ball_add:0}},20:{1:{min:10,max:48,ball_add:0},2:{min:10,max:48,ball_add:0},3:{min:10,max:48,ball_add:0},4:{min:10,max:48,ball_add:0},5:{min:49,max:58,ball_add:0}}},IOS:{1:{1:{min:1,max:1,ball_add:10},2:{min:2,max:2,ball_add:8},3:{min:3,max:3,ball_add:8},4:{min:4,max:4,ball_add:8},5:{min:5,max:5,ball_add:6}},2:{1:{min:6,max:6,ball_add:6},2:{min:7,max:7,ball_add:5},3:{min:8,max:8,ball_add:5},4:{min:9,max:9,ball_add:5},5:{min:10,max:10,ball_add:4}},3:{1:{min:11,max:11,ball_add:5},2:{min:12,max:12,ball_add:5},3:{min:13,max:13,ball_add:4},4:{min:14,max:14,ball_add:4},5:{min:15,max:15,ball_add:2}},4:{1:{min:1,max:19,ball_add:4},2:{min:1,max:19,ball_add:4},3:{min:1,max:19,ball_add:3},4:{min:1,max:19,ball_add:3},5:{min:20,max:20,ball_add:2}},5:{1:{min:1,max:24,ball_add:3},2:{min:1,max:24,ball_add:3},3:{min:1,max:24,ball_add:3},4:{min:1,max:24,ball_add:3},5:{min:25,max:25,ball_add:2}},6:{1:{min:5,max:29,ball_add:3},2:{min:5,max:29,ball_add:3},3:{min:5,max:29,ball_add:3},4:{min:5,max:29,ball_add:3},5:{min:30,max:30,ball_add:1}},7:{1:{min:5,max:34,ball_add:2},2:{min:5,max:34,ball_add:2},3:{min:5,max:34,ball_add:2},4:{min:5,max:34,ball_add:2},5:{min:35,max:35,ball_add:1}},8:{1:{min:5,max:39,ball_add:2},2:{min:5,max:39,ball_add:2},3:{min:5,max:39,ball_add:2},4:{min:5,max:39,ball_add:2},5:{min:40,max:40,ball_add:1}},9:{1:{min:10,max:44,ball_add:2},2:{min:10,max:44,ball_add:2},3:{min:10,max:44,ball_add:2},4:{min:10,max:44,ball_add:2},5:{min:45,max:45,ball_add:1}},10:{1:{min:10,max:49,ball_add:2},2:{min:10,max:49,ball_add:2},3:{min:10,max:49,ball_add:2},4:{min:10,max:49,ball_add:2},5:{min:50,max:50,ball_add:1}},11:{1:{min:10,max:54,ball_add:2},2:{min:10,max:54,ball_add:2},3:{min:10,max:54,ball_add:2},4:{min:10,max:54,ball_add:2},5:{min:55,max:55,ball_add:1}},12:{1:{min:10,max:54,ball_add:2},2:{min:10,max:54,ball_add:2},3:{min:10,max:54,ball_add:2},4:{min:10,max:54,ball_add:2},5:{min:35,max:58,ball_add:1}},13:{1:{min:10,max:54,ball_add:2},2:{min:10,max:54,ball_add:2},3:{min:10,max:54,ball_add:2},4:{min:10,max:54,ball_add:2},5:{min:35,max:58,ball_add:1}},14:{1:{min:10,max:54,ball_add:2},2:{min:10,max:54,ball_add:2},3:{min:10,max:54,ball_add:2},4:{min:10,max:54,ball_add:2},5:{min:35,max:58,ball_add:1}},15:{1:{min:10,max:54,ball_add:1},2:{min:10,max:54,ball_add:1},3:{min:10,max:54,ball_add:1},4:{min:10,max:54,ball_add:1},5:{min:35,max:58,ball_add:0}},16:{1:{min:10,max:54,ball_add:1},2:{min:10,max:54,ball_add:1},3:{min:10,max:54,ball_add:1},4:{min:10,max:54,ball_add:1},5:{min:35,max:58,ball_add:0}},17:{1:{min:10,max:54,ball_add:1},2:{min:10,max:54,ball_add:1},3:{min:10,max:54,ball_add:1},4:{min:10,max:54,ball_add:1},5:{min:35,max:58,ball_add:0}},18:{1:{min:10,max:54,ball_add:1},2:{min:10,max:54,ball_add:1},3:{min:10,max:54,ball_add:1},4:{min:10,max:54,ball_add:1},5:{min:35,max:58,ball_add:0}},19:{1:{min:10,max:54,ball_add:1},2:{min:10,max:54,ball_add:1},3:{min:10,max:54,ball_add:1},4:{min:10,max:54,ball_add:1},5:{min:35,max:58,ball_add:0}},20:{1:{min:10,max:54,ball_add:0},2:{min:10,max:54,ball_add:0},3:{min:10,max:54,ball_add:0},4:{min:10,max:54,ball_add:0},5:{min:35,max:58,ball_add:0}}}},a.StageRaw={1:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},2:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},3:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},4:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},5:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},6:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},7:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},8:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},9:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},10:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},11:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},12:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},13:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},14:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},15:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},16:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},17:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},18:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},19:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},20:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},21:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},22:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},23:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},24:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},25:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},26:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},27:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},28:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},29:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},30:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},31:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},32:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},33:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},34:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},35:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},36:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},37:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},38:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},39:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},40:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},41:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},42:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},43:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},44:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},45:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},46:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},47:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},48:{ball_num:9,rotate:!0,move_x:!0,move_y:!0,move_z:!0},49:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},50:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},51:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},52:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},53:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},54:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},55:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},56:{ball_num:14,rotate:!0,move_x:!0,move_y:!0,move_z:!0},57:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},58:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0}}},{}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../runtime/GameScene"),i=e("../Const"),o=e("./Target"),l=e("./Guard"),s=function(e){function t(){var t=e.call(this)||this;return t.collisionBlackList=["bullet","player"],t}return __extends(t,e),t.prototype.onAwake=function(){this.bullet||(this.bullet=this.owner)},t.prototype.init=function(){this.rigidbody=this.bullet.addComponent(Laya.Rigidbody3D),this.rigidbody.colliderShape=new Laya.SphereColliderShape(i.BulletRadius),this.material=new Laya.PBRSpecularMaterial,this.bullet.meshRenderer.material=this.material},t.prototype.reset=function(e,t){var a=this;void 0===t&&(t=!1),this.bullet=this.owner,this.isReward=t,this.type=e,this.effect=this.bullet.getChildByName("effect"),this.lifetime=120,this.isReward&&1===this.type&&(this.lifetime=300),this.flag_active=!1,void 0===this.rigidbody&&this.init(),this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_FADE,this.material.albedoColorA=0,this.isReward||Laya.Texture2D.load(i.BulletTextureUrl[this.type],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.effect&&(this.effect.active=!1),this.bullet.transform.localPosition=n.default.instance.turretInitPos.clone(),this.bullet.transform.localRotationEuler=i.StageInitRot.clone(),Laya.Vector3.scale(new Laya.Vector3(1,1,1),i.BulletScale[+this.isReward][this.type],this.bullet.transform.localScale),this.effect&&Laya.Vector3.scale(this.effect.transform.localScale,1/i.BulletScale[+this.isReward][this.type],this.effect.transform.localScale),this.rigidbody.isTrigger=i.BulletTrigger[+this.isReward][this.type],this.rigidbody.ccdMotionThreshold=.001,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type],this.rigidbody.mass=i.BulletMass[+this.isReward][this.type];var o=n.default.instance.bulletDirection.clone();Laya.Vector3.scale(o,i.BulletVelocity[+this.isReward][this.type],o),this.rigidbody.linearVelocity=o,this.rigidbody.overrideGravity=i.BulletOverrideGravity[+this.isReward][this.type],this.rigidbody.overrideGravity&&(this.rigidbody.gravity=new Laya.Vector3(0,0,0)),this.rigidbody.canCollideWith=1,this.rigidbody.collisionGroup=4,"bulletTrigger"===this.bullet.name&&(this.rigidbody.isTrigger=!0,this.rigidbody.collisionGroup=5,this.rigidbody.ccdMotionThreshold=1e-4,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type]/1e3)},t.prototype.onCollisionExit=function(e){"bulletTrigger"===this.bullet.name&&this.recover()},t.prototype.onCollisionEnter=function(e){"bottom"!==e.other.owner.name&&"top"!==e.other.owner.name||(0===n.default.instance.treasureHitState&&(n.default.instance.treasureHitState=1),n.default.instance.treasureHitCnt++,this.destroy())},t.prototype.onTriggerEnter=function(e){this.triggerHandler(e)},t.prototype.triggerHandler=function(e){if(this.isReward&&1===this.type){n.default.instance.isStageStart=!0;var t=e.owner;if("stand"===t.name||t.name.indexOf("Guard")>=0||t.name.indexOf("Obstacle")>=0){t.timer.frameOnce(1,this,function(){t.getComponent(Laya.PhysicsCollider)&&t.getComponent(Laya.PhysicsCollider).destroy(),t.getComponent(Laya.Rigidbody3D)&&t.getComponent(Laya.Rigidbody3D).destroy(),t.getComponent(o.default)&&t.getComponent(o.default).destroy(),t.getComponent(l.default)&&t.getComponent(l.default).destroy()});var a=0,i=t.transform.localScaleX/120,s=t.transform.localScaleY/120,r=t.transform.localScaleZ/120,c=(this.bullet.transform.position.x-t.transform.position.x)/120/n.default.instance.gameStage.transform.scale.x,d=(this.bullet.transform.position.y-t.transform.position.y)/120/n.default.instance.gameStage.transform.scale.y,u=(this.bullet.transform.position.z-t.transform.position.z)/120/n.default.instance.gameStage.transform.scale.z,h=5*Math.random(),m=5*Math.random(),f=5*Math.random();t.timer.frameLoop(1,t,function(){if(a++>60)return t.timer.clearAll(t),void t.destroy();t.transform.localScaleX-=i,t.transform.localScaleY-=s,t.transform.localScaleZ-=r,t.transform.localPositionX-=c,t.transform.localPositionY+=d,t.transform.localPositionZ-=u,t.transform.localRotationEulerX+=h,t.transform.localRotationEulerY+=m,t.transform.localRotationEulerZ+=f})}}},t.prototype.onUpdate=function(){this.lifetime--,this.lifetime<0&&this.recover(),"bullet"===this.bullet.name&&!this.flag_active&&this.bullet.transform.position.z<-1&&(this.flag_active=!0,this.refreshMaterial(),this.effect&&(this.effect.active=!0)),this.effect&&!this.rigidbody.isTrigger&&(this.effect.transform.localRotationEulerX=-this.bullet.transform.localRotationEulerX,this.effect.transform.localRotationEulerY=-this.bullet.transform.localRotationEulerY,this.effect.transform.localRotationEulerZ=-this.bullet.transform.localRotationEulerZ)},t.prototype.refreshMaterial=function(){this.isReward||(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,this.material.albedoColorA=1)},t.prototype.recover=function(){var e=this;this.isReward?Laya.timer.frameOnce(1,this,function(){e.bullet.destroy(),e.destroy()}):Laya.timer.frameOnce(1,this,function(){e.rigidbody.clearForces(),e.bullet.removeChildByName("effect"),e.bullet.removeSelf(),"bulletTrigger"===e.bullet.name?Laya.Pool.recover("bulletTrigger",e.bullet):Laya.Pool.recover("bullet",e.bullet)})},t}(Laya.Script3D);a.default=s},{"../Const":3,"../runtime/GameScene":11,"./Guard":7,"./Target":9}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../Const"),i=function(e){function t(){var t=e.call(this)||this;return t.moveTimes=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.boundingBox.clone();this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);var t=new Laya.PBRSpecularMaterial;if(Laya.Texture2D.load(n.StageTexUrl[0],Laya.Handler.create(this,function(e){t.albedoTexture=e})),t.specularColor=new Laya.Vector4(0,0,0,1),t.enableEmission=!0,t.emissionColor=new Laya.Vector4(.2,.2,.2,1),this.guard.meshRenderer.material=t,this.guard.name.search("move_x")>=0)this.MaxMoveTimes=120,this.moveStepY=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepX=2*this.guard.transform.localPositionY/this.MaxMoveTimes:this.moveStepX=2*this.guard.transform.localPositionX/this.MaxMoveTimes;else if(this.guard.name.search("move_y")>=0)this.MaxMoveTimes=120,this.moveStepX=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepY=2*this.guard.transform.localPositionX/this.MaxMoveTimes:this.moveStepY=2*this.guard.transform.localPositionY/this.MaxMoveTimes;else if(this.guard.name.search("move_")>=0){this.MaxMoveTimes=60;var a=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,i=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var o=a;a=i,i=o}this.guard.name.search("move_left")>=0?(this.moveStepX=-a,this.moveStepY=0):this.guard.name.search("move_right")>=0?(this.MaxMoveTimes=60,this.moveStepX=a,this.moveStepY=0):this.guard.name.search("move_up")>=0?(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=-i):this.guard.name.search("move_down")>=0&&(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=i)}},t.prototype.onUpdate=function(){this.guard.destroyed?this.destroy():this.guard.name.search("move")>=0?(this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes),this.flag_move=Math.floor(this.moveTimes/this.MaxMoveTimes%2)>0,this.flag_move?(this.guard.transform.localPositionX+=this.moveStepX,this.guard.transform.localPositionY+=this.moveStepY):(this.guard.transform.localPositionX-=this.moveStepX,this.guard.transform.localPositionY-=this.moveStepY)):this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)},t}(Laya.Script3D);a.default=i},{"../Const":3}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../utils/wx"),i=e("../utils/ws.js"),o=e("../utils/Ad"),l=e("../Global"),s=function(e){function t(){var a=e.call(this)||this;return a.shareTimestampMap={},a.lastShareTimestamp=0,console.log("Reward constructor()"),t.instance=a,a}return __extends(t,e),t.prototype.onAwake=function(){var e=this;console.log("Reward onAwake()"),Laya.Browser.onMiniGame&&n.default.onShow(function(t){var a=e.shareArgs;if(a&&a.length){var i=a[0]||{},o=i.pos,s=i.success,r=i.fail,c=i.complete;try{var d=Date.now();s||r?d-e.lastShareTimestamp>1e3*(l.default.config.share_delay||5)?(l.default.gameData.shareCount++,l.default.gameData.lastShareTimestamp=d,e.shareTimestampMap[o]=d,s&&s(t),c&&c(t)):(e.shareTimestampMap[o]=0,n.default.showModal({title:"提示",content:l.default.config.share_fail,cancelText:"知道了",confirmText:"重新发送",success:function(n){n.confirm?e.share.apply(e,a):(r&&r(t),c&&c(t))}})):(e.shareTimestampMap[o]=0,c&&c(t))}finally{e.lastShareTimestamp=0,e.shareArgs=null}}})},t.prototype.reward=function(e){var t=e.pos,a=e.query,n=e.success,i=e.fail,o=e.complete;this.isShareState(t)?this.share({pos:t,query:a,success:n,fail:i,complete:o}):this.video({pos:t,success:n,fail:i,complete:o})},t.prototype.share=function(e){var t=e.pos,a=e.query,n=e.success,o=e.fail,s=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),o&&o(),void(s&&s());if(!this.isOnline()||!this.allowShare(t))return console.log("今日视频已看完"),o&&o(),void(s&&s());var r=Date.now(),c=Number(this.shareTimestampMap[t]);if(c&&r-c<1e3*l.default.config.share_time)return console.log("请稍等一会再操作"),o&&o(),void(s&&s());(n||o)&&(this.shareTimestampMap[t]=r),this.lastShareTimestamp=Date.now(),this.shareArgs=arguments,i.default.share({pos:t,query:a})},t.prototype.video=function(e){var t=e.pos,a=e.success,n=e.fail,i=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),n&&n(),void(i&&i());o.posShowVideo(t,function(){console.log("今日视频已看完"),n&&n(),i&&i()},function(e){e&&e.isEnded||void 0===e?(l.default.gameData.videoCount++,l.default.gameData.lastVideoTimestamp=Date.now(),a&&a()):e&&!e.isEnded||n&&n(),i&&i()})},t.prototype.allowShare=function(e){var t=l.default.config[e+"_allow_share"];return"boolean"==typeof t?t:l.default.config.allow_share},t.prototype.allowVideo=function(e){var t=l.default.config[e+"_allow_video"];return"boolean"==typeof t?t:l.default.config.allow_video},t.prototype.isOnline=function(){return l.default.config.online},t.prototype.isShareFirst=function(e){var t=l.default.config[e+"_share_first"];return"boolean"==typeof t?t:l.default.config.share_first},t.prototype.getShareCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!l.default.gameData.lastShareTimestamp||l.default.gameData.lastShareTimestamp<t)&&(l.default.gameData.shareCount=0),l.default.gameData.shareCount},t.prototype.isOverShare=function(){return l.default.config.share_number&&l.default.config.share_number<=this.getShareCount()},t.prototype.getVideoCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!l.default.gameData.lastVideoTimestamp||l.default.gameData.lastVideoTimestamp<t)&&(l.default.gameData.videoCount=0),l.default.gameData.videoCount},t.prototype.isOverVideo=function(){return l.default.config.video_number&&l.default.config.video_number<=this.getVideoCount()},t.prototype.hasVideo=function(){return o.hasVideoAd()},t.prototype.isShareState=function(e){return!(!this.isOnline()||!this.allowShare(e))&&(!this.allowVideo(e)||!this.hasVideo()||(this.isShareFirst(e)?!this.isOverShare()||this.isOverVideo():this.isOverVideo()))},t}(Laya.Script);a.default=s},{"../Global":4,"../utils/Ad":13,"../utils/ws.js":16,"../utils/wx":17}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../Const"),i=e("../runtime/GameScene"),o=e("../component/Bullet"),l=function(e){function t(){var t=e.call(this)||this;return t.type=1,t.collisionWhiteList=["bullet","Obstacle"],t.piecesList=[],t.jumpCnt=0,t.isOnGround=!1,t}return __extends(t,e),t.prototype.onAwake=function(){var e=this;this.target=this.owner,this.setRigidbody(),Laya.timer.frameOnce(n.SetKinematicWaitTime,this,function(){i.default.instance.isStageStart||(e.rigidbody.isKinematic=!0)}),this.initPieces()},t.prototype.onCollisionEnter=function(e){this.collisionHandler(e)},t.prototype.onCollisionStay=function(e){this.collisionHandler(e)},t.prototype.onCollisionExit=function(e){this.collisionHandler(e)},t.prototype.collisionHandler=function(e){for(var t=this,a=e.other.owner,l=!1,s=0,r=this.collisionWhiteList;s<r.length;s++){var c=r[s];if(a.name.indexOf(c)>=0){l=!0;break}}if(2===this.type){if(this.jumpCnt>60){(u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)))>=n.GlassFallingBrokenVelocity&&this.broken()}if(l){var d=a.getComponent(Laya.Rigidbody3D).linearVelocity.clone(),u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)),h=Laya.Vector3.distance(d,new Laya.Vector3(0,0,0));(u>=n.GlassBrokenVelocity||h>=n.GlassBrokenVelocity)&&this.broken()}else"ground"!==a.name&&"bomb"!==a.name||this.broken()}else if(3===this.type&&this.target.parent)if(a.name.indexOf("bullet")>=0||a.name.indexOf("bomb")>=0)this.TNTBomb();else{var m=a.getComponent(Laya.Rigidbody3D),d=new Laya.Vector3(0,0,0);m&&(d=m.linearVelocity.clone()),Laya.Vector3.distance(d,this.rigidbody.linearVelocity)>=10&&this.TNTBomb()}if("stand"===a.name||a.name.indexOf("Guard")>=0)this.isOnGround||(i.default.instance.winCheckCnt=0);else if("ground"===a.name)this.isOnGround=!0,Laya.timer.frameOnce(60,this,function(){t.destroy(),t.target&&t.target.destroy()});else if("bullet"===a.name||"bulletTrigger"===a.name)this.bulletHit(a.getComponent(o.default));else if("bomb"===a.name){var f=new Laya.Vector3;Laya.Vector3.subtract(this.target.transform.position,a.transform.position,f),Laya.Vector3.normalize(f,f),Laya.Vector3.scale(f,20/a.transform.localScaleX,f),Laya.Vector3.add(this.rigidbody.linearVelocity,f,f),this.rigidbody.linearVelocity=f}this.jumpCnt=0},t.prototype.TNTBomb=function(){var e=this,t=this.sizeX/2*this.target.transform.localScaleX*1,a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(t));i.default.instance.scene3D.addChild(a),a.name="bomb";var n=a.addComponent(Laya.PhysicsCollider);n.colliderShape=new Laya.SphereColliderShape(t),n.isTrigger=!0,n.collisionGroup=3,n.canCollideWith=1,a.transform.position=this.target.transform.position.clone(),a.transform.scale=this.target.transform.scale.clone();var o=new Laya.UnlitMaterial;a.meshRenderer.material=o,o.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,o.albedoColor=new Laya.Vector4(1,.5,0,.2),this.target.removeSelf();var l=0,s=.4*a.transform.localScaleX,r=.4*a.transform.localScaleY,c=.4*a.transform.localScaleZ;a.timer.frameLoop(1,a,function(){if(l++>15)return a.timer.clearAll(a),a.destroy(),e.target&&e.target.destroy(),void e.destroy();a.transform.localScaleX+=s,a.transform.localScaleY+=r,a.transform.localScaleZ+=c})},t.prototype.bulletHit=function(e){e.isReward||3===e.type&&2!==this.type&&this.setType(2)},t.prototype.onUpdate=function(){this.target.destroyed?this.destroy():(this.rigidbody.isKinematic&&i.default.instance.isStageStart&&(this.rigidbody.isKinematic=!1),this.jumpCnt++,this.refreshRenderMode(),!this.isOnGround&&this.jumpCnt<=60&&(this.distance=Laya.Vector3.distance(this.target.transform.position,i.default.instance.gameStage.transform.position),this.distance<15&&(i.default.instance.winCheckCnt=0)),this.rigidbody.destroyed||0!=this.rigidbody.isActive||(console.log("Physics_engine_bug_fixing: Reset rigidbody."),this.refreshRigidbody()))},t.prototype.refreshRenderMode=function(){2===this.type?this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT:this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE},t.prototype.refreshRigidbody=function(){this.rigidbody&&(console.log("refresh rigidbody"),this.rigidbody.destroy(),this.setRigidbody())},t.prototype.setType=function(e){var t=this;this.type=e,this.material=this.target.meshRenderer.material,this.material||(this.material=new Laya.PBRSpecularMaterial,this.target.meshRenderer.material=this.material),1===this.type?(Laya.Texture2D.load(n.StageTexUrl[1],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)):2===this.type?(this.material.albedoTexture=null,this.material.albedoColor=new Laya.Vector4(.7,.7,1,.7),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.2,.2,.2,1)):3===this.type&&(Laya.Texture2D.load(n.StageTexUrl[2],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)),this.refreshRenderMode()},t.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.boundingBox.clone();if(this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z,this.rigidbody=this.target.addComponent(Laya.Rigidbody3D),this.target.name.search("Cube")>=0)this.rigidbody.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else if(this.target.name.search("Cylinder")>=0)this.rigidbody.colliderShape=new Laya.CylinderColliderShape(this.sizeX/2,this.sizeY);else{var t=new Laya.MeshColliderShape;t.mesh=this.target.meshFilter.sharedMesh,this.rigidbody.colliderShape=t}this.setPhysicsParam()},t.prototype.setPhysicsParam=function(){this.rigidbody.isKinematic=!1,1===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):2===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):3===this.type&&(this.rigidbody.mass=50,this.rigidbody.friction=100)},t.prototype.broken=function(){var e=this;this.piecesList.length>0&&this.effectPiecesBroken(),Laya.timer.frameOnce(2,this,function(){e.target.active=!1})},t.prototype.initPieces=function(){var e=this;Laya.Mesh.load(n.PieceResUrl,Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(t);a.active=!1,a.name="piece";var o=new Laya.PBRSpecularMaterial;o.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,o.albedoTexture=null,o.albedoColor=new Laya.Vector4(.7,.7,1,.7),o.specularColor=new Laya.Vector4(0,0,0,1),o.enableEmission=!0,o.emissionColor=new Laya.Vector4(.2,.2,.2,1),a.meshRenderer.material=o;var l=a.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=a.meshFilter.sharedMesh,l.colliderShape=s,l.collisionGroup=2,l.canCollideWith=1;for(var r=n.PiecesNum-Math.round(Math.random()),c=0;c<r;c++)e.piecesList.push(a.clone()),i.default.instance.scene3D.addChild(e.piecesList[c])}))},t.prototype.effectPiecesBroken=function(){var e=this,t=function(t){a.piecesList[t].active=!0;var i=1.5*(.5*Math.random()+.5)*a.sizeX*a.target.transform.localScaleX*n.StageInitScale.x,o=1.5*(.5*Math.random()+.5)*a.sizeY*a.target.transform.localScaleY*n.StageInitScale.y,l=1.5*(.5*Math.random()+.5)*a.sizeZ*a.target.transform.localScaleZ*n.StageInitScale.z;a.piecesList[t].transform.localScale=new Laya.Vector3(i,o,l),a.piecesList[t].transform.localRotationEulerX=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerY=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerZ=2*(Math.random()-.5)*90;var s=new Laya.Vector3;s.x=(Math.random()-.5)*n.StageInitScale.x/80,s.y=(Math.random()-.5)*n.StageInitScale.y/80,s.z=(Math.random()-.5)*n.StageInitScale.z/80,a.piecesList[t].transform.position=a.target.transform.position.clone(),Laya.Vector3.add(a.piecesList[t].transform.localPosition,s,a.piecesList[t].transform.localPosition),Laya.Vector3.scale(s,50,s),Laya.Vector3.add(s,a.rigidbody.linearVelocity,s),a.piecesList[t].getComponent(Laya.Rigidbody3D).linearVelocity=s.clone(),Laya.Tween.to(a.piecesList[t].transform.localScale,{x:i/2,y:o/2,z:l/2},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(a.piecesList[t].meshRenderer.material,{albedoColorA:0},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(a,function(){e.piecesList[+t].destroy()}))},a=this;for(var i in this.piecesList)t(i)},t}(Laya.Script3D);a.default=l},{"../Const":3,"../component/Bullet":6,"../runtime/GameScene":11}],10:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),l=e("../utils/ws.js"),s=e("../component/Reward"),r=e("./HomeView"),c=e("./GameScene"),d=function(e){function t(){var a=e.call(this)||this;return a.isReward=!1,a.unlockState=[],a.downFlag=!1,a.startIdx=0,a.selectedScaleAdd=.35,console.log("CannonSelect constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(i.URL_CannnonSelect,!1,e)},t.prototype.onOpened=function(e){console.log("CannonSelect onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.isClick=!1,this.selectType&&c.default.instance.isRewardCannon?!this.isReward&&c.default.instance.isRewardCannon&&(this.selectType=o.default.config.cannonRewardType):this.selectType=o.default.gameData.cannonType;for(var t=1;t<=i.CannonSelectIconList.length-2;t++)this.unlockState[t]=!1,o.default.gameData.stageIndex>i.CannonSelectTextList[i.CannonSelectIconList[t].index].unlockLvl&&(this.unlockState[t]=!0),i.CannonSelectIconList[t].index===this.selectType&&(this.list_Icon.selectedIndex=t);if(this.updateScroll(),this.updateUI(),c.default.instance&&2===c.default.instance.stageIdx&&1===c.default.instance.missionIdx&&4===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=5,this.tutorial_slide.visible=!0;var a=this.tutorial_slide.getChildByName("finger");a.timer.frameLoop(1,a,function(){a.right+=3,a.alpha=1-(a.right-80)/210,a.right>=280&&(a.right=50,a.alpha=1)})}},t.prototype.onAwake=function(){this.initCannonList(),this.initScene3D(),this.scene3D.input.multiTouchEnabled=!1},t.prototype.onEnable=function(){this.bindButtons()},t.prototype.initCannonList=function(){var e=this;this.list_Icon.renderHandler=Laya.Handler.create(this,function(t,a){var n=e.list_Icon.array[a];if(n&&-1!==n.index){t.visible=!0;var o=t.getChildByName("iconBg");o&&(o.skin=i.CannonSelectIconBgUrl);var l=t.getChildByName("iconImage");l&&(l.skin=n.icon)}else t.visible=!1},[],!1),this.list_Icon.hScrollBarSkin="",this.list_Icon.array=i.CannonSelectIconList,this.list_Icon.refresh()},t.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=new Laya.Vector3(0,0,0),this.camera.transform.localRotationEuler=new Laya.Vector3(-30,0,0),this.camera.clearColor=new Laya.Vector4(239/255,169/255,171/255,1),this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},t.prototype.newCannon=function(){var e=this;this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[i.CannonSelectIconList[this.list_Icon.selectedIndex].index],Laya.Handler.create(this,function(t){e.cannon&&e.cannon.destroy(),e.scene3D.removeChildByName("cannon"),e.cannon=t.clone(),e.cannon.name="cannon",e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=new Laya.Vector3(0,-.23,-.5),e.cannon.transform.localRotationEuler=new Laya.Vector3(0,-135,0),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.box_scene3D.timer.frameLoop(1,e,e.cannonAniLoop)}))},t.prototype.refreshText=function(){var e;if(!((e=this.list_Icon.selectedIndex)<1||e>i.CannonSelectIconList.length-2)){var t=i.CannonSelectIconList[e].index;this.label_name.changeText(i.CannonSelectTextList[t].name),this.label_feature.changeText(i.CannonSelectTextList[t].feature),this.unlockState[e]?(this.label_unlockMsg.changeText("已解锁"),this.isReward||this.selectType!==t?this.btn_select.gray=!1:this.btn_select.gray=!0,this.btn_select.visible=!0,this.btn_unlock.visible=!1,this.btn_try.visible=!1):(i.CannonSelectTextList[t].unlockLvl>=999?(this.label_unlockMsg.changeText("敬请期待"),this.btn_try.visible=!1):(this.label_unlockMsg.changeText("完成关卡 "+(o.default.gameData.stageIndex-1)+"/"+i.CannonSelectTextList[t].unlockLvl+" 解锁"),this.btn_try.visible=!0),this.btn_select.visible=!1,this.btn_unlock.visible=!0,this.isReward&&this.selectType===t?(this.btn_try.gray=!0,this.label_try.changeText("正在试用")):(this.btn_try.gray=!1,this.label_try.changeText("免费试用")))}},t.prototype.refreshIcon=function(){var e,t,a,n=this.list_Icon.selectedIndex;if(!(n<1||n>i.CannonSelectIconList.length-2)){this.arrowLeft.visible=!0,this.arrowRight.visible=!0;for(var o=0;o<=2;o++)if(n+o-1<=0)this.arrowLeft.visible=!1;else if(n+o-1>=i.CannonSelectIconList.length-1)this.arrowRight.visible=!1;else if(!this.downFlag||this.list_Icon.startIndex!==this.startIdx){var l=i.CannonSelectIconList[n+o-1].index;(e=this.list_Icon.cells[o].getChildByName("iconImage"))&&!this.downFlag&&(1===o?(e.scaleX=1+this.selectedScaleAdd,e.scaleY=1+this.selectedScaleAdd):(e.scaleX=1,e.scaleY=1)),(t=this.list_Icon.cells[o].getChildByName("iconBg"))&&(l===this.selectType?t.gray=!1:t.gray=!0,this.downFlag||(1===o?(t.scaleX=1+this.selectedScaleAdd,t.scaleY=1+this.selectedScaleAdd):(t.scaleX=1,t.scaleY=1))),(a=this.list_Icon.cells[o].getChildByName("lock"))&&(a.visible=!0,this.unlockState[n+o-1]&&a&&(a.visible=!1),this.isReward&&this.selectType===l&&a&&(a.visible=!1),this.downFlag||(1===o?(a.scaleX=1+this.selectedScaleAdd,a.scaleY=1+this.selectedScaleAdd):(a.scaleX=1,a.scaleY=1)))}}},t.prototype.bindButtons=function(){var e=this;this.list_Icon.on(Laya.Event.MOUSE_DOWN,this,function(){c.default.instance&&2===c.default.instance.stageIdx&&1===c.default.instance.missionIdx&&5===o.default.gameData.tutorialStep&&(console.log("newplayer_5"),l.default.traceEvent("newplayer_5")),e.downMouseX=e.mouseX,e.downFlag=!0,e.startIdx=e.list_Icon.startIndex}),this.list_Icon.on(Laya.Event.MOUSE_MOVE,this,function(){if(e.downFlag)if(e.downMouseX-e.mouseX>0&&e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2)e.downMouseX=e.mouseX,e.arrowRight.visible=!1;else if(e.downMouseX-e.mouseX<0&&e.list_Icon.selectedIndex<=1)e.downMouseX=e.mouseX,e.arrowLeft.visible=!1;else if(e.downMouseX-e.mouseX>0){var t=e.list_Icon.getCell(e.list_Icon.selectedIndex),a=e.list_Icon.getCell(e.list_Icon.selectedIndex+1);if(t&&a)for(l=0;l<t.numChildren;l++){var n=t.getChildAt(l),o=a.getChildAt(l);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowRight.visible=!0,e.downMouseX-e.mouseX>115&&(e.list_Icon.selectedIndex++,e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.downMouseX=e.mouseX-115,e.updateUI(),e.tutorial_slide.visible&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon(),e.openTutorial()))}else if(e.downMouseX-e.mouseX<0){var t=e.list_Icon.getCell(e.list_Icon.selectedIndex),a=e.list_Icon.getCell(e.list_Icon.selectedIndex-1);if(t&&a)for(var l=0;l<t.numChildren;l++){var n=t.getChildAt(l),o=a.getChildAt(l);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowLeft.visible=!0,e.downMouseX-e.mouseX<-115&&(e.list_Icon.selectedIndex--,e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.downMouseX=e.mouseX+115,e.updateUI())}}),this.list_Icon.on(Laya.Event.MOUSE_UP,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.list_Icon.on(Laya.Event.MOUSE_OUT,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.arrowLeft.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex--,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.arrowRight.visible=!0}),this.arrowRight.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex++,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.arrowLeft.visible=!0,e.tutorial_slide.visible&&e.openTutorial()}),this.btn_select.on(Laya.Event.CLICK,this,function(){(e.isReward||o.default.gameData.cannonType!==i.CannonSelectIconList[e.list_Icon.selectedIndex].index)&&(e.isClick=!0,e.btn_select.gray=!0,e.isReward=!1,e.selectType=i.CannonSelectIconList[e.list_Icon.selectedIndex].index,o.default.gameData.cannonType=e.selectType,e.refreshIcon())}),this.btn_try.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.revive&&(s.default.instance.isOverVideo()?s.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}}):(e.mouseEnabled=!1,s.default.instance.video({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()},fail:function(){s.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.try_cannon&&s.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})):e.onClick_try()}),this.btn_back.on(Laya.Event.CLICK,this,this.onClick_back)},t.prototype.onClick_back=function(){this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.mouseEnabled=!1,this.visible=!1,this.isClick&&c.default.instance.cannonType!==this.selectType&&(this.isReward&&(c.default.instance.isRewardCannon=!0),c.default.instance.setCannon(this.selectType)),c.default.instance&&c.default.instance.state===i.GameState.PAUSE?c.default.openInstance():r.default.openInstance()},t.prototype.onClick_try=function(){this.isReward&&this.selectType===i.CannonSelectIconList[this.list_Icon.selectedIndex].index||(this.isClick=!0,this.isReward=!0,this.selectType=i.CannonSelectIconList[this.list_Icon.selectedIndex].index,this.btn_try.gray=!0,this.label_try.changeText("正在试用"),this.refreshIcon())},t.prototype.openTutorial=function(){var e=this;this.tutorial_slide.visible=!1,Laya.timer.clearAll(this.tutorial_slide.getChildByName("finger")),this.tutorial_try.visible=!0;var t=this.tutorial_try.getChildByName("finger");t.timer.frameLoop(1,t,function(){t.bottom+=.5,t.bottom>=20&&(t.bottom=10)}),this.tutorial_try.getChildByName("inputArea").on(Laya.Event.CLICK,this,function(){console.log("newplayer_6"),l.default.traceEvent("newplayer_6"),e.onClick_try(),e.tutorial_try.visible=!1,e.tutorial_try.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_try.getChildByName("finger")),e.tutorial_back.visible=!0;var t=e.tutorial_back.getChildByName("finger");t.timer.frameLoop(1,t,function(){t.top-=.5,t.top<=100&&(t.top=120)}),e.tutorial_back.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_7"),l.default.traceEvent("newplayer_7"),e.onClick_back(),e.tutorial_back.visible=!1,e.tutorial_back.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_back.getChildByName("finger"))})})},t.prototype.updateScroll=function(){this.list_Icon.scrollBar.stopScroll(),this.list_Icon.scrollTo(this.list_Icon.selectedIndex-1)},t.prototype.updateUI=function(){this.refreshIcon(),this.refreshText(),this.newCannon()},t.prototype.cannonAniLoop=function(){this.cannon&&(this.cannon.transform.localRotationEulerY+=1)},t}(n.ui.cannonSelect.CannonSelectUI);a.default=d},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../component/Reward":8,"../utils/ws.js":16,"./GameScene":11,"./HomeView":12}],11:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),l=e("../utils/Navigator"),s=e("../utils/wx"),r=e("../utils/ws.js"),c=e("../utils/Ad"),d=e("../component/Bullet"),u=e("../component/Target"),h=e("../component/Guard"),m=e("../component/Reward"),f=e("./HomeView"),g=e("./CannonSelect"),y=e("../StageConfig"),p=function(e){function t(){var a=e.call(this)||this;return a.bgIdx=0,a.missionRawIdxList=[0,0,0,0,0],a.MaxBulletNum=100,a.currBulletNum=0,a.isStageStart=!1,a.winCheckCnt=0,a.flag_missionWin=!1,a.treasureHitCnt=0,a.treasereMaxHitCnt=10,a.treasureFrameCnt=0,a.treasereMaxFrameCnt=90,a.treasureHitState=0,a.cannonType=1,a.turretInitPos=i.CannonInitPos.clone(),a.isRecoil=!1,a.MaxRecoilTime=8,a.isRewardCannon=!1,a.bulletType=1,a.bulletDirection=new Laya.Vector3,a.isRewardBullet=!1,a.mousePoint=new Laya.Vector2,a.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),a.hitResult=new Laya.HitResult,a.state=0,console.log("GameScene constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(i.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){if(console.log("GameScene onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.state===i.GameState.START){this.isRewardCannon||this.cannonType===o.default.gameData.cannonType||this.setCannon(o.default.gameData.cannonType),this.showUI(),this.stageIdx=o.default.gameData.stageIndex,this.missionIdx=1;for(var t=1;t<=5;t++)this.missionRawIdxList[t-1]=0,this["level"+t].sizeGrid="0, 96, 0, 0";this.newStage(),Laya.Browser.onMiniGame&&!this.navWin&&(this.navWin=new l.default(r.default),this.box_winIcon.visible=!0,this.navWin.createHomeIcons(this.box_winIcon,this.box_winIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.navRevive=new l.default(r.default),this.box_reviveIcon.visible=!0,this.navRevive.createHomeIcons(this.box_reviveIcon,this.box_reviveIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]))}else this.state===i.GameState.PAUSE&&(this.state=i.GameState.START);f.default.instance.isTest?this.box_test.visible=!0:this.box_test.visible=!1},t.prototype.onAwake=function(){this.initScene3D(),this.bgIdx=0,this.newBackground(),this.isRewardCannon=!1,this.cannonType=1,this.newCannon(),this.newBallBox(),this.scene3D.input.multiTouchEnabled=!1,this.scene3D.physicsSimulation.fixedTimeStep=.5/60},t.prototype.onEnable=function(){this.bindButtons(),this.btnAniFrame=0,Laya.timer.frameLoop(1,this,this.rewardBtnAni)},t.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=i.CameraInitPos.clone(),this.camera.transform.localRotationEuler=i.CameraInitRotEuler.clone(),this.camera.clearColor=null;var e=Laya.Browser.width/Laya.Browser.height;if(e<.5625){var t=2*Math.atan(.5625*Math.tan(.5235987));this.camera.fieldOfView=2*Math.atan(Math.tan(t/2)/e)*57.29578}this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},t.prototype.newBackground=function(){var e=this;this.background&&(Laya.timer.clear(this,this.bgMoving),this.background.destroy()),Laya.Sprite3D.load(i.BgResUrl[this.bgIdx],Laya.Handler.create(this,function(t){e.background=e.scene3D.addChild(t),e.background.transform.localPosition=i.StageInitPos.clone(),e.background.transform.localRotationEuler=i.StageInitRot.clone(),e.background.transform.localScale=i.StageInitScale.clone();var a=e.background.getComponent(Laya.Animator);if(a&&a.destroy(),e.background&&0===e.bgIdx){e.cloud0=e.background.getChildByName("Scenes_02").getChildByName("cloud01"),e.cloud1=e.background.getChildByName("Scenes_02").getChildByName("cloud03");var n=e.background.getChildByName("Scenes_02").getChildByName("Plane").getChildByName("Plane_0");n.name="ground";n.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.StaticPlaneColliderShape(new Laya.Vector3(0,1,0),0),e.background.frameLoop(1,e,e.bgMoving)}}))},t.prototype.newBallBox=function(){var e=this;Laya.Sprite3D.load(i.CannonBallBoxUrl,Laya.Handler.create(this,function(t){e.ballBox=e.scene3D.addChild(t),e.ballBox.name="ball_box",e.ballBox.transform.localPosition=i.CannonBallInitPos.clone(),e.ballBox.transform.localRotationEuler=i.CannonInitRot.clone(),e.ballBox.transform.localScale=i.CannonBallInitScale.clone();for(n=1;n<=10;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT);for(n=1;n<=5;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("chest_wooden_"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE);for(var a=e.scene3D.addChild(e.ballBox.clone()),n=1;n<=10;n++)if(n<=e.MaxBulletNum){var o=a.getChildByName("CannonBall"+n+"_0");o&&o.destroy()}a.transform.localPositionX=.11,a.transform.localPositionY-=.008,a.transform.localPositionZ+=.012,a.transform.localRotationEulerY=150}))},t.prototype.setCannon=function(e){this.cannonType=e,this.bulletType=this.cannonType,this.newCannon()},t.prototype.newCannon=function(){var e=this;this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[this.cannonType],Laya.Handler.create(this,function(t){e.cannon&&e.cannon.destroy(),e.cannon=t.clone(),e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=i.CannonInitPos.clone(),e.cannon.transform.localRotationEuler=i.CannonInitRot.clone(),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.turret=e.cannon.getChildByName("Turret_0"),e.turretInitPos=e.turret.transform.position.clone(),e.turretInitRot=e.turret.transform.localRotationEuler.clone()}))},t.prototype.showUI=function(){this.box_UI.visible=!0},t.prototype.hideUI=function(){this.box_UI.visible=!1,this.box_win.visible=!1,this.hideReviveUI()},t.prototype.hideReviveUI=function(){c.posHideBanner(i.BannerPos.ReviveDialog),this.box_revive.visible=!1},t.prototype.bindButtons=function(){var e=this;this.btn_test_next.on(Laya.Event.CLICK,this,function(){f.default.instance.testStageIdx++,e.input_test_lvl.text&&(f.default.instance.testStageIdx=parseInt(e.input_test_lvl.text),e.input_test_lvl.text=""),e.newStage()}),this.btn_test_restart.on(Laya.Event.CLICK,this,function(){e.newStage()}),this.onClick_cannonSelect=function(){e.state=i.GameState.PAUSE,e.mouseEnabled=!1,e.visible=!1,g.default.openInstance()},this.onClick_rewardBullet=function(){e.isRewardBullet=!0,e.bulletType=o.default.config.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(i.cannonEffectUrl[1],Laya.Handler.create(e,function(t){e.scene3D.addChild(t).name="cannon_effect"}))},this.onClick_rewardCannon=function(){e.isRewardCannon=!0,e.setCannon(o.default.config.cannonRewardType)},this.btn_back.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!0}),this.btn_backReturn.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1}),this.btn_backExit.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1,e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.visible=!1,e.mouseEnabled=!1,e.turret&&e.cannon&&!e.cannon.destroyed&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1),e.clearStageTimer(),f.default.openInstance()}),this.btn_cannonOpen.on(Laya.Event.CLICK,this,function(){e.onClick_cannonSelect()}),this.btn_rewardBullet.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(console.log("reward bullet onclick"),1==o.default.config.try_ball&&(m.default.instance.isOverVideo()?m.default.instance.share({pos:i.RewardPos.Bullet,success:function(){console.log("reward bullet share onclick"),e.onClick_rewardBullet()},complete:function(){}}):(e.mouseEnabled=!1,m.default.instance.video({pos:i.RewardPos.Bullet,success:function(){console.log("reward bullet video onclick"),e.onClick_rewardBullet()},fail:function(){m.default.instance.share({pos:i.RewardPos.Bullet,success:function(){console.log("reward bullet share onclick"),e.onClick_rewardBullet()},complete:function(){}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.try_ball&&m.default.instance.share({pos:i.RewardPos.Bullet,success:function(){console.log("reward bullet share onclick"),e.onClick_rewardBullet()},complete:function(){}})):e.onClick_rewardBullet()}),this.btn_rewardCannon.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.try_cannon&&(m.default.instance.isOverVideo()?m.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_rewardCannon()},complete:function(){}}):(e.mouseEnabled=!1,m.default.instance.video({pos:i.RewardPos.Cannon,success:function(){e.onClick_rewardCannon()},fail:function(){m.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_rewardCannon()},complete:function(){}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.try_cannon&&m.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_rewardCannon()},complete:function(){}})):e.onClick_rewardCannon()}),this.btn_win_next.on(Laya.Event.CLICK,this,function(){e.nextStage()}),this.btn_revive.on(Laya.Event.MOUSE_DOWN,this,function(){if(Laya.Browser.onMiniGame)1==o.default.config.revive&&(m.default.instance.isOverVideo()?m.default.instance.share({pos:i.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},complete:function(){}}):(e.mouseEnabled=!1,m.default.instance.video({pos:i.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},fail:function(){m.default.instance.share({pos:i.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},complete:function(){}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.revive&&m.default.instance.share({pos:i.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},complete:function(){}});else{if(e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.ballBox)for(var t=1;t<=3;t++)t<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+t+"_0").meshRenderer.material.albedoColorA=1);e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)}}),this.btn_retry.on(Laya.Event.CLICK,this,function(){e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.turret&&e.cannon&&!e.cannon.destroyed&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1),e.clearStageTimer(),e.visible=!1,e.mouseEnabled=!1,f.default.openInstance()})},t.prototype.rewardBtnAni=function(){this.btnAniFrame++,this.btnAniFrame<=60?(this.btn_rewardCannon.scaleX+=.00625,this.btn_rewardCannon.scaleY+=.00625,this.btn_rewardBullet.scaleX+=.00625,this.btn_rewardBullet.scaleY+=.00625):this.btnAniFrame<=120?(this.btn_rewardCannon.scaleX-=.00625,this.btn_rewardCannon.scaleY-=.00625,this.btn_rewardBullet.scaleX-=.00625,this.btn_rewardBullet.scaleY-=.00625):(this.btnAniFrame=1,this.btn_rewardCannon.scaleX=1.5,this.btn_rewardCannon.scaleY=1.5,this.btn_rewardBullet.scaleX=1.5,this.btn_rewardBullet.scaleY=1.5)},t.prototype.cleanStage=function(){this.gameStage&&(this.gameStage.destroyChildren(),this.gameStage.destroy(),this.clearStageTimer());for(var e=0;e<this.scene3D.numChildren;e++){var t=this.scene3D.getChildAt(e);t&&"bullet"==t.name&&(t.getComponent(d.default)?t.getComponent(d.default).recover():t.destroy())}},t.prototype.clearStageTimer=function(){Laya.timer.clear(this,this.stageLooping),Laya.timer.clear(this,this.stageFailCountDown),Laya.timer.clear(this,this.nextStage),this.box_countdown.visible=!1},t.prototype.newStage=function(){var e=this;if(!(this.missionIdx<1||this.missionIdx>6)){if(this.cleanStage(),this.box_win.visible=!1,this.missionWin.visible=!1,this.missionIdx>=1&&this.missionIdx<=5&&(this["level"+this.missionIdx].sizeGrid="0,64,0,0"),this.isRewardBullet=!1,this.scene3D.getChildByName("cannon_effect")&&this.scene3D.getChildByName("cannon_effect").destroy(),this.isRevive=!1,this.currBulletNum=0,this.winCheckCnt=0,this.flag_missionWin=!1,this.isStageStart=!1,this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime,this.bulletType=this.cannonType,this.cannon&&!this.cannon.destroyed&&this.turret&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone()),f.default.instance.isTest)this.rawIdx=f.default.instance.testStageIdx,this.MaxBulletNum=100,this.label_ballNum.changeText("x"+this.MaxBulletNum),this.label_test_lvl.changeText("关卡："+f.default.instance.testStageIdx);else if(this.missionIdx>=1&&this.missionIdx<=5){var t=y.Stage[f.default.instance.systemName][this.stageIdx>i.StageNum?i.StageNum:this.stageIdx][this.missionIdx];this.rawIdx=this.missionRawIdxList[0];for(var a=0;a<20&&this.missionRawIdxList.indexOf(this.rawIdx)>=0;)this.rawIdx=Math.round(Math.random()*(t.max-t.min))+t.min,a++;if(this.missionRawIdxList[this.missionIdx-1]=this.rawIdx,this.MaxBulletNum=t.ball_add+y.StageRaw[this.rawIdx].ball_num,this.label_ballNum.changeText("x"+this.MaxBulletNum),console.log("stage: "+this.stageIdx+"\tmission: "+this.missionIdx+"\traw stage index: "+this.rawIdx),console.log("max ball num: "+this.MaxBulletNum),this.ballBox)for(n=1;n<=10;n++)n<=this.MaxBulletNum?this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1:this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=0}else if(this.MaxBulletNum=999,this.label_ballNum.changeText("无限"),this.ballBox)for(var n=1;n<=10;n++)this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1;var l;l=this.missionIdx>=1&&this.missionIdx<=5?i.StageResUrl+this.rawIdx+".lh":i.treasureUrl,Laya.Sprite3D.load(l,Laya.Handler.create(this,function(t){console.log("load_stage"),r.default.traceEvent("load_stage"),e.scene3D.getChildByName("gameStage")&&e.scene3D.getChildByName("gameStage").destroy(),Laya.timer.frameOnce(15,e,function(){e.gameStage=e.scene3D.addChild(t.clone()),e.gameStage.name="gameStage",e.label_level.changeText(""+e.stageIdx),e.gameStage.transform.localPosition=i.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=i.StageInitRot.clone(),e.gameStage.transform.localScale=i.StageInitScale.clone();var a=e.gameStage.getComponent(Laya.Animator);if(a&&a.destroy(),e.missionIdx>=1&&e.missionIdx<=5)for(var n,l=0;l<e.gameStage.numChildren;l++)if(n=e.gameStage.getChildAt(l),n.meshRenderer.castShadow=!1,n.name.search("Obstacle")>=0){var s=n.addComponent(u.default);n.name.search("Glass")>=0?s.setType(2):n.name.search("TNT")>=0?s.setType(3):s.setType(1)}else if(n.name.search("Cube")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),d=n.meshFilter.sharedMesh.boundingBox.clone(),m=d.max.x-d.min.x,f=d.max.y-d.min.y,g=d.max.z-d.min.z;c.colliderShape=new Laya.BoxColliderShape(m,f,g),Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,n.meshRenderer.material=t}))}else if(n.name.search("Cylinder")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),y=new Laya.MeshColliderShape;y.mesh=n.meshFilter.sharedMesh,c.colliderShape=y,Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,n.meshRenderer.material=t}))}else if(n.name.search("Guard")>=0)n.addComponent(h.default);else n&&n.destroy();else e.gameStage.name="treasure",e.gameStage.transform.localPositionZ+=.3,e.treasureHitCnt=0,e.treasureFrameCnt=0,e.treasureHitState=0;if(e.gameStage.frameLoop(1,e,e.stageLooping),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),1===e.stageIdx){if(1===e.missionIdx&&0===o.default.gameData.tutorialStep)o.default.gameData.tutorialStep=1,e.tutorial_shoot.visible=!0,e.tutorial_shoot.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_1"),r.default.traceEvent("newplayer_1"),e.onClick(),e.tutorial_shoot.visible=!1,e.tutorial_shoot.getChildByName("inputArea").offAll()});else if(2===e.missionIdx&&1===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=2,e.btn_rewardBullet.visible=!0,e.tutorial_bulletTry.visible=!0;(p=e.tutorial_bulletTry.getChildByName("finger")).timer.frameLoop(1,p,function(){p.centerY-=1,p.centerY<=450&&(p.centerY=480)}),e.tutorial_bulletTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_2"),r.default.traceEvent("newplayer_2"),e.onClick_rewardBullet(),e.tutorial_bulletTry.visible=!1,Laya.timer.clearAll(e.tutorial_bulletTry.getChildByName("finger")),e.tutorial_bulletTry.getChildByName("inputArea").offAll()})}else if(4===e.missionIdx&&2===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=3,e.btn_rewardCannon.visible=!0,e.tutorial_cannonTry.visible=!0;(p=e.tutorial_cannonTry.getChildByName("finger")).timer.frameLoop(1,p,function(){p.centerY-=1,p.centerY<=450&&(p.centerY=480)}),e.tutorial_cannonTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_3"),r.default.traceEvent("newplayer_3"),e.onClick_rewardCannon(),e.tutorial_cannonTry.visible=!1,Laya.timer.clearAll(e.tutorial_cannonTry.getChildByName("finger")),e.tutorial_cannonTry.getChildByName("inputArea").offAll()})}}else if(2===e.stageIdx&&1===e.missionIdx&&3===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=4,e.btn_cannonOpen.visible=!0,e.tutorial_cannonSelect.visible=!0;var p=e.tutorial_cannonSelect.getChildByName("finger");p.timer.frameLoop(1,p,function(){p.bottom+=.5,p.bottom>=20&&(p.bottom=5)}),e.tutorial_cannonSelect.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_4"),r.default.traceEvent("newplayer_4"),e.onClick_cannonSelect(),e.tutorial_cannonSelect.visible=!1,Laya.timer.clearAll(e.tutorial_cannonSelect.getChildByName("finger")),e.tutorial_cannonSelect.getChildByName("inputArea").offAll()})}})}))}},t.prototype.stageLooping=function(){f.default.instance.isTest?this.testWinCheck():this.missionIdx>=1&&this.missionIdx<=5?this.winCheck():this.winCheck_treasure(),this.isRecoil&&this.cannon&&(this.recoilTime<this.MaxRecoilTime?(this.recoilTime<this.MaxRecoilTime/4?(this.cannon.transform.localPositionX+=.01*this.bulletDirection.x,this.cannon.transform.localPositionY+=.01*this.bulletDirection.y,this.cannon.transform.localPositionZ+=.01*this.bulletDirection.z):(this.cannon.transform.localPositionX-=.006*this.bulletDirection.x,this.cannon.transform.localPositionY-=.006*this.bulletDirection.y,this.cannon.transform.localPositionZ-=.006*this.bulletDirection.z),this.recoilTime++):(this.cannon.transform.position=i.CannonInitPos.clone(),this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime))},t.prototype.testWinCheck=function(){this.winCheckCnt++>=i.MaxWinCheckTime&&(console.log("player win"),this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.missionWin.visible=!0)},t.prototype.winCheck=function(){var e=this;if(this.winCheckCnt++>=i.MaxWinCheckTime){console.log("player win"),this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this["level"+this.missionIdx].sizeGrid="0,32,0,0";var t=this.currBulletNum-this.MaxBulletNum+4;t=(t=t<y.StageRaw[this.rawIdx].ball_num?0:t)>4?4:t,this.missionWin.skin="res/ui/game/grade_"+t+"_CN.png",this.missionWin.visible=!0;var a=0;this.missionWin.centerY=30,this.missionWin.scaleX=1.5,this.missionWin.scaleY=1.5,this.missionWin.timer.frameLoop(1,this.missionWin,function(){++a<=13?(e.missionWin.scaleX+=.15,e.missionWin.scaleY+=.15,e.missionWin.centerY-=3):a<=40?(e.missionWin.scaleX-=.07,e.missionWin.scaleY-=.07,e.missionWin.centerY-=10):Laya.timer.clearAll(e.missionWin)}),Laya.timer.frameOnce(90,this,this.nextStage)}},t.prototype.winCheck_treasure=function(){var e=this;if(this.treasureFrameCnt++,this.treasureFrameCnt>=this.treasereMaxFrameCnt&&this.treasureHitCnt>=this.treasereMaxHitCnt)this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),Laya.timer.clearAll(this.gameStage),Laya.timer.frameOnce(1,this.gameStage,function(){var t=!1;Laya.timer.frameLoop(1,e.gameStage,function(){t?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03),!t&&e.gameStage.transform.localRotationEulerZ>12?t=!0:t&&e.gameStage.transform.localRotationEulerZ<-12&&(t=!1)}),Laya.timer.frameOnce(40,e.gameStage,function(){e.gameStage.transform.localRotationEulerZ=0,e.gameStage.transform.localPositionX=0,Laya.timer.clearAll(e.gameStage);var t=0,a=e.gameStage.getChildByName("top");e.gameStage.getChildByName("bottom");e.gameStage.getChildByName("lock").transform.localRotationEulerX-=45,Laya.timer.frameLoop(1,e.gameStage,function(){if(t++,a.transform.localRotationEulerX>-100&&(a.transform.localRotationEulerX-=5),t<=20)e.gameStage.transform.localPositionY-=.005;else if(t<=60){t<=25?e.gameStage.transform.localPositionY+=.2:t<=35&&(e.gameStage.transform.localPositionY-=.1);for(var n=1;n<=9;n++){var o=e.gameStage.getChildByName("currency_"+n);o&&(t<=25?o.transform.localPositionY+=.003:t<=35?o.transform.localPositionY+=.004:t<=40?o.transform.localPositionY-=.001:t<=45?o.transform.localPositionY-=.002:t<=60&&(o.transform.localPositionY-=.003),o.transform.localPositionX+=.001*i.treasureAngleX[n],o.transform.localPositionZ+=-.002*i.treasureAngleZ[n],o.transform.localRotationEulerX+=30*i.treasureAngleX[n],o.transform.localRotationEulerZ+=30*i.treasureAngleZ[n])}}else Laya.timer.clearAll(e.gameStage),Laya.timer.frameOnce(90,e,e.nextStage)})})});else if(1===this.treasureHitState){this.treasureHitState=2;var t=0;Laya.timer.frameLoop(1,this.gameStage,function(){++t<=2?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):t<=6?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):t<=8?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):(e.treasureHitState=0,Laya.timer.clearAll(e.gameStage))})}},t.prototype.restart=function(){this.newStage()},t.prototype.nextStage=function(){Laya.timer.clearAll(this.missionWin),this.missionIdx++,this.missionIdx>5+(o.default.config.hasTreasure?1:0)?this.passStage():this.newStage()},t.prototype.passStage=function(){console.log("pass_stage"+this.stageIdx),r.default.traceEvent("pass_stage"+this.stageIdx);for(t=0;t<this.scene3D.numChildren;t++){var e=this.scene3D.getChildAt(t);"bullet"!==e.name&&"bulletTrigger"!==e.name||e.destroy()}this.missionWin.visible=!1,this.label_lvlPass.changeText(""+this.stageIdx),this.box_win.visible=!0,this.navWin&&this.navWin.loadHomeIconInfoList(),this.stageIdx++,o.default.gameData.stageIndex=this.stageIdx,this.missionIdx=0;for(var t=1;t<=5;t++)this.missionRawIdxList[t-1]=0,this["level"+t].sizeGrid="0, 96, 0, 0";this.isRewardCannon&&(this.setCannon(o.default.gameData.cannonType),this.isRewardCannon=!1),g.default.instance&&(g.default.instance.isReward=!1)},t.prototype.stageFailCountDown=function(){this.countdown++,this.countdown>=240&&(this.clearStageTimer(),this.box_countdown.visible=!1,this.btn_retry.bottom=150,o.default.config.online||(this.btn_retry.bottom=260),Laya.Browser.onMiniGame&&r.default.isIPhoneX()&&(this.btn_retry.bottom+=o.default.config.distance_iphonex||0),this.box_revive.visible=!0,this.navRevive&&this.navRevive.loadHomeIconInfoList(),this.showBanner()),this.label_failTimer.changeText(""+Math.floor(4-this.countdown/60%4)),this.failCircle.scaleX+=.015,this.failCircle.scaleY+=.015},t.prototype.showBanner=function(){var e=this;!o.default.config.deny_banner&&Math.random()<=o.default.config.banner_delay_ratio?Laya.timer.frameOnce(60*o.default.config.banner_delay,null,function(){e.btn_retry.bottom=260,Laya.Browser.onMiniGame&&r.default.isIPhoneX()&&(e.btn_retry.bottom+=o.default.config.distance_iphonex||0),c.posShowBanner(i.BannerPos.ReviveDialog)}):(this.btn_retry.bottom=260,Laya.Browser.onMiniGame&&r.default.isIPhoneX()&&(this.btn_retry.bottom+=o.default.config.distance_iphonex||0),c.posShowBanner(i.BannerPos.ReviveDialog))},t.prototype.onClick=function(){if(this.gameStage&&this.cannon){if(this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30,1,1))Laya.Vector3.subtract(this.hitResult.point,this.turretInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,this.turretInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}var a=this.bulletDirection.z<0;Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.physicsStartCheck(),this.createBullet(),this.turret&&this.cannon&&!this.cannon.destroyed&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone(),a&&(-1===this.cannon.name.indexOf("Anti")?this.turret.transform.localRotationEulerX-=90*this.bulletDirection.y:this.turret.transform.localRotationEulerX+=90*this.bulletDirection.y,this.turret.transform.localRotationEulerY-=90*this.bulletDirection.x)),this.isRecoil=!0,this.recoilTime=0}},t.prototype.physicsStartCheck=function(){if(!this.isStageStart){var e=new Laya.SphereColliderShape(i.BulletRadius*i.BulletScale[+this.isRewardBullet][this.bulletType]*3),t=[],a=this.bulletDirection.clone();if(Laya.Vector3.scale(a,50,a),this.scene3D.physicsSimulation.shapeCastAll(e,this.turretInitPos,a,t))for(var n in t)if(t[n].collider.owner.name.indexOf("Obstacle")>=0){this.isStageStart=!0;break}}},t.prototype.createBullet=function(){var e=this;if(this.currBulletNum++,this.missionIdx>=1&&this.missionIdx<=5&&(this.label_ballNum.changeText("x"+(this.MaxBulletNum-this.currBulletNum)),f.default.instance.isTest||this.ballBox&&this.MaxBulletNum-this.currBulletNum+1>=1&&this.MaxBulletNum-this.currBulletNum+1<=10&&(this.ballBox.getChildByName("CannonBall"+(this.MaxBulletNum-this.currBulletNum+1)+"_0").meshRenderer.material.albedoColorA=0)),Laya.Browser.onMiniGame&&o.default.gameData.soundEnabled&&Laya.SoundManager.playSound(i.soundUrl),Laya.Browser.onMiniGame&&o.default.gameData.vibrationEnabled&&s.default.vibrateShort(),this.currBulletNum>=this.MaxBulletNum&&!this.flag_missionWin&&(this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),Laya.timer.frameOnce(30,this,function(){e.box_countdown.visible=!0,e.failCircle.scaleX=1,e.failCircle.scaleY=1,e.countdown=0,e.isRevive?e.btn_revive.visible=!1:e.btn_revive.visible=!0,e.flag_missionWin||Laya.timer.frameLoop(1,e,e.stageFailCountDown)})),this.isRewardBullet)Laya.Sprite3D.load(i.BulletRewardResUrl[o.default.config.bulletRewardType],Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));a.name="bullet";a.addChild(t.clone()).name="effect";a.addComponent(d.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(a);var n=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));n.name="bulletTrigger";n.addComponent(d.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(n)})),this.isRewardBullet=!1,Laya.timer.frameOnce(30,this,function(){e.scene3D.getChildByName("cannon_effect")&&e.scene3D.getChildByName("cannon_effect").destroy()});else if(2===this.cannonType){t=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-t,0),this.createSingleBullet(t,0)}else if(4===this.cannonType){var t=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-t,-t),this.createSingleBullet(-t,t),this.createSingleBullet(t,-t),this.createSingleBullet(t,t)}else 6===this.cannonType?Laya.Sprite3D.load(i.BulletLightningUrl,Laya.Handler.create(this,function(t){Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(e,function(a){var n=new Laya.MeshSprite3D(a);n.name="bullet";n.addChild(t.clone()).name="effect";n.addComponent(d.default).reset(e.bulletType),e.scene3D.addChild(n);var o=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));o.name="bulletTrigger";o.addComponent(d.default).reset(e.bulletType),e.scene3D.addChild(o)}))})):this.createSingleBullet()},t.prototype.createSingleBullet=function(e,t){var a=this;void 0===e&&(e=0),void 0===t&&(t=0);var n=Laya.Pool.getItem("bullet");if(n){n.getComponent(d.default).reset(this.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=t,this.scene3D.addChild(n)}else Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(i){(n=new Laya.MeshSprite3D(i)).name="bullet";n.addComponent(d.default).reset(a.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=t,a.scene3D.addChild(n)}));var o=Laya.Pool.getItem("bulletTrigger");if(o){o.getComponent(d.default).reset(this.bulletType),o.transform.localPositionX+=e,o.transform.localPositionY+=t,this.scene3D.addChild(o)}else Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(n){(o=new Laya.MeshSprite3D(n)).name="bulletTrigger";o.addComponent(d.default).reset(a.bulletType),o.transform.localPositionX+=e,o.transform.localPositionY+=t,a.scene3D.addChild(o)}))},t.prototype.bgMoving=function(){0===this.bgIdx&&this.cloud0&&this.cloud1&&(this.cloud0.transform.localPositionX>.5&&(this.cloud0.transform.localPositionX=-.5),this.cloud0.transform.localPositionX+=7e-4,this.cloud1.transform.localPositionX<-.5&&(this.cloud1.transform.localPositionX=.5),this.cloud1.transform.localPositionX-=5e-4)},t}(n.ui.game.GameSceneUI);a.default=p},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../StageConfig":5,"../component/Bullet":6,"../component/Guard":7,"../component/Reward":8,"../component/Target":9,"../utils/Ad":13,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./CannonSelect":10,"./HomeView":12}],12:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./../../ui/layaMaxUI"),i=e("./GameScene"),o=e("./CannonSelect"),l=e("../Const"),s=e("../utils/wx"),r=e("../utils/ws.js"),c=e("../Global"),d=e("../utils/Ad"),u=e("../utils/Navigator"),h=e("../utils/Loader"),m=function(e){function t(){var a=e.call(this)||this;return a.iconInfosList=[],a.currentIconInfoList=[],a.isGameDataLoaded=!1,a.isTest=!1,console.log("HomeView constructor()"),t.instance=a,i.default.openInstance(),a.label_version.changeText("v"+l.VERSION),a}return __extends(t,e),t.openInstance=function(e){t.instance?(d.posShowBanner(l.BannerPos.HomeView,!0),t.instance.onOpened(e)):Laya.Scene.open(l.URL_HomeView,!1,e)},t.prototype.onOpened=function(e){console.log("HomeView onOpened()"),this.visible=!0,this.label_level.changeText("关卡："+c.default.gameData.stageIndex),this.nav&&this.nav.loadHomeIconInfoList(),this.refreshUnlock()},t.prototype.onEnable=function(){var e=this;console.log("HomeView onEnable()"),Laya.Browser.onMiniGame?this.initWeixin():this.onGameDataLoaded(),h.default.loadZip(l.cdnUrl,"res",Laya.Handler.create(this,function(t){Laya.loader.load(l.StageTexUrl,Laya.Handler.create(e,function(){Laya.timer.frameLoop(1,e,e.onResEnable)}))}))},t.prototype.onResEnable=function(){i.default.instance&&i.default.instance.ballBox&&i.default.instance.cannon&&(i.default.instance&&1!=c.default.gameData.cannonType&&(i.default.instance.cannonType=c.default.gameData.cannonType,i.default.instance.newCannon()),this.refreshUnlock(),this.bindButtons(),Laya.timer.clear(this,this.onResEnable))},t.prototype.bindButtons=function(){var e=this;this.btn_start.on(Laya.Event.CLICK,this,function(){var t=e.btn_start.scaleX,a=e.btn_start.scaleY;Laya.Tween.to(e.btn_start,{alpha:.8,scaleX:.9*t,scaleY:.9*a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.btn_start,{alpha:1,scaleX:t,scaleY:a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){i.default.instance&&i.default.instance.state!=l.GameState.START&&(console.log("click_startgame"),r.default.traceEvent("click_startgame"),e.hide(),i.default.instance.state=l.GameState.START,i.default.openInstance())}))}))}),this.btn_sound.on(Laya.Event.CLICK,this,function(){c.default.gameData.soundEnabled=!c.default.gameData.soundEnabled,e.btn_sound.gray=!c.default.gameData.soundEnabled,Laya.Browser.onMiniGame&&c.default.gameData.soundEnabled&&Laya.SoundManager.playSound(l.soundUrl)}),this.btn_vibration.on(Laya.Event.CLICK,this,function(){c.default.gameData.vibrationEnabled=!c.default.gameData.vibrationEnabled,e.btn_vibration.gray=!c.default.gameData.vibrationEnabled,Laya.Browser.onMiniGame&&c.default.gameData.vibrationEnabled&&s.default.vibrateShort()}),this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon),this.btn_test.gray=!this.isTest,this.btn_test.on(Laya.Event.CLICK,this,function(){e.isTest=!e.isTest,e.btn_test.gray=!e.isTest,e.testStageIdx=1})},t.prototype.onclick_cannon=function(){o.default.openInstance(),this.hide()},t.prototype.hide=function(){d.posHideBanner(l.BannerPos.HomeView),this.visible=!1},t.prototype.initWeixin=function(){s.default.showShareMenu({withShareTicket:!0}),s.default.onShareAppMessage(function(){var e=r.default.createShareOptions({pos:"ShareAppButton"});return{title:e.title,imageUrl:e.imageUrl,query:e.query}}),r.default.init({host:"ws.lesscool.cn",version:l.VERSION,appid:1124,secret:"79ce022eb0ca47bfde9bc7e753df2074",share:{title:"全民欢乐，天天游戏！",image:"http://oss.lesscool.cn/fcdh/96d172496dbafa4ab9c8335a7133476c.png"}}),this.loginWs()},t.prototype.loginWs=function(){s.default.showLoading({title:"登录中",mask:!0}),r.default.onLoginComplete(this.onLoginComplete.bind(this)),r.default.login()},t.prototype.onLoginComplete=function(e,t){"success"===r.default.getLoginStatus()?(console.log("login_succeed"),r.default.traceEvent("login_succeed"),s.default.hideLoading(),console.log("ws.conf",r.default.conf),console.log("ws.user",r.default.user),console.log("ws.data",r.default.data),this.loadConfig(),this.loadGameData(t)):"fail"===r.default.getLoginStatus()&&(console.log("login_failed"),r.default.traceEvent("login_failed"),s.default.hideLoading(),s.default.showModal({title:"登陆失败",content:"请允许授权",confirmText:"重新登陆",cancelText:"关闭",success:function(e){s.default.showLoading({title:"登录中",mask:!0}),r.default.login()}}))},t.prototype.loadConfig=function(){Object.assign(c.default.config,r.default.conf)},t.prototype.loadGameData=function(e){var t=this;e&&e.updateTimestamp?r.default.data&&r.default.data.updateTimestamp&&r.default.data.updateTimestamp>e.updateTimestamp?r.default.setAllData(r.default.data,!0):r.default.setAllData(e):r.default.data&&r.default.data.updateTimestamp||r.default.setAllData(c.default.gameData,!0),c.default.gameData=Object.assign(c.default.gameData,r.default.data),s.default.onHide(function(){t.updateGameData(!0)}),r.default.onShow(function(){d.refreshCurrentBanner()}),this.nav=new u.default(r.default),this.box_homeIcon.visible=!0,this.nav.createHomeIcons(this.box_homeIcon,this.box_homeIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.box_drawer.visible=!0,this.onGameDataLoaded()},t.prototype.onGameDataLoaded=function(){console.log("onGameDataLoaded",c.default.gameData),this.isGameDataLoaded=!0,d.posShowBanner(l.BannerPos.HomeView),this.refreshUnlock(),this.systemName="Android",Laya.Browser.onMiniGame&&s.default.getSystemInfoSync().system.indexOf("iOS")>=0&&(this.systemName="IOS"),this.label_level.changeText("关卡："+c.default.gameData.stageIndex),this.label_level.visible=!0,this.icon_diamond.x=this.stage.width/2-(this.text_diamond.text.length*this.text_diamond.fontSize+this.text_diamond.x)/2,this.icon_diamond.visible=!0},t.prototype.updateGameData=function(e){c.default.gameData.updateTimestamp=Date.now(),e&&console.log("updateGameData",c.default.gameData),Laya.Browser.onMiniGame&&r.default.setAllData(c.default.gameData,e)},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),r.default.tapGameAd({pos:e,ad:t,redirect:a})},t.prototype.refreshUnlock=function(){(c.default.gameData.tutorialStep<5||1===c.default.gameData.stageIndex&&5===c.default.gameData.tutorialStep)&&(c.default.gameData.tutorialStep=0,this.lock_cannon.visible=!0,this.btn_cannon.visible=!1,this.btn_cannon.off(Laya.Event.CLICK,this,this.onclick_cannon)),(c.default.gameData.tutorialStep>=5||c.default.gameData.stageIndex>2)&&(this.lock_cannon.visible=!1,this.btn_cannon.visible=!0,this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon)),i.default.instance&&(c.default.gameData.tutorialStep>=2&&(i.default.instance.btn_rewardBullet.visible=!0),c.default.gameData.tutorialStep>=3&&(i.default.instance.btn_rewardCannon.visible=!0),c.default.gameData.tutorialStep>=4&&(i.default.instance.btn_cannonOpen.visible=!0))},t}(n.ui.home.HomeViewUI);a.default=m},{"../Const":3,"../Global":4,"../utils/Ad":13,"../utils/Loader":14,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./../../ui/layaMaxUI":18,"./CannonSelect":10,"./GameScene":11}],13:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./wx"),i=e("./ws.js"),o=e("../Global"),l=!0,s=null,r=0;a.refreshCurrentBanner=function(){r++,s&&r>=o.default.config.banner_click_time&&(r=0,a.posShowBanner(s,!0))},a.hasVideoAd=function(){return l},a.posShowBanner=function(e,t){if(void 0===t&&(t=!1),Laya.Browser.onMiniGame){var a=n.default.getSystemInfoSync(),o=a.screenHeight,l=a.screenWidth,r=Math.max(300,300*l/350),c=.348*r,d=o-c,u=(l-r)/2;s=e,i.default.createBanner({pos:e,style:{left:u,top:d,width:r,height:c},force:t})}},a.posHideBanner=function(e){Laya.Browser.onMiniGame&&(s=null,i.default.closeBanner(e))},a.posShowVideo=function(e,t,a){Laya.Browser.onMiniGame&&i.default.createVideo?i.default.createVideo({pos:e,success:function(e){a&&a(e)},fail:function(e){l=!1,console.log("NO VIDEO AD"),console.log("error res: ",e),e&&e.errMsg&&(i.default.traceEvent("errCode_"+e.errCode),console.log("errCode: "+e.errCode),console.log("errMsg: "+e.errMsg)),t&&t()}}):(l=!1,console.log("NO VIDEO AD"),t&&t())}},{"../Global":4,"./ws.js":16,"./wx":17}],14:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=window.wx,i=function(){function e(){this.debug=!0,this.failCount=0}return e.prototype.log=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];this.debug&&console.log.apply(this,arguments)},e.prototype.stat=function(e,t){var a=n.getFileSystemManager().statSync(e);if(a.isDirectory())for(var i=0,o=n.getFileSystemManager().readdirSync(e);i<o.length;i++){var l=o[i];try{this.stat(e+"/"+l,t)}catch(t){this.log("stat fail: "+e+"/"+l,t)}}else t[e]=a},e.prototype.loadZip=function(e,t,a,n){Laya.Browser.onMiniGame&&e?(this.failCount=0,this.unzipFile(e,t,a,n)):a&&a.runWith(!1)},e.prototype.unzipFile=function(e,t,a,i){var o=this,l=e.split("/"),s=l[l.length-1],r=n.env.USER_DATA_PATH+"/zip/",c=r+s,d=Laya.MiniFileMgr.getFileNativePath("");n.getFileSystemManager().unzip({zipFilePath:c,targetPath:d,success:function(){o.log("unzip success");var e={};try{o.stat(d+t,e),o.log("stat success")}catch(e){return o.log("stat fail",e),o.cleanDir(d+t),void(a&&a.runWith(!1))}var n=[];for(var i in e){var l=i.replace(d,""),s=Laya.Utils.getFileExtension(l);-1===[].indexOf(s)&&n.push([i,l])}if(n.length){Laya.MiniFileMgr.filesListObj.fileUsedSize||(Laya.MiniFileMgr.filesListObj.fileUsedSize=0);for(var r=0;r<n.length;r++){var c=n[r],i=c[0],l=c[1],u=e[i].size||0,h=o.getEncoding(l);if(Laya.MiniFileMgr.filesListObj[l]){var m=parseInt(Laya.MiniFileMgr.filesListObj[l].size)||0;Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u-m}else Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u;Laya.MiniFileMgr.filesListObj[l]={md5:l,readyUrl:l,size:u,times:Laya.Browser.now(),encoding:h}}o.saveFileListObj(),a&&a.runWith(!0)}else a&&a.runWith(!1)},fail:function(l){if(o.log("unzip fail"),o.failCount++,o.failCount>=3)a&&a.runWith(!1);else{try{n.getFileSystemManager().accessSync(r),o.cleanDir(r,i),o.cleanDir(d+t)}catch(e){o.log("mkdir",r),n.getFileSystemManager().mkdir({dirPath:r})}n.downloadFile({url:e,filePath:c,success:function(){o.log("downloadFile success"),o.unzipFile(e,t,a,i)},fail:function(){o.log("downloadFile fail"),a&&a.runWith(!1)}})}}})},e.prototype.cleanDir=function(e,t){var a=this;"/"===e.charAt(e.length-1)&&(e=e.slice(0,e.length-1));var i={};try{this.stat(e,i),this.log("cleanDir stat success")}catch(e){this.log("cleanDir stat fail")}for(var o in i){if(t&&t.length){r=o.replace(e+"/","");if(-1!==t.indexOf(r))continue}n.getFileSystemManager().unlink({filePath:o,success:function(){a.log("unlink success")},fail:function(){a.log("unlink fail")}})}if(0===(e+"/").indexOf(Laya.MiniFileMgr.getFileNativePath(""))){var l=!1,s=(e+"/").replace(Laya.MiniFileMgr.getFileNativePath(""),"");this.log("cleanDir: ",s);for(var r in Laya.MiniFileMgr.filesListObj)if(0===r.indexOf(s)){l=!0;var c=Laya.MiniFileMgr.filesListObj[r];Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)-(parseInt(c.size)||0),delete Laya.MiniFileMgr.filesListObj[r]}l&&s&&this.saveFileListObj()}},e.prototype.saveFileListObj=function(){n.getFileSystemManager().writeFile({filePath:Laya.MiniFileMgr.fileNativeDir+"/"+Laya.MiniFileMgr.fileListName,encoding:"utf8",data:JSON.stringify(Laya.MiniFileMgr.filesListObj)}),this.log("filesListObj",Laya.MiniFileMgr.filesListObj)},e.prototype.getEncoding=function(e){var t,a=Laya.Loader.getTypeFromUrl(e);if(!a){switch(Laya.Utils.getFileExtension(e)){case"lh":case"ls":case"lmat":case"ltc":case"lav":t="json";break;case"lm":case"lani":t="arraybuffer"}if(t)return Laya.MiniAdpter.getUrlEncode(e,t)}switch(a){case"atlas":case"prefab":case"plf":t="json";break;case"font":t="xml";break;case"plfb":case"image":case"sound":t="arraybuffer";break;default:t=a}return Laya.MiniAdpter.getUrlEncode(e,t)},e}();a.default=new i},{}],15:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(e){this.ws=e,this.SCALE=Laya.stage.width/720}return e.prototype.createHomeIcons=function(e,t,a){var n=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var i=[],o=[],l=new Laya.Box;l.width=720*this.SCALE,l.height=1280*this.SCALE,l.centerX=0,l.centerY=0,l.mouseThrough=!0,e.addChild(l);var s=new Laya.List;s.width=720*this.SCALE,s.height=790*this.SCALE,s.x=0,s.y=240*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=468*this.SCALE,s.repeatY=5,s.repeatX=2,l.addChild(s);var r=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*r,t.height=106*r,t.pivotX=53*r,t.pivotY=53*r,t.x=73*r,t.y=73*r,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*r,a.height=106*r,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.scaleX=-1,n.width=36*r,n.height=36*r,n.x=116*r,n.y=-10*r,n.loadImage("res/texture/navigator/tips2.png"),t.addChild(n);var i=new Laya.Label;return i.name="titleLabel",i.width=106*r,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*r),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*r,i.x=53*r,t.addChild(i),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,t){var a=s.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",a]);var i=e.getChildByName("iconImage");i&&i.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),n.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var d=function(){if(l&&l.activeInHierarchy&&t&&t.visible){for(var e=0;e<i.length;e++){var a=i[e],r=n.getRandom(a);o[e]=r}s.array=o,s.refresh()}};return this.loadHomeIconInfoList=function(){n.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;i=[];for(var s=0;s<Math.min(t.length,a.length);s++){var r=t[s];i.push([r])}o=[],l.clearTimer(n,d),d(),l.timerLoop(3e3,n,d)}})},this.loadHomeIconInfoList(),l}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createDrawer=function(e,t){var a=this;{if(Laya.Browser.onMiniGame){var n=new Laya.Box;n.width=720*this.SCALE,n.height=1280*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!0,e.addChild(n);var i=new Laya.Image;i.width=720*this.SCALE,i.height=1600*this.SCALE,i.centerX=0,i.centerY=0,i.mouseThrough=!1,i.mouseEnabled=!0,i.visible=!1,i.skin="res/texture/navigator/blank.png",i.sizeGrid="1,1,1,1",n.addChild(i);var o=new Laya.Box;o.width=720*this.SCALE,o.height=1280*this.SCALE,o.centerX=-480*this.SCALE,o.centerY=0,o.mouseThrough=!0,n.addChild(o);var l=new Laya.Sprite;l.width=480*this.SCALE,l.height=665*this.SCALE,l.x=0,l.y=120*this.SCALE,l.loadImage("res/texture/navigator/drawer_panel.png"),o.addChild(l);var s=new Laya.List;s.width=380*this.SCALE,s.height=540*this.SCALE,s.x=40*this.SCALE,s.y=85*this.SCALE,s.mouseThrough=!0,s.spaceY=40*this.SCALE,s.spaceX=30*this.SCALE,s.repeatX=3,l.addChild(s);var r=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*r,t.height=106*r,t.x=0,t.y=0,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*r,a.height=106*r,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.width=59*r,n.height=32*r,n.x=60*r,n.y=-10*r,n.loadImage("res/texture/navigator/tips.png"),t.addChild(n);var i=new Laya.Label;i.name="tipsLabel",i.width=42*r,i.height=18*r,i.valign="middle",i.align="center",i.fontSize=Math.round(18*r),i.font="Arial",i.color="#ffffff",i.x=9*r,i.y=6*r,n.addChild(i);var o=new Laya.Label;return o.name="titleLabel",o.width=106*r,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(18*r),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=53*r,o.y=110*r,t.addChild(o),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,n){var i=s.array[n];if(i){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,a,a.onIconClick,[t,i]);var o=e.getChildByName("iconImage");o&&o.loadImage(i.icon);var l=e.getChildByName("titleLabel");l&&l.changeText(i.title);var r=e.getChildByName("tips");if(r){var c=r.getChildByName("tipsLabel");c&&c.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1);var d=new Laya.Sprite;d.width=88*this.SCALE,d.height=74*this.SCALE,d.x=480*this.SCALE,d.y=40*this.SCALE,d.loadImage("res/texture/navigator/drawer_button.png"),d.visible=!1,l.addChild(d);var u=new Laya.Sprite;u.width=39*this.SCALE,u.height=49*this.SCALE,u.scaleX=-1,u.x=55*this.SCALE,u.y=12*this.SCALE,u.loadImage("res/texture/navigator/arrow.png"),d.addChild(u);var h=new Laya.Sprite;h.width=88*this.SCALE,h.height=74*this.SCALE,h.x=480*this.SCALE,h.y=40*this.SCALE,h.loadImage("res/texture/navigator/drawer_button.png"),h.visible=!0,l.addChild(h);var m=new Laya.Sprite;m.width=39*this.SCALE,m.height=49*this.SCALE,m.x=23*this.SCALE,m.y=12*this.SCALE,m.loadImage("res/texture/navigator/arrow.png"),h.addChild(m),h.on(Laya.Event.MOUSE_DOWN,this,function(){a.ws.getGameAd({pos:t,count:a.ws.conf.games[t].length,success:function(e){var t=e.data;s.array=t,s.refresh()}}),i.visible=!0,Laya.Tween.to(o,{centerX:0},300,Laya.Ease.linearNone,Laya.Handler.create(a,function(){h.visible=!1,d.visible=!0}))}),d.on(Laya.Event.MOUSE_DOWN,this,function(){a.ws.hideGameAd(t),Laya.Tween.to(o,{centerX:-480*r},300,Laya.Ease.linearNone,Laya.Handler.create(a,function(){h.visible=!0,d.visible=!1,i.visible=!1}))});var f=Math.round(13*this.SCALE),g=Math.round(28*this.SCALE),y=!1;return n.timerLoop(500,this,function(){y?(m.x=g,y=!1):(m.x=f,y=!0)}),n}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createMoreGame=function(e,t,a){var n=this;{if(Laya.Browser.onMiniGame){var i=new Laya.Box;i.width=720*this.SCALE,i.height=1280*this.SCALE,i.centerX=0,i.centerY=0,i.mouseThrough=!0,i.visible=!1,e.addChild(i);var o=new Laya.Image;o.width=720*this.SCALE,o.height=1600*this.SCALE,o.centerX=0,o.centerY=0,o.mouseThrough=!1,o.mouseEnabled=!0,o.skin="res/texture/navigator/blank.png",o.sizeGrid="1,1,1,1",i.addChild(o);var l=new Laya.Box;l.width=720*this.SCALE,l.height=1280*this.SCALE,l.centerX=0,l.centerY=0,l.mouseThrough=!0,i.addChild(l);var s=new Laya.Sprite;s.width=586*this.SCALE,s.height=806*this.SCALE,s.loadImage("res/texture/navigator/moregame_panel.png"),s.x=67*this.SCALE,s.y=137*this.SCALE,l.addChild(s);var r=new Laya.Sprite;r.x=538*this.SCALE,r.y=-12*this.SCALE,r.width=59*this.SCALE,r.height=62*this.SCALE,r.loadImage("res/texture/navigator/close_button.png"),s.addChild(r);var c=new Laya.Image;c.width=110*this.SCALE,c.height=110*this.SCALE,c.pivotY=55*this.SCALE,c.pivotX=55*this.SCALE,c.centerX=285*this.SCALE,c.centerY=-465*this.SCALE,c.loadImage("res/texture/navigator/more_game_button.png",Laya.Handler.create(this,function(){i.timerLoop(1005,n,function(){Laya.Tween.to(c,{scaleX:.9*u,scaleY:.9*u},500,Laya.Ease.linearNone,Laya.Handler.create(n,function(){Laya.Tween.to(c,{scaleX:u,scaleY:u},500,Laya.Ease.linearNone)}))})})),t.addChild(c);var d=new Laya.List;d.width=500*this.SCALE,d.height=640*this.SCALE,d.centerX=10*this.SCALE,d.centerY=5*this.SCALE,d.spaceY=50*this.SCALE,d.spaceX=40*this.SCALE,d.repeatX=3,s.addChild(d);var u=this.SCALE,h=function(e){function t(){var t=e.call(this)||this;t.width=132*u,t.height=132*u,t.x=0,t.y=0,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=132*u,a.height=132*u,a.x=0,a.y=-2*u,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.width=59*u,n.height=32*u,n.x=90*u,n.y=-10*u,n.loadImage("res/texture/navigator/tips.png"),t.addChild(n);var i=new Laya.Label;i.name="tipsLabel",i.width=42*u,i.height=18*u,i.valign="middle",i.align="center",i.fontSize=Math.round(18*u),i.font="Arial",i.color="#ffffff",i.x=9*u,i.y=6*u,n.addChild(i);var o=new Laya.Label;return o.name="titleLabel",o.width=132*u,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(22*u),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=66*u,o.y=138*u,t.addChild(o),t}return __extends(t,e),t}(Laya.Box);return d.itemRender=h,d.renderHandler=Laya.Handler.create(this,function(e,t){var i=d.array[t];if(i){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,[a,i]);var o=e.getChildByName("iconImage");o&&o.loadImage(i.icon);var l=e.getChildByName("titleLabel");l&&l.changeText(i.title);var s=e.getChildByName("tips");if(s){var r=s.getChildByName("tipsLabel");r&&r.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1),c.on(Laya.Event.MOUSE_DOWN,this,function(){n.ws.getGameAd({pos:a,count:n.ws.conf.games[a].length,success:function(e){var t=e.data;d.array=t,d.refresh()}}),i.visible=!0,c.visible=!1}),r.on(Laya.Event.MOUSE_DOWN,this,function(){n.ws.hideGameAd(a),c.visible=!0,i.visible=!1}),i}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createOverIcons=function(e,t,a){var n=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var i=[],o=[],l=new Laya.Box;l.width=720*this.SCALE,l.height=1280*this.SCALE,l.centerX=0,l.centerY=0,l.mouseThrough=!0,e.addChild(l);var s=new Laya.List;s.width=720*this.SCALE,s.height=470*this.SCALE,s.x=0,s.y=180*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=468*this.SCALE,s.repeatY=3,s.repeatX=2,l.addChild(s);var r=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*r,t.height=106*r,t.pivotX=53*r,t.pivotY=53*r,t.x=73*r,t.y=73*r,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*r,a.height=106*r,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.scaleX=-1,n.width=36*r,n.height=36*r,n.x=116*r,n.y=-10*r,n.loadImage("res/texture/navigator/tips2.png"),t.addChild(n);var i=new Laya.Label;return i.name="titleLabel",i.width=106*r,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*r),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*r,i.x=53*r,t.addChild(i),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,t){var a=s.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",a]);var i=e.getChildByName("iconImage");i&&i.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),n.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var d=function(){if(l&&l.activeInHierarchy&&t&&t.visible){for(var e=0;e<i.length;e++){var a=i[e],r=n.getRandom(a);o[e]=r}s.array=o,s.refresh()}};return this.loadOverIconInfoList=function(){n.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;i=[];for(var s=0;s<Math.min(t.length,a.length);s++){var r=t[s];i.push([r])}o=[],l.clearTimer(n,d),d(),l.timerLoop(3e3,n,d)}})},this.loadOverIconInfoList(),l}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createGuessLikeIcons=function(e,t,a){var n=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var i=[],o=[],l=new Laya.Box;l.width=720*this.SCALE,l.height=1280*this.SCALE,l.centerX=0,l.centerY=0,l.mouseThrough=!0,e.addChild(l);var s=new Laya.Sprite;s.width=560*this.SCALE,s.height=188*this.SCALE,s.y=670*this.SCALE,s.x=80*this.SCALE,s.loadImage("res/texture/navigator/guessyoulike.png"),l.addChild(s);var r=new Laya.List;r.width=500*this.SCALE,r.height=208*this.SCALE,r.x=60*this.SCALE,r.y=-20*this.SCALE,r.mouseThrough=!0,r.spaceY=45*this.SCALE,r.spaceX=18*this.SCALE,r.repeatY=1,r.repeatX=4,s.addChild(r);var c=this.SCALE,d=function(e){function t(){var t=e.call(this)||this;t.width=106*c,t.height=106*c,t.pivotX=53*c,t.pivotY=53*c,t.x=63*c,t.y=108*c,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*c,a.height=106*c,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Label;return n.name="titleLabel",n.width=106*c,n.overflow="visible",n.valign="middle",n.align="center",n.fontSize=Math.round(18*c),n.font="Arial",n.color="#1d3b63",n.anchorY=0,n.anchorX=.5,n.y=110*c,n.x=53*c,t.addChild(n),t}return __extends(t,e),t}(Laya.Box);r.itemRender=d,r.renderHandler=Laya.Handler.create(this,function(e,t){var a=r.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",a]);var i=e.getChildByName("iconImage");i&&i.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),n.jumpeOnce(150*t,e)}else e.visible=!1},[],!1);var u=function(){if(l&&l.activeInHierarchy&&t&&t.visible){for(var e=0;e<i.length;e++){var a=i[e],s=n.getRandom(a);o[e]=s}r.array=o,r.refresh()}};return this.loadGuessLikeIconInfoList=function(){n.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;i=[];for(var s=Math.max(t.length-a.length,0);s<t.length;s++){var r=t[s];i.push([r])}o=[],l.clearTimer(n,u),u(),l.timerLoop(3e3,n,u)}})},this.loadGuessLikeIconInfoList(),l}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),this.ws.tapGameAd({pos:e,ad:t,redirect:a})},e.prototype.shakeOnce=function(e,t){var a=this;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))}))}),this.blinkTips(e,t)},e.prototype.jumpeOnce=function(e,t){var a=this,n=t.y;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))})),Laya.Tween.to(t,{y:n-50},200,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(t,{y:n},200,Laya.Ease.sineIn)}))}),this.blinkTips(e,t)},e.prototype.blinkTips=function(e,t){var a=this,n=t.getChildByName("tips");n&&n.timerOnce(e,this,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.timer.clearAll(n)}))}))}))}))}))}))})},e.prototype.randomIndex=function(e,t,a){void 0===t&&(t="weight"),void 0===a&&(a=0);var n=[],i=0;if(e&&e.length)for(r=0;r<e.length;r++){var o=e[r],l=Number(o[t])||a||0;n[r]=[i,i+l],i+=l}if(i>0)for(var s=Math.random()*i,r=0;r<n.length;r++){var c=n[r];if(c[0]<=s&&s<c[1])return r}return 0},e.prototype.getRandom=function(e,t,a){return void 0===t&&(t="weight"),void 0===a&&(a=0),e&&e.length?1===e.length?e[0]:e[this.randomIndex(e,t,a)]:null},e}();a.default=n},{}],16:[function(e,t,a){t.exports.default=function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var n,i=(n=a(1))&&n.__esModule?n:{default:n},o=a(4),l=a(5),s=a(6),r=a(7),c=a(8),d=a(9),u=a(10),h=a(11),m=a(12),f=a(13),g=a(2),y=a(14);(0,g.initUtil)(i.default),(0,o.initHTTP)(i.default),(0,l.initUser)(i.default),(0,s.initConfig)(i.default),(0,r.initData)(i.default),(0,c.initShare)(i.default),(0,d.initProcess)(i.default),(0,u.initPayment)(i.default),(0,h.initAD)(i.default),(0,m.initHook)(i.default),(0,f.initInvite)(i.default),(0,y.initEvent)(i.default),e.exports=window.ws=i.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=(n=a(2))&&n.__esModule?n:{default:n},l={tmp:{},options:{scheme:"https://",host:"api.websdk.cn",apiVersion:"v1",USER_KEY:"ws_user",CONF_KEY:"ws_conf",DATA_KEY:"ws_data",share10:!0,commonDuration:120,allowAld:!1},conf:{},user:{},data:{},version:"1.0.1",mode:"default",debug:!0,shareCallbackData:{},shareTempData:{},shareGiftTempData:{},_initCallbacks:[],_showCallbacks:[],_hideCallbacks:[],_afterHideCallbacks:[],_shareCallbacks:[],_openFromShareCallbacks:[],_openFromCodeCallbacks:[],_onInit:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=this._initCallbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o&&o()}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}},_onShow:function(e){if(console.log("onShow:",e,"mode:",this.mode),"default"!==this.mode)this.shareCallbackData&&this.shareCallbackData.callback&&"shareAppMessage"==this.mode&&(this.shareCallbackData.callback(e,Date.now()-this.shareCallbackData.ms),this.shareCallbackData={}),this.mode="default";else{var t=!0,a=!1,n=void 0;try{for(var i,o=this._showCallbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;s&&s(e)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}if(e.query&&"share"===e.query.type?l._openFromShare("onShow",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&l._openFromCode("onShow",e.query.scene,e),this.user&&e.shareTicket&&e.query&&e.query.uid==this.user.id)for(var r in this.shareTempData)r==e.query.share_tid&&l._shareCallback(this.shareTempData[r],e)}},_onHide:function(e){if(console.log("onHide:",e,"mode:",this.mode),"default"===this.mode){var t=!0,a=!1,n=void 0;try{for(var i,o=this._hideCallbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;l&&l(e)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}var s=!0,r=!1,c=void 0;try{for(var d,u=this._afterHideCallbacks[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value;h&&h(e)}}catch(e){r=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(r)throw c}}}},_openFromShare:function(e,t,a){var n=!0,i=!1,o=void 0;try{for(var l,s=this._openFromShareCallbacks[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var r=l.value;r&&r({from:e,query:t,options:a})}}catch(e){i=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw o}}},_openFromCode:function(e,t,a){l.get({url:"/share/qrcode",data:{scene:t},success:function(n){var i=!0,o=!1,s=void 0;try{for(var r,c=l._openFromCodeCallbacks[Symbol.iterator]();!(i=(r=c.next()).done);i=!0){var d=r.value;d&&d({from:e,scene:t,options:a,query:n.data})}}catch(e){o=!0,s=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw s}}}})},_shareCallback:function(e,t){wx.getShareInfo({shareTicket:t.shareTicket,success:function(a){e.onShareTicketSuccess&&e.onShareTicketSuccess(a),l.shareLog(e,"click",t.shareTicket,a,t)}.bind(this),fail:function(a){e.onShareTicketFail&&e.onShareTicketFail(a),l.shareLog(e,"click",t.shareTicket,{},t)}.bind(this)})},onInit:function(e){this._initCallbacks.push(e)},onShow:function(e){this._showCallbacks.push(e)},onHide:function(e){this._hideCallbacks.push(e)},afterHide:function(e){this._afterHideCallbacks.push(e)},openFromShare:function(e){this._openFromShareCallbacks.push(e)},openFromCode:function(e){this._openFromCodeCallbacks.push(e)},init:function(e){this.options=i({},o.default.copy(e,this.options)),this.systemInfo=wx.getSystemInfoSync(),this.launchOptions=wx.getLaunchOptionsSync(),this.user=wx.getStorageSync(this.options.USER_KEY),this.conf=wx.getStorageSync(this.options.CONF_KEY),this.data=wx.getStorageSync(this.options.DATA_KEY),this.log("conf:",this.conf),wx.onShow(this._onShow.bind(this)),wx.onHide(this._onHide.bind(this))},onLogined:function(){var e=this.launchOptions;e.query&&"share"===e.query.type?l._openFromShare("onLaunch",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&l._openFromCode("onLaunch",e.query.scene,e),this._onInit()}};t.default=l},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.initUtil=function(e){e.checkSDK=function(e,t){var a=this;return function(n,i){return a.requireSDK(e)?t.apply(a,[n]):(a.log("微信SDK版本过低："+a.systemInfo.SDKVersion+",需要更新至"+e),void(i&&"function"==typeof i&&i([a.systemInfo.SDKVersion,e])))}},e.requireSDK=function(e){return l.compareVersion(this.systemInfo.SDKVersion,e)},e.requireSystemVersion=function(e){return l.compareVersion(this.systemInfo.version,e)},e.isIPhoneX=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iPhone X")},e.isIOS=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iOS")},e.isAndroid=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("Android")},e.toFixed=function(e,t){for(var a=e.toFixed(t)+"";"0"===a[a.length-1];)if("."===(a=a.substring(0,a.length-1))[a.length-1]){a=a.substring(0,a.length-1);break}return a},e.log=function(){try{if(this.debug&&console&&console.log){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return console.log.apply(console,t)}}catch(e){}},e.setAlertCallback=function(t){e._alertCallback=t},e.alert=function(t){e._alertCallback?e._alertCallback(t):wx.showModal({content:t})},e.trace=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.post({url:"/log/trace",data:{key:e,pos:t,data:a}})},e.getServerTime=function(){return e.conf&&e.conf.server_time?e.conf.server_time:0}};var i,o=(i=a(3))&&i.__esModule?i:{default:i},l={sign:function(e,t){if("string"==typeof e)return l.signSort(e,t);if("object"==(void 0===e?"undefined":n(e))){var a=[];for(var i in e)a.push(i+"="+e[i]);return l.signSort(a.join("&"),t)}},signSort:function(e,t){var a=e.split("&").sort().join("&")+"&key="+t;return(0,o.default)(a).toUpperCase()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return Date.now()+"-"+l.S4()},compareVersion:function(e,t){var a=parseFloat(e),n=parseFloat(t),i=e.replace(a+".",""),o=t.replace(n+".","");return a>n||!(a<n)&&i>=o},copy:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(e&&e.push?[]:{});for(var a in e)t[a]="object"===n(e[a])?l.copy(e[a]):e[a];return t},randomSort:function(e){for(var t,a=0;a<e.length;a++){var n=parseInt(Math.random()*e.length+"");t=e[n],e[n]=e[a],e[a]=t}return e}};t.default=l},function(e,t,a){var n;"function"==typeof Symbol&&Symbol.iterator,function(i){"use strict";function o(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function l(e,t,a,n,i,l){return o((s=o(o(t,e),o(n,l)))<<(r=i)|s>>>32-r,a);var s,r}function s(e,t,a,n,i,o,s){return l(t&a|~t&n,e,t,i,o,s)}function r(e,t,a,n,i,o,s){return l(t&n|a&~n,e,t,i,o,s)}function c(e,t,a,n,i,o,s){return l(t^a^n,e,t,i,o,s)}function d(e,t,a,n,i,o,s){return l(a^(t|~n),e,t,i,o,s)}function u(e,t){var a,n,i,l,u;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,m=-271733879,f=-1732584194,g=271733878;for(a=0;a<e.length;a+=16)n=h,i=m,l=f,u=g,h=s(h,m,f,g,e[a],7,-680876936),g=s(g,h,m,f,e[a+1],12,-389564586),f=s(f,g,h,m,e[a+2],17,606105819),m=s(m,f,g,h,e[a+3],22,-1044525330),h=s(h,m,f,g,e[a+4],7,-176418897),g=s(g,h,m,f,e[a+5],12,1200080426),f=s(f,g,h,m,e[a+6],17,-1473231341),m=s(m,f,g,h,e[a+7],22,-45705983),h=s(h,m,f,g,e[a+8],7,1770035416),g=s(g,h,m,f,e[a+9],12,-1958414417),f=s(f,g,h,m,e[a+10],17,-42063),m=s(m,f,g,h,e[a+11],22,-1990404162),h=s(h,m,f,g,e[a+12],7,1804603682),g=s(g,h,m,f,e[a+13],12,-40341101),f=s(f,g,h,m,e[a+14],17,-1502002290),h=r(h,m=s(m,f,g,h,e[a+15],22,1236535329),f,g,e[a+1],5,-165796510),g=r(g,h,m,f,e[a+6],9,-1069501632),f=r(f,g,h,m,e[a+11],14,643717713),m=r(m,f,g,h,e[a],20,-373897302),h=r(h,m,f,g,e[a+5],5,-701558691),g=r(g,h,m,f,e[a+10],9,38016083),f=r(f,g,h,m,e[a+15],14,-660478335),m=r(m,f,g,h,e[a+4],20,-405537848),h=r(h,m,f,g,e[a+9],5,568446438),g=r(g,h,m,f,e[a+14],9,-1019803690),f=r(f,g,h,m,e[a+3],14,-187363961),m=r(m,f,g,h,e[a+8],20,1163531501),h=r(h,m,f,g,e[a+13],5,-1444681467),g=r(g,h,m,f,e[a+2],9,-51403784),f=r(f,g,h,m,e[a+7],14,1735328473),h=c(h,m=r(m,f,g,h,e[a+12],20,-1926607734),f,g,e[a+5],4,-378558),g=c(g,h,m,f,e[a+8],11,-2022574463),f=c(f,g,h,m,e[a+11],16,1839030562),m=c(m,f,g,h,e[a+14],23,-35309556),h=c(h,m,f,g,e[a+1],4,-1530992060),g=c(g,h,m,f,e[a+4],11,1272893353),f=c(f,g,h,m,e[a+7],16,-155497632),m=c(m,f,g,h,e[a+10],23,-1094730640),h=c(h,m,f,g,e[a+13],4,681279174),g=c(g,h,m,f,e[a],11,-358537222),f=c(f,g,h,m,e[a+3],16,-722521979),m=c(m,f,g,h,e[a+6],23,76029189),h=c(h,m,f,g,e[a+9],4,-640364487),g=c(g,h,m,f,e[a+12],11,-421815835),f=c(f,g,h,m,e[a+15],16,530742520),h=d(h,m=c(m,f,g,h,e[a+2],23,-995338651),f,g,e[a],6,-198630844),g=d(g,h,m,f,e[a+7],10,1126891415),f=d(f,g,h,m,e[a+14],15,-1416354905),m=d(m,f,g,h,e[a+5],21,-57434055),h=d(h,m,f,g,e[a+12],6,1700485571),g=d(g,h,m,f,e[a+3],10,-1894986606),f=d(f,g,h,m,e[a+10],15,-1051523),m=d(m,f,g,h,e[a+1],21,-2054922799),h=d(h,m,f,g,e[a+8],6,1873313359),g=d(g,h,m,f,e[a+15],10,-30611744),f=d(f,g,h,m,e[a+6],15,-1560198380),m=d(m,f,g,h,e[a+13],21,1309151649),h=d(h,m,f,g,e[a+4],6,-145523070),g=d(g,h,m,f,e[a+11],10,-1120210379),f=d(f,g,h,m,e[a+2],15,718787259),m=d(m,f,g,h,e[a+9],21,-343485551),h=o(h,n),m=o(m,i),f=o(f,l),g=o(g,u);return[h,m,f,g]}function h(e){var t,a="",n=32*e.length;for(t=0;t<n;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function m(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function f(e){var t,a,n="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function g(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return h(u(m(e),8*e.length))}(g(e))}function p(e,t){return function(e,t){var a,n,i=m(e),o=[],l=[];for(o[15]=l[15]=void 0,i.length>16&&(i=u(i,8*e.length)),a=0;a<16;a+=1)o[a]=909522486^i[a],l[a]=1549556828^i[a];return n=u(o.concat(m(t)),512+8*t.length),h(u(l.concat(n),640))}(g(e),g(t))}function v(e,t,a){return t?a?p(t,e):f(p(t,e)):a?y(e):f(y(e))}void 0===(n=function(){return v}.call(t,a,t,e))||(e.exports=n)}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.success,a=e.fail;return"GET"==e.method?e.url=c(e.url,e.data):e.url=c(e.url),e.header||(e.header={}),e.header.Authorization=d.default.isLogined()?d.default.user.token:"",e.success=function(n){"LOGIN_REQUIRED"===n.data.key?(d.default.log("login required:",e.url,e,n),d.default.doLogin()):0===n.data.code?(d.default.log("success:",e.url,e,n),t&&t(n.data)):a?(d.default.log("fail:",e.url,e,n),a(n.data)):d.default.log("unknown:",e.url,e,n)},e.fail=function(t){d.default.log("error:",e.url,e,t),a&&a(t)},wx.request(e)}function o(e){return e.method="GET",i(e)}function l(e){return e.method="POST",i(e)}function s(e){return e.method="PUT",i(e)}function r(e){return e.method="DELETE",i(e)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){-1==e.indexOf("?")&&(e+="?");var a=[];if(d.default.isLogined()&&a.push("user="+d.default.user.id),d.default.launchOptions){var n=d.default.launchOptions.query;n&&(n.uid&&a.push("uid="+n.uid),n.channel&&a.push("channel="+n.channel),n.share_id&&a.push("share_id="+n.share_id),n.share_tid&&a.push("share_tid="+n.share_tid),n.pos&&a.push("share_pos="+n.pos),n.scene&&a.push("scene="+decodeURIComponent(n.scene)))}a.push("v="+d.default.version),a.push("version="+d.default.options.version),a.push("appid="+d.default.options.appid),a.push("t="+Date.now()),"?"!==e.charAt(e.length-1)&&"&"!==e.charAt(e.length-1)&&(e+="&");var i=(e+=a.join("&")).split("?")[1];if(t){var o=[];for(var l in t)o.push(l+"="+t[l]);i+="&"+o.join("&")}if((e+="&sign="+u.default.sign(i,d.default.options.secret)).startsWith("/"))return d.default.options.scheme+d.default.options.host+"/"+d.default.options.apiVersion+e}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.initHTTP=function(e){e.request=i,e.get=o,e.post=l,e.put=s,e.delete=r,e.formatURL=c};var d=n(a(1)),u=n(a(2))},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initUser=function(e){e.isLogined=function(){return e.user&&e.user.token},e.getLoginStatus=function(){return e.isLogined()?"success":e.isCheckSession||e.isLogining?"logining":"fail"},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?e.doLogin(t):(e.isCheckSession=!0,wx.checkSession({success:function(){e.checkLogin(t),e.isCheckSession=!1}.bind(e),fail:function(){e.doLogin(t),e.isCheckSession=!1}.bind(e)}))},e.checkLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogined()?(e.loginSuccess(),!e.requireSDK("2.0.3")&&e.needUserInfo()&&e.getUserInfo()):e.doLogin(t)},e.checkCode2access=function(t){var a=t.session_key?t:null;e.post({url:"/oauth/code2access_token",data:t,success:function(t){e.isLogining=!1,e.saveUser(t.data),e.checkLogin(a)}.bind(e),fail:e.loginFail.bind(e)})},e.doLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogining||(e.isLogining=!0,e.user=null,t?e.checkCode2access(t):wx.login({success:function(t){t.code?e.checkCode2access({code:t.code}):e.loginFail(t)}.bind(e),fail:e.loginFail.bind(e)}))},e.loginSuccess=function(t){var a=e.conf&&e.conf.last?e.conf.last:0;!a||Date.now()-a>1e3*e.options.commonDuration?e.getCommon(t):(e.doLoginSuccess(t),e.onLogined())},e.getCommon=function(t){e.get({url:"/common",success:function(a){e.conf=a.data.conf,e.conf.last=Date.now(),wx.setStorage({key:e.options.CONF_KEY,data:e.conf}),e.data||(e.data=a.data.data,wx.setStorage({key:e.options.DATA_KEY,data:e.data})),e.doLoginSuccess(t),e.onLogined()}.bind(e),fail:function(t){e.loginFail(t)}.bind(e)})},e.doLoginSuccess=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginSuccessCallback&&e.loginSuccessCallback(t)},e.loginFail=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginFailCallback&&e.loginFailCallback(t)},e.onLoginSuccess=function(t){e.loginSuccessCallback=t},e.onLoginFail=function(t){e.loginFailCallback=t},e.onLoginComplete=function(t){e.loginCompleteCallback=t},e.checkUserInfo=function(){e.needUserInfo()&&e.getUserInfo()},e.needUserInfo=function(){return!e.user||!e.user.nickname||!e.user.avatar},e.getUserInfo=function(){wx.getUserInfo({withCredentials:!0,success:function(t){return e.post({url:"/oauth/update_userinfo",data:t,success:function(t){e.saveUser(t.data),e.needUserInfo()?e.getUserInfoFail(t):e.getUserInfoSuccess()}.bind(e),fail:e.getUserInfoFail.bind(e)}),t}.bind(e),fail:e.getUserInfoFail.bind(e)})},e.getUserInfoSuccess=function(e){},e.getUserInfoFail=function(e){},e.saveUser=function(t){e.user=t,e.user.last=Date.parse(new Date),wx.setStorage({key:e.options.USER_KEY,data:e.user})}}},function(e,t,a){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.conf&&void 0!==o.default.conf[e]?o.default.conf[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.initConfig=function(e){e.getConfig=n};var i,o=(i=a(1))&&i.__esModule?i:{default:i}},function(e,t,a){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.default.data&&void 0!==u.default.data[e]?u.default.data[e]:t}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.default.data||(u.default.data={}),u.default.data[e]=t,a&&u.default.postData(e)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.default.data=e,t&&u.default.postData()}function l(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=u.default.getData(e,n)+t;return u.default.setData(e,i,a),i}function s(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],wx.setStorage({key:u.default.options.DATA_KEY,data:u.default.data}),u.default.post({url:"/data",data:u.default.data})}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",o={};if(e instanceof Object){var l=e;o={id:l.id,score:l.score,time:l.time,version:u.default.options.version,data:l.data,key:l.key}}else o={id:e,score:t,time:a,version:u.default.options.version,data:n,key:i};u.default.post({url:"/score",data:o,success:function(e){u.default.log("提交分数成功：",t,e)},fail:function(e){u.default.log("提交分数失败：",t,e)}})}function c(e){var t=e.key,a=void 0===t?"default":t,n=e.scale,i=void 0===n?"week":n,o=e.skip,l=void 0===o?0:o,s=e.limit,r=void 0===s?10:s,c=e.success,d=void 0===c?null:c,h=e.fail,m=void 0===h?null:h;u.default.get({url:"/score",data:{score_key:a,scale:i,skip:l,limit:r},success:function(e){d&&d(e.data)},fail:function(e){m&&m(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initData=function(e){e.getData=n,e.setData=i,e.setAllData=o,e.incData=l,e.postData=s,e.postGameScore=r,e.getScoreRank=c};var d,u=(d=a(1))&&d.__esModule?d:{default:d}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initShare=function(e){e.share=function(t){e.options.allowAld?e.aldShareAppMessage(this.createShareOptions(t)):e.shareAppMessage(this.createShareOptions(t)),this.options.share10&&(this.log("share10"),this.shareLog(t,"share10","",{},{})),t.onShareBack&&(e.shareCallbackData={callback:t.onShareBack,ms:Date.now()})},e.createShareOptions=function(t){t.pos||(t.pos="default");var a=this.getShareInfo(t);t.shareId=a.shareId,t.title||(t.title=a.title),t.imageUrl||(t.imageUrl=a.imageUrl),t.success||(t.success=a.success),t.fail||(t.fail=a.fail),t.onHttpError||(t.onHttpError=a.onHttpError),t.tid||(t.tid=""+Date.now());var n="type=share&pos="+t.pos+"&share_id="+a.shareId+"&share_tid="+t.tid;return this.isLogined()&&(n+="&uid="+this.user.id),t.gift&&(n+="&gift="+t.gift),t.query?"&"==t.query.indexOf(0)?(t.query=n+t.query,e.log("new share query: "+t.query)):(t.query=n+"&"+t.query,e.log("new share query: "+t.query)):t.query=n,e.shareTempData[t.tid]=t,{title:t.title,imageUrl:t.imageUrl,query:t.query,success:this.shareSuccess(t),fail:this.shareFail(t),complete:t.complete}},e.getShareInfo=function(e){var t="",a="";this.options.share&&(t=this.options.share.title,a=this.options.share.imageUrl);var n,i=0;return e.defaultTitle&&(t=e.defaultTitle),this.conf&&this.conf.shares&&(this.conf.shares[e.pos]?n=this.conf.shares[e.pos]:this.conf.shares.default&&(n=this.conf.shares.default),n&&(n.title&&(t=n.title),n.image&&(a=n.image),n.id&&(i=n.id))),{title:t,imageUrl:a,shareId:i,success:function(){wx.showToast({title:"分享成功！",icon:"success"})},fail:function(){wx.showToast({title:"分享失败！",icon:"fail"})},onHttpError:function(){wx.showToast({title:"网络出错！",icon:"fail"})}}},e.shareSuccess=function(t){return function(a){console.log("shareSuccess"),delete e.shareTempData[t.tid];var n=!0;t.onShareSuccess&&(n=t.onShareSuccess(a)),n&&(a.shareTickets&&a.shareTickets.length>0?wx.getShareInfo({shareTicket:a.shareTickets[0],success:function(e){t.onShareTicketSuccess&&t.onShareTicketSuccess(e),this.shareLog(t,"success",a.shareTickets[0],e,a)}.bind(this),fail:function(e){t.onShareTicketFail&&t.onShareTicketFail(e),this.shareLog(t,"success",a.shareTickets[0],{},a)}.bind(this)}):(t.onShareTicketFail&&t.onShareTicketFail(),this.shareLog(t,"success","",{},a)))}.bind(this)},e.shareFail=function(e){return function(t){console.log("shareFail");var a=!0;e.onShareFail&&(a=e.onShareFail(t)),a&&this.shareLog(e,"fail","",{},t)}.bind(this)},e.shareLog=function(t,a,n,i,o){this.post({url:"/log/share",data:{share_id:t.shareId,title:t.title,query:t.query,image:t.imageUrl,pos:t.pos,tid:t.tid,status:a,shareTicket:n,info:i,error:o.errMsg,system_version:e.systemInfo.system,sdk_version:e.systemInfo.SDKVersion},success:function(n){"success"!==a&&"click"!==a||!t.success?"fail"===a&&t.fail&&t.fail(n,o):(t.success(n,o),delete e.shareTempData[t.tid])},fail:function(e){"success"!==a&&"click"!==a||!t.onHttpError?"fail"===a&&t.fail&&t.fail(e,o):t.onHttpError(e,o)}})},e.isEnableShare=function(){return!(!e.conf||!e.conf.allow_share||e.requireSystemVersion("6.7.0"))}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){"string"==typeof e?(c.process=e,c.processDuration=Date.now()-c.initStartAt):s.default.log("setProcess():  参数类型错误")}function o(e){s.default.post({url:"/log/process",data:e,success:function(e){s.default.log("提交游戏进度数据成功：",e)},fail:function(e){s.default.log("提交游戏进度数据失败：",e)}})}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initProcess=function(e){e.onShow(function(e){d=Date.now(),c.showOptions=JSON.stringify(e)}),e.afterHide(function(t){var a=Date.now(),n=c=l({},c,{times:c.times+1,showDuration:d?a-d:a-c.initStartAt,duration:a-c.initStartAt}),i=(n.hasInited,n.initStartAt,function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}(n,["hasInited","initStartAt"]));c.hasInited?o(i):(c.hasInited=!0,o(l({systemInfo:JSON.stringify(e.systemInfo),launchOptions:JSON.stringify(e.launchOptions)},i)))}),e.setProcess=i};var s=n(a(1)),r=n(a(2)),c={hasInited:!1,initStartAt:Date.now(),showOptions:"",times:0,uuid:r.default.guid(),duration:0,showDuration:0,process:"init",processDuration:0},d=0},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initPayment=function(e){e.getPaymentResult=function(e){var t=e.success,a=void 0===t?null:t,n=e.fail,i=void 0===n?null:n;this.get({url:"/payment/result",success:function(e){this.log("获取充值数据成功",e),a&&a(e.data)}.bind(this),fail:function(e){this.log("获取充值数据失败",e),i&&i(e)}.bind(this)})},e.requestMPPayment=function(t){var a=this,n=t.title,i=void 0===n?"点击充值链接进入充值":n,o=t.pos,l=void 0===o?"default":o,s=t.image,r=void 0===s?null:s,c=t.success,d=void 0===c?null:c,u=t.fail,h=void 0===u?null:u,m=t.complete,f=void 0===m?null:m;this.log("打开客服对话"),e.openCustomerServiceConversation({sessionFrom:l,showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"?type=message",sendMessageImg:r||e.conf.shares.default.image,success:function(e){a.log("打开充值会话成功",e),f&&f(),d&&d()},fail:function(e){a.log("打开充值会话fail",e),f&&f(),h&&h()}})},e.requestMPPayment=e.checkSDK("2.0.3",e.requestMPPayment)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.pos,a=e.style,n=void 0===a?null:a,s=e.ms,r=void 0===s?0:s,c=e.force,d=void 0!==c&&c,u=e.forceTimeout,h=void 0===u?600:u,m=e.onResize,f=void 0===m?null:m;if(S.default.conf&&S.default.conf.banners&&S.default.conf.banners[t]){var g=S.default.conf.banners[t];if(g.enable){var y=void 0,p=x[t];p&&(y=C[p.adUnitId])&&(p.showed&&o(p),(d||Date.now()-y.created>1e3*h)&&function(e){var t=C[e.adUnitId];if(t)t.hide(),t.destroy(),delete C[e.adUnitId]}(p)),r||(r=S.default.getConfig("banner_ms",120)),p||(p={adUnitId:g.adUnitId,pos:t,count:0,ms:r,duration:0,style:n,width:g.width?g.width>1?1:g.width:1,window:"*",data:[],onResize:f,created:Date.now()},x[t]=p),p.count+=1,p.status="success",(y=C[p.adUnitId])||(y=C[p.adUnitId]=function(e){var t=e.banner,a=e.style,n=void 0===a?null:a,i=S.default.systemInfo.screenWidth*t.width,o=(S.default.systemInfo.screenHeight,wx.createBannerAd({adUnitId:t.adUnitId,style:L({left:0,top:0,width:i,height:180*i/750},n)}));return o.created=Date.now(),o.onError(function(e){t.status="error",t.error=e,t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,l(t,"error"),S.default.log("banner 创建失败",t),x[t.pos]&&delete x[t.pos]}),o.onResize(function(e){t.onResize&&t.onResize(e,o)}),o.onLoad(function(e){S.default.log("banner 加载完成",t),o.created=Date.now()}),o}({banner:p,style:n})),p.showed=Date.now(),setTimeout(function(){y.show()},.01),p.ms&&y&&(p.timeout&&clearTimeout(p.timeout),p.timeout=setTimeout(function(){i({pos:t,style:n,ms:r,force:!0,onResize:f})},1e3*r))}}else S.default.log("createBanner 没有配置: "+t)}function o(e){var t=x[e];if(t&&t.showed){var a=C[t.adUnitId];if(a){var n=a.style,i=n.realWidth,o=n.realHeight,l=Date.now()-t.showed;return a.hide(),t.duration+=l,t.data.push({created:a.created,showed:t.showed,duration:l}),t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,t.window=i+"*"+Math.round(o),!0}}return!1}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onHide",a={adUnitId:e.adUnitId,pos:e.pos,ms:e.ms,count:e.count,duration:e.duration,data:JSON.stringify(e.data),window:e.window,status:e.status,error:e.error,commit:t};e.count=0,e.duration=0,e.status="success",e.error="",e.data=[],S.default.log("postBannerData",a),S.default.post({url:"/log/ad/banner",data:a,success:function(e){S.default.log("提交banner数据成功：",e)},fail:function(e){S.default.log("提交banner数据失败：",e)}})}function s(e){return S.default.conf&&S.default.conf.videos&&S.default.conf.videos[e]?!!S.default.conf.videos[e].enable:(S.default.log("createVideo 没有配置: "+e),!1)}function r(e){function t(e){f.status="error",f.error=e,c(f),m&&m(e),u&&u(e),i()}function a(e){f.created=Date.now()}function n(e){m&&m(e),f.duration=Date.now()-f.created,e&&e.isEnded||void 0===e?r&&r({isEnded:!0,duration:f.duration}):(f.status="cancel",r&&r({isEnded:!1,duration:f.duration})),c(f),i()}function i(){g.offError(t),g.offLoad(a),g.offClose(n)}var o=e.pos,l=e.success,r=void 0===l?null:l,d=e.fail,u=void 0===d?null:d,h=e.complete,m=void 0===h?null:h;if(!s(o))return!1;var f={adUnitId:S.default.conf.videos[o].adUnitId,pos:o,status:"success",created:Date.now(),duration:0},g=wx.createRewardedVideoAd({adUnitId:f.adUnitId});return g.onError(t),g.onLoad(a),g.onClose(n),g.show().catch(function(e){console.log("ws.createVideo error:",e),g.load().then(function(){return g.show()})}),!0}function c(e){S.default.post({url:"/log/ad/rewardedvideo",data:e,success:function(e){S.default.log("提交激励视频数据成功：",e)},fail:function(e){S.default.log("提交激励视频数据失败：",e)}})}function d(e){var t;if(S.default.conf&&S.default.conf.games&&(S.default.conf.games[e]?t=S.default.conf.games[e]:S.default.conf.games.default&&(t=S.default.conf.games.default),t&&t.length>0)){S.default.tmp.getMoreGame||(S.default.tmp.getMoreGame={});var a=S.default.tmp.getMoreGame[e];return(!a||a>=t.length)&&(a=0),S.default.tmp.getMoreGame[e]=a+1,t[a]}}function u(e){var t;if(S.default.conf&&S.default.conf.games)if(S.default.conf.games[e]?t=S.default.conf.games[e]:S.default.conf.games.default&&(t=S.default.conf.games.default),t&&t.length>0){for(var a=[],n=0;n<t.length;n++)a.push(t[n].image);S.default.previewImage({urls:w.default.randomSort(a)})}else wx.showToast({title:"没有更多游戏！",icon:"info"});else wx.showToast({title:"没有更多游戏！",icon:"info"})}function h(e){return I&&I[e]?(I[e].showed&&p(e),I[e]):null}function m(e){for(var t in e)I[t]={pos:t,data:e[t]?e[t]:[],last:Date.now(),duration:0,total_ms:0,logs:[],showed:!0}}function f(e){var t=e.pos,a=void 0===t?"default":t,n=e.count,i=void 0===n?1:n,o=e.success,l=void 0===o?null:o,s=e.fail,r=void 0===s?null:s,c=h(a);c?(I[a].showed=!0,l&&l({code:0,data:c.data,key:"SUCCESS"})):S.default.get({url:"/game/ad",data:{pos:a,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,m(t)}l&&l(e)}else r&&r(e)},fail:function(e){r&&r(e)}})}function g(e){var t=e.data,a=void 0===t?[{pos:"default",count:1}]:t,n=e.success,i=void 0===n?null:n,o=e.fail,l=void 0===o?null:o,s={},r=!1,c=!0,d=!1,u=void 0;try{for(var f,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){h(f.value.pos)||(r=!0)}}catch(e){d=!0,u=e}finally{try{!c&&g.return&&g.return()}finally{if(d)throw u}}if(s&&_({ads:s}),r)S.default.post({url:"/game/ad",data:{pos:a},success:function(e){0==e.code?(e.data&&m(e.data),i&&i(e)):l&&l(e)},fail:function(e){l&&l(e)}});else{var y={},p=!0,v=!1,b=void 0;try{for(var L,w=a[Symbol.iterator]();!(p=(L=w.next()).done);p=!0){var x=L.value;I[x.pos].showed=!0,y[x.pos]=I[x.pos].data}}catch(e){v=!0,b=e}finally{try{!p&&w.return&&w.return()}finally{if(v)throw b}}i&&i({code:0,data:y,key:"SUCCESS"})}}function y(e){var t=e.pos,a=void 0===t?"default":t,n=e.count,i=void 0===n?1:n,o=e.success,l=void 0===o?null:o,s=e.fail,r=void 0===s?null:s,c=e.force,d=void 0===c||c,u=h(a);!d&&u?(I[a].showed=!0,l&&l({code:0,data:u.data,key:"SUCCESS"})):S.default.get({url:"/game/ad/feature",data:{pos:a,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,m(t)}l&&l(e)}else r&&r(e)},fail:function(e){r&&r(e)}})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(){function e(e){var t=Date.now(),a=t-e.last;e.logs.push({ms:a,last:e.last,posted:!1}),e.total_ms+=a,e.last=t}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t||I[t])if(t)e(I[t]);else for(var a in I)e(I[a])}(e),I[e]&&(I[e].showed=!1)}function v(e){function t(e){e.image?S.default.previewImage({urls:[e.image],success:function(e){S.default.log("tapGameAD, success"),c&&c(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD，ad参数内image属性缺失")}function a(e){S.default.requireSDK("2.2.0")?e.appid?wx.navigateToMiniProgram({appId:e.appid,path:e.path,success:function(e){S.default.log("tapGameAD, success"),c&&c(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD, ad参数内appid属性缺失"):e.image?t(e):S.default.alert("当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。")}var n=e.ad,i=e.pos,o=void 0===i?"default":i,l=e.redirect,s=void 0!==l&&l,r=e.success,c=void 0===r?null:r,d=e.fail,u=void 0===d?null:d,h=e.complete,m=void 0===h?null:h,f=n;I&&I[o]&&f?(function(e,t){if(!t||!t.cid||!t.id)return!1;b([{pos:e,tid:t.tid,commit:"click",data:[{cid:t.cid,id:t.id,action:t.action}]}])}(o,f),"code"==f.action?t(f):"navigate"==f.action?a(f):s?a(f):t(f)):S.default.log("tapGameAD pos无效，没有对应数据，或未传ad参数")}function b(e){S.default.post({url:"/game/ad/log",data:e,success:function(t){for(var a=0;a<e.length;a++){var n=e[a];"show"==n.commit&&n.pos in I&&(I[n.pos].logs=[])}S.default.log("广告数据提交成功！")},fail:function(e){S.default.log("广告数据提交失败！")}})}function _(e){function t(e){for(var t=[],a=0,n=null,i=0;i<e.logs.length;i++)e.logs[i].posted||(a+=e.logs[i].ms,n=e.logs[i].last);if(!a||!e.data)return t;for(var o={pos:e.pos,tid:e.data[0].tid,commit:"show",last:n,ms:a,data:[]},l=0;l<e.data.length;l++)o.data.push({id:e.data[l].id,cid:e.data[l].cid,action:e.data[l].action});return t.push(o),t}var a=e.ads,n=void 0===a?null:a,i=e.ad,o=void 0===i?null:i;if(!n&&!o)return!1;var l=[];if(n)for(var s in n)l=l.concat(t(n[s]));else o&&(l=t(o));l.length>0&&b(l)}Object.defineProperty(t,"__esModule",{value:!0});var L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initAD=function(e){e.onShow(function(){for(var t in x){var a=x[t];a.isShow&&(e.createBanner({pos:a.pos,style:a.style,ms:a.ms,onResize:a.onResize}),a.isShow=!1)}for(var n=0;n<M.length;n++){var i=M[n];I[i].showed=!0,I[i].last=Date.now()}M=[]}),e.afterHide(function(){for(var e in x){var t=x[e];t.isShow=t.showed,t.isShow&&o(t.pos),t.duration>0&&l(t)}for(var a in I)I[a].showed&&(p(a),M.push(a));_({ads:I})}),e.createBanner=e.checkSDK("2.0.4",i),e.closeBanner=e.checkSDK("2.0.4",o),e.createVideo=e.checkSDK("2.0.4",r),e.isEnableVideo=s,e.getMoreGame=d,e.showMoreGame=u,e.getGameAd=f,e.hideGameAd=p,e.tapGameAd=v,e.fetchGameAd=g,e.getPromoGameAd=y};var S=n(a(1)),w=n(a(2)),x={},C={},I={},M=[]},function(e,t,a){"use strict";function n(e,t){e[t]=function(){var a;return e.mode=t,"aldShareAppMessage"==t&&(e.mode="shareAppMessage"),(a=wx)[t].apply(a,arguments)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initHook=function(e){e.setMode=function(t){e.mode=t},n(e,"previewImage"),n(e,"openCustomerServiceConversation"),n(e,"shareAppMessage"),n(e,"aldShareAppMessage")};var i;(i=a(1))&&i.__esModule},function(e,t,a){"use strict";function n(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function i(e){var t=e.pos,a=void 0===t?null:t,n=e.success,i=void 0===n?null:n,o=e.fail,l=void 0===o?null:o,s={};a&&(s.pos=a),v.default.get({url:"/invited/users/count",data:s,success:function(e){i&&i(e.data.count)},fail:function(e){l&&l(e)}})}function o(e){var t=e.pos,a=void 0===t?null:t,n=e.receive,i=void 0===n||n,o=e.skip,l=void 0===o?0:o,s=e.limit,r=void 0===s?-1:s,c=e.success,d=void 0===c?null:c,u=e.fail,h=void 0===u?null:u,m={skip:l,limit:r,receive:i};a&&(m.pos=a),v.default.get({url:"/invited/users",data:m,success:function(e){d&&d(e.data)},fail:function(e){h&&h(e)}})}function l(e){var t=e.user,a=e.pos,n=void 0===a?null:a,i=e.success,o=void 0===i?null:i,l=e.fail,s=void 0===l?null:l,r={users:[{id:t.id,gift:t.gift}]};n&&(r.pos=n),v.default.post({url:"/invited/gift/receive",data:r,success:function(e){o&&o(e.data.receive[0])},fail:function(e){s&&s(e)}})}function s(e){var t=e.users,a=e.pos,n=void 0===a?null:a,i=e.success,o=void 0===i?null:i,l=e.fail,s=void 0===l?null:l,r={users:[]},c=!0,d=!1,u=void 0;try{for(var h,m=t[Symbol.iterator]();!(c=(h=m.next()).done);c=!0){var f=h.value;r.users.push({id:f.id,gift:f.gift})}}catch(e){d=!0,u=e}finally{try{!c&&m.return&&m.return()}finally{if(d)throw u}}n&&(r.pos=n),v.default.post({url:"/invited/gift/receive",data:r,success:function(e){o&&o(e.data.receive)},fail:function(e){s&&s(e)}})}function r(e,t){if(t&&t.gift){var a={type:e,gift:t.gift,uid:t.uid,share_tid:t.share_tid},n=v.default.conf[t.gift];n&&(a.receive=!0),v.default.post({url:"/share/gift/log",data:a,success:function(e){if(n){var i=e.data;i.is_self&&n.not_allow_self?v.default.alert(n.not_allow_self_tip||"不能领取自己送出的礼物～"):i.user_count>=(n.date_limit||2)?v.default.alert(n.date_limit_tip||"今天已经领取太多次了～"):i.user_share_count>=(n.share_date_limit||1)?v.default.alert(n.share_date_limit_tip||"已经领取过该礼物了～"):i.count>=(n.limit||10)?v.default.alert(n.limit_tip||"该礼物被领光了～"):(e={gift:t.gift,query:t,conf:n,options:a,data:i},v.default._onGiftCallback&&v.default._onGiftCallback(e))}}})}}function c(e){e.from;var t=e.query;e.options,r("share",t)}function d(e){e.from,e.scene,e.options,r("code",e.query)}function u(e){v.default._onGiftCallback=e}function h(e){var t=e.gifts,a=e.users,n=void 0===a||a,i=e.receive,o=void 0===i||i,l=e.dateLimit,s=void 0===l?0:l,r=e.cache,c=void 0===r?60:r,d=e.limit,u=void 0===d?0:d,h=e.success,m=void 0===h?null:h,f=e.fail,g=void 0===f?null:f;if("boolean"==typeof n&&"boolean"==typeof o&&"number"==typeof s&&"number"==typeof c&&"number"==typeof u){var y=!0,p=[t.sort().toString(),n,o,s,u].join("-");v.default.shareGiftTempData&&v.default.shareGiftTempData[p]&&Date.now()-v.default.shareGiftTempData[p].ms<1e3*c&&(y=!1),y?v.default.post({url:"/share/gift/receive",data:{gifts:t,is_users:n,receive:o,date_limit:s,limit:u},success:function(e){v.default.shareGiftTempData[p]={data:e.data,ms:Date.now()},m&&m(e.data)},fail:g}):m&&m(v.default.shareGiftTempData[p].data)}else v.default.log("requestShareGift, 参数格式异常")}function m(e){var t=e.users,a=e.success,n=void 0===a?null:a,i=e.fail,o=void 0===i?null:i;Array.isArray(t)?v.default.post({url:"/share/gift/receive2",data:{users:t},success:function(e){n&&n(e)},fail:function(e){o&&o(e)}}):v.default.log("receiveShareGift, users参数格式错误")}function f(e){var t=e.pos,a=e.bg,i=void 0===a||a,o=e.success,l=void 0===o?null:o,s=e.fail,r=void 0===s?null:s,c=n(e,["pos","bg","success","fail"]);v.default.post({url:"/share/qrcode",data:y({pos:t,bg:i,uid:v.default.user.id,share_tid:Date.now()+""},c),success:function(e){l&&l(e.data)},fail:r})}function g(e){var t=e.pos,a=e.bg,i=void 0===a||a,o=e.filePath,l=void 0===o?"":o,s=e.success,r=void 0===s?null:s,c=e.fail,d=void 0===c?null:c,u=e.complete,h=void 0===u?null:u,m=n(e,["pos","bg","filePath","success","fail","complete"]);f(y({pos:t,bg:i,success:function(e){!function(t){var a=e.codeUrl;wx.downloadFile({url:a,filePath:l,success:function(e){200==e.statusCode&&(v.default.alert("download success",e.tempFilePath),v.default.log("download success",e.tempFilePath),l||(l=e.tempFilePath,wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){r&&r(e)},fail:function(e){d&&d(e)},complete:function(e){h&&h(e)}})))},fail:function(e){d&&d(e)},complete:function(e){h&&h(e)}})}()},fail:d},m))}Object.defineProperty(t,"__esModule",{value:!0});var y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initInvite=function(e){e.getInviteCount=i,e.getInviteUsers=o,e.receiveInviteGift=l,e.receiveInviteGifts=s,e.openFromShare(c),e.openFromCode(d),e.onShareGift=u,e.requestShareGift=h,e.receiveShareGift=m,e.getWXACode=f,e.saveWXACode=g};var p,v=(p=a(1))&&p.__esModule?p:{default:p}},function(e,t,a){"use strict";function n(e,t){l.index+=1,l.events.push({event:e,data:t?JSON.stringify(t):null,tm:Date.now()})}Object.defineProperty(t,"__esModule",{value:!0}),t.initEvent=function(e){e.afterHide(function(){o.default.post({url:"/log/event",data:l,success:function(e){0==e.code&&(l.events=[]),o.default.log("事件日志提交成功！")},fail:function(e){o.default.log("事件日志提交失败！")}})}),e.traceEvent=n};var i,o=(i=a(1))&&i.__esModule?i:{default:i},l={index:0,events:[]}}])},{}],17:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=window.wx},{}],18:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=Laya.View,i=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("cannonSelect/CannonSelect")},t}(n);e.CannonSelectUI=t,i("ui.cannonSelect.CannonSelectUI",t)}(e.cannonSelect||(e.cannonSelect={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(n);e.GameSceneUI=t,i("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},t}(n);e.HomeViewUI=t,i("ui.home.HomeViewUI",t)}(e.home||(e.home={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},t}(n);e.OverViewUI=t,i("ui.over.OverViewUI",t)}(e.over||(e.over={}))}(a.ui||(a.ui={}))},{}]},{},[2]);