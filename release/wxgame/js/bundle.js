var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();!function(){function e(t,a,i){function n(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(o)return o(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=a[r]={exports:{}};t[r][0].call(d.exports,function(e){return n(t[r][1][e]||e)},d,d.exports,e,t,a,i)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)n(i[r]);return n}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./script/runtime/GameScene"),n=e("./script/runtime/HomeView"),o=e("./script/component/Reward"),r=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("script/runtime/GameScene.ts",i.default),e("script/runtime/HomeView.ts",n.default),e("script/component/Reward.ts",o.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="home/HomeView.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=r,r.init()},{"./script/component/Reward":8,"./script/runtime/GameScene":10,"./script/runtime/HomeView":11}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./GameConfig");new(function(){function e(){window.Laya3D?Laya3D.init(i.default.width,i.default.height):Laya.init(i.default.width,i.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=i.default.scaleMode,Laya.stage.screenMode=i.default.screenMode,Laya.URL.exportSceneToJson=i.default.exportSceneToJson,(i.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),i.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),i.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.height=Math.round(i.default.width*Laya.Browser.height/Laya.Browser.width)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){i.default.startScene&&Laya.Scene.open(i.default.startScene)},e}())},{"./GameConfig":1}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.0.3",a.RewardPos={Cannon:"try_cannon",Bullet:"try_ball",OverShare:"OverShare",Revive:"revive"},a.BannerPos={HomeView:"HomeView",GameScene:"HomeView",OverView:"HomeView",ReviveDialog:"HomeView"},a.ReviveCountdown=5;!function(e){e[e.START=1]="START",e[e.OVER=2]="OVER"}(a.GameState||(a.GameState={})),a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_OverView="over/OverView.scene",a.URL_ReviveView="dialog/ReviveView.scene",a.CameraInitPos=new Laya.Vector3(0,.3,.2),a.CameraInitRotEuler=new Laya.Vector3(0,0,0),a.LightInitPos=new Laya.Vector3(0,5,0),a.LightInitRotEuler=new Laya.Vector3(-30,0,0),a.LightInitColor=new Laya.Vector3(1,1,1),a.StageTexUrl=["res/stage/out/materials/mutou_06.jpg","res/stage/out/materials/box_13.png","res/stage/out/materials/TNT.png"],a.StageResUrl="res/stage/out/",a.StageInitPos=new Laya.Vector3(0,0,0),a.StageInitRot=new Laya.Vector3(0,180,0),a.StageInitScale=new Laya.Vector3(20,20,20),a.StageNum=10,a.MaxWinCheckTime=30,a.SetKinematicWaitTime=10,a.BgResUrl=["res/scene/Scenes_02.lh","res/scene/Scenes_04.lh","res/scene/Scenes_07.lh"],a.GlassBrokenVelocity=10,a.GlassFallingBrokenVelocity=1,a.PieceResUrl="res/cube_piece.lm",a.PiecesNum=3,a.PiecesBrokenTime=120,a.CannonInitPos=new Laya.Vector3(0,.04,-.2),a.CannonInitRot=new Laya.Vector3(0,180,0),a.CannonInitScale=new Laya.Vector3(25,25,25),a.TurretInitLocalRot=new Laya.Vector3(0,0,0),a.CannonBallBoxUrl="res/ball_box/ball_box.lh",a.CannonBallInitPos=new Laya.Vector3(-.01,.05,-.13),a.CannonBallInitScale=new Laya.Vector3(25,25,25),a.cdnUrl="https://static.miniant.cn/cannon/res2.zip",a.soundUrl="res/audio/shoot.mp3",a.BulletMeshUrl="res/bullet/bullet.lm",a.BulletLightningUrl="res/bullet/lightning/lightning.lh",a.BulletRewardResUrl={1:"res/bullet/blackhole/blackhole.lh"},a.cannonEffectUrl={1:"res/cannon_effect/gunlightning.lh"},a.BulletRadius=.08,a.CannonResUrl={1:"res/cannon/Cannon_Default.lh",2:"res/cannon/Cannon_ShotgunX2.lh",3:"res/cannon/Cannon_Frozen.lh",4:"res/cannon/Cannon_Reward.lh",5:"res/cannon/Cannon_Bomb.lh",6:"res/cannon/Cannon_Lightning.lh"},a.BulletTextureUrl={1:"res/bullet/ball_texture/normal.jpg",2:"res/bullet/ball_texture/shotgun.jpg",3:"res/bullet/ball_texture/ice.jpg",4:"res/bullet/ball_texture/shotgun.jpg",5:"res/bullet/ball_texture/boom.jpg",6:"res/bullet/ball_texture/lightning.jpg"},a.BulletScale={0:{1:1,2:1,3:1,4:1,5:1,6:1},1:{1:7}},a.BulletMass={0:{1:20,2:20,3:20,4:20,5:20,6:100},1:{1:100}},a.BulletVelocity={0:{1:30,2:30,3:30,4:30,5:30,6:30},1:{1:5}},a.BulletTrigger={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1},1:{1:!0}},a.BulletOverrideGravity={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1},1:{1:!0}}},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default={gameData:{musicEnabled:!0,soundEnabled:!0,vibrationEnabled:!0,updateTimestamp:0,videoCount:0,lastVideoTimestamp:0,shareCount:0,lastShareTimestamp:0,stageIndex:1,cannonType:1},config:{skin_block:!1,share_first:!1,allow_share:!0,allow_video:!0,share_number:5,video_number:6,share_time:30,banner_time:180,share_delay:4,online:!0,debug:!1,allow_pay:!1,allow_revive:!0,banner_delay:1,banner_delay_ratio:.8,banner_delay_ratio1:.8,share_fail:"'操作失败，请换个群'",distance_iphonex:50,banner_click_time:2,games:{},shares:{},videos:{},banners:{},try_cannon:1,try_ball:1,revive:1},user:{},audio:{volume:.5}}},{}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Map={Android:{1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30},IOS:{1:1,2:2,3:5,4:6,5:25,6:6,7:30,8:8,9:6,10:9,11:11,12:9,13:10,14:14,15:19,16:16,17:26,18:18,19:30,20:20,21:19,22:22,23:14,24:6,25:25,26:25,27:30,28:1,29:2,30:5}},a.Stage={Android:{1:{1:{min:1,max:1,ball_add:6},2:{min:2,max:2,ball_add:5},3:{min:3,max:3,ball_add:5},4:{min:4,max:4,ball_add:5},5:{min:6,max:6,ball_add:5}},2:{1:{min:5,max:20,ball_add:3},2:{min:5,max:20,ball_add:3},3:{min:5,max:20,ball_add:3},4:{min:5,max:20,ball_add:3},5:{min:8,max:8,ball_add:3}},3:{1:{min:5,max:30,ball_add:2},2:{min:5,max:30,ball_add:2},3:{min:5,max:30,ball_add:2},4:{min:5,max:30,ball_add:2},5:{min:11,max:11,ball_add:2}},4:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:15,max:15,ball_add:2}},5:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:23,max:23,ball_add:2}},6:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:24,max:24,ball_add:2}},7:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:15,max:15,ball_add:2}},8:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:25,max:25,ball_add:2}},9:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:28,max:28,ball_add:2}},10:{1:{min:5,max:30,ball_add:2},2:{min:5,max:30,ball_add:2},3:{min:5,max:30,ball_add:2},4:{min:5,max:30,ball_add:2},5:{min:27,max:27,ball_add:2}}},IOS:{1:{1:{min:1,max:1,ball_add:6},2:{min:2,max:2,ball_add:5},3:{min:3,max:3,ball_add:5},4:{min:4,max:4,ball_add:5},5:{min:5,max:5,ball_add:5}},2:{1:{min:5,max:20,ball_add:3},2:{min:5,max:20,ball_add:3},3:{min:5,max:20,ball_add:3},4:{min:5,max:20,ball_add:3},5:{min:5,max:20,ball_add:3}},3:{1:{min:5,max:30,ball_add:2},2:{min:5,max:30,ball_add:2},3:{min:5,max:30,ball_add:2},4:{min:5,max:30,ball_add:2},5:{min:16,max:16,ball_add:2}},4:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:20,max:20,ball_add:2}},5:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:11,max:11,ball_add:2}},6:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:18,max:18,ball_add:2}},7:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:20,max:20,ball_add:2}},8:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:23,max:23,ball_add:2}},9:{1:{min:10,max:30,ball_add:2},2:{min:10,max:30,ball_add:2},3:{min:10,max:30,ball_add:2},4:{min:10,max:30,ball_add:2},5:{min:21,max:21,ball_add:2}},10:{1:{min:5,max:30,ball_add:2},2:{min:5,max:30,ball_add:2},3:{min:5,max:30,ball_add:2},4:{min:5,max:30,ball_add:2},5:{min:22,max:22,ball_add:2}}}},a.StageRaw={1:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},2:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},3:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},4:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},5:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},6:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},7:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},8:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},9:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},10:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},11:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},12:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},13:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},14:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},15:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},16:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},17:{ball_num:5,rotate:!1,move_x:!1,move_y:!1,move_z:!1},18:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},19:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},20:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},21:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},22:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},23:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},24:{ball_num:4,rotate:!1,move_x:!1,move_y:!1,move_z:!1},25:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},26:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},27:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},28:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1},29:{ball_num:2,rotate:!1,move_x:!1,move_y:!1,move_z:!1},30:{ball_num:3,rotate:!1,move_x:!1,move_y:!1,move_z:!1}}},{}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../runtime/GameScene"),n=e("../Const"),o=e("./Target"),r=e("./Guard"),s=function(e){function t(){var t=e.call(this)||this;return t.collisionBlackList=["bullet","player"],t}return __extends(t,e),t.prototype.onAwake=function(){this.bullet||(this.bullet=this.owner)},t.prototype.init=function(){this.rigidbody=this.bullet.addComponent(Laya.Rigidbody3D),this.rigidbody.colliderShape=new Laya.SphereColliderShape(n.BulletRadius),this.material=new Laya.PBRSpecularMaterial,this.bullet.meshRenderer.material=this.material},t.prototype.reset=function(e,t){var a=this;void 0===t&&(t=!1),this.bullet=this.owner,this.isReward=t,this.type=e,this.effect=this.bullet.getChildByName("effect"),this.lifetime=120,this.isReward&&1===this.type&&(this.lifetime=300),this.flag_active=!1,void 0===this.rigidbody&&this.init(),this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_FADE,this.material.albedoColorA=0,this.isReward||Laya.Texture2D.load(n.BulletTextureUrl[this.type],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.effect&&(this.effect.active=!1),this.bullet.transform.localPosition=i.default.instance.turretInitPos.clone(),this.bullet.transform.localRotationEuler=n.StageInitRot.clone(),Laya.Vector3.scale(new Laya.Vector3(1,1,1),n.BulletScale[+this.isReward][this.type],this.bullet.transform.localScale),this.effect&&Laya.Vector3.scale(this.effect.transform.localScale,1/n.BulletScale[+this.isReward][this.type],this.effect.transform.localScale),this.rigidbody.isTrigger=n.BulletTrigger[+this.isReward][this.type],this.rigidbody.ccdMotionThreshold=.001,this.rigidbody.ccdSweptSphereRadius=n.BulletRadius*n.BulletScale[+this.isReward][this.type],this.rigidbody.mass=n.BulletMass[+this.isReward][this.type];var o=i.default.instance.bulletDirection.clone();Laya.Vector3.scale(o,n.BulletVelocity[+this.isReward][this.type],o),this.rigidbody.linearVelocity=o.clone(),this.rigidbody.overrideGravity=n.BulletOverrideGravity[+this.isReward][this.type],this.rigidbody.overrideGravity&&(this.rigidbody.gravity=new Laya.Vector3(0,0,0)),"bulletTrigger"===this.bullet.name&&(this.rigidbody.isTrigger=!0,this.rigidbody.ccdMotionThreshold=1e-4,this.rigidbody.ccdSweptSphereRadius=n.BulletRadius*n.BulletScale[+this.isReward][this.type]/1e3)},t.prototype.onCollisionExit=function(e){"bulletTrigger"===this.bullet.name&&this.recover()},t.prototype.onTriggerEnter=function(e){this.triggerHandler(e)},t.prototype.triggerHandler=function(e){if(this.isReward&&1===this.type){i.default.instance.isStageStart=!0;var t=e.owner;if("stand"===t.name||t.name.indexOf("Guard")>=0||t.name.indexOf("Obstacle")>=0){t.timer.frameOnce(1,this,function(){t.getComponent(Laya.PhysicsCollider)&&t.getComponent(Laya.PhysicsCollider).destroy(),t.getComponent(Laya.Rigidbody3D)&&t.getComponent(Laya.Rigidbody3D).destroy(),t.getComponent(o.default)&&t.getComponent(o.default).destroy(),t.getComponent(r.default)&&t.getComponent(r.default).destroy()});var a=0,n=t.transform.localScaleX/120,s=t.transform.localScaleY/120,l=t.transform.localScaleZ/120,c=(this.bullet.transform.position.x-t.transform.position.x)/120/i.default.instance.gameStage.transform.scale.x,d=(this.bullet.transform.position.y-t.transform.position.y)/120/i.default.instance.gameStage.transform.scale.y,u=(this.bullet.transform.position.z-t.transform.position.z)/120/i.default.instance.gameStage.transform.scale.z,h=5*Math.random(),f=5*Math.random(),m=5*Math.random();t.timer.frameLoop(1,t,function(){if(a++>60)return t.timer.clearAll(t),void t.destroy();t.transform.localScaleX-=n,t.transform.localScaleY-=s,t.transform.localScaleZ-=l,t.transform.localPositionX-=c,t.transform.localPositionY+=d,t.transform.localPositionZ-=u,t.transform.localRotationEulerX+=h,t.transform.localRotationEulerY+=f,t.transform.localRotationEulerZ+=m})}}},t.prototype.onUpdate=function(){this.lifetime--,this.lifetime<0&&this.recover(),"bullet"===this.bullet.name&&!this.flag_active&&this.bullet.transform.position.z<-1&&(this.flag_active=!0,this.refreshMaterial(),this.effect&&(this.effect.active=!0)),this.effect&&!this.rigidbody.isTrigger&&(this.effect.transform.localRotationEulerX=-this.bullet.transform.localRotationEulerX,this.effect.transform.localRotationEulerY=-this.bullet.transform.localRotationEulerY,this.effect.transform.localRotationEulerZ=-this.bullet.transform.localRotationEulerZ)},t.prototype.refreshMaterial=function(){this.isReward||(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,this.material.albedoColorA=1)},t.prototype.recover=function(){var e=this;this.isReward?Laya.timer.frameOnce(1,this,function(){e.destroy()}):Laya.timer.frameOnce(1,this,function(){e.rigidbody.clearForces(),e.bullet.removeChildByName("effect"),e.bullet.removeSelf(),"bulletTrigger"===e.bullet.name?Laya.Pool.recover("bulletTrigger",e.bullet):Laya.Pool.recover("bullet",e.bullet)})},t}(Laya.Script3D);a.default=s},{"../Const":3,"../runtime/GameScene":10,"./Guard":7,"./Target":9}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../Const"),n=function(e){function t(){var t=e.call(this)||this;return t.moveTimes=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.boundingBox.clone();this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);var t=new Laya.PBRSpecularMaterial;if(Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(this,function(e){t.albedoTexture=e})),t.specularColor=new Laya.Vector4(0,0,0,1),t.enableEmission=!0,t.emissionColor=new Laya.Vector4(.2,.2,.2,1),this.guard.meshRenderer.material=t,this.guard.name.search("move_x")>=0)this.MaxMoveTimes=120,this.moveStepY=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepX=2*this.guard.transform.localPositionY/this.MaxMoveTimes:this.moveStepX=2*this.guard.transform.localPositionX/this.MaxMoveTimes;else if(this.guard.name.search("move_y")>=0)this.MaxMoveTimes=120,this.moveStepX=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepY=2*this.guard.transform.localPositionX/this.MaxMoveTimes:this.moveStepY=2*this.guard.transform.localPositionY/this.MaxMoveTimes;else if(this.guard.name.search("move_")>=0){this.MaxMoveTimes=60;var a=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,n=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var o=a;a=n,n=o}this.guard.name.search("move_left")>=0?(this.moveStepX=-a,this.moveStepY=0):this.guard.name.search("move_right")>=0?(this.MaxMoveTimes=60,this.moveStepX=a,this.moveStepY=0):this.guard.name.search("move_up")>=0?(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=-n):this.guard.name.search("move_down")>=0&&(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=n)}},t.prototype.onUpdate=function(){this.guard.destroyed?this.destroy():this.guard.name.search("move")>=0?(this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes),this.flag_move=Math.floor(this.moveTimes/this.MaxMoveTimes%2)>0,this.flag_move?(this.guard.transform.localPositionX+=this.moveStepX,this.guard.transform.localPositionY+=this.moveStepY):(this.guard.transform.localPositionX-=this.moveStepX,this.guard.transform.localPositionY-=this.moveStepY)):this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)},t}(Laya.Script3D);a.default=n},{"../Const":3}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../utils/wx"),n=e("../utils/ws.js"),o=e("../utils/Ad"),r=e("../Global"),s=function(e){function t(){var a=e.call(this)||this;return a.shareTimestampMap={},a.lastShareTimestamp=0,console.log("Reward constructor()"),t.instance=a,a}return __extends(t,e),t.prototype.onAwake=function(){var e=this;console.log("Reward onAwake()"),Laya.Browser.onMiniGame&&i.default.onShow(function(t){var a=e.shareArgs;if(a&&a.length){var n=a[0]||{},o=n.pos,s=n.success,l=n.fail,c=n.complete;try{var d=Date.now();s||l?d-e.lastShareTimestamp>1e3*(r.default.config.share_delay||5)?(r.default.gameData.shareCount++,r.default.gameData.lastShareTimestamp=d,e.shareTimestampMap[o]=d,s&&s(t),c&&c(t)):(e.shareTimestampMap[o]=0,i.default.showModal({title:"提示",content:r.default.config.share_fail,cancelText:"知道了",confirmText:"重新发送",success:function(i){i.confirm?e.share.apply(e,a):(l&&l(t),c&&c(t))}})):(e.shareTimestampMap[o]=0,c&&c(t))}finally{e.lastShareTimestamp=0,e.shareArgs=null}}})},t.prototype.reward=function(e){var t=e.pos,a=e.query,i=e.success,n=e.fail,o=e.complete;this.isShareState(t)?this.share({pos:t,query:a,success:i,fail:n,complete:o}):this.video({pos:t,success:i,fail:n,complete:o})},t.prototype.share=function(e){var t=e.pos,a=e.query,i=e.success,o=e.fail,s=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),o&&o(),void(s&&s());if(!this.isOnline()||!this.allowShare(t))return console.log("今日视频已看完"),o&&o(),void(s&&s());var l=Date.now(),c=Number(this.shareTimestampMap[t]);if(c&&l-c<1e3*r.default.config.share_time)return console.log("请稍等一会再操作"),o&&o(),void(s&&s());(i||o)&&(this.shareTimestampMap[t]=l),this.lastShareTimestamp=Date.now(),this.shareArgs=arguments,n.default.share({pos:t,query:a})},t.prototype.video=function(e){var t=e.pos,a=e.success,i=e.fail,n=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),i&&i(),void(n&&n());o.posShowVideo(t,function(){console.log("今日视频已看完"),i&&i(),n&&n()},function(e){e&&e.isEnded||void 0===e?(r.default.gameData.videoCount++,r.default.gameData.lastVideoTimestamp=Date.now(),a&&a()):i&&i(),n&&n()})},t.prototype.allowShare=function(e){var t=r.default.config[e+"_allow_share"];return"boolean"==typeof t?t:r.default.config.allow_share},t.prototype.allowVideo=function(e){var t=r.default.config[e+"_allow_video"];return"boolean"==typeof t?t:r.default.config.allow_video},t.prototype.isOnline=function(){return r.default.config.online},t.prototype.isShareFirst=function(e){var t=r.default.config[e+"_share_first"];return"boolean"==typeof t?t:r.default.config.share_first},t.prototype.getShareCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastShareTimestamp||r.default.gameData.lastShareTimestamp<t)&&(r.default.gameData.shareCount=0),r.default.gameData.shareCount},t.prototype.isOverShare=function(){return r.default.config.share_number&&r.default.config.share_number<=this.getShareCount()},t.prototype.getVideoCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastVideoTimestamp||r.default.gameData.lastVideoTimestamp<t)&&(r.default.gameData.videoCount=0),r.default.gameData.videoCount},t.prototype.isOverVideo=function(){return r.default.config.video_number&&r.default.config.video_number<=this.getVideoCount()},t.prototype.hasVideo=function(){return o.hasVideoAd()},t.prototype.isShareState=function(e){return!(!this.isOnline()||!this.allowShare(e))&&(!this.allowVideo(e)||!this.hasVideo()||(this.isShareFirst(e)?!this.isOverShare()||this.isOverVideo():this.isOverVideo()))},t}(Laya.Script);a.default=s},{"../Global":4,"../utils/Ad":12,"../utils/ws.js":15,"../utils/wx":16}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../Const"),n=e("../runtime/GameScene"),o=e("../component/Bullet"),r=function(e){function t(){var t=e.call(this)||this;return t.type=1,t.collisionWhiteList=["bullet","Obstacle"],t.piecesList=[],t.jumpCnt=0,t}return __extends(t,e),t.prototype.onAwake=function(){var e=this;this.target=this.owner,this.setRigidbody(),Laya.timer.frameOnce(i.SetKinematicWaitTime,this,function(){n.default.instance.isStageStart||(e.rigidbody.isKinematic=!0)}),this.initPieces()},t.prototype.onCollisionEnter=function(e){this.collisionHandler(e)},t.prototype.onCollisionStay=function(e){this.collisionHandler(e)},t.prototype.onCollisionExit=function(e){this.collisionHandler(e)},t.prototype.collisionHandler=function(e){for(var t=this,a=e.other.owner,r=!1,s=0,l=this.collisionWhiteList;s<l.length;s++){var c=l[s];if(a.name.indexOf(c)>=0){r=!0;break}}if(2===this.type){if(this.jumpCnt>60){(u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)))>=i.GlassFallingBrokenVelocity&&this.broken()}if(r){var d=a.getComponent(Laya.Rigidbody3D).linearVelocity.clone(),u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)),h=Laya.Vector3.distance(d,new Laya.Vector3(0,0,0));(u>=i.GlassBrokenVelocity||h>=i.GlassBrokenVelocity)&&this.broken()}else"ground"!==a.name&&"bomb"!==a.name||this.broken()}else if(3===this.type&&this.target.parent)if(a.name.indexOf("bullet")>=0||a.name.indexOf("bomb")>=0)this.TNTBomb();else{var f=a.getComponent(Laya.Rigidbody3D),d=new Laya.Vector3(0,0,0);f&&(d=f.linearVelocity.clone()),Laya.Vector3.distance(d,this.rigidbody.linearVelocity)>=10&&this.TNTBomb()}if("stand"===a.name||a.name.indexOf("Guard")>=0)n.default.instance.winCheckCnt=0;else if("ground"===a.name)Laya.timer.frameOnce(60,this,function(){t.destroy(),t.target&&t.target.destroy()});else if("bullet"===a.name||"bulletTrigger"===a.name)this.bulletHit(a.getComponent(o.default));else if("bomb"===a.name){var m=new Laya.Vector3;Laya.Vector3.subtract(this.target.transform.position,a.transform.position,m),Laya.Vector3.normalize(m,m),Laya.Vector3.scale(m,20/a.transform.localScaleX,m),Laya.Vector3.add(this.rigidbody.linearVelocity,m,m),this.rigidbody.linearVelocity=m}this.jumpCnt=0},t.prototype.TNTBomb=function(){var e=this,t=this.sizeX/2*this.target.transform.localScaleX*1,a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(t));n.default.instance.scene3D.addChild(a),a.name="bomb";var i=a.addComponent(Laya.PhysicsCollider);i.colliderShape=new Laya.SphereColliderShape(t),i.isTrigger=!0,i.collisionGroup=3,i.canCollideWith=1,a.transform.position=this.target.transform.position.clone(),a.transform.scale=this.target.transform.scale.clone();var o=new Laya.UnlitMaterial;a.meshRenderer.material=o,o.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,o.albedoColor=new Laya.Vector4(1,.5,0,.2),this.target.removeSelf();var r=0,s=.4*a.transform.localScaleX,l=.4*a.transform.localScaleY,c=.4*a.transform.localScaleZ;a.timer.frameLoop(1,a,function(){if(r++>15)return a.timer.clearAll(a),a.destroy(),e.target&&e.target.destroy(),void e.destroy();a.transform.localScaleX+=s,a.transform.localScaleY+=l,a.transform.localScaleZ+=c})},t.prototype.bulletHit=function(e){e.isReward||3===e.type&&2!==this.type&&this.setType(2)},t.prototype.onUpdate=function(){this.target.destroyed?this.destroy():(this.rigidbody.isKinematic&&n.default.instance.isStageStart&&(this.rigidbody.isKinematic=!1),this.jumpCnt++,this.refreshRenderMode(),this.distance=Laya.Vector3.distance(this.target.transform.position,n.default.instance.gameStage.transform.position),this.distance<15&&(n.default.instance.winCheckCnt=0),this.rigidbody.destroyed||0!=this.rigidbody.isActive||(console.log("Physics_engine_bug_fixing: Reset rigidbody."),this.refreshRigidbody()))},t.prototype.refreshRenderMode=function(){2===this.type?this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT:this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE},t.prototype.refreshRigidbody=function(){this.rigidbody&&(console.log("refresh rigidbody"),this.rigidbody.destroy(),this.setRigidbody())},t.prototype.setType=function(e){var t=this;this.type=e,this.material=this.target.meshRenderer.material,this.material||(this.material=new Laya.PBRSpecularMaterial,this.target.meshRenderer.material=this.material),1===this.type?(Laya.Texture2D.load(i.StageTexUrl[1],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)):2===this.type?(this.material.albedoTexture=null,this.material.albedoColor=new Laya.Vector4(.7,.7,1,.7),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.2,.2,.2,1)):3===this.type&&(Laya.Texture2D.load(i.StageTexUrl[2],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)),this.refreshRenderMode()},t.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.boundingBox.clone();if(this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z,this.rigidbody=this.target.addComponent(Laya.Rigidbody3D),this.target.name.search("Cube")>=0)this.rigidbody.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else if(this.target.name.search("Cylinder")>=0)this.rigidbody.colliderShape=new Laya.CylinderColliderShape(this.sizeX/2,this.sizeY);else{var t=new Laya.MeshColliderShape;t.mesh=this.target.meshFilter.sharedMesh,this.rigidbody.colliderShape=t}this.setPhysicsParam()},t.prototype.setPhysicsParam=function(){this.rigidbody.isKinematic=!1,1===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):2===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):3===this.type&&(this.rigidbody.mass=50,this.rigidbody.friction=100)},t.prototype.broken=function(){var e=this;this.effectPiecesBroken(),Laya.timer.frameOnce(2,this,function(){e.target.active=!1})},t.prototype.initPieces=function(){var e=this;Laya.Mesh.load(i.PieceResUrl,Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(t);a.active=!1,a.name="piece";var o=new Laya.PBRSpecularMaterial;o.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,o.albedoTexture=null,o.albedoColor=new Laya.Vector4(.7,.7,1,.7),o.specularColor=new Laya.Vector4(0,0,0,1),o.enableEmission=!0,o.emissionColor=new Laya.Vector4(.2,.2,.2,1),a.meshRenderer.material=o;var r=a.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=a.meshFilter.sharedMesh,r.colliderShape=s,r.collisionGroup=2,r.canCollideWith=1;for(var l=i.PiecesNum-Math.round(Math.random()),c=0;c<l;c++)e.piecesList.push(a.clone()),n.default.instance.scene3D.addChild(e.piecesList[c])}))},t.prototype.effectPiecesBroken=function(){var e=this,t=function(t){a.piecesList[t].active=!0;var n=1.5*(.5*Math.random()+.5)*a.sizeX*a.target.transform.localScaleX*i.StageInitScale.x,o=1.5*(.5*Math.random()+.5)*a.sizeY*a.target.transform.localScaleY*i.StageInitScale.y,r=1.5*(.5*Math.random()+.5)*a.sizeZ*a.target.transform.localScaleZ*i.StageInitScale.z;a.piecesList[t].transform.localScale=new Laya.Vector3(n,o,r),a.piecesList[t].transform.localRotationEulerX=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerY=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerZ=2*(Math.random()-.5)*90;var s=new Laya.Vector3;s.x=(Math.random()-.5)*i.StageInitScale.x/80,s.y=(Math.random()-.5)*i.StageInitScale.y/80,s.z=(Math.random()-.5)*i.StageInitScale.z/80,a.piecesList[t].transform.position=a.target.transform.position.clone(),Laya.Vector3.add(a.piecesList[t].transform.localPosition,s,a.piecesList[t].transform.localPosition),Laya.Vector3.scale(s,50,s),Laya.Vector3.add(s,a.rigidbody.linearVelocity,s),a.piecesList[t].getComponent(Laya.Rigidbody3D).linearVelocity=s.clone(),Laya.Tween.to(a.piecesList[t].transform.localScale,{x:n/2,y:o/2,z:r/2},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(a.piecesList[t].meshRenderer.material,{albedoColorA:0},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(a,function(){e.piecesList[+t].destroy()}))},a=this;for(var n in this.piecesList)t(n)},t}(Laya.Script3D);a.default=r},{"../Const":3,"../component/Bullet":6,"../runtime/GameScene":10}],10:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../../ui/layaMaxUI"),n=e("../Const"),o=e("../Global"),r=e("../utils/Navigator"),s=e("../utils/wx"),l=e("../utils/ws.js"),c=e("../utils/Ad"),d=e("../component/Bullet"),u=e("../component/Target"),h=e("../component/Guard"),f=e("../component/Reward"),m=e("./HomeView"),g=e("../StageConfig"),y=function(e){function t(){var a=e.call(this)||this;return a.bgIdx=0,a.missionRawIdxList=[0,0,0,0,0],a.MaxBulletNum=100,a.currBulletNum=0,a.winCheckCnt=0,a.isStageStart=!1,a.cannonType=1,a.isRecoil=!1,a.MaxRecoilTime=8,a.isRewardCannon=!1,a.cannonRewardType=4,a.bulletType=1,a.bulletDirection=new Laya.Vector3,a.isRewardBullet=!1,a.bulletRewardType=1,a.mousePoint=new Laya.Vector2,a.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),a.hitResult=new Laya.HitResult,a.state=0,console.log("GameScene constructor()"),t.instance=a,a.initScene3D(),a.bgIdx=0,a.newBackground(),a.cannonType=1,a.newCannon(),a.newBallBox(),a.scene3D.input.multiTouchEnabled=!1,a.scene3D.physicsSimulation.fixedTimeStep=.5/60,a.navWin=new r.default(l.default),a.box_winIcon.visible=!0,a.navWin.createHomeIcons(a.box_winIcon,a.box_winIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),a.navRevive=new r.default(l.default),a.box_reviveIcon.visible=!0,a.navRevive.createHomeIcons(a.box_reviveIcon,a.box_reviveIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(n.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){if(console.log("GameScene onOpened()"),this.visible=!0,this.state===n.GameState.START){this.showUI(),this.stageIdx=o.default.gameData.stageIndex,this.missionIdx=1;for(var t=1;t<=5;t++)this.missionRawIdxList[t-1]=0,this["level"+t].sizeGrid="0, 96, 0, 0";this.newStage()}},t.prototype.onEnable=function(){this.bindButtons(),this.btnAniFrame=0,Laya.timer.frameLoop(1,this,this.rewardBtnAni)},t.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=n.CameraInitPos.clone(),this.camera.transform.localRotationEuler=n.CameraInitRotEuler.clone(),this.camera.clearColor=null;var e=Laya.Browser.width/Laya.Browser.height;if(e<.5625){var t=2*Math.atan(.5625*Math.tan(.5235987));this.camera.fieldOfView=2*Math.atan(Math.tan(t/2)/e)*57.29578}this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=n.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=n.LightInitRotEuler.clone(),this.directionLight.color=n.LightInitColor.clone()},t.prototype.newBackground=function(){var e=this;this.background&&(Laya.timer.clear(this,this.bgMoving),this.background.destroy()),Laya.Sprite3D.load(n.BgResUrl[this.bgIdx],Laya.Handler.create(this,function(t){e.background=e.scene3D.addChild(t),e.background.transform.localPosition=n.StageInitPos.clone(),e.background.transform.localRotationEuler=n.StageInitRot.clone(),e.background.transform.localScale=n.StageInitScale.clone();var a=e.background.getComponent(Laya.Animator);if(a&&a.destroy(),0===e.bgIdx){e.cloud0=e.background.getChildByName("Scenes_02").getChildByName("cloud01"),e.cloud1=e.background.getChildByName("Scenes_02").getChildByName("cloud03");var i=e.background.getChildByName("Scenes_02").getChildByName("Plane").getChildByName("Plane_0");i.name="ground";i.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.StaticPlaneColliderShape(new Laya.Vector3(0,1,0),0)}e.background.frameLoop(1,e,e.bgMoving)}))},t.prototype.newBallBox=function(){var e=this;Laya.Sprite3D.load(n.CannonBallBoxUrl,Laya.Handler.create(this,function(t){e.ballBox=e.scene3D.addChild(t),e.ballBox.name="ball_box",e.ballBox.transform.localPosition=n.CannonBallInitPos.clone(),e.ballBox.transform.localRotationEuler=n.CannonInitRot.clone(),e.ballBox.transform.localScale=n.CannonBallInitScale.clone();for(i=1;i<=10;i++)i<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+i+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT);for(i=1;i<=5;i++)i<=e.MaxBulletNum&&(e.ballBox.getChildByName("chest_wooden_"+i+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE);for(var a=e.scene3D.addChild(e.ballBox.clone()),i=1;i<=10;i++)i<=e.MaxBulletNum&&(a.getChildByName("CannonBall"+i+"_0").destroy(),a.transform.localPositionX=.11,a.transform.localPositionY-=8e-4,a.transform.localPositionZ+=.0012,a.transform.localRotationEulerY=150)}))},t.prototype.newCannon=function(){var e=this;this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(n.CannonResUrl[this.cannonType],Laya.Handler.create(this,function(t){e.cannon=t,e.scene3D.addChild(e.cannon),e.cannon.name="player",e.cannon.transform.localPosition=n.CannonInitPos.clone(),e.cannon.transform.localRotationEuler=n.CannonInitRot.clone(),e.cannon.transform.localScale=n.CannonInitScale.clone(),e.turret=e.cannon.getChildByName("Turret_0"),e.turretInitPos=e.turret.transform.position.clone()}))},t.prototype.showUI=function(){this.box_UI.visible=!0},t.prototype.hideUI=function(){this.box_UI.visible=!1,this.box_win.visible=!1,this.hideReviveUI()},t.prototype.hideReviveUI=function(){c.posHideBanner(n.BannerPos.ReviveDialog),this.box_revive.visible=!1},t.prototype.bindButtons=function(){var e=this;this.btn_back.on(Laya.Event.CLICK,this,function(){e.state=n.GameState.OVER,e.cleanStage(),e.hideUI(),e.turret&&(e.turret.transform.localRotationEuler=n.TurretInitLocalRot.clone()),e.clearStageTimer(),m.default.openInstance()}),this.btn_cannon.on(Laya.Event.CLICK,this,function(){e.cannonType=e.cannonType%6+1,e.bulletType=e.cannonType,o.default.gameData.cannonType=e.cannonType,e.newCannon()}),this.btn_rewardBullet.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.try_ball&&f.default.instance.video({pos:n.RewardPos.Bullet,success:function(){e.isRewardBullet=!0,e.bulletType=e.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(n.cannonEffectUrl[1],Laya.Handler.create(e,function(t){var a=e.scene3D.addChild(t);a.name="cannon_effect",console.log(a)}))},complete:function(){}}),2==o.default.config.try_ball&&f.default.instance.share({pos:n.RewardPos.Bullet,success:function(){e.isRewardBullet=!0,e.bulletType=e.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(n.cannonEffectUrl[1],Laya.Handler.create(e,function(t){var a=e.scene3D.addChild(t);a.name="cannon_effect",console.log(a)}))},complete:function(){}})):(e.isRewardBullet=!0,e.bulletType=e.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(n.cannonEffectUrl[1],Laya.Handler.create(e,function(t){e.scene3D.addChild(t).name="cannon_effect"})))}),this.btn_rewardCannon.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.try_cannon&&f.default.instance.video({pos:n.RewardPos.Cannon,success:function(){e.isRewardCannon=!0,e.cannonType=e.cannonRewardType,e.bulletType=e.cannonType,e.newCannon()},complete:function(){}}),2==o.default.config.try_cannon&&f.default.instance.share({pos:n.RewardPos.Cannon,success:function(){e.isRewardCannon=!0,e.cannonType=e.cannonRewardType,e.bulletType=e.cannonType,e.newCannon()},complete:function(){}})):(e.isRewardCannon=!0,e.cannonType=e.cannonRewardType,e.bulletType=e.cannonType,e.newCannon())}),this.btn_next.on(Laya.Event.CLICK,this,function(){e.nextStage()}),this.btn_revive.on(Laya.Event.MOUSE_DOWN,this,function(){if(Laya.Browser.onMiniGame)1==o.default.config.try_cannon&&f.default.instance.video({pos:n.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},complete:function(){}}),2==o.default.config.try_cannon&&f.default.instance.share({pos:n.RewardPos.Revive,success:function(){e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)},complete:function(){}});else{e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3");for(var t=1;t<=3;t++)t<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+t+"_0").meshRenderer.material.albedoColorA=1);e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)}}),this.btn_retry.on(Laya.Event.CLICK,this,function(){e.state=n.GameState.OVER,e.cleanStage(),e.hideUI(),e.turret&&(e.turret.transform.localRotationEuler=n.TurretInitLocalRot.clone()),e.clearStageTimer(),m.default.openInstance()})},t.prototype.rewardBtnAni=function(){this.btnAniFrame++,this.btnAniFrame<=60?(this.btn_rewardCannon.scaleX+=.00625,this.btn_rewardCannon.scaleY+=.00625,this.btn_rewardBullet.scaleX+=.00625,this.btn_rewardBullet.scaleY+=.00625):this.btnAniFrame<=120?(this.btn_rewardCannon.scaleX-=.00625,this.btn_rewardCannon.scaleY-=.00625,this.btn_rewardBullet.scaleX-=.00625,this.btn_rewardBullet.scaleY-=.00625):(this.btnAniFrame=1,this.btn_rewardCannon.scaleX=1.5,this.btn_rewardCannon.scaleY=1.5,this.btn_rewardBullet.scaleX=1.5,this.btn_rewardBullet.scaleY=1.5)},t.prototype.cleanStage=function(){this.gameStage&&(this.gameStage.destroyChildren(),this.gameStage.destroy(),this.clearStageTimer())},t.prototype.clearStageTimer=function(){Laya.timer.clear(this,this.stageLooping),Laya.timer.clear(this,this.stageFailCountDown),this.box_countdown.visible=!1},t.prototype.newStage=function(){var e=this;this.cleanStage(),this.box_win.visible=!1,this.missionWin.visible=!1,this["level"+this.missionIdx].sizeGrid="0,64,0,0",this.isRewardBullet=!1,this.scene3D.getChildByName("cannon_effect")&&this.scene3D.getChildByName("cannon_effect").destroy(),this.isRevive=!1,this.currBulletNum=0,this.winCheckCnt=0,this.isStageStart=!1,this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime,this.bulletType=this.cannonType,this.cannon&&!this.cannon.destroyed&&this.turret&&(this.turret.transform.localRotationEuler=n.TurretInitLocalRot.clone());var t=g.Stage[m.default.instance.systemName][this.stageIdx][this.missionIdx];this.rawIdx=this.missionRawIdxList[0];for(var a=0;a<20&&this.missionRawIdxList.indexOf(this.rawIdx)>=0;)this.rawIdx=Math.round(Math.random()*(t.max-t.min))+t.min,a++;this.missionRawIdxList[this.missionIdx-1]=this.rawIdx,this.MaxBulletNum=t.ball_add+g.StageRaw[this.rawIdx].ball_num,this.label_ballNum.changeText("x"+this.MaxBulletNum),console.log("stage: "+this.stageIdx+"\tmission: "+this.missionIdx+"\traw stage index: "+this.rawIdx),console.log("max ball num: "+this.MaxBulletNum);for(var i=1;i<=10;i++)i<=this.MaxBulletNum?this.ballBox.getChildByName("CannonBall"+i+"_0").meshRenderer.material.albedoColorA=1:this.ballBox.getChildByName("CannonBall"+i+"_0").meshRenderer.material.albedoColorA=0;var o=n.StageResUrl+this.rawIdx+".lh";Laya.Sprite3D.load(o,Laya.Handler.create(this,function(t){console.log("stage loaded"),e.gameStage=e.scene3D.addChild(t),Laya.loader.clearRes(o),e.label_level.changeText(""+e.stageIdx),e.gameStage.transform.localPosition=n.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=n.StageInitRot.clone(),e.gameStage.transform.localScale=n.StageInitScale.clone();var a=e.gameStage.getComponent(Laya.Animator);a&&a.destroy();for(var i,r=0;r<e.gameStage.numChildren;r++)if(i=e.gameStage.getChildAt(r),i.meshRenderer.castShadow=!1,i.name.search("Obstacle")>=0){var s=i.addComponent(u.default);i.name.search("Glass")>=0?s.setType(2):i.name.search("TNT")>=0?s.setType(3):s.setType(1)}else if(i.name.search("Cube")>=0){i.name="stand";var l=i.addComponent(Laya.PhysicsCollider),c=i.meshFilter.sharedMesh.boundingBox.clone(),d=c.max.x-c.min.x,f=c.max.y-c.min.y,m=c.max.z-c.min.z;l.colliderShape=new Laya.BoxColliderShape(d,f,m),Laya.Texture2D.load(n.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,i.meshRenderer.material=t}))}else if(i.name.search("Cylinder")>=0){i.name="stand";var l=i.addComponent(Laya.PhysicsCollider),g=new Laya.MeshColliderShape;g.mesh=i.meshFilter.sharedMesh,l.colliderShape=g,Laya.Texture2D.load(n.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,i.meshRenderer.material=t}))}else if(i.name.search("Guard")>=0)i.addComponent(h.default);else i.destroy();e.gameStage.frameLoop(1,e,e.stageLooping),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick)}))},t.prototype.stageLooping=function(){this.winCheck(),this.isRecoil&&this.cannon&&(this.recoilTime<this.MaxRecoilTime?(this.recoilTime<this.MaxRecoilTime/4?(this.cannon.transform.localPositionX+=.01*this.bulletDirection.x,this.cannon.transform.localPositionY+=.01*this.bulletDirection.y,this.cannon.transform.localPositionZ+=.01*this.bulletDirection.z):(this.cannon.transform.localPositionX-=.006*this.bulletDirection.x,this.cannon.transform.localPositionY-=.006*this.bulletDirection.y,this.cannon.transform.localPositionZ-=.006*this.bulletDirection.z),this.recoilTime++):(this.cannon.transform.position=n.CannonInitPos.clone(),this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime))},t.prototype.winCheck=function(){var e=this;if(this.winCheckCnt++>=n.MaxWinCheckTime){console.log("player win"),this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this["level"+this.missionIdx].sizeGrid="0,32,0,0";var t=this.currBulletNum-this.MaxBulletNum+4;t=(t=t<g.StageRaw[this.rawIdx].ball_num?0:t)>4?4:t,this.missionWin.skin="res/ui/game/grade_"+t+"_CN.png",this.missionWin.visible=!0,Laya.timer.frameOnce(90,this,function(){e.nextStage()})}},t.prototype.restart=function(){this.newStage()},t.prototype.nextStage=function(){this.missionIdx++,this.missionIdx>5?this.passStage():this.newStage()},t.prototype.passStage=function(){if(this.missionWin.visible=!1,this.label_lvlPass.changeText(""+this.stageIdx),this.box_win.visible=!0,this.navWin&&this.navWin.loadHomeIconInfoList(),this.stageIdx++,this.stageIdx>n.StageNum)return console.log("通关"),this.stageIdx=1,this.state=n.GameState.OVER,this.cleanStage(),this.hideUI(),this.turret&&(this.turret.transform.localRotationEuler=n.TurretInitLocalRot.clone()),this.clearStageTimer(),void m.default.openInstance();o.default.gameData.stageIndex=this.stageIdx,this.missionIdx=0;for(var e=1;e<=5;e++)this.missionRawIdxList[e-1]=0,this["level"+e].sizeGrid="0, 96, 0, 0";this.cannonType!==o.default.gameData.cannonType&&(this.cannonType=o.default.gameData.cannonType,this.bulletType=this.cannonType,this.newCannon())},t.prototype.stageFailCountDown=function(){var e=this;this.countdown++,this.countdown>=240&&(this.clearStageTimer(),this.box_countdown.visible=!1,this.btn_retry.bottom=150,o.default.config.online||(this.btn_retry.bottom=230),Laya.Browser.onMiniGame&&l.default.isIPhoneX()&&(this.btn_retry.bottom+=o.default.config.distance_iphonex||0),this.box_revive.visible=!0,this.navRevive&&this.navRevive.loadHomeIconInfoList(),Laya.timer.frameOnce(60,null,function(){e.btn_retry.bottom=230,Laya.Browser.onMiniGame&&l.default.isIPhoneX()&&(e.btn_retry.bottom+=o.default.config.distance_iphonex||0),c.posShowBanner(n.BannerPos.ReviveDialog)})),this.label_failTimer.changeText(""+Math.floor(4-this.countdown/60%4)),this.failCircle.scaleX+=.015,this.failCircle.scaleY+=.015},t.prototype.onClick=function(){if(this.gameStage&&this.cannon){if(this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30,1,1))Laya.Vector3.subtract(this.hitResult.point,this.turretInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,this.turretInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}var a=this.bulletDirection.z<0;Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.physicsStartCheck(),this.createBullet(),this.turret&&(this.turret.transform.localRotationEuler=n.TurretInitLocalRot.clone(),a&&(this.turret.transform.localRotationEulerX-=90*this.bulletDirection.y,this.turret.transform.localRotationEulerY-=90*this.bulletDirection.x)),this.isRecoil=!0,this.recoilTime=0}},t.prototype.physicsStartCheck=function(){if(!this.isStageStart){var e=new Laya.SphereColliderShape(n.BulletRadius*n.BulletScale[+this.isRewardBullet][this.bulletType]*3),t=[],a=this.bulletDirection.clone();if(Laya.Vector3.scale(a,50,a),this.scene3D.physicsSimulation.shapeCastAll(e,this.turretInitPos,a,t))for(var i in t)if(t[i].collider.owner.name.indexOf("Obstacle")>=0){this.isStageStart=!0;break}}},t.prototype.createBullet=function(){var e=this;if(this.currBulletNum++,this.ballBox.getChildByName("CannonBall"+(this.MaxBulletNum-this.currBulletNum+1)+"_0").meshRenderer.material.albedoColorA=0,this.label_ballNum.changeText("x"+(this.MaxBulletNum-this.currBulletNum)),Laya.Browser.onMiniGame&&o.default.gameData.soundEnabled&&Laya.SoundManager.playSound(n.soundUrl),Laya.Browser.onMiniGame&&o.default.gameData.vibrationEnabled&&s.default.vibrateShort(),this.currBulletNum>=this.MaxBulletNum&&(this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),Laya.timer.frameOnce(30,this,function(){e.box_countdown.visible=!0,e.failCircle.scaleX=1,e.failCircle.scaleY=1,e.countdown=0,e.isRevive?e.btn_revive.visible=!1:e.btn_revive.visible=!0,Laya.timer.frameLoop(1,e,e.stageFailCountDown)})),this.isRewardBullet)Laya.Sprite3D.load(n.BulletRewardResUrl[this.bulletRewardType],Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(n.BulletRadius));a.name="bullet";a.addChild(t.clone()).name="effect";a.addComponent(d.default).reset(e.bulletRewardType,!0),e.scene3D.addChild(a);var i=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(n.BulletRadius));i.name="bulletTrigger";i.addComponent(d.default).reset(e.bulletRewardType,!0),e.scene3D.addChild(i)})),this.isRewardBullet=!1,Laya.timer.frameOnce(30,this,function(){e.scene3D.getChildByName("cannon_effect")&&e.scene3D.getChildByName("cannon_effect").destroy()});else if(2===this.cannonType){t=.1/n.BulletScale[0][this.cannonType];this.createSingleBullet(-t,0),this.createSingleBullet(t,0)}else if(4===this.cannonType){var t=.1/n.BulletScale[0][this.cannonType];this.createSingleBullet(-t,-t),this.createSingleBullet(-t,t),this.createSingleBullet(t,-t),this.createSingleBullet(t,t)}else 6===this.cannonType?Laya.Sprite3D.load(n.BulletLightningUrl,Laya.Handler.create(this,function(t){Laya.Mesh.load(n.BulletMeshUrl,Laya.Handler.create(e,function(a){var i=new Laya.MeshSprite3D(a);i.name="bullet";i.addChild(t.clone()).name="effect";i.addComponent(d.default).reset(e.bulletType),e.scene3D.addChild(i);var o=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(n.BulletRadius));o.name="bulletTrigger";o.addComponent(d.default).reset(e.bulletType),e.scene3D.addChild(o)}))})):this.createSingleBullet()},t.prototype.createSingleBullet=function(e,t){var a=this;void 0===e&&(e=0),void 0===t&&(t=0);var i=Laya.Pool.getItem("bullet");if(i){i.getComponent(d.default).reset(this.bulletType),i.transform.localPositionX+=e,i.transform.localPositionY+=t,this.scene3D.addChild(i)}else Laya.Mesh.load(n.BulletMeshUrl,Laya.Handler.create(this,function(n){(i=new Laya.MeshSprite3D(n)).name="bullet";i.addComponent(d.default).reset(a.bulletType),i.transform.localPositionX+=e,i.transform.localPositionY+=t,a.scene3D.addChild(i)}));var o=Laya.Pool.getItem("bulletTrigger");if(o){o.getComponent(d.default).reset(this.bulletType),o.transform.localPositionX+=e,o.transform.localPositionY+=t,this.scene3D.addChild(o)}else Laya.Mesh.load(n.BulletMeshUrl,Laya.Handler.create(this,function(i){(o=new Laya.MeshSprite3D(i)).name="bulletTrigger";o.addComponent(d.default).reset(a.bulletType),o.transform.localPositionX+=e,o.transform.localPositionY+=t,a.scene3D.addChild(o)}))},t.prototype.bgMoving=function(){0===this.bgIdx&&this.cloud0&&this.cloud1&&(this.cloud0.transform.localPositionX>.5&&(this.cloud0.transform.localPositionX=-.5),this.cloud0.transform.localPositionX+=7e-4,this.cloud1.transform.localPositionX<-.5&&(this.cloud1.transform.localPositionX=.5),this.cloud1.transform.localPositionX-=5e-4)},t}(i.ui.game.GameSceneUI);a.default=y},{"../../ui/layaMaxUI":17,"../Const":3,"../Global":4,"../StageConfig":5,"../component/Bullet":6,"../component/Guard":7,"../component/Reward":8,"../component/Target":9,"../utils/Ad":12,"../utils/Navigator":14,"../utils/ws.js":15,"../utils/wx":16,"./HomeView":11}],11:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./../../ui/layaMaxUI"),n=e("./GameScene"),o=e("../Const"),r=e("../utils/wx"),s=e("../utils/ws.js"),l=e("../Global"),c=e("../utils/Ad"),d=e("../utils/Navigator"),u=e("../utils/Loader"),h=function(e){function t(){var a=e.call(this)||this;return a.iconInfosList=[],a.currentIconInfoList=[],a.isGameDataLoaded=!1,console.log("HomeView constructor()"),t.instance=a,n.default.openInstance(),a.label_version.changeText("v"+o.VERSION),a}return __extends(t,e),t.openInstance=function(e){t.instance?(c.posShowBanner(o.BannerPos.HomeView),t.instance.onOpened(e)):Laya.Scene.open(o.URL_HomeView,!1,e)},t.prototype.onOpened=function(e){console.log("HomeView onOpened()"),this.visible=!0,this.label_level.changeText("关卡："+l.default.gameData.stageIndex),this.nav&&this.nav.loadHomeIconInfoList()},t.prototype.onEnable=function(){var e=this;console.log("HomeView onEnable()"),Laya.Browser.onMiniGame?this.initWeixin():this.onGameDataLoaded(),u.default.loadZip(o.cdnUrl,"res",Laya.Handler.create(this,function(t){e.bindButtons()}))},t.prototype.bindButtons=function(){var e=this;this.btn_start.on(Laya.Event.CLICK,this,function(){var t=e.btn_start.scaleX,a=e.btn_start.scaleY;Laya.Tween.to(e.btn_start,{alpha:.8,scaleX:.9*t,scaleY:.9*a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.btn_start,{alpha:1,scaleX:t,scaleY:a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){n.default.instance&&(s.default.traceEvent("Click_Startgame"),e.hide(),n.default.instance.state=o.GameState.START,n.default.openInstance())}))}))}),this.btn_sound.on(Laya.Event.CLICK,this,function(){l.default.gameData.soundEnabled=!l.default.gameData.soundEnabled,e.btn_sound.gray=!l.default.gameData.soundEnabled,Laya.Browser.onMiniGame&&l.default.gameData.soundEnabled&&Laya.SoundManager.playSound(o.soundUrl)}),this.btn_vibration.on(Laya.Event.CLICK,this,function(){l.default.gameData.vibrationEnabled=!l.default.gameData.vibrationEnabled,e.btn_vibration.gray=!l.default.gameData.vibrationEnabled,Laya.Browser.onMiniGame&&l.default.gameData.vibrationEnabled&&r.default.vibrateShort()}),this.btn_cannon.on(Laya.Event.CLICK,this,function(){e.box_cannon.visible=!0,e.box_UI.visible=!1}),this.btn_cannonBack.on(Laya.Event.CLICK,this,function(){e.box_UI.visible=!0,e.box_cannon.visible=!1})},t.prototype.initCannonSelect=function(){var e=this;this.cannonScene3D=this.box_cannonScene3D.addChild(new Laya.Scene3D);var t=this.cannonScene3D.addChild(new Laya.Camera);t.transform.localPosition=new Laya.Vector3(0,0,10),t.transform.localRotationEuler=new Laya.Vector3(-20,0,0);var a=this.cannonScene3D.addChild(new Laya.DirectionLight);a.transform.localPosition=o.LightInitPos.clone(),a.transform.localRotationEuler=o.LightInitRotEuler.clone(),a.color=o.LightInitColor.clone(),Laya.Sprite3D.load(o.CannonResUrl[1],Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(1));e.cannonScene3D.addChild(a);e.cannonScene3D.addChild(t).transform.localScale=new Laya.Vector3(100,100,100)}))},t.prototype.hide=function(){c.posHideBanner(o.BannerPos.HomeView),this.visible=!1},t.prototype.initWeixin=function(){r.default.showShareMenu({withShareTicket:!0}),r.default.onShareAppMessage(function(){var e=s.default.createShareOptions({pos:"ShareAppButton"});return{title:e.title,imageUrl:e.imageUrl,query:e.query}}),s.default.init({host:"ws.lesscool.cn",version:o.VERSION,appid:1124,secret:"79ce022eb0ca47bfde9bc7e753df2074",share:{title:"全民欢乐，天天游戏！",image:"http://oss.lesscool.cn/fcdh/96d172496dbafa4ab9c8335a7133476c.png"}}),this.loginWs()},t.prototype.loginWs=function(){s.default.traceEvent("WS_LOGINING"),r.default.showLoading({title:"登录中",mask:!0}),s.default.onLoginComplete(this.onLoginComplete.bind(this)),s.default.login()},t.prototype.onLoginComplete=function(e,t){"success"===s.default.getLoginStatus()?(s.default.traceEvent("WS_LOGINED"),r.default.hideLoading(),console.log("ws.conf",s.default.conf),console.log("ws.user",s.default.user),console.log("ws.data",s.default.data),this.loadConfig(),this.loadGameData(t)):"fail"===s.default.getLoginStatus()&&(s.default.traceEvent("WS_LOGIN_FAIL"),r.default.hideLoading(),r.default.showModal({title:"登陆失败",content:"请允许授权",confirmText:"重新登陆",cancelText:"关闭",success:function(e){r.default.showLoading({title:"登录中",mask:!0}),s.default.login()}}))},t.prototype.loadConfig=function(){Object.assign(l.default.config,s.default.conf)},t.prototype.loadGameData=function(e){var t=this;e&&e.updateTimestamp?s.default.data&&s.default.data.updateTimestamp&&s.default.data.updateTimestamp>e.updateTimestamp?s.default.setAllData(s.default.data,!0):s.default.setAllData(e):s.default.data&&s.default.data.updateTimestamp||s.default.setAllData(l.default.gameData,!0),l.default.gameData=Object.assign(l.default.gameData,s.default.data),r.default.onHide(function(){t.updateGameData(!0)}),s.default.onShow(function(){c.refreshCurrentBanner()}),this.nav=new d.default(s.default),this.box_homeIcon.visible=!0,this.nav.createHomeIcons(this.box_homeIcon,this.box_homeIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.box_drawer.visible=!0,this.onGameDataLoaded()},t.prototype.onGameDataLoaded=function(){console.log("onGameDataLoaded",l.default.gameData),this.isGameDataLoaded=!0,c.posShowBanner(o.BannerPos.HomeView),this.systemName="Android",Laya.Browser.onMiniGame&&r.default.getSystemInfoSync().system.indexOf("iOS")>=0&&(this.systemName="IOS"),this.label_level.changeText("关卡："+l.default.gameData.stageIndex),this.label_level.visible=!0,this.icon_diamond.x=this.stage.width/2-(this.text_diamond.text.length*this.text_diamond.fontSize+this.text_diamond.x)/2,this.icon_diamond.visible=!0},t.prototype.updateGameData=function(e){l.default.gameData.updateTimestamp=Date.now(),e&&console.log("updateGameData",l.default.gameData),Laya.Browser.onMiniGame&&s.default.setAllData(l.default.gameData,e)},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),s.default.tapGameAd({pos:e,ad:t,redirect:a})},t}(i.ui.home.HomeViewUI);a.default=h},{"../Const":3,"../Global":4,"../utils/Ad":12,"../utils/Loader":13,"../utils/Navigator":14,"../utils/ws.js":15,"../utils/wx":16,"./../../ui/layaMaxUI":17,"./GameScene":10}],12:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./wx"),n=e("./ws.js"),o=e("../Global"),r=!0,s=null,l=0;a.refreshCurrentBanner=function(){l++,s&&l>=o.default.config.banner_click_time&&(l=0,a.posShowBanner(s,!0))},a.hasVideoAd=function(){return r},a.posShowBanner=function(e,t){if(void 0===t&&(t=!1),Laya.Browser.onMiniGame){var a=i.default.getSystemInfoSync(),o=a.screenHeight,r=a.screenWidth,l=Math.max(300,300*r/350),c=.348*l,d=o-c,u=(r-l)/2;s=e,n.default.createBanner({pos:e,style:{left:u,top:d,width:l,height:c},force:t})}},a.posHideBanner=function(e){Laya.Browser.onMiniGame&&(s=null,n.default.closeBanner(e))},a.posShowVideo=function(e,t,a){Laya.Browser.onMiniGame&&n.default.createVideo?n.default.createVideo({pos:e,success:function(e){a&&a(e)},fail:function(e){r=!1,console.log("NO VIDEO AD")}}):(r=!1,console.log("NO VIDEO AD"),t&&t())}},{"../Global":4,"./ws.js":15,"./wx":16}],13:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=window.wx,n=function(){function e(){this.debug=!0,this.failCount=0}return e.prototype.log=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];this.debug&&console.log.apply(this,arguments)},e.prototype.stat=function(e,t){var a=i.getFileSystemManager().statSync(e);if(a.isDirectory())for(var n=0,o=i.getFileSystemManager().readdirSync(e);n<o.length;n++){var r=o[n];try{this.stat(e+"/"+r,t)}catch(t){this.log("stat fail: "+e+"/"+r,t)}}else t[e]=a},e.prototype.loadZip=function(e,t,a,i){Laya.Browser.onMiniGame&&e?(this.failCount=0,this.unzipFile(e,t,a,i)):a&&a.runWith(!1)},e.prototype.unzipFile=function(e,t,a,n){var o=this,r=e.split("/"),s=r[r.length-1],l=i.env.USER_DATA_PATH+"/zip/",c=l+s,d=Laya.MiniFileMgr.getFileNativePath("");i.getFileSystemManager().unzip({zipFilePath:c,targetPath:d,success:function(){o.log("unzip success");var e={};try{o.stat(d+t,e),o.log("stat success")}catch(e){return o.log("stat fail",e),o.cleanDir(d+t),void(a&&a.runWith(!1))}var n=[];for(var r in e){var s=r.replace(d,""),l=Laya.Utils.getFileExtension(s);-1===[].indexOf(l)&&n.push([r,s])}if(n.length){Laya.MiniFileMgr.filesListObj.fileUsedSize||(Laya.MiniFileMgr.filesListObj.fileUsedSize=0);for(var c=0;c<n.length;c++){var u=n[c],r=u[0],s=u[1],h=e[r].size||0,f=o.getEncoding(s);if(Laya.MiniFileMgr.filesListObj[s]){var m=parseInt(Laya.MiniFileMgr.filesListObj[s].size)||0;Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+h-m}else Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+h;Laya.MiniFileMgr.filesListObj[s]={md5:s,readyUrl:s,size:h,times:Laya.Browser.now(),encoding:f}}i.getFileSystemManager().writeFile({filePath:Laya.MiniFileMgr.fileNativeDir+"/"+Laya.MiniFileMgr.fileListName,encoding:"utf8",data:JSON.stringify(Laya.MiniFileMgr.filesListObj)}),o.log("filesListObj",Laya.MiniFileMgr.filesListObj),a&&a.runWith(!0)}else a&&a.runWith(!1)},fail:function(r){if(o.log("unzip fail"),o.failCount++,o.failCount>=3)a&&a.runWith(!1);else{try{i.getFileSystemManager().accessSync(l),o.cleanDir(l,n)}catch(e){o.log("mkdir",l),i.getFileSystemManager().mkdir({dirPath:l})}i.downloadFile({url:e,filePath:c,success:function(){o.log("downloadFile success"),o.unzipFile(e,t,a,n)},fail:function(){o.log("downloadFile fail"),a&&a.runWith(!1)}})}}})},e.prototype.cleanDir=function(e,t){var a=this;"/"===e.charAt(e.length-1)&&(e=e.slice(0,e.length-1));var n={};try{this.stat(e,n),this.log("cleanDir stat success")}catch(e){this.log("cleanDir stat fail")}for(var o in n){if(t&&t.length){var r=o.replace(e+"/","");if(-1!==t.indexOf(r))continue}i.getFileSystemManager().unlink({filePath:o,success:function(){a.log("unlink success")},fail:function(){a.log("unlink fail")}})}},e.prototype.getEncoding=function(e){var t,a=Laya.Loader.getTypeFromUrl(e);if(!a){switch(Laya.Utils.getFileExtension(e)){case"lh":case"ls":case"lmat":case"ltc":case"lav":t="json";break;case"lm":case"lani":t="arraybuffer"}if(t)return Laya.MiniAdpter.getUrlEncode(e,t)}switch(a){case"atlas":case"prefab":case"plf":t="json";break;case"font":t="xml";break;case"plfb":case"image":case"sound":t="arraybuffer";break;default:t=a}return Laya.MiniAdpter.getUrlEncode(e,t)},e}();a.default=new n},{}],14:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=function(){function e(e){this.ws=e,this.SCALE=Laya.stage.width/720}return e.prototype.createHomeIcons=function(e,t,a){var i=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var n=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var s=new Laya.List;s.width=720*this.SCALE,s.height=790*this.SCALE,s.x=0,s.y=240*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=468*this.SCALE,s.repeatY=5,s.repeatX=2,r.addChild(s);var l=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*l,t.height=106*l,t.pivotX=53*l,t.pivotY=53*l,t.x=73*l,t.y=73*l,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*l,a.height=106*l,a.x=0,a.y=0,t.addChild(a);var i=new Laya.Sprite;i.name="tips",i.scaleX=-1,i.width=36*l,i.height=36*l,i.x=116*l,i.y=-10*l,i.loadImage("res/texture/navigator/tips2.png"),t.addChild(i);var n=new Laya.Label;return n.name="titleLabel",n.width=106*l,n.overflow="visible",n.valign="middle",n.align="center",n.fontSize=Math.round(18*l),n.font="Arial",n.color="#1d3b63",n.anchorY=0,n.anchorX=.5,n.y=110*l,n.x=53*l,t.addChild(n),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,t){var a=s.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,i,i.onIconClick,["default",a]);var n=e.getChildByName("iconImage");n&&n.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),i.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var d=function(){if(r&&r.activeInHierarchy&&t&&t.visible){for(var e=0;e<n.length;e++){var a=n[e],l=i.getRandom(a);o[e]=l}s.array=o,s.refresh()}};return this.loadHomeIconInfoList=function(){i.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;n=[];for(var s=0;s<Math.min(t.length,a.length);s++){var l=t[s];n.push([l])}o=[],r.clearTimer(i,d),d(),r.timerLoop(3e3,i,d)}})},this.loadHomeIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createDrawer=function(e,t){var a=this;{if(Laya.Browser.onMiniGame){var i=new Laya.Box;i.width=720*this.SCALE,i.height=1280*this.SCALE,i.centerX=0,i.centerY=0,i.mouseThrough=!0,e.addChild(i);var n=new Laya.Image;n.width=720*this.SCALE,n.height=1600*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!1,n.mouseEnabled=!0,n.visible=!1,n.skin="res/texture/navigator/blank.png",n.sizeGrid="1,1,1,1",i.addChild(n);var o=new Laya.Box;o.width=720*this.SCALE,o.height=1280*this.SCALE,o.centerX=-480*this.SCALE,o.centerY=0,o.mouseThrough=!0,i.addChild(o);var r=new Laya.Sprite;r.width=480*this.SCALE,r.height=665*this.SCALE,r.x=0,r.y=120*this.SCALE,r.loadImage("res/texture/navigator/drawer_panel.png"),o.addChild(r);var s=new Laya.List;s.width=380*this.SCALE,s.height=540*this.SCALE,s.x=40*this.SCALE,s.y=85*this.SCALE,s.mouseThrough=!0,s.spaceY=40*this.SCALE,s.spaceX=30*this.SCALE,s.repeatX=3,r.addChild(s);var l=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*l,t.height=106*l,t.x=0,t.y=0,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*l,a.height=106*l,a.x=0,a.y=0,t.addChild(a);var i=new Laya.Sprite;i.name="tips",i.width=59*l,i.height=32*l,i.x=60*l,i.y=-10*l,i.loadImage("res/texture/navigator/tips.png"),t.addChild(i);var n=new Laya.Label;n.name="tipsLabel",n.width=42*l,n.height=18*l,n.valign="middle",n.align="center",n.fontSize=Math.round(18*l),n.font="Arial",n.color="#ffffff",n.x=9*l,n.y=6*l,i.addChild(n);var o=new Laya.Label;return o.name="titleLabel",o.width=106*l,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(18*l),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=53*l,o.y=110*l,t.addChild(o),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,i){var n=s.array[i];if(n){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,a,a.onIconClick,[t,n]);var o=e.getChildByName("iconImage");o&&o.loadImage(n.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(n.title);var l=e.getChildByName("tips");if(l){var c=l.getChildByName("tipsLabel");c&&c.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1);var d=new Laya.Sprite;d.width=88*this.SCALE,d.height=74*this.SCALE,d.x=480*this.SCALE,d.y=40*this.SCALE,d.loadImage("res/texture/navigator/drawer_button.png"),d.visible=!1,r.addChild(d);var u=new Laya.Sprite;u.width=39*this.SCALE,u.height=49*this.SCALE,u.scaleX=-1,u.x=55*this.SCALE,u.y=12*this.SCALE,u.loadImage("res/texture/navigator/arrow.png"),d.addChild(u);var h=new Laya.Sprite;h.width=88*this.SCALE,h.height=74*this.SCALE,h.x=480*this.SCALE,h.y=40*this.SCALE,h.loadImage("res/texture/navigator/drawer_button.png"),h.visible=!0,r.addChild(h);var f=new Laya.Sprite;f.width=39*this.SCALE,f.height=49*this.SCALE,f.x=23*this.SCALE,f.y=12*this.SCALE,f.loadImage("res/texture/navigator/arrow.png"),h.addChild(f),h.on(Laya.Event.MOUSE_DOWN,this,function(){a.ws.getGameAd({pos:t,count:a.ws.conf.games[t].length,success:function(e){var t=e.data;s.array=t,s.refresh()}}),n.visible=!0,Laya.Tween.to(o,{centerX:0},300,Laya.Ease.linearNone,Laya.Handler.create(a,function(){h.visible=!1,d.visible=!0}))}),d.on(Laya.Event.MOUSE_DOWN,this,function(){a.ws.hideGameAd(t),Laya.Tween.to(o,{centerX:-480*l},300,Laya.Ease.linearNone,Laya.Handler.create(a,function(){h.visible=!0,d.visible=!1,n.visible=!1}))});var m=Math.round(13*this.SCALE),g=Math.round(28*this.SCALE),y=!1;return i.timerLoop(500,this,function(){y?(f.x=g,y=!1):(f.x=m,y=!0)}),i}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createMoreGame=function(e,t,a){var i=this;{if(Laya.Browser.onMiniGame){var n=new Laya.Box;n.width=720*this.SCALE,n.height=1280*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!0,n.visible=!1,e.addChild(n);var o=new Laya.Image;o.width=720*this.SCALE,o.height=1600*this.SCALE,o.centerX=0,o.centerY=0,o.mouseThrough=!1,o.mouseEnabled=!0,o.skin="res/texture/navigator/blank.png",o.sizeGrid="1,1,1,1",n.addChild(o);var r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,n.addChild(r);var s=new Laya.Sprite;s.width=586*this.SCALE,s.height=806*this.SCALE,s.loadImage("res/texture/navigator/moregame_panel.png"),s.x=67*this.SCALE,s.y=137*this.SCALE,r.addChild(s);var l=new Laya.Sprite;l.x=538*this.SCALE,l.y=-12*this.SCALE,l.width=59*this.SCALE,l.height=62*this.SCALE,l.loadImage("res/texture/navigator/close_button.png"),s.addChild(l);var c=new Laya.Image;c.width=110*this.SCALE,c.height=110*this.SCALE,c.pivotY=55*this.SCALE,c.pivotX=55*this.SCALE,c.centerX=285*this.SCALE,c.centerY=-465*this.SCALE,c.loadImage("res/texture/navigator/more_game_button.png",Laya.Handler.create(this,function(){n.timerLoop(1005,i,function(){Laya.Tween.to(c,{scaleX:.9*u,scaleY:.9*u},500,Laya.Ease.linearNone,Laya.Handler.create(i,function(){Laya.Tween.to(c,{scaleX:u,scaleY:u},500,Laya.Ease.linearNone)}))})})),t.addChild(c);var d=new Laya.List;d.width=500*this.SCALE,d.height=640*this.SCALE,d.centerX=10*this.SCALE,d.centerY=5*this.SCALE,d.spaceY=50*this.SCALE,d.spaceX=40*this.SCALE,d.repeatX=3,s.addChild(d);var u=this.SCALE,h=function(e){function t(){var t=e.call(this)||this;t.width=132*u,t.height=132*u,t.x=0,t.y=0,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=132*u,a.height=132*u,a.x=0,a.y=-2*u,t.addChild(a);var i=new Laya.Sprite;i.name="tips",i.width=59*u,i.height=32*u,i.x=90*u,i.y=-10*u,i.loadImage("res/texture/navigator/tips.png"),t.addChild(i);var n=new Laya.Label;n.name="tipsLabel",n.width=42*u,n.height=18*u,n.valign="middle",n.align="center",n.fontSize=Math.round(18*u),n.font="Arial",n.color="#ffffff",n.x=9*u,n.y=6*u,i.addChild(n);var o=new Laya.Label;return o.name="titleLabel",o.width=132*u,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(22*u),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=66*u,o.y=138*u,t.addChild(o),t}return __extends(t,e),t}(Laya.Box);return d.itemRender=h,d.renderHandler=Laya.Handler.create(this,function(e,t){var n=d.array[t];if(n){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,i,i.onIconClick,[a,n]);var o=e.getChildByName("iconImage");o&&o.loadImage(n.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(n.title);var s=e.getChildByName("tips");if(s){var l=s.getChildByName("tipsLabel");l&&l.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1),c.on(Laya.Event.MOUSE_DOWN,this,function(){i.ws.getGameAd({pos:a,count:i.ws.conf.games[a].length,success:function(e){var t=e.data;d.array=t,d.refresh()}}),n.visible=!0,c.visible=!1}),l.on(Laya.Event.MOUSE_DOWN,this,function(){i.ws.hideGameAd(a),c.visible=!0,n.visible=!1}),n}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createOverIcons=function(e,t,a){var i=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var n=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var s=new Laya.List;s.width=720*this.SCALE,s.height=470*this.SCALE,s.x=0,s.y=180*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=468*this.SCALE,s.repeatY=3,s.repeatX=2,r.addChild(s);var l=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*l,t.height=106*l,t.pivotX=53*l,t.pivotY=53*l,t.x=73*l,t.y=73*l,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*l,a.height=106*l,a.x=0,a.y=0,t.addChild(a);var i=new Laya.Sprite;i.name="tips",i.scaleX=-1,i.width=36*l,i.height=36*l,i.x=116*l,i.y=-10*l,i.loadImage("res/texture/navigator/tips2.png"),t.addChild(i);var n=new Laya.Label;return n.name="titleLabel",n.width=106*l,n.overflow="visible",n.valign="middle",n.align="center",n.fontSize=Math.round(18*l),n.font="Arial",n.color="#1d3b63",n.anchorY=0,n.anchorX=.5,n.y=110*l,n.x=53*l,t.addChild(n),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,t){var a=s.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,i,i.onIconClick,["default",a]);var n=e.getChildByName("iconImage");n&&n.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),i.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var d=function(){if(r&&r.activeInHierarchy&&t&&t.visible){for(var e=0;e<n.length;e++){var a=n[e],l=i.getRandom(a);o[e]=l}s.array=o,s.refresh()}};return this.loadOverIconInfoList=function(){i.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;n=[];for(var s=0;s<Math.min(t.length,a.length);s++){var l=t[s];n.push([l])}o=[],r.clearTimer(i,d),d(),r.timerLoop(3e3,i,d)}})},this.loadOverIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createGuessLikeIcons=function(e,t,a){var i=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var n=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var s=new Laya.Sprite;s.width=560*this.SCALE,s.height=188*this.SCALE,s.y=670*this.SCALE,s.x=80*this.SCALE,s.loadImage("res/texture/navigator/guessyoulike.png"),r.addChild(s);var l=new Laya.List;l.width=500*this.SCALE,l.height=208*this.SCALE,l.x=60*this.SCALE,l.y=-20*this.SCALE,l.mouseThrough=!0,l.spaceY=45*this.SCALE,l.spaceX=18*this.SCALE,l.repeatY=1,l.repeatX=4,s.addChild(l);var c=this.SCALE,d=function(e){function t(){var t=e.call(this)||this;t.width=106*c,t.height=106*c,t.pivotX=53*c,t.pivotY=53*c,t.x=63*c,t.y=108*c,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*c,a.height=106*c,a.x=0,a.y=0,t.addChild(a);var i=new Laya.Label;return i.name="titleLabel",i.width=106*c,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*c),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*c,i.x=53*c,t.addChild(i),t}return __extends(t,e),t}(Laya.Box);l.itemRender=d,l.renderHandler=Laya.Handler.create(this,function(e,t){var a=l.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,i,i.onIconClick,["default",a]);var n=e.getChildByName("iconImage");n&&n.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),i.jumpeOnce(150*t,e)}else e.visible=!1},[],!1);var u=function(){if(r&&r.activeInHierarchy&&t&&t.visible){for(var e=0;e<n.length;e++){var a=n[e],s=i.getRandom(a);o[e]=s}l.array=o,l.refresh()}};return this.loadGuessLikeIconInfoList=function(){i.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;n=[];for(var s=Math.max(t.length-a.length,0);s<t.length;s++){var l=t[s];n.push([l])}o=[],r.clearTimer(i,u),u(),r.timerLoop(3e3,i,u)}})},this.loadGuessLikeIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),this.ws.tapGameAd({pos:e,ad:t,redirect:a})},e.prototype.shakeOnce=function(e,t){var a=this;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))}))}),this.blinkTips(e,t)},e.prototype.jumpeOnce=function(e,t){var a=this,i=t.y;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))})),Laya.Tween.to(t,{y:i-50},200,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(t,{y:i},200,Laya.Ease.sineIn)}))}),this.blinkTips(e,t)},e.prototype.blinkTips=function(e,t){var a=this,i=t.getChildByName("tips");i&&i.timerOnce(e,this,function(){Laya.Tween.to(i,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(i,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(i,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(i,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(i,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(i,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.timer.clearAll(i)}))}))}))}))}))}))})},e.prototype.randomIndex=function(e,t,a){void 0===t&&(t="weight"),void 0===a&&(a=0);var i=[],n=0;if(e&&e.length)for(l=0;l<e.length;l++){var o=e[l],r=Number(o[t])||a||0;i[l]=[n,n+r],n+=r}if(n>0)for(var s=Math.random()*n,l=0;l<i.length;l++){var c=i[l];if(c[0]<=s&&s<c[1])return l}return 0},e.prototype.getRandom=function(e,t,a){return void 0===t&&(t="weight"),void 0===a&&(a=0),e&&e.length?1===e.length?e[0]:e[this.randomIndex(e,t,a)]:null},e}();a.default=i},{}],15:[function(e,t,a){t.exports.default=function(e){function t(i){if(a[i])return a[i].exports;var n=a[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var i,n=(i=a(1))&&i.__esModule?i:{default:i},o=a(4),r=a(5),s=a(6),l=a(7),c=a(8),d=a(9),u=a(10),h=a(11),f=a(12),m=a(13),g=a(2),y=a(14);(0,g.initUtil)(n.default),(0,o.initHTTP)(n.default),(0,r.initUser)(n.default),(0,s.initConfig)(n.default),(0,l.initData)(n.default),(0,c.initShare)(n.default),(0,d.initProcess)(n.default),(0,u.initPayment)(n.default),(0,h.initAD)(n.default),(0,f.initHook)(n.default),(0,m.initInvite)(n.default),(0,y.initEvent)(n.default),e.exports=window.ws=n.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},o=(i=a(2))&&i.__esModule?i:{default:i},r={tmp:{},options:{scheme:"https://",host:"api.websdk.cn",apiVersion:"v1",USER_KEY:"ws_user",CONF_KEY:"ws_conf",DATA_KEY:"ws_data",share10:!0,commonDuration:120,allowAld:!1},conf:{},user:{},data:{},version:"1.0.1",mode:"default",debug:!0,shareCallbackData:{},shareTempData:{},shareGiftTempData:{},_initCallbacks:[],_showCallbacks:[],_hideCallbacks:[],_afterHideCallbacks:[],_shareCallbacks:[],_openFromShareCallbacks:[],_openFromCodeCallbacks:[],_onInit:function(){var e=!0,t=!1,a=void 0;try{for(var i,n=this._initCallbacks[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var o=i.value;o&&o()}}catch(e){t=!0,a=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw a}}},_onShow:function(e){if(console.log("onShow:",e,"mode:",this.mode),"default"!==this.mode)this.shareCallbackData&&this.shareCallbackData.callback&&"shareAppMessage"==this.mode&&(this.shareCallbackData.callback(e,Date.now()-this.shareCallbackData.ms),this.shareCallbackData={}),this.mode="default";else{var t=!0,a=!1,i=void 0;try{for(var n,o=this._showCallbacks[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var s=n.value;s&&s(e)}}catch(e){a=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw i}}if(e.query&&"share"===e.query.type?r._openFromShare("onShow",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onShow",e.query.scene,e),this.user&&e.shareTicket&&e.query&&e.query.uid==this.user.id)for(var l in this.shareTempData)l==e.query.share_tid&&r._shareCallback(this.shareTempData[l],e)}},_onHide:function(e){if(console.log("onHide:",e,"mode:",this.mode),"default"===this.mode){var t=!0,a=!1,i=void 0;try{for(var n,o=this._hideCallbacks[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var r=n.value;r&&r(e)}}catch(e){a=!0,i=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw i}}var s=!0,l=!1,c=void 0;try{for(var d,u=this._afterHideCallbacks[Symbol.iterator]();!(s=(d=u.next()).done);s=!0){var h=d.value;h&&h(e)}}catch(e){l=!0,c=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw c}}}},_openFromShare:function(e,t,a){var i=!0,n=!1,o=void 0;try{for(var r,s=this._openFromShareCallbacks[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var l=r.value;l&&l({from:e,query:t,options:a})}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}},_openFromCode:function(e,t,a){r.get({url:"/share/qrcode",data:{scene:t},success:function(i){var n=!0,o=!1,s=void 0;try{for(var l,c=r._openFromCodeCallbacks[Symbol.iterator]();!(n=(l=c.next()).done);n=!0){var d=l.value;d&&d({from:e,scene:t,options:a,query:i.data})}}catch(e){o=!0,s=e}finally{try{!n&&c.return&&c.return()}finally{if(o)throw s}}}})},_shareCallback:function(e,t){wx.getShareInfo({shareTicket:t.shareTicket,success:function(a){e.onShareTicketSuccess&&e.onShareTicketSuccess(a),r.shareLog(e,"click",t.shareTicket,a,t)}.bind(this),fail:function(a){e.onShareTicketFail&&e.onShareTicketFail(a),r.shareLog(e,"click",t.shareTicket,{},t)}.bind(this)})},onInit:function(e){this._initCallbacks.push(e)},onShow:function(e){this._showCallbacks.push(e)},onHide:function(e){this._hideCallbacks.push(e)},afterHide:function(e){this._afterHideCallbacks.push(e)},openFromShare:function(e){this._openFromShareCallbacks.push(e)},openFromCode:function(e){this._openFromCodeCallbacks.push(e)},init:function(e){this.options=n({},o.default.copy(e,this.options)),this.systemInfo=wx.getSystemInfoSync(),this.launchOptions=wx.getLaunchOptionsSync(),this.user=wx.getStorageSync(this.options.USER_KEY),this.conf=wx.getStorageSync(this.options.CONF_KEY),this.data=wx.getStorageSync(this.options.DATA_KEY),this.log("conf:",this.conf),wx.onShow(this._onShow.bind(this)),wx.onHide(this._onHide.bind(this))},onLogined:function(){var e=this.launchOptions;e.query&&"share"===e.query.type?r._openFromShare("onLaunch",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onLaunch",e.query.scene,e),this._onInit()}};t.default=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.initUtil=function(e){e.checkSDK=function(e,t){var a=this;return function(i,n){return a.requireSDK(e)?t.apply(a,[i]):(a.log("微信SDK版本过低："+a.systemInfo.SDKVersion+",需要更新至"+e),void(n&&"function"==typeof n&&n([a.systemInfo.SDKVersion,e])))}},e.requireSDK=function(e){return r.compareVersion(this.systemInfo.SDKVersion,e)},e.requireSystemVersion=function(e){return r.compareVersion(this.systemInfo.version,e)},e.isIPhoneX=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iPhone X")},e.isIOS=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iOS")},e.isAndroid=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("Android")},e.toFixed=function(e,t){for(var a=e.toFixed(t)+"";"0"===a[a.length-1];)if("."===(a=a.substring(0,a.length-1))[a.length-1]){a=a.substring(0,a.length-1);break}return a},e.log=function(){try{if(this.debug&&console&&console.log){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return console.log.apply(console,t)}}catch(e){}},e.setAlertCallback=function(t){e._alertCallback=t},e.alert=function(t){e._alertCallback?e._alertCallback(t):wx.showModal({content:t})},e.trace=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.post({url:"/log/trace",data:{key:e,pos:t,data:a}})},e.getServerTime=function(){return e.conf&&e.conf.server_time?e.conf.server_time:0}};var n,o=(n=a(3))&&n.__esModule?n:{default:n},r={sign:function(e,t){if("string"==typeof e)return r.signSort(e,t);if("object"==(void 0===e?"undefined":i(e))){var a=[];for(var n in e)a.push(n+"="+e[n]);return r.signSort(a.join("&"),t)}},signSort:function(e,t){var a=e.split("&").sort().join("&")+"&key="+t;return(0,o.default)(a).toUpperCase()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return Date.now()+"-"+r.S4()},compareVersion:function(e,t){var a=parseFloat(e),i=parseFloat(t),n=e.replace(a+".",""),o=t.replace(i+".","");return a>i||!(a<i)&&n>=o},copy:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(e&&e.push?[]:{});for(var a in e)t[a]="object"===i(e[a])?r.copy(e[a]):e[a];return t},randomSort:function(e){for(var t,a=0;a<e.length;a++){var i=parseInt(Math.random()*e.length+"");t=e[i],e[i]=e[a],e[a]=t}return e}};t.default=r},function(e,t,a){var i;"function"==typeof Symbol&&Symbol.iterator,function(n){"use strict";function o(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function r(e,t,a,i,n,r){return o((s=o(o(t,e),o(i,r)))<<(l=n)|s>>>32-l,a);var s,l}function s(e,t,a,i,n,o,s){return r(t&a|~t&i,e,t,n,o,s)}function l(e,t,a,i,n,o,s){return r(t&i|a&~i,e,t,n,o,s)}function c(e,t,a,i,n,o,s){return r(t^a^i,e,t,n,o,s)}function d(e,t,a,i,n,o,s){return r(a^(t|~i),e,t,n,o,s)}function u(e,t){var a,i,n,r,u;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,f=-271733879,m=-1732584194,g=271733878;for(a=0;a<e.length;a+=16)i=h,n=f,r=m,u=g,h=s(h,f,m,g,e[a],7,-680876936),g=s(g,h,f,m,e[a+1],12,-389564586),m=s(m,g,h,f,e[a+2],17,606105819),f=s(f,m,g,h,e[a+3],22,-1044525330),h=s(h,f,m,g,e[a+4],7,-176418897),g=s(g,h,f,m,e[a+5],12,1200080426),m=s(m,g,h,f,e[a+6],17,-1473231341),f=s(f,m,g,h,e[a+7],22,-45705983),h=s(h,f,m,g,e[a+8],7,1770035416),g=s(g,h,f,m,e[a+9],12,-1958414417),m=s(m,g,h,f,e[a+10],17,-42063),f=s(f,m,g,h,e[a+11],22,-1990404162),h=s(h,f,m,g,e[a+12],7,1804603682),g=s(g,h,f,m,e[a+13],12,-40341101),m=s(m,g,h,f,e[a+14],17,-1502002290),h=l(h,f=s(f,m,g,h,e[a+15],22,1236535329),m,g,e[a+1],5,-165796510),g=l(g,h,f,m,e[a+6],9,-1069501632),m=l(m,g,h,f,e[a+11],14,643717713),f=l(f,m,g,h,e[a],20,-373897302),h=l(h,f,m,g,e[a+5],5,-701558691),g=l(g,h,f,m,e[a+10],9,38016083),m=l(m,g,h,f,e[a+15],14,-660478335),f=l(f,m,g,h,e[a+4],20,-405537848),h=l(h,f,m,g,e[a+9],5,568446438),g=l(g,h,f,m,e[a+14],9,-1019803690),m=l(m,g,h,f,e[a+3],14,-187363961),f=l(f,m,g,h,e[a+8],20,1163531501),h=l(h,f,m,g,e[a+13],5,-1444681467),g=l(g,h,f,m,e[a+2],9,-51403784),m=l(m,g,h,f,e[a+7],14,1735328473),h=c(h,f=l(f,m,g,h,e[a+12],20,-1926607734),m,g,e[a+5],4,-378558),g=c(g,h,f,m,e[a+8],11,-2022574463),m=c(m,g,h,f,e[a+11],16,1839030562),f=c(f,m,g,h,e[a+14],23,-35309556),h=c(h,f,m,g,e[a+1],4,-1530992060),g=c(g,h,f,m,e[a+4],11,1272893353),m=c(m,g,h,f,e[a+7],16,-155497632),f=c(f,m,g,h,e[a+10],23,-1094730640),h=c(h,f,m,g,e[a+13],4,681279174),g=c(g,h,f,m,e[a],11,-358537222),m=c(m,g,h,f,e[a+3],16,-722521979),f=c(f,m,g,h,e[a+6],23,76029189),h=c(h,f,m,g,e[a+9],4,-640364487),g=c(g,h,f,m,e[a+12],11,-421815835),m=c(m,g,h,f,e[a+15],16,530742520),h=d(h,f=c(f,m,g,h,e[a+2],23,-995338651),m,g,e[a],6,-198630844),g=d(g,h,f,m,e[a+7],10,1126891415),m=d(m,g,h,f,e[a+14],15,-1416354905),f=d(f,m,g,h,e[a+5],21,-57434055),h=d(h,f,m,g,e[a+12],6,1700485571),g=d(g,h,f,m,e[a+3],10,-1894986606),m=d(m,g,h,f,e[a+10],15,-1051523),f=d(f,m,g,h,e[a+1],21,-2054922799),h=d(h,f,m,g,e[a+8],6,1873313359),g=d(g,h,f,m,e[a+15],10,-30611744),m=d(m,g,h,f,e[a+6],15,-1560198380),f=d(f,m,g,h,e[a+13],21,1309151649),h=d(h,f,m,g,e[a+4],6,-145523070),g=d(g,h,f,m,e[a+11],10,-1120210379),m=d(m,g,h,f,e[a+2],15,718787259),f=d(f,m,g,h,e[a+9],21,-343485551),h=o(h,i),f=o(f,n),m=o(m,r),g=o(g,u);return[h,f,m,g]}function h(e){var t,a="",i=32*e.length;for(t=0;t<i;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function f(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;var i=8*e.length;for(t=0;t<i;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function m(e){var t,a,i="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),i+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return i}function g(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return h(u(f(e),8*e.length))}(g(e))}function p(e,t){return function(e,t){var a,i,n=f(e),o=[],r=[];for(o[15]=r[15]=void 0,n.length>16&&(n=u(n,8*e.length)),a=0;a<16;a+=1)o[a]=909522486^n[a],r[a]=1549556828^n[a];return i=u(o.concat(f(t)),512+8*t.length),h(u(r.concat(i),640))}(g(e),g(t))}function v(e,t,a){return t?a?p(t,e):m(p(t,e)):a?y(e):m(y(e))}void 0===(i=function(){return v}.call(t,a,t,e))||(e.exports=i)}()},function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=e.success,a=e.fail;return"GET"==e.method?e.url=c(e.url,e.data):e.url=c(e.url),e.header||(e.header={}),e.header.Authorization=d.default.isLogined()?d.default.user.token:"",e.success=function(i){"LOGIN_REQUIRED"===i.data.key?(d.default.log("login required:",e.url,e,i),d.default.doLogin()):0===i.data.code?(d.default.log("success:",e.url,e,i),t&&t(i.data)):a?(d.default.log("fail:",e.url,e,i),a(i.data)):d.default.log("unknown:",e.url,e,i)},e.fail=function(t){d.default.log("error:",e.url,e,t),a&&a(t)},wx.request(e)}function o(e){return e.method="GET",n(e)}function r(e){return e.method="POST",n(e)}function s(e){return e.method="PUT",n(e)}function l(e){return e.method="DELETE",n(e)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){-1==e.indexOf("?")&&(e+="?");var a=[];if(d.default.isLogined()&&a.push("user="+d.default.user.id),d.default.launchOptions){var i=d.default.launchOptions.query;i&&(i.uid&&a.push("uid="+i.uid),i.channel&&a.push("channel="+i.channel),i.share_id&&a.push("share_id="+i.share_id),i.share_tid&&a.push("share_tid="+i.share_tid),i.pos&&a.push("share_pos="+i.pos),i.scene&&a.push("scene="+decodeURIComponent(i.scene)))}a.push("v="+d.default.version),a.push("version="+d.default.options.version),a.push("appid="+d.default.options.appid),a.push("t="+Date.now()),"?"!==e.charAt(e.length-1)&&"&"!==e.charAt(e.length-1)&&(e+="&");var n=(e+=a.join("&")).split("?")[1];if(t){var o=[];for(var r in t)o.push(r+"="+t[r]);n+="&"+o.join("&")}if((e+="&sign="+u.default.sign(n,d.default.options.secret)).startsWith("/"))return d.default.options.scheme+d.default.options.host+"/"+d.default.options.apiVersion+e}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.initHTTP=function(e){e.request=n,e.get=o,e.post=r,e.put=s,e.delete=l,e.formatURL=c};var d=i(a(1)),u=i(a(2))},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initUser=function(e){e.isLogined=function(){return e.user&&e.user.token},e.getLoginStatus=function(){return e.isLogined()?"success":e.isCheckSession||e.isLogining?"logining":"fail"},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?e.doLogin(t):(e.isCheckSession=!0,wx.checkSession({success:function(){e.checkLogin(t),e.isCheckSession=!1}.bind(e),fail:function(){e.doLogin(t),e.isCheckSession=!1}.bind(e)}))},e.checkLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogined()?(e.loginSuccess(),!e.requireSDK("2.0.3")&&e.needUserInfo()&&e.getUserInfo()):e.doLogin(t)},e.checkCode2access=function(t){var a=t.session_key?t:null;e.post({url:"/oauth/code2access_token",data:t,success:function(t){e.isLogining=!1,e.saveUser(t.data),e.checkLogin(a)}.bind(e),fail:e.loginFail.bind(e)})},e.doLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogining||(e.isLogining=!0,e.user=null,t?e.checkCode2access(t):wx.login({success:function(t){t.code?e.checkCode2access({code:t.code}):e.loginFail(t)}.bind(e),fail:e.loginFail.bind(e)}))},e.loginSuccess=function(t){var a=e.conf&&e.conf.last?e.conf.last:0;!a||Date.now()-a>1e3*e.options.commonDuration?e.getCommon(t):(e.doLoginSuccess(t),e.onLogined())},e.getCommon=function(t){e.get({url:"/common",success:function(a){e.conf=a.data.conf,e.conf.last=Date.now(),wx.setStorage({key:e.options.CONF_KEY,data:e.conf}),e.data||(e.data=a.data.data,wx.setStorage({key:e.options.DATA_KEY,data:e.data})),e.doLoginSuccess(t),e.onLogined()}.bind(e),fail:function(t){e.loginFail(t)}.bind(e)})},e.doLoginSuccess=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginSuccessCallback&&e.loginSuccessCallback(t)},e.loginFail=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginFailCallback&&e.loginFailCallback(t)},e.onLoginSuccess=function(t){e.loginSuccessCallback=t},e.onLoginFail=function(t){e.loginFailCallback=t},e.onLoginComplete=function(t){e.loginCompleteCallback=t},e.checkUserInfo=function(){e.needUserInfo()&&e.getUserInfo()},e.needUserInfo=function(){return!e.user||!e.user.nickname||!e.user.avatar},e.getUserInfo=function(){wx.getUserInfo({withCredentials:!0,success:function(t){return e.post({url:"/oauth/update_userinfo",data:t,success:function(t){e.saveUser(t.data),e.needUserInfo()?e.getUserInfoFail(t):e.getUserInfoSuccess()}.bind(e),fail:e.getUserInfoFail.bind(e)}),t}.bind(e),fail:e.getUserInfoFail.bind(e)})},e.getUserInfoSuccess=function(e){},e.getUserInfoFail=function(e){},e.saveUser=function(t){e.user=t,e.user.last=Date.parse(new Date),wx.setStorage({key:e.options.USER_KEY,data:e.user})}}},function(e,t,a){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.conf&&void 0!==o.default.conf[e]?o.default.conf[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.initConfig=function(e){e.getConfig=i};var n,o=(n=a(1))&&n.__esModule?n:{default:n}},function(e,t,a){"use strict";function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.default.data&&void 0!==u.default.data[e]?u.default.data[e]:t}function n(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.default.data||(u.default.data={}),u.default.data[e]=t,a&&u.default.postData(e)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.default.data=e,t&&u.default.postData()}function r(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=u.default.getData(e,i)+t;return u.default.setData(e,n,a),n}function s(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],wx.setStorage({key:u.default.options.DATA_KEY,data:u.default.data}),u.default.post({url:"/data",data:u.default.data})}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",o={};if(e instanceof Object){var r=e;o={id:r.id,score:r.score,time:r.time,version:u.default.options.version,data:r.data,key:r.key}}else o={id:e,score:t,time:a,version:u.default.options.version,data:i,key:n};u.default.post({url:"/score",data:o,success:function(e){u.default.log("提交分数成功：",t,e)},fail:function(e){u.default.log("提交分数失败：",t,e)}})}function c(e){var t=e.key,a=void 0===t?"default":t,i=e.scale,n=void 0===i?"week":i,o=e.skip,r=void 0===o?0:o,s=e.limit,l=void 0===s?10:s,c=e.success,d=void 0===c?null:c,h=e.fail,f=void 0===h?null:h;u.default.get({url:"/score",data:{score_key:a,scale:n,skip:r,limit:l},success:function(e){d&&d(e.data)},fail:function(e){f&&f(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initData=function(e){e.getData=i,e.setData=n,e.setAllData=o,e.incData=r,e.postData=s,e.postGameScore=l,e.getScoreRank=c};var d,u=(d=a(1))&&d.__esModule?d:{default:d}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initShare=function(e){e.share=function(t){e.options.allowAld?e.aldShareAppMessage(this.createShareOptions(t)):e.shareAppMessage(this.createShareOptions(t)),this.options.share10&&(this.log("share10"),this.shareLog(t,"share10","",{},{})),t.onShareBack&&(e.shareCallbackData={callback:t.onShareBack,ms:Date.now()})},e.createShareOptions=function(t){t.pos||(t.pos="default");var a=this.getShareInfo(t);t.shareId=a.shareId,t.title||(t.title=a.title),t.imageUrl||(t.imageUrl=a.imageUrl),t.success||(t.success=a.success),t.fail||(t.fail=a.fail),t.onHttpError||(t.onHttpError=a.onHttpError),t.tid||(t.tid=""+Date.now());var i="type=share&pos="+t.pos+"&share_id="+a.shareId+"&share_tid="+t.tid;return this.isLogined()&&(i+="&uid="+this.user.id),t.gift&&(i+="&gift="+t.gift),t.query?"&"==t.query.indexOf(0)?(t.query=i+t.query,e.log("new share query: "+t.query)):(t.query=i+"&"+t.query,e.log("new share query: "+t.query)):t.query=i,e.shareTempData[t.tid]=t,{title:t.title,imageUrl:t.imageUrl,query:t.query,success:this.shareSuccess(t),fail:this.shareFail(t),complete:t.complete}},e.getShareInfo=function(e){var t="",a="";this.options.share&&(t=this.options.share.title,a=this.options.share.imageUrl);var i,n=0;return e.defaultTitle&&(t=e.defaultTitle),this.conf&&this.conf.shares&&(this.conf.shares[e.pos]?i=this.conf.shares[e.pos]:this.conf.shares.default&&(i=this.conf.shares.default),i&&(i.title&&(t=i.title),i.image&&(a=i.image),i.id&&(n=i.id))),{title:t,imageUrl:a,shareId:n,success:function(){wx.showToast({title:"分享成功！",icon:"success"})},fail:function(){wx.showToast({title:"分享失败！",icon:"fail"})},onHttpError:function(){wx.showToast({title:"网络出错！",icon:"fail"})}}},e.shareSuccess=function(t){return function(a){console.log("shareSuccess"),delete e.shareTempData[t.tid];var i=!0;t.onShareSuccess&&(i=t.onShareSuccess(a)),i&&(a.shareTickets&&a.shareTickets.length>0?wx.getShareInfo({shareTicket:a.shareTickets[0],success:function(e){t.onShareTicketSuccess&&t.onShareTicketSuccess(e),this.shareLog(t,"success",a.shareTickets[0],e,a)}.bind(this),fail:function(e){t.onShareTicketFail&&t.onShareTicketFail(e),this.shareLog(t,"success",a.shareTickets[0],{},a)}.bind(this)}):(t.onShareTicketFail&&t.onShareTicketFail(),this.shareLog(t,"success","",{},a)))}.bind(this)},e.shareFail=function(e){return function(t){console.log("shareFail");var a=!0;e.onShareFail&&(a=e.onShareFail(t)),a&&this.shareLog(e,"fail","",{},t)}.bind(this)},e.shareLog=function(t,a,i,n,o){this.post({url:"/log/share",data:{share_id:t.shareId,title:t.title,query:t.query,image:t.imageUrl,pos:t.pos,tid:t.tid,status:a,shareTicket:i,info:n,error:o.errMsg,system_version:e.systemInfo.system,sdk_version:e.systemInfo.SDKVersion},success:function(i){"success"!==a&&"click"!==a||!t.success?"fail"===a&&t.fail&&t.fail(i,o):(t.success(i,o),delete e.shareTempData[t.tid])},fail:function(e){"success"!==a&&"click"!==a||!t.onHttpError?"fail"===a&&t.fail&&t.fail(e,o):t.onHttpError(e,o)}})},e.isEnableShare=function(){return!(!e.conf||!e.conf.allow_share||e.requireSystemVersion("6.7.0"))}}},function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){"string"==typeof e?(c.process=e,c.processDuration=Date.now()-c.initStartAt):s.default.log("setProcess():  参数类型错误")}function o(e){s.default.post({url:"/log/process",data:e,success:function(e){s.default.log("提交游戏进度数据成功：",e)},fail:function(e){s.default.log("提交游戏进度数据失败：",e)}})}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};t.initProcess=function(e){e.onShow(function(e){d=Date.now(),c.showOptions=JSON.stringify(e)}),e.afterHide(function(t){var a=Date.now(),i=c=r({},c,{times:c.times+1,showDuration:d?a-d:a-c.initStartAt,duration:a-c.initStartAt}),n=(i.hasInited,i.initStartAt,function(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}(i,["hasInited","initStartAt"]));c.hasInited?o(n):(c.hasInited=!0,o(r({systemInfo:JSON.stringify(e.systemInfo),launchOptions:JSON.stringify(e.launchOptions)},n)))}),e.setProcess=n};var s=i(a(1)),l=i(a(2)),c={hasInited:!1,initStartAt:Date.now(),showOptions:"",times:0,uuid:l.default.guid(),duration:0,showDuration:0,process:"init",processDuration:0},d=0},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initPayment=function(e){e.getPaymentResult=function(e){var t=e.success,a=void 0===t?null:t,i=e.fail,n=void 0===i?null:i;this.get({url:"/payment/result",success:function(e){this.log("获取充值数据成功",e),a&&a(e.data)}.bind(this),fail:function(e){this.log("获取充值数据失败",e),n&&n(e)}.bind(this)})},e.requestMPPayment=function(t){var a=this,i=t.title,n=void 0===i?"点击充值链接进入充值":i,o=t.pos,r=void 0===o?"default":o,s=t.image,l=void 0===s?null:s,c=t.success,d=void 0===c?null:c,u=t.fail,h=void 0===u?null:u,f=t.complete,m=void 0===f?null:f;this.log("打开客服对话"),e.openCustomerServiceConversation({sessionFrom:r,showMessageCard:!0,sendMessageTitle:n,sendMessagePath:"?type=message",sendMessageImg:l||e.conf.shares.default.image,success:function(e){a.log("打开充值会话成功",e),m&&m(),d&&d()},fail:function(e){a.log("打开充值会话fail",e),m&&m(),h&&h()}})},e.requestMPPayment=e.checkSDK("2.0.3",e.requestMPPayment)}},function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=e.pos,a=e.style,i=void 0===a?null:a,s=e.ms,l=void 0===s?0:s,c=e.force,d=void 0!==c&&c,u=e.forceTimeout,h=void 0===u?600:u,f=e.onResize,m=void 0===f?null:f;if(w.default.conf&&w.default.conf.banners&&w.default.conf.banners[t]){var g=w.default.conf.banners[t];if(g.enable){var y=void 0,p=C[t];p&&(y=x[p.adUnitId])&&(p.showed&&o(p),(d||Date.now()-y.created>1e3*h)&&function(e){var t=x[e.adUnitId];if(t)t.hide(),t.destroy(),delete x[e.adUnitId]}(p)),l||(l=w.default.getConfig("banner_ms",120)),p||(p={adUnitId:g.adUnitId,pos:t,count:0,ms:l,duration:0,style:i,width:g.width?g.width>1?1:g.width:1,window:"*",data:[],onResize:m,created:Date.now()},C[t]=p),p.count+=1,p.status="success",(y=x[p.adUnitId])||(y=x[p.adUnitId]=function(e){var t=e.banner,a=e.style,i=void 0===a?null:a,n=w.default.systemInfo.screenWidth*t.width,o=(w.default.systemInfo.screenHeight,wx.createBannerAd({adUnitId:t.adUnitId,style:_({left:0,top:0,width:n,height:180*n/750},i)}));return o.created=Date.now(),o.onError(function(e){t.status="error",t.error=e,t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,r(t,"error"),w.default.log("banner 创建失败",t),C[t.pos]&&delete C[t.pos]}),o.onResize(function(e){t.onResize&&t.onResize(e,o)}),o.onLoad(function(e){w.default.log("banner 加载完成",t),o.created=Date.now()}),o}({banner:p,style:i})),p.showed=Date.now(),setTimeout(function(){y.show()},.01),p.ms&&y&&(p.timeout&&clearTimeout(p.timeout),p.timeout=setTimeout(function(){n({pos:t,style:i,ms:l,force:!0,onResize:m})},1e3*l))}}else w.default.log("createBanner 没有配置: "+t)}function o(e){var t=C[e];if(t&&t.showed){var a=x[t.adUnitId];if(a){var i=a.style,n=i.realWidth,o=i.realHeight,r=Date.now()-t.showed;return a.hide(),t.duration+=r,t.data.push({created:a.created,showed:t.showed,duration:r}),t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,t.window=n+"*"+Math.round(o),!0}}return!1}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onHide",a={adUnitId:e.adUnitId,pos:e.pos,ms:e.ms,count:e.count,duration:e.duration,data:JSON.stringify(e.data),window:e.window,status:e.status,error:e.error,commit:t};e.count=0,e.duration=0,e.status="success",e.error="",e.data=[],w.default.log("postBannerData",a),w.default.post({url:"/log/ad/banner",data:a,success:function(e){w.default.log("提交banner数据成功：",e)},fail:function(e){w.default.log("提交banner数据失败：",e)}})}function s(e){return w.default.conf&&w.default.conf.videos&&w.default.conf.videos[e]?!!w.default.conf.videos[e].enable:(w.default.log("createVideo 没有配置: "+e),!1)}function l(e){function t(e){m.status="error",m.error=e,c(m),f&&f(e),u&&u(e),n()}function a(e){m.created=Date.now()}function i(e){f&&f(e),m.duration=Date.now()-m.created,e&&e.isEnded||void 0===e?l&&l({isEnded:!0,duration:m.duration}):(m.status="cancel",l&&l({isEnded:!1,duration:m.duration})),c(m),n()}function n(){g.offError(t),g.offLoad(a),g.offClose(i)}var o=e.pos,r=e.success,l=void 0===r?null:r,d=e.fail,u=void 0===d?null:d,h=e.complete,f=void 0===h?null:h;if(!s(o))return!1;var m={adUnitId:w.default.conf.videos[o].adUnitId,pos:o,status:"success",created:Date.now(),duration:0},g=wx.createRewardedVideoAd({adUnitId:m.adUnitId});return g.onError(t),g.onLoad(a),g.onClose(i),g.show().catch(function(e){console.log("ws.createVideo error:",e),g.load().then(function(){return g.show()})}),!0}function c(e){w.default.post({url:"/log/ad/rewardedvideo",data:e,success:function(e){w.default.log("提交激励视频数据成功：",e)},fail:function(e){w.default.log("提交激励视频数据失败：",e)}})}function d(e){var t;if(w.default.conf&&w.default.conf.games&&(w.default.conf.games[e]?t=w.default.conf.games[e]:w.default.conf.games.default&&(t=w.default.conf.games.default),t&&t.length>0)){w.default.tmp.getMoreGame||(w.default.tmp.getMoreGame={});var a=w.default.tmp.getMoreGame[e];return(!a||a>=t.length)&&(a=0),w.default.tmp.getMoreGame[e]=a+1,t[a]}}function u(e){var t;if(w.default.conf&&w.default.conf.games)if(w.default.conf.games[e]?t=w.default.conf.games[e]:w.default.conf.games.default&&(t=w.default.conf.games.default),t&&t.length>0){for(var a=[],i=0;i<t.length;i++)a.push(t[i].image);w.default.previewImage({urls:S.default.randomSort(a)})}else wx.showToast({title:"没有更多游戏！",icon:"info"});else wx.showToast({title:"没有更多游戏！",icon:"info"})}function h(e){return M&&M[e]?(M[e].showed&&p(e),M[e]):null}function f(e){for(var t in e)M[t]={pos:t,data:e[t]?e[t]:[],last:Date.now(),duration:0,total_ms:0,logs:[],showed:!0}}function m(e){var t=e.pos,a=void 0===t?"default":t,i=e.count,n=void 0===i?1:i,o=e.success,r=void 0===o?null:o,s=e.fail,l=void 0===s?null:s,c=h(a);c?(M[a].showed=!0,r&&r({code:0,data:c.data,key:"SUCCESS"})):w.default.get({url:"/game/ad",data:{pos:a,count:n},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,f(t)}r&&r(e)}else l&&l(e)},fail:function(e){l&&l(e)}})}function g(e){var t=e.data,a=void 0===t?[{pos:"default",count:1}]:t,i=e.success,n=void 0===i?null:i,o=e.fail,r=void 0===o?null:o,s={},l=!1,c=!0,d=!1,u=void 0;try{for(var m,g=a[Symbol.iterator]();!(c=(m=g.next()).done);c=!0){h(m.value.pos)||(l=!0)}}catch(e){d=!0,u=e}finally{try{!c&&g.return&&g.return()}finally{if(d)throw u}}if(s&&L({ads:s}),l)w.default.post({url:"/game/ad",data:{pos:a},success:function(e){0==e.code?(e.data&&f(e.data),n&&n(e)):r&&r(e)},fail:function(e){r&&r(e)}});else{var y={},p=!0,v=!1,b=void 0;try{for(var _,S=a[Symbol.iterator]();!(p=(_=S.next()).done);p=!0){var C=_.value;M[C.pos].showed=!0,y[C.pos]=M[C.pos].data}}catch(e){v=!0,b=e}finally{try{!p&&S.return&&S.return()}finally{if(v)throw b}}n&&n({code:0,data:y,key:"SUCCESS"})}}function y(e){var t=e.pos,a=void 0===t?"default":t,i=e.count,n=void 0===i?1:i,o=e.success,r=void 0===o?null:o,s=e.fail,l=void 0===s?null:s,c=e.force,d=void 0===c||c,u=h(a);!d&&u?(M[a].showed=!0,r&&r({code:0,data:u.data,key:"SUCCESS"})):w.default.get({url:"/game/ad/feature",data:{pos:a,count:n},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,f(t)}r&&r(e)}else l&&l(e)},fail:function(e){l&&l(e)}})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(){function e(e){var t=Date.now(),a=t-e.last;e.logs.push({ms:a,last:e.last,posted:!1}),e.total_ms+=a,e.last=t}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t||M[t])if(t)e(M[t]);else for(var a in M)e(M[a])}(e),M[e]&&(M[e].showed=!1)}function v(e){function t(e){e.image?w.default.previewImage({urls:[e.image],success:function(e){w.default.log("tapGameAD, success"),c&&c(e)},fail:function(e){w.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){w.default.log("tapGameAD, complete"),f&&f(e)}}):w.default.log("tapGameAD，ad参数内image属性缺失")}function a(e){w.default.requireSDK("2.2.0")?e.appid?wx.navigateToMiniProgram({appId:e.appid,path:e.path,success:function(e){w.default.log("tapGameAD, success"),c&&c(e)},fail:function(e){w.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){w.default.log("tapGameAD, complete"),f&&f(e)}}):w.default.log("tapGameAD, ad参数内appid属性缺失"):e.image?t(e):w.default.alert("当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。")}var i=e.ad,n=e.pos,o=void 0===n?"default":n,r=e.redirect,s=void 0!==r&&r,l=e.success,c=void 0===l?null:l,d=e.fail,u=void 0===d?null:d,h=e.complete,f=void 0===h?null:h,m=i;M&&M[o]&&m?(function(e,t){if(!t||!t.cid||!t.id)return!1;b([{pos:e,tid:t.tid,commit:"click",data:[{cid:t.cid,id:t.id,action:t.action}]}])}(o,m),"code"==m.action?t(m):"navigate"==m.action?a(m):s?a(m):t(m)):w.default.log("tapGameAD pos无效，没有对应数据，或未传ad参数")}function b(e){w.default.post({url:"/game/ad/log",data:e,success:function(t){for(var a=0;a<e.length;a++){var i=e[a];"show"==i.commit&&i.pos in M&&(M[i.pos].logs=[])}w.default.log("广告数据提交成功！")},fail:function(e){w.default.log("广告数据提交失败！")}})}function L(e){function t(e){for(var t=[],a=0,i=null,n=0;n<e.logs.length;n++)e.logs[n].posted||(a+=e.logs[n].ms,i=e.logs[n].last);if(!a||!e.data)return t;for(var o={pos:e.pos,tid:e.data[0].tid,commit:"show",last:i,ms:a,data:[]},r=0;r<e.data.length;r++)o.data.push({id:e.data[r].id,cid:e.data[r].cid,action:e.data[r].action});return t.push(o),t}var a=e.ads,i=void 0===a?null:a,n=e.ad,o=void 0===n?null:n;if(!i&&!o)return!1;var r=[];if(i)for(var s in i)r=r.concat(t(i[s]));else o&&(r=t(o));r.length>0&&b(r)}Object.defineProperty(t,"__esModule",{value:!0});var _=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};t.initAD=function(e){e.onShow(function(){for(var t in C){var a=C[t];a.isShow&&(e.createBanner({pos:a.pos,style:a.style,ms:a.ms,onResize:a.onResize}),a.isShow=!1)}for(var i=0;i<T.length;i++){var n=T[i];M[n].showed=!0,M[n].last=Date.now()}T=[]}),e.afterHide(function(){for(var e in C){var t=C[e];t.isShow=t.showed,t.isShow&&o(t.pos),t.duration>0&&r(t)}for(var a in M)M[a].showed&&(p(a),T.push(a));L({ads:M})}),e.createBanner=e.checkSDK("2.0.4",n),e.closeBanner=e.checkSDK("2.0.4",o),e.createVideo=e.checkSDK("2.0.4",l),e.isEnableVideo=s,e.getMoreGame=d,e.showMoreGame=u,e.getGameAd=m,e.hideGameAd=p,e.tapGameAd=v,e.fetchGameAd=g,e.getPromoGameAd=y};var w=i(a(1)),S=i(a(2)),C={},x={},M={},T=[]},function(e,t,a){"use strict";function i(e,t){e[t]=function(){var a;return e.mode=t,"aldShareAppMessage"==t&&(e.mode="shareAppMessage"),(a=wx)[t].apply(a,arguments)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initHook=function(e){e.setMode=function(t){e.mode=t},i(e,"previewImage"),i(e,"openCustomerServiceConversation"),i(e,"shareAppMessage"),i(e,"aldShareAppMessage")};var n;(n=a(1))&&n.__esModule},function(e,t,a){"use strict";function i(e,t){var a={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(a[i]=e[i]);return a}function n(e){var t=e.pos,a=void 0===t?null:t,i=e.success,n=void 0===i?null:i,o=e.fail,r=void 0===o?null:o,s={};a&&(s.pos=a),v.default.get({url:"/invited/users/count",data:s,success:function(e){n&&n(e.data.count)},fail:function(e){r&&r(e)}})}function o(e){var t=e.pos,a=void 0===t?null:t,i=e.receive,n=void 0===i||i,o=e.skip,r=void 0===o?0:o,s=e.limit,l=void 0===s?-1:s,c=e.success,d=void 0===c?null:c,u=e.fail,h=void 0===u?null:u,f={skip:r,limit:l,receive:n};a&&(f.pos=a),v.default.get({url:"/invited/users",data:f,success:function(e){d&&d(e.data)},fail:function(e){h&&h(e)}})}function r(e){var t=e.user,a=e.pos,i=void 0===a?null:a,n=e.success,o=void 0===n?null:n,r=e.fail,s=void 0===r?null:r,l={users:[{id:t.id,gift:t.gift}]};i&&(l.pos=i),v.default.post({url:"/invited/gift/receive",data:l,success:function(e){o&&o(e.data.receive[0])},fail:function(e){s&&s(e)}})}function s(e){var t=e.users,a=e.pos,i=void 0===a?null:a,n=e.success,o=void 0===n?null:n,r=e.fail,s=void 0===r?null:r,l={users:[]},c=!0,d=!1,u=void 0;try{for(var h,f=t[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var m=h.value;l.users.push({id:m.id,gift:m.gift})}}catch(e){d=!0,u=e}finally{try{!c&&f.return&&f.return()}finally{if(d)throw u}}i&&(l.pos=i),v.default.post({url:"/invited/gift/receive",data:l,success:function(e){o&&o(e.data.receive)},fail:function(e){s&&s(e)}})}function l(e,t){if(t&&t.gift){var a={type:e,gift:t.gift,uid:t.uid,share_tid:t.share_tid},i=v.default.conf[t.gift];i&&(a.receive=!0),v.default.post({url:"/share/gift/log",data:a,success:function(e){if(i){var n=e.data;n.is_self&&i.not_allow_self?v.default.alert(i.not_allow_self_tip||"不能领取自己送出的礼物～"):n.user_count>=(i.date_limit||2)?v.default.alert(i.date_limit_tip||"今天已经领取太多次了～"):n.user_share_count>=(i.share_date_limit||1)?v.default.alert(i.share_date_limit_tip||"已经领取过该礼物了～"):n.count>=(i.limit||10)?v.default.alert(i.limit_tip||"该礼物被领光了～"):(e={gift:t.gift,query:t,conf:i,options:a,data:n},v.default._onGiftCallback&&v.default._onGiftCallback(e))}}})}}function c(e){e.from;var t=e.query;e.options,l("share",t)}function d(e){e.from,e.scene,e.options,l("code",e.query)}function u(e){v.default._onGiftCallback=e}function h(e){var t=e.gifts,a=e.users,i=void 0===a||a,n=e.receive,o=void 0===n||n,r=e.dateLimit,s=void 0===r?0:r,l=e.cache,c=void 0===l?60:l,d=e.limit,u=void 0===d?0:d,h=e.success,f=void 0===h?null:h,m=e.fail,g=void 0===m?null:m;if("boolean"==typeof i&&"boolean"==typeof o&&"number"==typeof s&&"number"==typeof c&&"number"==typeof u){var y=!0,p=[t.sort().toString(),i,o,s,u].join("-");v.default.shareGiftTempData&&v.default.shareGiftTempData[p]&&Date.now()-v.default.shareGiftTempData[p].ms<1e3*c&&(y=!1),y?v.default.post({url:"/share/gift/receive",data:{gifts:t,is_users:i,receive:o,date_limit:s,limit:u},success:function(e){v.default.shareGiftTempData[p]={data:e.data,ms:Date.now()},f&&f(e.data)},fail:g}):f&&f(v.default.shareGiftTempData[p].data)}else v.default.log("requestShareGift, 参数格式异常")}function f(e){var t=e.users,a=e.success,i=void 0===a?null:a,n=e.fail,o=void 0===n?null:n;Array.isArray(t)?v.default.post({url:"/share/gift/receive2",data:{users:t},success:function(e){i&&i(e)},fail:function(e){o&&o(e)}}):v.default.log("receiveShareGift, users参数格式错误")}function m(e){var t=e.pos,a=e.bg,n=void 0===a||a,o=e.success,r=void 0===o?null:o,s=e.fail,l=void 0===s?null:s,c=i(e,["pos","bg","success","fail"]);v.default.post({url:"/share/qrcode",data:y({pos:t,bg:n,uid:v.default.user.id,share_tid:Date.now()+""},c),success:function(e){r&&r(e.data)},fail:l})}function g(e){var t=e.pos,a=e.bg,n=void 0===a||a,o=e.filePath,r=void 0===o?"":o,s=e.success,l=void 0===s?null:s,c=e.fail,d=void 0===c?null:c,u=e.complete,h=void 0===u?null:u,f=i(e,["pos","bg","filePath","success","fail","complete"]);m(y({pos:t,bg:n,success:function(e){!function(t){var a=e.codeUrl;wx.downloadFile({url:a,filePath:r,success:function(e){200==e.statusCode&&(v.default.alert("download success",e.tempFilePath),v.default.log("download success",e.tempFilePath),r||(r=e.tempFilePath,wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){l&&l(e)},fail:function(e){d&&d(e)},complete:function(e){h&&h(e)}})))},fail:function(e){d&&d(e)},complete:function(e){h&&h(e)}})}()},fail:d},f))}Object.defineProperty(t,"__esModule",{value:!0});var y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e};t.initInvite=function(e){e.getInviteCount=n,e.getInviteUsers=o,e.receiveInviteGift=r,e.receiveInviteGifts=s,e.openFromShare(c),e.openFromCode(d),e.onShareGift=u,e.requestShareGift=h,e.receiveShareGift=f,e.getWXACode=m,e.saveWXACode=g};var p,v=(p=a(1))&&p.__esModule?p:{default:p}},function(e,t,a){"use strict";function i(e,t){r.index+=1,r.events.push({event:e,data:t?JSON.stringify(t):null,tm:Date.now()})}Object.defineProperty(t,"__esModule",{value:!0}),t.initEvent=function(e){e.afterHide(function(){o.default.post({url:"/log/event",data:r,success:function(e){0==e.code&&(r.events=[]),o.default.log("事件日志提交成功！")},fail:function(e){o.default.log("事件日志提交失败！")}})}),e.traceEvent=i};var n,o=(n=a(1))&&n.__esModule?n:{default:n},r={index:0,events:[]}}])},{}],16:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=window.wx},{}],17:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=Laya.View,n=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(i);e.GameSceneUI=t,n("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},t}(i);e.HomeViewUI=t,n("ui.home.HomeViewUI",t)}(e.home||(e.home={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},t}(i);e.OverViewUI=t,n("ui.over.OverViewUI",t)}(e.over||(e.over={}))}(a.ui||(a.ui={}))},{}]},{},[2]);