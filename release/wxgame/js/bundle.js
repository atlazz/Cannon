var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function n(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(n.prototype=a.prototype,new n)}}();!function(){function e(t,a,n){function i(r,l){if(!a[r]){if(!t[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=a[r]={exports:{}};t[r][0].call(c.exports,function(e){return i(t[r][1][e]||e)},c,c.exports,e,t,a,n)}return a[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./script/runtime/CannonSelect"),i=e("./script/runtime/GameScene"),o=e("./script/runtime/HomeView"),r=e("./script/component/Reward"),l=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("script/runtime/CannonSelect.ts",n.default),e("script/runtime/GameScene.ts",i.default),e("script/runtime/HomeView.ts",o.default),e("script/component/Reward.ts",r.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="home/HomeView.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=l,l.init()},{"./script/component/Reward":8,"./script/runtime/CannonSelect":10,"./script/runtime/GameScene":11,"./script/runtime/HomeView":12}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./GameConfig"),i=e("./script/utils/wx");new(function(){function e(){if(Laya.Browser.onMiniGame){var e=i.default.getUpdateManager();e.onUpdateReady(function(){i.default.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(t){t.confirm&&e.applyUpdate()}})})}window.Laya3D?Laya3D.init(n.default.width,n.default.height):Laya.init(n.default.width,n.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n.default.scaleMode,Laya.stage.screenMode=n.default.screenMode,Laya.stage.alignV=n.default.alignV,Laya.stage.alignH=n.default.alignH,Laya.URL.exportSceneToJson=n.default.exportSceneToJson,(n.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.height=Math.round(n.default.width*Laya.Browser.height/Laya.Browser.width)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){n.default.startScene&&Laya.Scene.open(n.default.startScene)},e}())},{"./GameConfig":1,"./script/utils/wx":17}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.3.4",a.RewardPos={Cannon:"try_cannon",Bullet:"try_ball",Revive:"revive",Treasure:"reward_triple",Trail:"get_trail"},a.BannerPos={HomeView:"HomeView",StagePass:"missionpass",Revive:"revive"};!function(e){e[e.START=1]="START",e[e.PAUSE=2]="PAUSE",e[e.OVER=3]="OVER",e[e.BANNER_TOUCH=4]="BANNER_TOUCH"}(a.GameState||(a.GameState={})),a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_CannnonSelect="cannonSelect/CannonSelect.scene",a.URL_OverView="over/OverView.scene",a.CameraInitPos=new Laya.Vector3(0,.3,.2),a.CameraInitRotEuler=new Laya.Vector3(0,0,0),a.LightInitPos=new Laya.Vector3(0,5,0),a.LightInitRotEuler=new Laya.Vector3(-30,0,0),a.LightInitColor=new Laya.Vector3(1,1,1),a.StageTexUrl=["res/stage/out/materials/mutou_06.jpg","res/stage/out/materials/TNT.png","res/stage/out/materials/Glass.jpg","res/stage/out/materials/stack_texture.jpg","res/stage/out/materials/stack_texture1.jpg","res/stage/out/materials/stack_texture2.jpg","res/stage/out/materials/stack_texture3.jpg","res/stage/out/materials/stack_texture4.jpg","res/stage/out/materials/stack_texture5.jpg","res/stage/out/materials/stack_texture6.jpg"],a.StageResUrl="res/stage/out/",a.StageInitPos=new Laya.Vector3(0,0,0),a.StageInitRot=new Laya.Vector3(0,180,0),a.StageInitScale=new Laya.Vector3(20,20,20),a.StageNum=20,a.MaxWinCheckTime=30,a.SetKinematicWaitTime=10,a.BgResUrl=["res/scene/1/Scenes_02.lh","res/scene/2/Scenes_04.lh","res/scene/bg1.jpg","res/scene/bg2.jpg"],a.GlassBrokenVelocity=10,a.GlassFallingBrokenVelocity=1,a.PieceResUrl="res/cube_piece.lm",a.PiecesBrokenTime=120,a.CannonInitPos=new Laya.Vector3(0,.04,-.2),a.CannonInitRot=new Laya.Vector3(0,180,0),a.CannonInitScale=new Laya.Vector3(25,25,25),a.TurretInitLocalRot=new Laya.Vector3(0,0,0),a.CannonBallBoxUrl="res/ball_box/ball_box.lh",a.CannonBallInitPos=new Laya.Vector3(-.01,.05,-.13),a.CannonBallInitScale=new Laya.Vector3(25,25,25),a.cdnUrl="https://coolant.miniant.cn/cannon/res_v128.zip",a.soundUrl=["res/audio/shoot.mp3","res/audio/blackhole.mp3","res/audio/winner.mp3","res/audio/broken.mp3"],a.treasureUrl="res/treasure/treasure.lh",a.treasureAngleX=[-1.6,-1.4,-.8,.1,.6,1.2,1,-.8,-.45],a.treasureAngleZ=[0,.2,.5,.6,.3,.2,.1,0,.8],a.TrailUnlock={1:0,2:0,3:2,4:-1},a.BulletMeshUrl="res/bullet/bullet.lm",a.BulletEffectUrl={1:"res/bullet/boom/boomTrail.lh",2:"res/bullet/lightning/lightning.lh",3:"res/bullet/bombEff/bombEff.lh"},a.BulletRewardResUrl={1:"res/bullet/blackhole/blackhole.lh"},a.cannonEffectUrl={1:"res/cannon_effect/gunlightning.lh"},a.BulletRadius=.08,a.CannonSelectIconBgUrl="res/ui/cannonSelect/CannonIconBG.png",a.CannonSelectIconList=[{index:-1},{index:1,icon:"res/ui/cannonSelect/cannon_default.png"},{index:3,icon:"res/ui/cannonSelect/Cannon_10.png"},{index:7,icon:"res/ui/cannonSelect/cannon_dragon.png"},{index:2,icon:"res/ui/cannonSelect/Cannon_03.png"},{index:6,icon:"res/ui/cannonSelect/cannon_light.png"},{index:5,icon:"res/ui/cannonSelect/cannon_lion.png"},{index:4,icon:"res/ui/cannonSelect/Cannon_22.png"},{index:-1}],a.CannonSelectTextList={1:{name:"普通炮",feature:"普通的大炮，普通的威力，就很普通",unlockLvl:0,unlockDiamond:0},3:{name:"冰雪奇缘",feature:"更强的威力，将方块变成冰块",unlockLvl:5,unlockDiamond:1350},7:{name:"龙门大炮",feature:"威力超强，拥有它，你就是龙的传人",unlockLvl:11,unlockDiamond:3500},2:{name:"双重射击",feature:"两炮齐发，威力强大",unlockLvl:17,unlockDiamond:7500},6:{name:"闪电风暴",feature:"威力无比，一发入魂",unlockLvl:23,unlockDiamond:10500},5:{name:"黄金狮子头",feature:"河东狮吼，十分暴躁",unlockLvl:30,unlockDiamond:15e3},4:{name:"无敌散弹炮",feature:"终极武器，用一次爽一次",unlockLvl:999,unlockDiamond:999999}},a.CannonResUrl={1:"res/cannon/Cannon_Default.lh",2:"res/cannon/Cannon_ShotgunX2.lh",3:"res/cannon/Cannon_Frozen.lh",4:"res/cannon/Cannon_Reward.lh",5:"res/cannon/Cannon_Lion.lh",6:"res/cannon/Cannon_Lightning.lh",7:"res/cannon/Cannon_Dragon.lh"},a.BulletTextureUrl={1:"res/bullet/ball_texture/ball_default.jpg",2:"res/bullet/ball_texture/shotgun.jpg",3:"res/bullet/ball_texture/ice.jpg",4:"res/bullet/ball_texture/shotgun.jpg",5:"res/bullet/ball_texture/boom.jpg",6:"res/bullet/ball_texture/lightning.jpg",7:"res/bullet/ball_texture/ball_default.jpg"},a.BulletScale={0:{1:1,2:1,3:1,4:1,5:1,6:1,7:1},1:{1:7}},a.BulletMass={0:{1:20,2:20,3:25,4:20,5:30,6:60,7:35},1:{1:100}},a.BulletVelocity={0:{1:30,2:30,3:30,4:30,5:30,6:30,7:30},1:{1:5}},a.BulletTrigger={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1},1:{1:!0}},a.BulletOverrideGravity={0:{1:8,2:8,3:8,4:8,5:8,6:8,7:8},1:{1:0}}},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default={gameData:{musicEnabled:!0,soundEnabled:!0,vibrationEnabled:!0,updateTimestamp:0,videoCount:0,lastVideoTimestamp:0,shareCount:0,lastShareTimestamp:0,stageIndex:1,cannonType:1,cannonUnlockState:{},trailType:1,trailUnlockState:{},trailShowToday:!1,lastTrailShowTimestamp:0,diamond:0,tutorialStep:6,videoErr:{},getDiamond:1,treasureBannerHit:0,lastTreasureBannerHitTimestamp:0},config:{skin_block:!1,share_first:!1,allow_share:!0,allow_video:!0,share_number:5,video_number:6,share_time:30,banner_time:180,share_delay:4,online:!0,debug:!1,allow_pay:!1,allow_revive:!0,banner_delay:1,banner_delay_ratio:1,banner_delay_ratio1:.8,deny_banner:!1,share_fail:"'操作失败，请换个群'",distance_iphonex:50,banner_click_time:2,games:{},shares:{},videos:{},banners:{},try_cannon:1,try_ball:1,revive:1,get_trail:1,reward_triple:1,bulletRewardType:1,cannonRewardType:4,hasTreasure:!0,banner:"",banner_number:0,banner_delay_pass:1,banner_show_treasure:1,show_number:2,show_number_t:1,MaxTreasureBannerHit:2,allow_interstitial:!0,uid_interstitial:"adunit-1b8d841eedb67978",first_step_count:10},user:{},audio:{volume:.5}}},{}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.Map={Android:{1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:9,9:10,10:8,11:11,12:12,13:13,14:14,15:15,16:18,17:19,18:22,19:24,20:16,21:25,22:26,23:27,24:28,25:17,26:29,27:30,28:32,29:33,30:20,31:34,32:35,33:36,34:37,35:21,36:38,37:39,38:41,39:42,40:23,41:47,42:48,43:51,44:52,45:31,46:53,47:54,48:58,49:40,50:43,51:44,52:45,53:46,54:49,55:50,56:55,57:56,58:57,59:void 0},IOS:{1:1,2:2,3:5,4:7,5:6,6:9,7:10,8:3,9:12,10:8,11:14,12:16,13:19,14:23,15:11,16:25,17:26,18:27,19:29,20:30,21:30,22:3,23:4,24:32,25:16,26:25,27:26,28:27,29:29,30:20,31:3,32:4,33:37,34:39,35:17,36:41,37:42,38:45,39:48,40:18,41:6,42:8,43:11,44:30,45:38,46:48,47:51,48:52,49:31,50:53,51:38,52:58,53:40,54:43,55:18,56:45,57:46,58:49,59:void 0}},a.Stage={Android:{1:{1:{min:1,max:1,ball_add:10,reward:10},2:{min:2,max:2,ball_add:10,reward:10},3:{min:3,max:3,ball_add:10,reward:10},4:{min:4,max:4,ball_add:10,reward:10},5:{min:5,max:5,ball_add:8,reward:10}},2:{1:{min:6,max:6,ball_add:8,reward:15},2:{min:7,max:7,ball_add:8,reward:15},3:{min:8,max:8,ball_add:8,reward:15},4:{min:9,max:9,ball_add:8,reward:15},5:{min:10,max:10,ball_add:6,reward:15}},3:{1:{min:11,max:11,ball_add:7,reward:20},2:{min:12,max:12,ball_add:7,reward:20},3:{min:13,max:13,ball_add:7,reward:20},4:{min:14,max:14,ball_add:7,reward:20},5:{min:15,max:15,ball_add:5,reward:20}},4:{1:{min:1,max:19,ball_add:6,reward:25},2:{min:1,max:19,ball_add:6,reward:25},3:{min:1,max:19,ball_add:6,reward:25},4:{min:1,max:19,ball_add:6,reward:25},5:{min:20,max:20,ball_add:4,reward:25}},5:{1:{min:1,max:24,ball_add:5,reward:30},2:{min:1,max:24,ball_add:5,reward:30},3:{min:1,max:24,ball_add:5,reward:30},4:{min:1,max:24,ball_add:5,reward:30},5:{min:25,max:25,ball_add:3,reward:30}},6:{1:{min:5,max:29,ball_add:4,reward:35},2:{min:5,max:29,ball_add:4,reward:35},3:{min:5,max:29,ball_add:4,reward:35},4:{min:5,max:29,ball_add:4,reward:35},5:{min:30,max:30,ball_add:2,reward:35}},7:{1:{min:5,max:34,ball_add:4,reward:40},2:{min:5,max:34,ball_add:4,reward:40},3:{min:5,max:34,ball_add:4,reward:40},4:{min:5,max:34,ball_add:4,reward:40},5:{min:35,max:35,ball_add:2,reward:40}},8:{1:{min:5,max:39,ball_add:4,reward:45},2:{min:5,max:39,ball_add:4,reward:45},3:{min:5,max:39,ball_add:4,reward:45},4:{min:5,max:39,ball_add:4,reward:45},5:{min:40,max:40,ball_add:2,reward:45}},9:{1:{min:5,max:44,ball_add:3,reward:50},2:{min:5,max:44,ball_add:3,reward:50},3:{min:5,max:44,ball_add:3,reward:50},4:{min:5,max:44,ball_add:3,reward:50},5:{min:45,max:45,ball_add:1,reward:50}},10:{1:{min:5,max:48,ball_add:3,reward:55},2:{min:5,max:48,ball_add:3,reward:55},3:{min:5,max:48,ball_add:3,reward:55},4:{min:5,max:48,ball_add:3,reward:55},5:{min:49,max:49,ball_add:1,reward:55}},11:{1:{min:5,max:48,ball_add:3,reward:60},2:{min:5,max:48,ball_add:3,reward:60},3:{min:5,max:48,ball_add:3,reward:60},4:{min:5,max:48,ball_add:3,reward:60},5:{min:50,max:50,ball_add:1,reward:60}},12:{1:{min:5,max:48,ball_add:3,reward:65},2:{min:5,max:48,ball_add:3,reward:65},3:{min:5,max:48,ball_add:3,reward:65},4:{min:5,max:48,ball_add:3,reward:65},5:{min:51,max:51,ball_add:1,reward:65}},13:{1:{min:5,max:48,ball_add:2,reward:70},2:{min:5,max:48,ball_add:2,reward:70},3:{min:5,max:48,ball_add:2,reward:70},4:{min:5,max:48,ball_add:2,reward:70},5:{min:52,max:52,ball_add:1,reward:70}},14:{1:{min:5,max:48,ball_add:2,reward:75},2:{min:5,max:48,ball_add:2,reward:75},3:{min:5,max:48,ball_add:2,reward:75},4:{min:5,max:48,ball_add:2,reward:75},5:{min:53,max:53,ball_add:1,reward:75}},15:{1:{min:5,max:48,ball_add:2,reward:80},2:{min:5,max:48,ball_add:2,reward:80},3:{min:5,max:48,ball_add:2,reward:80},4:{min:5,max:48,ball_add:2,reward:80},5:{min:54,max:54,ball_add:1,reward:80}},16:{1:{min:10,max:48,ball_add:2,reward:85},2:{min:10,max:48,ball_add:2,reward:85},3:{min:10,max:48,ball_add:2,reward:85},4:{min:10,max:48,ball_add:2,reward:85},5:{min:55,max:55,ball_add:1,reward:85}},17:{1:{min:10,max:48,ball_add:2,reward:90},2:{min:10,max:48,ball_add:2,reward:90},3:{min:10,max:48,ball_add:2,reward:90},4:{min:10,max:48,ball_add:2,reward:90},5:{min:56,max:56,ball_add:1,reward:90}},18:{1:{min:10,max:48,ball_add:2,reward:95},2:{min:10,max:48,ball_add:2,reward:95},3:{min:10,max:48,ball_add:2,reward:95},4:{min:10,max:48,ball_add:2,reward:95},5:{min:57,max:57,ball_add:1,reward:95}},19:{1:{min:10,max:48,ball_add:2,reward:100},2:{min:10,max:48,ball_add:2,reward:100},3:{min:10,max:48,ball_add:2,reward:100},4:{min:10,max:48,ball_add:2,reward:100},5:{min:58,max:58,ball_add:1,reward:100}},20:{1:{min:10,max:48,ball_add:1,reward:105},2:{min:10,max:48,ball_add:1,reward:105},3:{min:10,max:48,ball_add:1,reward:105},4:{min:10,max:48,ball_add:1,reward:105},5:{min:49,max:58,ball_add:0,reward:105}}},IOS:{1:{1:{min:1,max:1,ball_add:10,reward:10},2:{min:2,max:2,ball_add:10,reward:10},3:{min:3,max:3,ball_add:10,reward:10},4:{min:4,max:4,ball_add:10,reward:10},5:{min:5,max:5,ball_add:8,reward:10}},2:{1:{min:6,max:6,ball_add:8,reward:15},2:{min:7,max:7,ball_add:8,reward:15},3:{min:8,max:8,ball_add:8,reward:15},4:{min:9,max:9,ball_add:8,reward:15},5:{min:10,max:10,ball_add:6,reward:15}},3:{1:{min:11,max:11,ball_add:7,reward:20},2:{min:12,max:12,ball_add:7,reward:20},3:{min:13,max:13,ball_add:7,reward:20},4:{min:14,max:14,ball_add:7,reward:20},5:{min:15,max:15,ball_add:5,reward:20}},4:{1:{min:1,max:19,ball_add:6,reward:25},2:{min:1,max:19,ball_add:6,reward:25},3:{min:1,max:19,ball_add:6,reward:25},4:{min:1,max:19,ball_add:6,reward:25},5:{min:20,max:20,ball_add:4,reward:25}},5:{1:{min:1,max:24,ball_add:5,reward:30},2:{min:1,max:24,ball_add:5,reward:30},3:{min:1,max:24,ball_add:5,reward:30},4:{min:1,max:24,ball_add:5,reward:30},5:{min:25,max:25,ball_add:3,reward:30}},6:{1:{min:5,max:29,ball_add:4,reward:35},2:{min:5,max:29,ball_add:4,reward:35},3:{min:5,max:29,ball_add:4,reward:35},4:{min:5,max:29,ball_add:4,reward:35},5:{min:30,max:30,ball_add:2,reward:35}},7:{1:{min:5,max:34,ball_add:4,reward:40},2:{min:5,max:34,ball_add:4,reward:40},3:{min:5,max:34,ball_add:4,reward:40},4:{min:5,max:34,ball_add:4,reward:40},5:{min:35,max:35,ball_add:2,reward:40}},8:{1:{min:5,max:39,ball_add:4,reward:45},2:{min:5,max:39,ball_add:4,reward:45},3:{min:5,max:39,ball_add:4,reward:45},4:{min:5,max:39,ball_add:4,reward:45},5:{min:40,max:40,ball_add:2,reward:45}},9:{1:{min:10,max:44,ball_add:3,reward:50},2:{min:10,max:44,ball_add:3,reward:50},3:{min:10,max:44,ball_add:3,reward:50},4:{min:10,max:44,ball_add:3,reward:50},5:{min:45,max:45,ball_add:1,reward:50}},10:{1:{min:10,max:49,ball_add:3,reward:55},2:{min:10,max:49,ball_add:3,reward:55},3:{min:10,max:49,ball_add:3,reward:55},4:{min:10,max:49,ball_add:3,reward:55},5:{min:50,max:50,ball_add:1,reward:55}},11:{1:{min:10,max:54,ball_add:3,reward:60},2:{min:10,max:54,ball_add:3,reward:60},3:{min:10,max:54,ball_add:3,reward:60},4:{min:10,max:54,ball_add:3,reward:60},5:{min:55,max:55,ball_add:1,reward:60}},12:{1:{min:10,max:54,ball_add:3,reward:65},2:{min:10,max:54,ball_add:3,reward:65},3:{min:10,max:54,ball_add:3,reward:65},4:{min:10,max:54,ball_add:3,reward:65},5:{min:35,max:58,ball_add:1,reward:65}},13:{1:{min:10,max:54,ball_add:2,reward:70},2:{min:10,max:54,ball_add:2,reward:70},3:{min:10,max:54,ball_add:2,reward:70},4:{min:10,max:54,ball_add:2,reward:70},5:{min:35,max:58,ball_add:1,reward:70}},14:{1:{min:10,max:54,ball_add:2,reward:75},2:{min:10,max:54,ball_add:2,reward:75},3:{min:10,max:54,ball_add:2,reward:75},4:{min:10,max:54,ball_add:2,reward:75},5:{min:35,max:58,ball_add:1,reward:75}},15:{1:{min:10,max:54,ball_add:2,reward:80},2:{min:10,max:54,ball_add:2,reward:80},3:{min:10,max:54,ball_add:2,reward:80},4:{min:10,max:54,ball_add:2,reward:80},5:{min:35,max:58,ball_add:1,reward:80}},16:{1:{min:10,max:54,ball_add:2,reward:85},2:{min:10,max:54,ball_add:2,reward:85},3:{min:10,max:54,ball_add:2,reward:85},4:{min:10,max:54,ball_add:2,reward:85},5:{min:35,max:58,ball_add:1,reward:85}},17:{1:{min:10,max:54,ball_add:2,reward:90},2:{min:10,max:54,ball_add:2,reward:90},3:{min:10,max:54,ball_add:2,reward:90},4:{min:10,max:54,ball_add:2,reward:90},5:{min:35,max:58,ball_add:1,reward:90}},18:{1:{min:10,max:54,ball_add:2,reward:95},2:{min:10,max:54,ball_add:2,reward:95},3:{min:10,max:54,ball_add:2,reward:95},4:{min:10,max:54,ball_add:2,reward:95},5:{min:35,max:58,ball_add:1,reward:95}},19:{1:{min:10,max:54,ball_add:2,reward:100},2:{min:10,max:54,ball_add:2,reward:100},3:{min:10,max:54,ball_add:2,reward:100},4:{min:10,max:54,ball_add:2,reward:100},5:{min:35,max:58,ball_add:1,reward:100}},20:{1:{min:10,max:54,ball_add:1,reward:105},2:{min:10,max:54,ball_add:1,reward:105},3:{min:10,max:54,ball_add:1,reward:105},4:{min:10,max:54,ball_add:1,reward:105},5:{min:35,max:58,ball_add:0,reward:105}}}},a.StageRaw={1:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},2:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},3:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},4:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},5:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},6:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},7:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},8:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},9:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},10:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},11:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},12:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},13:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},14:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},15:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},16:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},17:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},18:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},19:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},20:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},21:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},22:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},23:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},24:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},25:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},26:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},27:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},28:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},29:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},30:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},31:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},32:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},33:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},34:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},35:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},36:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},37:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},38:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},39:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},40:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},41:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},42:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},43:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},44:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},45:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},46:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},47:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},48:{ball_num:9,rotate:!0,move_x:!0,move_y:!0,move_z:!0},49:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},50:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},51:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},52:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},53:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},54:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},55:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},56:{ball_num:14,rotate:!0,move_x:!0,move_y:!0,move_z:!0},57:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},58:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0}},a.StageReward={1:150,2:200,3:250,4:300,5:350,6:400,7:450,8:500,9:550,10:600,11:650,12:700,13:750,14:800,15:850,16:900,17:950,18:1e3,19:1050,20:1100,21:1150,22:1200,23:1250,24:1300,25:1350,26:1400,27:1450,28:1500,29:1550,30:1600,31:1650,32:1700,33:1750,34:1800,35:1850,36:1900,37:1950,38:2e3,39:2050},a.StageTexture={1:3,2:4,3:5,4:6,5:7,6:8,7:9,8:999,9:999,10:999,11:999,12:999,13:999,14:999,15:999,16:999,17:999,18:999,19:999,20:999}},{}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../runtime/GameScene"),i=e("../Const"),o=e("./Target"),r=e("./Guard"),l=function(e){function t(){var t=e.call(this)||this;return t.isReward=!0,t.isBomb=!1,t.collisionBlackList=["bullet","player"],t}return __extends(t,e),t.prototype.onAwake=function(){this.bullet||(this.bullet=this.owner)},t.prototype.init=function(){this.rigidbody=this.bullet.addComponent(Laya.Rigidbody3D),this.rigidbody.colliderShape=new Laya.SphereColliderShape(i.BulletRadius),this.material=new Laya.PBRSpecularMaterial,this.bullet.meshRenderer.material=this.material},t.prototype.reset=function(e,t){var a=this;void 0===t&&(t=!1),this.bullet=this.owner,this.isReward=t,this.type=e,this.effect=this.bullet.getChildByName("effect"),this.lifetime=120,this.isReward&&1===this.type&&(this.lifetime=300),this.flag_active=!1,void 0===this.rigidbody&&this.init(),this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_FADE,this.material.albedoColorA=0,this.isReward||Laya.Texture2D.load(i.BulletTextureUrl[this.type],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.effect&&(this.effect.active=!1),this.bullet.transform.localPosition=n.default.instance.turretInitPos.clone(),this.bullet.transform.localRotationEuler=i.StageInitRot.clone(),Laya.Vector3.scale(new Laya.Vector3(1,1,1),i.BulletScale[+this.isReward][this.type],this.bullet.transform.localScale),this.effect&&Laya.Vector3.scale(this.effect.transform.localScale,1/i.BulletScale[+this.isReward][this.type],this.effect.transform.localScale),this.rigidbody.isTrigger=i.BulletTrigger[+this.isReward][this.type],this.rigidbody.ccdMotionThreshold=.001,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type],this.rigidbody.mass=i.BulletMass[+this.isReward][this.type];var o=n.default.instance.bulletDirection.clone();Laya.Vector3.scale(o,i.BulletVelocity[+this.isReward][this.type],o),this.rigidbody.linearVelocity=o,this.rigidbody.overrideGravity=!0,this.rigidbody.gravity=new Laya.Vector3(0,-i.BulletOverrideGravity[+this.isReward][this.type],0),this.rigidbody.canCollideWith=1,this.rigidbody.collisionGroup=4,"bulletTrigger"===this.bullet.name&&(this.rigidbody.isTrigger=!0,this.rigidbody.collisionGroup=5,this.rigidbody.ccdMotionThreshold=1e-4,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type]/1e3,5===this.type&&(this.isBomb=!1))},t.prototype.onTriggerEnter=function(e){this.triggerHandler(e)},t.prototype.onTriggerExit=function(e){"bulletTrigger"===this.bullet.name&&this.recover()},t.prototype.triggerHandler=function(e){if("bottom"===e.owner.name){if(!n.default.instance)return;n.default.instance.treasureFrameCnt>=300&&(n.default.instance.treasureHitCnt=n.default.instance.treasereMaxHitCnt),0===n.default.instance.treasureHitState&&(n.default.instance.treasureHitState=1),n.default.instance.isTreasureMoveStart=!0,n.default.instance.isTreasureHit=!0,n.default.instance.treasureHitCnt++,this.recover()}if(this.isReward){if(1===this.type){n.default.instance.isStageStart=!0;var t=e.owner;if("stand"===t.name||t.name.indexOf("Guard")>=0||t.name.indexOf("Obstacle")>=0){t.timer.frameOnce(1,this,function(){t.getComponent(Laya.PhysicsCollider)&&t.getComponent(Laya.PhysicsCollider).destroy(),t.getComponent(Laya.Rigidbody3D)&&t.getComponent(Laya.Rigidbody3D).destroy(),t.getComponent(o.default)&&t.getComponent(o.default).destroy(),t.getComponent(r.default)&&t.getComponent(r.default).destroy()});var a=0,i=t.transform.localScaleX/120,l=t.transform.localScaleY/120,s=t.transform.localScaleZ/120,d=(this.bullet.transform.position.x-t.transform.position.x)/120/n.default.instance.gameStage.transform.scale.x,c=(this.bullet.transform.position.y-t.transform.position.y)/120/n.default.instance.gameStage.transform.scale.y,u=(this.bullet.transform.position.z-t.transform.position.z)/120/n.default.instance.gameStage.transform.scale.z,h=5*Math.random(),m=5*Math.random(),f=5*Math.random();t.timer.frameLoop(1,t,function(){if(a++>60)return t.timer.clearAll(t),void t.destroy();t.transform.localScaleX-=i,t.transform.localScaleY-=l,t.transform.localScaleZ-=s,t.transform.localPositionX-=d,t.transform.localPositionY+=c,t.transform.localPositionZ-=u,t.transform.localRotationEulerX+=h,t.transform.localRotationEulerY+=m,t.transform.localRotationEulerZ+=f})}}}else 5!==this.type||this.isBomb||(this.isBomb=!0,n.default.instance.bulletBombEff(this.bullet.transform.position))},t.prototype.onUpdate=function(){this.lifetime--,this.lifetime<0&&this.recover(),"bullet"===this.bullet.name&&!this.flag_active&&this.bullet.transform.position.z<-1&&(this.flag_active=!0,this.refreshMaterial(),this.effect&&(this.effect.active=!0)),this.effect&&!this.rigidbody.isTrigger&&(this.effect.transform.localRotationEulerX=-this.bullet.transform.localRotationEulerX,this.effect.transform.localRotationEulerY=-this.bullet.transform.localRotationEulerY,this.effect.transform.localRotationEulerZ=-this.bullet.transform.localRotationEulerZ)},t.prototype.refreshMaterial=function(){this.isReward||(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,this.material.albedoColorA=1)},t.prototype.recover=function(){var e=this;this.isReward?Laya.timer.frameOnce(1,this,function(){e.bullet.destroy(),e.destroy()}):Laya.timer.frameOnce(1,this,function(){e.rigidbody.clearForces();var t=e.bullet.getChildByName("effect");t&&t.destroy&&t.destroy(),e.bullet.removeChildByName("effect");var a=e.bullet.getChildByName("trail");a&&a.destroy&&a.destroy(),e.bullet.removeChildByName("trail"),e.bullet.removeSelf(),"bulletTrigger"===e.bullet.name?Laya.Pool.recover("bulletTrigger",e.bullet):Laya.Pool.recover("bullet",e.bullet)})},t}(Laya.Script3D);a.default=l},{"../Const":3,"../runtime/GameScene":11,"./Guard":7,"./Target":9}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../Const"),i=function(e){function t(){var t=e.call(this)||this;return t.moveTimes=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.bounds;this.sizeX=e.getMax().x-e.getMin().x,this.sizeY=e.getMax().y-e.getMin().y,this.sizeZ=e.getMax().z-e.getMin().z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);var t=new Laya.PBRSpecularMaterial;if(Laya.Texture2D.load(n.StageTexUrl[0],Laya.Handler.create(this,function(e){t.albedoTexture=e})),t.specularColor=new Laya.Vector4(0,0,0,1),t.enableEmission=!0,t.emissionColor=new Laya.Vector4(.2,.2,.2,1),this.guard.meshRenderer.material=t,this.guard.name.search("move_x")>=0)this.MaxMoveTimes=120,this.moveStepY=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepX=2*this.guard.transform.localPositionY/this.MaxMoveTimes:this.moveStepX=2*this.guard.transform.localPositionX/this.MaxMoveTimes;else if(this.guard.name.search("move_y")>=0)this.MaxMoveTimes=120,this.moveStepX=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepY=2*this.guard.transform.localPositionX/this.MaxMoveTimes:this.moveStepY=2*this.guard.transform.localPositionY/this.MaxMoveTimes;else if(this.guard.name.search("move_")>=0){this.MaxMoveTimes=60;var a=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,i=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var o=a;a=i,i=o}this.guard.name.search("move_left")>=0?(this.moveStepX=-a,this.moveStepY=0):this.guard.name.search("move_right")>=0?(this.MaxMoveTimes=60,this.moveStepX=a,this.moveStepY=0):this.guard.name.search("move_up")>=0?(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=-i):this.guard.name.search("move_down")>=0&&(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=i)}},t.prototype.onUpdate=function(){this.guard.destroyed?this.destroy():this.guard.name.search("move")>=0?(this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes),this.flag_move=Math.floor(this.moveTimes/this.MaxMoveTimes%2)>0,this.flag_move?(this.guard.transform.localPositionX+=this.moveStepX,this.guard.transform.localPositionY+=this.moveStepY):(this.guard.transform.localPositionX-=this.moveStepX,this.guard.transform.localPositionY-=this.moveStepY)):this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)},t}(Laya.Script3D);a.default=i},{"../Const":3}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../utils/wx"),i=e("../utils/ws.js"),o=e("../utils/Ad"),r=e("../Global"),l=function(e){function t(){var a=e.call(this)||this;return a.shareTimestampMap={},a.lastShareTimestamp=0,console.log("Reward constructor()"),t.instance=a,a}return __extends(t,e),t.prototype.onAwake=function(){var e=this;console.log("Reward onAwake()"),Laya.Browser.onMiniGame&&n.default.onShow(function(t){var a=e.shareArgs;if(a&&a.length){var i=a[0]||{},o=i.pos,l=i.success,s=i.fail,d=i.complete;try{var c=Date.now();l||s?c-e.lastShareTimestamp>=1e3*(r.default.config.share_delay||5)?(r.default.gameData.shareCount++,r.default.gameData.lastShareTimestamp=c,e.shareTimestampMap[o]=c,l&&l(t),d&&d(t)):(e.shareTimestampMap[o]=0,n.default.showModal({title:"提示",content:r.default.config.share_fail,cancelText:"知道了",confirmText:"重新发送",success:function(n){n.confirm?e.share.apply(e,a):(s&&s(t),d&&d(t))}})):(e.shareTimestampMap[o]=0,d&&d(t))}finally{e.lastShareTimestamp=0,e.shareArgs=null}}})},t.prototype.reward=function(e){var t=e.pos,a=e.query,n=e.success,i=e.fail,o=e.complete;this.isShareState(t)?this.share({pos:t,query:a,success:n,fail:i,complete:o}):this.video({pos:t,success:n,fail:i,complete:o})},t.prototype.share=function(e){var t=e.pos,a=e.query,n=e.success,o=e.fail,l=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),o&&o(),void(l&&l());if(!this.isOnline()||!this.allowShare(t))return console.log("share not allowed"),o&&o(),void(l&&l());var s=Date.now(),d=Number(this.shareTimestampMap[t]);if(d&&s-d<1e3*r.default.config.share_time)return console.log("请稍等一会再操作"),o&&o(),void(l&&l());(n||o)&&(this.shareTimestampMap[t]=s),this.lastShareTimestamp=Date.now(),this.shareArgs=arguments,i.default.share({pos:t,query:a})},t.prototype.video=function(e){var t=e.pos,a=e.success,n=e.fail,i=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),n&&n(),void(i&&i());o.posShowVideo(t,function(){console.log("今日视频已看完"),n&&n(),i&&i()},function(e){e&&e.isEnded||void 0===e?(r.default.gameData.videoCount++,r.default.gameData.lastVideoTimestamp=Date.now(),a&&a()):e&&!e.isEnded||n&&n(),i&&i()})},t.prototype.allowShare=function(e){var t=r.default.config[e+"_allow_share"];return"boolean"==typeof t?t:r.default.config.allow_share},t.prototype.allowVideo=function(e){var t=r.default.config[e+"_allow_video"];return"boolean"==typeof t?t:r.default.config.allow_video},t.prototype.isOnline=function(){return r.default.config.online},t.prototype.isShareFirst=function(e){var t=r.default.config[e+"_share_first"];return"boolean"==typeof t?t:r.default.config.share_first},t.prototype.getShareCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastShareTimestamp||r.default.gameData.lastShareTimestamp<t)&&(r.default.gameData.shareCount=0),r.default.gameData.shareCount},t.prototype.isOverShare=function(){return r.default.config.share_number&&r.default.config.share_number<=this.getShareCount()},t.prototype.getVideoCount=function(){var e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastVideoTimestamp||r.default.gameData.lastVideoTimestamp<t)&&(r.default.gameData.videoCount=0),r.default.gameData.videoCount},t.prototype.isOverVideo=function(){return r.default.config.video_number&&r.default.config.video_number<=this.getVideoCount()},t.prototype.hasVideo=function(){return o.hasVideoAd()},t.prototype.isShareState=function(e){return!(!this.isOnline()||!this.allowShare(e))&&(!this.allowVideo(e)||!this.hasVideo()||(this.isShareFirst(e)?!this.isOverShare()||this.isOverVideo():this.isOverVideo()))},t}(Laya.Script);a.default=l},{"../Global":4,"../utils/Ad":13,"../utils/ws.js":16,"../utils/wx":17}],9:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../Const"),i=e("../runtime/HomeView"),o=e("../runtime/GameScene"),r=e("../component/Bullet"),l=e("../Global"),s=function(e){function t(){var t=e.call(this)||this;return t.type=1,t.collisionWhiteList=["bullet","Obstacle"],t.jumpCnt=0,t.isOnGround=!1,t.isBroken=!1,t}return __extends(t,e),t.prototype.onAwake=function(){var e=this;this.target=this.owner,this.setRigidbody(),Laya.timer.frameOnce(n.SetKinematicWaitTime,this,function(){o.default.instance.isStageStart||(e.rigidbody.isKinematic=!0)})},t.prototype.onCollisionEnter=function(e){this.collisionHandler(e)},t.prototype.onCollisionStay=function(e){this.collisionHandler(e)},t.prototype.onCollisionExit=function(e){this.collisionHandler(e)},t.prototype.collisionHandler=function(e){for(var t=this,a=e.other.owner,i=!1,l=0,s=this.collisionWhiteList;l<s.length;l++){var d=s[l];if(a.name.indexOf(d)>=0){i=!0;break}}if(2===this.type){if(this.jumpCnt>60){(h=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)))>=n.GlassFallingBrokenVelocity&&this.broken()}if(i){var c=new Laya.Vector3(0,0,0),u=a.getComponent(Laya.Rigidbody3D);u&&(c=u.linearVelocity.clone());var h=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)),m=Laya.Vector3.distance(c,new Laya.Vector3(0,0,0));(h>=n.GlassBrokenVelocity||m>=n.GlassBrokenVelocity)&&this.broken()}else"ground"!==a.name&&"bomb"!==a.name||this.broken()}else if(3===this.type&&this.target.parent)if(a.name.indexOf("bullet")>=0||a.name.indexOf("bomb")>=0)this.TNTBomb();else{var f=a.getComponent(Laya.Rigidbody3D),c=new Laya.Vector3(0,0,0);f&&(c=f.linearVelocity.clone()),Laya.Vector3.distance(c,this.rigidbody.linearVelocity)>=10&&this.TNTBomb()}if("stand"===a.name||a.name.indexOf("Guard")>=0)this.isOnGround||(o.default.instance.winCheckCnt=0);else if("ground"===a.name)this.isOnGround=!0,Laya.timer.frameOnce(60,this,function(){t.destroy(),t.target&&t.target.destroy()});else if("bullet"===a.name||"bulletTrigger"===a.name)this.bulletHit(a.getComponent(r.default));else if("bomb"===a.name){var g=new Laya.Vector3;Laya.Vector3.subtract(this.target.transform.position,a.transform.position,g),Laya.Vector3.normalize(g,g),Laya.Vector3.scale(g,20/a.transform.localScaleX,g),Laya.Vector3.add(this.rigidbody.linearVelocity,g,g),this.rigidbody.linearVelocity=g}this.jumpCnt=0},t.prototype.TNTBomb=function(){var e=this,t=this.sizeX/2*this.target.transform.localScaleX*1,a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(t));o.default.instance.scene3D.addChild(a),a.name="bomb";var n=a.addComponent(Laya.PhysicsCollider);n.colliderShape=new Laya.SphereColliderShape(t),n.isTrigger=!0,n.collisionGroup=3,n.canCollideWith=1,a.transform.position=this.target.transform.position.clone(),a.transform.scale=this.target.transform.scale.clone();var i=new Laya.UnlitMaterial;a.meshRenderer.material=i,i.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,i.albedoColor=new Laya.Vector4(1,.5,0,.2),this.target.removeSelf();var r=0,l=.4*a.transform.localScaleX,s=.4*a.transform.localScaleY,d=.4*a.transform.localScaleZ;a.timer.frameLoop(1,a,function(){if(r++>15)return a.timer.clearAll(a),a.destroy(),e.target&&e.target.destroy(),void e.destroy();a.transform.localScaleX+=l,a.transform.localScaleY+=s,a.transform.localScaleZ+=d})},t.prototype.bulletHit=function(e){e&&!e.isReward&&3===e.type&&2!==this.type&&this.setType(2)},t.prototype.onUpdate=function(){this.target.destroyed?this.destroy():(this.rigidbody.isKinematic&&o.default.instance.isStageStart&&(this.rigidbody.isKinematic=!1),this.jumpCnt++,this.refreshRenderMode(),!this.isOnGround&&this.jumpCnt<=60&&(this.distance=Laya.Vector3.distance(this.target.transform.position,o.default.instance.gameStage.transform.position),this.distance<15&&(o.default.instance.winCheckCnt=0)),this.rigidbody.destroyed||0!=this.rigidbody.isActive||(console.log("Physics_engine_bug_fixing: Reset rigidbody."),this.refreshRigidbody()))},t.prototype.refreshRenderMode=function(){2===this.type?this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT:this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE},t.prototype.refreshRigidbody=function(){this.rigidbody&&(console.log("refresh rigidbody"),this.rigidbody.destroy(),this.setRigidbody())},t.prototype.setType=function(e){var t=this;this.type=e,this.material=this.target.meshRenderer.material,this.material||(this.material=new Laya.PBRSpecularMaterial,this.target.meshRenderer.material=this.material),1===this.type?(Laya.Texture2D.load(n.StageTexUrl[o.default.instance.textureIdx],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)):2===this.type?(Laya.Texture2D.load(n.StageTexUrl[2],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.albedoColor=new Laya.Vector4(1,1,1,.7),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.2,.2,.2,1)):3===this.type&&(Laya.Texture2D.load(n.StageTexUrl[1],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)),this.refreshRenderMode()},t.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.bounds;if(this.sizeX=e.getMax().x-e.getMin().x,this.sizeY=e.getMax().y-e.getMin().y,this.sizeZ=e.getMax().z-e.getMin().z,this.rigidbody=this.target.addComponent(Laya.Rigidbody3D),this.target.name.search("Cube")>=0)this.rigidbody.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else if(this.target.name.search("Cylinder")>=0)this.rigidbody.colliderShape=new Laya.CylinderColliderShape(this.sizeX/2,this.sizeY);else{var t=new Laya.MeshColliderShape;t.mesh=this.target.meshFilter.sharedMesh,this.rigidbody.colliderShape=t}this.setPhysicsParam()},t.prototype.setPhysicsParam=function(){this.rigidbody.isKinematic=!1,1===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):2===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):3===this.type&&(this.rigidbody.mass=50,this.rigidbody.friction=100)},t.prototype.broken=function(){var e=this;this.isBroken||(this.isBroken=!0,Laya.Browser.onMiniGame&&l.default.gameData.soundEnabled&&Laya.SoundManager.playSound(n.soundUrl[3]),this.effectPiecesBroken(),Laya.timer.frameOnce(2,this,function(){e.target.active=!1}))},t.prototype.effectPiecesBroken=function(){var e=this;Laya.Mesh.load(n.PieceResUrl,Laya.Handler.create(this,function(t){var a;a="IOS"==i.default.instance.systemName?3-Math.round(Math.random()):5-Math.round(3*Math.random());for(var r=function(a){var i=new Laya.MeshSprite3D(t);i.name="piece";var r=new Laya.PBRSpecularMaterial;r.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,r.albedoColor=new Laya.Vector4(1,1,1,.7),r.specularColor=new Laya.Vector4(0,0,0,1),r.enableEmission=!0,r.emissionColor=new Laya.Vector4(.2,.2,.2,1),i.meshRenderer.material=r,Laya.Texture2D.load(n.StageTexUrl[2],Laya.Handler.create(e,function(e){i.meshRenderer.material.albedoTexture=e}));var l=i.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=i.meshFilter.sharedMesh,l.colliderShape=s,l.collisionGroup=2,l.canCollideWith=1,o.default.instance.scene3D.addChild(i),o.default.instance.piecesList.push(i);var d=1.5*(.5*Math.random()+.5)*e.sizeX*e.target.transform.localScaleX*n.StageInitScale.x,c=1.5*(.5*Math.random()+.5)*e.sizeY*e.target.transform.localScaleY*n.StageInitScale.y,u=1.5*(.5*Math.random()+.5)*e.sizeZ*e.target.transform.localScaleZ*n.StageInitScale.z;i.transform.localScale=new Laya.Vector3(d,c,u),i.transform.localRotationEulerX=2*(Math.random()-.5)*90,i.transform.localRotationEulerY=2*(Math.random()-.5)*90,i.transform.localRotationEulerZ=2*(Math.random()-.5)*90;var h=new Laya.Vector3;h.x=(Math.random()-.5)*n.StageInitScale.x/80,h.y=(Math.random()-.5)*n.StageInitScale.y/80,h.z=(Math.random()-.5)*n.StageInitScale.z/80,i.transform.position=e.target.transform.position.clone(),Laya.Vector3.add(i.transform.localPosition,h,i.transform.localPosition),Laya.Vector3.scale(h,50,h),Laya.Vector3.add(h,e.rigidbody.linearVelocity,h),i.getComponent(Laya.Rigidbody3D).linearVelocity=h.clone(),Laya.Tween.to(i.transform.localScale,{x:d/2,y:c/2,z:u/2},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(i.meshRenderer.material,{albedoColorA:0},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(e,function(){i.destroy()}))},l=0;l<a;l++)r()}))},t}(Laya.Script3D);a.default=s},{"../Const":3,"../Global":4,"../component/Bullet":6,"../runtime/GameScene":11,"../runtime/HomeView":12}],10:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),r=e("../utils/ws.js"),l=e("../component/Reward"),s=e("./HomeView"),d=e("./GameScene"),c=function(e){function t(){var a=e.call(this)||this;return a.isReward=!1,a.downFlag=!1,a.startIdx=0,a.selectedScaleAdd=.35,console.log("CannonSelect constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(i.URL_CannnonSelect,!1,e)},t.prototype.onOpened=function(e){console.log("CannonSelect onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.isClick=!1,this.selectType&&d.default.instance&&d.default.instance.isRewardCannon?(d.default.instance&&d.default.instance.isRewardCannon||this.isReward)&&(this.selectType=d.default.instance.cannonType,this.isReward=!0):this.selectType=o.default.gameData.cannonType;for(var t=1;t<=i.CannonSelectIconList.length-2;t++)o.default.gameData.cannonUnlockState[i.CannonSelectIconList[t].index]||(o.default.gameData.cannonUnlockState[i.CannonSelectIconList[t].index]=!1,o.default.gameData.stageIndex>i.CannonSelectTextList[i.CannonSelectIconList[t].index].unlockLvl&&(o.default.gameData.cannonUnlockState[i.CannonSelectIconList[t].index]=!0)),i.CannonSelectIconList[t].index===this.selectType&&(this.list_Icon.selectedIndex=t);if(this.updateScroll(),this.updateUI(),d.default.instance&&2===d.default.instance.stageIdx&&1===d.default.instance.missionIdx&&5===o.default.gameData.tutorialStep){this.tutorial_slide.visible=!0;var a=this.tutorial_slide.getChildByName("finger");a.timer.frameLoop(1,a,function(){a.right+=3,a.alpha=1-(a.right-80)/210,a.right>=280&&(a.right=50,a.alpha=1)})}this.text_diamond.changeText(""+o.default.gameData.diamond),this.icon_diamond.visible=!0},t.prototype.onAwake=function(){this.initCannonList(),this.initScene3D(),this.scene3D.input.multiTouchEnabled=!1},t.prototype.onEnable=function(){this.bindButtons()},t.prototype.initCannonList=function(){var e=this;this.list_Icon.renderHandler=Laya.Handler.create(this,function(t,a){var n=e.list_Icon.array[a];if(n&&-1!==n.index){t.visible=!0;var o=t.getChildByName("iconBg");o&&(o.skin=i.CannonSelectIconBgUrl);var r=t.getChildByName("iconImage");r&&(r.skin=n.icon)}else t.visible=!1},[],!1),this.list_Icon.hScrollBarSkin="",this.list_Icon.array=i.CannonSelectIconList,this.list_Icon.refresh()},t.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=new Laya.Vector3(0,0,0),this.camera.transform.localRotationEuler=new Laya.Vector3(-30,0,0),this.camera.clearColor=new Laya.Vector4(239/255,169/255,171/255,1),this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},t.prototype.newCannon=function(){var e=this;this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[i.CannonSelectIconList[this.list_Icon.selectedIndex].index],Laya.Handler.create(this,function(t){e.cannon&&e.cannon.destroy(),e.scene3D.removeChildByName("cannon"),e.cannon=t.clone(),e.cannon.name="cannon",e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=new Laya.Vector3(0,-.23,-.5),e.cannon.transform.localRotationEuler=new Laya.Vector3(0,-135,0),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.box_scene3D.timer.frameLoop(1,e,e.cannonAniLoop)}))},t.prototype.refreshText=function(){var e;if(!((e=this.list_Icon.selectedIndex)<1||e>i.CannonSelectIconList.length-2)){var t=i.CannonSelectIconList[e].index;this.label_name.changeText(i.CannonSelectTextList[t].name),this.label_feature.changeText(i.CannonSelectTextList[t].feature),o.default.gameData.cannonUnlockState[t]?(this.label_unlockMsg.changeText("已解锁"),this.isReward||this.selectType!==t?this.btn_select.gray=!1:this.btn_select.gray=!0,this.btn_select.visible=!0,this.btn_unlock.visible=!1,this.btn_try.visible=!1):(i.CannonSelectTextList[t].unlockLvl>=999?(this.label_unlockMsg.changeText("敬请期待"),this.btn_try.visible=!1):(this.label_unlockMsg.changeText("完成关卡 "+(o.default.gameData.stageIndex-1)+"/"+i.CannonSelectTextList[t].unlockLvl+" 自动解锁"),this.btn_try.visible=!0),this.btn_select.visible=!1,this.btn_unlock.visible=!0,this.isReward&&this.selectType===t?(this.btn_try.gray=!0,this.label_try.changeText("正在试用")):(this.btn_try.gray=!1,this.label_try.changeText("免费试用")),this.icon_unlockDiamond.visible=!0,this.label_unlockDiamond.changeText(i.CannonSelectTextList[t].unlockDiamond+"解锁"),o.default.gameData.diamond>=i.CannonSelectTextList[t].unlockDiamond?this.btn_unlock.gray=!1:this.btn_unlock.gray=!0)}},t.prototype.refreshIcon=function(){var e,t,a,n=this.list_Icon.selectedIndex;if(!(n<1||n>i.CannonSelectIconList.length-2)){this.arrowLeft.visible=!0,this.arrowRight.visible=!0;for(var r=0;r<=2;r++)if(n+r-1<=0)this.arrowLeft.visible=!1;else if(n+r-1>=i.CannonSelectIconList.length-1)this.arrowRight.visible=!1;else if(!this.downFlag||this.list_Icon.startIndex!==this.startIdx){var l=i.CannonSelectIconList[n+r-1].index;(e=this.list_Icon.cells[r].getChildByName("iconImage"))&&!this.downFlag&&(1===r?(e.scaleX=1+this.selectedScaleAdd,e.scaleY=1+this.selectedScaleAdd):(e.scaleX=1,e.scaleY=1)),(t=this.list_Icon.cells[r].getChildByName("iconBg"))&&(l===this.selectType?t.gray=!1:t.gray=!0,this.downFlag||(1===r?(t.scaleX=1+this.selectedScaleAdd,t.scaleY=1+this.selectedScaleAdd):(t.scaleX=1,t.scaleY=1))),(a=this.list_Icon.cells[r].getChildByName("lock"))&&(a.visible=!0,o.default.gameData.cannonUnlockState[i.CannonSelectIconList[n+r-1].index]&&a&&(a.visible=!1),this.isReward&&this.selectType===l&&a&&(a.visible=!1),this.downFlag||(1===r?(a.scaleX=1+this.selectedScaleAdd,a.scaleY=1+this.selectedScaleAdd):(a.scaleX=1,a.scaleY=1)))}}},t.prototype.bindButtons=function(){var e=this;this.list_Icon.on(Laya.Event.MOUSE_DOWN,this,function(){d.default.instance&&2===d.default.instance.stageIdx&&1===d.default.instance.missionIdx&&5===o.default.gameData.tutorialStep&&(o.default.gameData.tutorialStep=6,console.log("newplayer_6"),r.default.traceEvent("newplayer_6")),e.downMouseX=e.mouseX,e.downFlag=!0,e.startIdx=e.list_Icon.startIndex}),this.list_Icon.on(Laya.Event.MOUSE_MOVE,this,function(){if(e.downFlag)if(e.downMouseX-e.mouseX>0&&e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2)e.downMouseX=e.mouseX,e.arrowRight.visible=!1;else if(e.downMouseX-e.mouseX<0&&e.list_Icon.selectedIndex<=1)e.downMouseX=e.mouseX,e.arrowLeft.visible=!1;else if(e.downMouseX-e.mouseX>0){var t=e.list_Icon.getCell(e.list_Icon.selectedIndex),a=e.list_Icon.getCell(e.list_Icon.selectedIndex+1);if(t&&a)for(r=0;r<t.numChildren;r++){var n=t.getChildAt(r),o=a.getChildAt(r);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowRight.visible=!0,e.downMouseX-e.mouseX>115&&(e.list_Icon.selectedIndex++,e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.downMouseX=e.mouseX-115,e.updateUI(),e.tutorial_slide.visible&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon(),e.openTutorial()))}else if(e.downMouseX-e.mouseX<0){var t=e.list_Icon.getCell(e.list_Icon.selectedIndex),a=e.list_Icon.getCell(e.list_Icon.selectedIndex-1);if(t&&a)for(var r=0;r<t.numChildren;r++){var n=t.getChildAt(r),o=a.getChildAt(r);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowLeft.visible=!0,e.downMouseX-e.mouseX<-115&&(e.list_Icon.selectedIndex--,e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.downMouseX=e.mouseX+115,e.updateUI())}}),this.list_Icon.on(Laya.Event.MOUSE_UP,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.list_Icon.on(Laya.Event.MOUSE_OUT,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.arrowLeft.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex--,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.arrowRight.visible=!0}),this.arrowRight.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex++,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.arrowLeft.visible=!0,e.tutorial_slide.visible&&e.openTutorial()}),this.btn_select.on(Laya.Event.CLICK,this,function(){(e.isReward||o.default.gameData.cannonType!==i.CannonSelectIconList[e.list_Icon.selectedIndex].index)&&(e.isClick=!0,e.btn_select.gray=!0,e.isReward=!1,e.selectType=i.CannonSelectIconList[e.list_Icon.selectedIndex].index,o.default.gameData.cannonType=e.selectType,e.refreshIcon())}),this.btn_unlock.on(Laya.Event.CLICK,this,function(){var t=i.CannonSelectIconList[e.list_Icon.selectedIndex].index;!o.default.gameData.cannonUnlockState[t]&&o.default.gameData.diamond>=i.CannonSelectTextList[t].unlockDiamond&&(o.default.gameData.diamond-=i.CannonSelectTextList[t].unlockDiamond,o.default.gameData.cannonUnlockState[t]=!0,e.refreshText(),e.refreshIcon())}),this.btn_try.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.revive&&(l.default.instance.isOverVideo()?l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}}):(e.mouseEnabled=!1,l.default.instance.video({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()},fail:function(){l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.try_cannon&&l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})):e.onClick_try()}),this.btn_back.on(Laya.Event.CLICK,this,this.onClick_back)},t.prototype.onClick_back=function(){this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.mouseEnabled=!1,this.visible=!1,this.isClick&&d.default.instance.cannonType!==this.selectType&&(this.isReward&&(d.default.instance.isRewardCannon=!0,d.default.instance.rewardCannonLeft=2,d.default.instance.label_rewardCannon.changeText("剩余"+d.default.instance.rewardCannonLeft+"小关"),d.default.instance.label_rewardCannon.visible=!0),d.default.instance.setCannon(this.selectType)),d.default.instance&&d.default.instance.state===i.GameState.PAUSE?d.default.openInstance():s.default.openInstance()},t.prototype.onClick_try=function(){this.isReward&&this.selectType===i.CannonSelectIconList[this.list_Icon.selectedIndex].index||(this.isClick=!0,this.isReward=!0,this.selectType=i.CannonSelectIconList[this.list_Icon.selectedIndex].index,this.btn_try.gray=!0,this.label_try.changeText("正在试用"),this.refreshIcon())},t.prototype.openTutorial=function(){var e=this;this.tutorial_slide.visible=!1,Laya.timer.clearAll(this.tutorial_slide.getChildByName("finger")),this.tutorial_try.visible=!0;var t=this.tutorial_try.getChildByName("finger");t.timer.frameLoop(1,t,function(){t.bottom+=.5,t.bottom>=20&&(t.bottom=10)}),this.tutorial_try.getChildByName("inputArea").on(Laya.Event.CLICK,this,function(){console.log("newplayer_7"),r.default.traceEvent("newplayer_7"),e.onClick_try(),e.tutorial_try.visible=!1,e.tutorial_try.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_try.getChildByName("finger")),e.tutorial_back.visible=!0;var t=e.tutorial_back.getChildByName("finger");t.timer.frameLoop(1,t,function(){t.top-=.5,t.top<=100&&(t.top=120)}),e.tutorial_back.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_8"),r.default.traceEvent("newplayer_8"),e.onClick_back(),e.tutorial_back.visible=!1,e.tutorial_back.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_back.getChildByName("finger"))})})},t.prototype.updateScroll=function(){this.list_Icon.scrollBar.stopScroll(),this.list_Icon.scrollTo(this.list_Icon.selectedIndex-1)},t.prototype.updateUI=function(){this.refreshIcon(),this.refreshText(),this.newCannon()},t.prototype.cannonAniLoop=function(){this.cannon&&(this.cannon.transform.localRotationEulerY+=1)},t}(n.ui.cannonSelect.CannonSelectUI);a.default=c},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../component/Reward":8,"../utils/ws.js":16,"./GameScene":11,"./HomeView":12}],11:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),r=e("../utils/Navigator"),l=e("../utils/wx"),s=e("../utils/ws.js"),d=e("../utils/Ad"),c=e("../component/Bullet"),u=e("../component/Target"),h=e("../component/Guard"),m=e("../component/Reward"),f=e("./HomeView"),g=e("./CannonSelect"),y=e("../StageConfig"),p=function(e){function t(){var a=e.call(this)||this;return a.bgIdx=0,a.missionRawIdxList=[0,0,0,0,0],a.MaxBulletNum=100,a.currBulletNum=0,a.isStageStart=!1,a.winCheckCnt=0,a.flag_missionWin=!1,a.textureIdx=3,a.treasureHitCnt=0,a.treasereMaxHitCnt=20,a.treasureFrameCnt=0,a.treasereMaxFrameCnt=90,a.treasureHitState=0,a.isTreasureHit=!1,a.isTreasureMoveStart=!1,a.isTreasureAdOpen=!1,a.missionDiamondAdd=0,a.cannonType=1,a.turretInitPos=i.CannonInitPos.clone(),a.isRecoil=!1,a.MaxRecoilTime=8,a.isRewardCannon=!1,a.rewardCannonLeft=-1,a.bulletType=1,a.bulletDirection=new Laya.Vector3,a.isRewardBullet=!1,a.mousePoint=new Laya.Vector2,a.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),a.hitResult=new Laya.HitResult,a.piecesList=[],a.state=0,a.reTimes=1,a.MaxReTimes=1,console.log("GameScene constructor()"),t.instance=a,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(i.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){if(console.log("GameScene onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.text_diamond.changeText(""+o.default.gameData.diamond),this.icon_diamond.visible=!0,Laya.Browser.onMiniGame&&!this.navGame&&(this.navGame=new r.default(s.default)),this.state===i.GameState.START){this._bullet||this.initBullet(),o.default.gameData.stageIndex<=2&&0!=this.bgIdx?(this.bgIdx=0,this.newBackground()):o.default.gameData.stageIndex>2&&this.bgIdx!=(o.default.gameData.stageIndex-2)%4&&(this.bgIdx=(o.default.gameData.stageIndex-2)%4,this.newBackground()),this.isRewardCannon||this.cannonType===o.default.gameData.cannonType||this.setCannon(o.default.gameData.cannonType);var t=y.StageTexture[o.default.gameData.stageIndex>i.StageNum?i.StageNum:o.default.gameData.stageIndex];(!t||t<3||t>9)&&(t=Math.floor(7*Math.random())+3)>9&&(t=9),this.textureIdx=t,this.showUI(),this.stageIdx=o.default.gameData.stageIndex,this.missionIdx=1;for(var a=1;a<=5;a++)this.missionRawIdxList[a-1]=0,this["level"+a].sizeGrid="0, 96, 0, 0";this.newStage(),Laya.Browser.onMiniGame&&!this.navWin&&(this.navWin=new r.default(s.default),this.box_winIcon.visible=!0,this.navWin.createIcons(this.box_winIcon,this.box_winIcon),this.navRevive=new r.default(s.default),this.box_reviveIcon.visible=!0,this.navRevive.createIcons(this.box_reviveIcon,this.box_reviveIcon))}else this.state===i.GameState.PAUSE&&(this.state=i.GameState.START);f.default.instance.isTest?(this.box_test.visible=!0,this.reTimes=1,this.MaxReTimes=1,Laya.Stat.show()):(this.box_test.visible=!1,Laya.Stat.hide())},t.prototype.onAwake=function(){this.initScene3D(),this.bgIdx=3,this.newBackground(),this.isRewardCannon=!1,this.cannonType=1,this.newCannon(),this.newBallBox(),this.newTrail(),this.initBullet(),this.scene3D.input.multiTouchEnabled=!1,Laya.MouseManager.multiTouchEnabled=!1,this.scene3D.physicsSimulation.fixedTimeStep=.5/60},t.prototype.onEnable=function(){this.bindButtons(),Laya.timer.clear(this,this.rewardBtnAni),this.btnAniFrame=0,Laya.timer.frameLoop(1,this,this.rewardBtnAni)},t.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=i.CameraInitPos.clone(),this.camera.transform.localRotationEuler=i.CameraInitRotEuler.clone(),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY;var e=new Laya.BlinnPhongMaterial;e.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,e.albedoColor=new Laya.Vector4(1,1,1,0),this.camera.skyRenderer.material=e;var t=Laya.Browser.width/Laya.Browser.height;if(t<.5625){var a=2*Math.atan(.5625*Math.tan(.5235987));this.camera.fieldOfView=2*Math.atan(Math.tan(a/2)/t)*57.29578}this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},t.prototype.initBullet=function(){var e=this;Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(t){e._bullet=new Laya.MeshSprite3D(t)}))},t.prototype.newTrail=function(){var e=this;if(this._trail&&this._trail.destroy(),1==o.default.gameData.trailType)this._trail=null;else if(2==o.default.gameData.trailType){this._trail=new Laya.TrailSprite3D,this._trail.trailFilter.time=.8,this._trail.trailFilter.alignment=Laya.TrailFilter.ALIGNMENT_VIEW;var t=new Array;this._trail.trailFilter.widthMultiplier=.4;for(var a=0;a<=10;a++)t[a]=new Laya.FloatKeyframe,t[a].time=this._trail.trailFilter.time*a/10,t[a].value=this._trail.trailFilter.widthMultiplier*(1-a/10),t[a].inTangent=0,t[a].outTangent=0;this._trail.trailFilter.widthCurve=t,this._trail.trailFilter.colorGradient.updateColorAlpha(0,0,1),this._trail.trailFilter.colorGradient.updateColorAlpha(1,1,0);var n=new Laya.TrailMaterial;n.color=new Laya.Vector4(1,1,1,.4),n.renderMode=Laya.TrailMaterial.RENDERMODE_ADDTIVE,this._trail.trailRenderer.material=n}else 3==o.default.gameData.trailType&&Laya.Sprite3D.load(i.BulletEffectUrl[1],Laya.Handler.create(this,function(t){e._trail=t.clone()}))},t.prototype.newBackground=function(){var e=this;if(!this.ground){this.ground=new Laya.MeshSprite3D,this.scene3D.addChild(this.ground),this.ground.name="ground";this.ground.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.StaticPlaneColliderShape(new Laya.Vector3(0,1,0),-2.7688)}this.background&&(Laya.timer.clearAll(this.background),this.background.destroy()),this.bgIdx>1?(this.bgImg.skin=i.BgResUrl[this.bgIdx],this.scene3D.addChild(this.ground)):Laya.Sprite3D.load(i.BgResUrl[this.bgIdx],Laya.Handler.create(this,function(t){e.scene3D.removeChildByName("background"),e.background=e.scene3D.addChild(t),e.background.name="background",e.background.transform.localPosition=i.StageInitPos.clone(),e.background.transform.localRotationEuler=i.StageInitRot.clone(),e.background.transform.localScale=i.StageInitScale.clone();var a=e.background.getComponent(Laya.Animator);if(a&&a.destroy(),0===e.bgIdx){var n=e.background.getChildByName("Scenes_02").getChildByName("cloud01"),o=e.background.getChildByName("Scenes_02").getChildByName("cloud03");e.background.getChildByName("Scenes_02").getChildByName("Plane").getChildByName("Plane_0");e.scene3D.addChild(e.ground),e.background.frameLoop(1,e.background,function(){n&&(n.transform.localPositionX>.5&&(n.transform.localPositionX=-.5),n.transform.localPositionX+=7e-4),o&&(o.transform.localPositionX<-.5&&(o.transform.localPositionX=.5),o.transform.localPositionX-=5e-4)})}else if(1===e.bgIdx){e.ground.removeSelf();var r=e.background.getChildByName("_0012_Island1_0"),l=e.background.getChildByName("_0014_Island3_0"),s=e.background.getChildByName("_0019_Island8_0"),d=e.background.getChildByName("_0006_Plant01_0 1"),c=e.background.getChildByName("_0022_Sky_0");r&&(r.meshRenderer.castShadow=!1,r.meshRenderer.receiveShadow=!1),l&&(l.meshRenderer.castShadow=!1,l.meshRenderer.receiveShadow=!1),s&&(s.meshRenderer.castShadow=!1,s.meshRenderer.receiveShadow=!1),c&&(c.meshRenderer.castShadow=!1,c.meshRenderer.receiveShadow=!1);var u=0,h=0;e.background.frameLoop(1,e.background,function(){h++,++u>180&&(u=0),h>300&&(h=0),r&&(u<=90?r.transform.localPositionY+=5e-4:r.transform.localPositionY-=5e-4),l&&(h<=150?l.transform.localPositionY-=2e-4:l.transform.localPositionY+=2e-4),s&&(u<=90?s.transform.localPositionY+=5e-4:s.transform.localPositionY-=5e-4),d&&(u<=90?(d.transform.localRotationEulerX-=.2,d.transform.localPositionX+=18e-5):(d.transform.localRotationEulerX+=.2,d.transform.localPositionX-=18e-5))})}}))},t.prototype.newBallBox=function(){var e=this;Laya.Sprite3D.load(i.CannonBallBoxUrl,Laya.Handler.create(this,function(t){e.ballBox=e.scene3D.addChild(t.clone()),e.ballBox.name="ball_box",e.ballBox.transform.localPosition=i.CannonBallInitPos.clone(),e.ballBox.transform.localRotationEuler=i.CannonInitRot.clone(),e.ballBox.transform.localScale=i.CannonBallInitScale.clone();for(n=1;n<=10;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT);for(n=1;n<=5;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("chest_wooden_"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE);for(var a=e.scene3D.addChild(e.ballBox.clone()),n=1;n<=10;n++)if(n<=e.MaxBulletNum){var o=a.getChildByName("CannonBall"+n+"_0");o&&o.destroy()}a.transform.localPositionX=.11,a.transform.localPositionY-=.008,a.transform.localPositionZ+=.012,a.transform.localRotationEulerY=150}))},t.prototype.setCannon=function(e){this.cannonType=e,this.bulletType=this.cannonType,this.newCannon()},t.prototype.newCannon=function(){var e=this;this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[this.cannonType],Laya.Handler.create(this,function(t){e.cannon&&e.cannon.destroy(),e.cannon=t.clone(),e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=i.CannonInitPos.clone(),e.cannon.transform.localRotationEuler=i.CannonInitRot.clone(),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.turret=e.cannon.getChildByName("Turret_0"),e.turret&&(e.turretInitPos=e.turret.transform.position.clone(),e.turretInitRot=e.turret.transform.localRotationEuler.clone())}))},t.prototype.showUI=function(){this.box_UI.visible=!0},t.prototype.hideUI=function(){this.box_UI.visible=!1,this.box_passStage.visible=!1,this.box_gameIcon.visible=!1,this.hideReviveUI()},t.prototype.hideReviveUI=function(){d.hideBanner(),this.box_revive.visible=!1},t.prototype.onClick_rewardTemplate=function(e,t,a){var n=this;Laya.Browser.onMiniGame?1==e?m.default.instance.isOverVideo()?m.default.instance.share({pos:t,success:function(){console.log("share succeed:",e,t),a()}}):(this.mouseEnabled=!1,m.default.instance.video({pos:t,success:function(){console.log("video succeed:",e,t),a()},fail:function(){console.log("video failed:",e,t),m.default.instance.share({pos:t,success:function(){console.log("share succeed:",e,t),a()}})},complete:function(){n.mouseEnabled=!0}})):2==e?m.default.instance.share({pos:t,success:function(){console.log("share succeed:",e,t),a()}}):3==e?this.navWin.randomIconTap("default",function(){a()},function(){m.default.instance.isOverVideo()?m.default.instance.share({pos:t,success:function(){console.log("share succeed:",e,t),a()}}):(n.mouseEnabled=!1,m.default.instance.video({pos:t,success:function(){console.log("video succeed:",e,t),a()},fail:function(){console.log("video failed:",e,t),m.default.instance.share({pos:t,success:function(){console.log("share succeed:",e,t),a()}})},complete:function(){n.mouseEnabled=!0}}))}):4==e&&(this.flag_missionWin||this.box_revive.visible||(this.box_moreGame.visible=!0,this.btn_moreGameBack.visible=!1,Laya.timer.frameOnce(60,this,function(){n.btn_moreGameBack.visible=!0}))):a()},t.prototype.bindButtons=function(){var e=this;this.btn_test_next.on(Laya.Event.CLICK,this,function(){f.default.instance.testStageIdx++,e.input_test_lvl.text&&(f.default.instance.testStageIdx=parseInt(e.input_test_lvl.text),e.input_test_lvl.text=""),e.reTimes=1,e.MaxReTimes=1,e.btn_test_restart.visible=!1,e.btn_test_next.visible=!1,e.newStage()}),this.btn_test_restart.on(Laya.Event.CLICK,this,function(){e.input_test_reTimes.text?(e.MaxReTimes=parseInt(e.input_test_reTimes.text),e.input_test_lvl.text=""):e.MaxReTimes=1,e.reTimes=1,e.btn_test_restart.visible=!1,e.btn_test_next.visible=!1,e.newStage()}),this.onClick_cannonSelect=function(){e.state=i.GameState.PAUSE,e.mouseEnabled=!1,g.default.openInstance()},this.onClick_rewardBullet=function(){e.isRewardBullet=!0,e.bulletType=o.default.config.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(i.cannonEffectUrl[1],Laya.Handler.create(e,function(t){e.scene3D.addChild(t).name="cannon_effect"}))},this.onClick_rewardCannon=function(){e.isRewardCannon=!0,e.rewardCannonLeft=2,e.label_rewardCannon.changeText("剩余"+e.rewardCannonLeft+"小关"),e.label_rewardCannon.visible=!0,e.setCannon(o.default.config.cannonRewardType)},this.btn_back.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!0}),this.btn_backReturn.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1}),this.btn_backExit.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1,e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.mouseEnabled=!1,e.turret&&e.cannon&&!e.cannon.destroyed&&e.turretInitRot&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1,e.rewardCannonLeft=-1,e.label_rewardCannon.visible=!1),e.clearStageTimer(),f.default.openInstance()}),this.btn_cannonOpen.on(Laya.Event.CLICK,this,function(){e.onClick_cannonSelect()}),this.btn_rewardBullet.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.try_ball,i.RewardPos.Bullet,this.onClick_rewardBullet]),this.btn_rewardCannon.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.try_cannon,i.RewardPos.Cannon,this.onClick_rewardCannon]),this.btn_passStage.on(Laya.Event.CLICK,this,function(){o.default.gameData.diamond+=e.missionDiamondAdd,e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_passStage.visible=!1,e.nextStage()}),this.btn_passStagex3.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.reward_triple,i.RewardPos.Treasure,function(){o.default.gameData.diamond+=3*e.missionDiamondAdd,e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_passStage.visible=!1,e.nextStage()}]),this.btn_revive.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.revive,i.RewardPos.Revive,function(){if(e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.ballBox)for(var t=1;t<=3;t++)t<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+t+"_0").meshRenderer.material.albedoColorA=1);e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)}]),this.btn_retry.on(Laya.Event.CLICK,this,function(){e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.turret&&e.cannon&&!e.cannon.destroyed&&e.turretInitRot&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1,e.rewardCannonLeft=-1,e.label_rewardCannon.visible=!1),e.clearStageTimer(),e.mouseEnabled=!1,f.default.openInstance()}),this.btn_treasureGetExtra.on(Laya.Event.CLICK,this,function(){o.default.gameData.diamond+=y.StageReward[e.stageIdx>39?39:e.stageIdx],e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_treasureAD.visible=!1}),this.btn_moreGameBack.on(Laya.Event.CLICK,this,function(){e.box_moreGame.visible=!1,e.onClick_rewardTemplate(1,i.RewardPos.Bullet,e.onClick_rewardBullet)})},t.prototype.rewardBtnAni=function(){this.btnAniFrame++,this.btnAniFrame<=60?(this.btn_rewardCannon.scaleX+=.00625,this.btn_rewardCannon.scaleY+=.00625,this.btn_rewardBullet.scaleX+=.00625,this.btn_rewardBullet.scaleY+=.00625):this.btnAniFrame<=120?(this.btn_rewardCannon.scaleX-=.00625,this.btn_rewardCannon.scaleY-=.00625,this.btn_rewardBullet.scaleX-=.00625,this.btn_rewardBullet.scaleY-=.00625):(this.btnAniFrame=1,this.btn_rewardCannon.scaleX=1.5,this.btn_rewardCannon.scaleY=1.5,this.btn_rewardBullet.scaleX=1.5,this.btn_rewardBullet.scaleY=1.5)},t.prototype.cleanStage=function(){this.gameStage&&(this.gameStage.destroy(),this.gameStage.removeSelf(),this.clearStageTimer(),Laya.Browser.onMiniGame&&l.default.triggerGC&&l.default.triggerGC());for(var e=0;e<this.scene3D.numChildren;e++){var t=this.scene3D.getChildAt(e);t&&"bullet"==t.name&&(t.getComponent(c.default)?t.getComponent(c.default).recover():t.destroy())}for(;this.piecesList&&0!==this.piecesList.length;){var a=this.piecesList.pop();a.destroy(),a.removeSelf()}},t.prototype.clearStageTimer=function(){Laya.timer.clear(this,this.stageLooping),Laya.timer.clear(this,this.stageFailCountDown),Laya.timer.clear(this,this.nextStage),this.box_countdown.visible=!1},t.prototype.updateTrailUnlock=function(){var e=this;o.default.gameData.trailUnlockState[3]<i.TrailUnlock[3]?this.label_trailUnlockMsg.changeText("观看视频"+o.default.gameData.trailUnlockState[3]+"/"+i.TrailUnlock[3]):(this.btn_trailUnlock.visible=!1,this.btn_trailSelect.visible=!0,this.btn_trailSelect.on(Laya.Event.CLICK,this,function(){o.default.gameData.trailType=3,e.newTrail(),e.box_trailShow.visible=!1,e.btn_trailClose.offAll(Laya.Event.CLICK),e.btn_trailUnlock.offAll(Laya.Event.CLICK),e.btn_trailSelect.offAll(Laya.Event.CLICK)}))},t.prototype.newStage=function(){var e=this;if(!(this.missionIdx<1||this.missionIdx>6)){if(o.default.gameData.trailUnlockState[3]<i.TrailUnlock[3]&&!o.default.gameData.trailShowToday&&(o.default.gameData.stageIndex>2||2==o.default.gameData.stageIndex&&2==this.missionIdx)&&(this.label_trailUnlockMsg.changeText("观看视频"+o.default.gameData.trailUnlockState[3]+"/"+i.TrailUnlock[3]),o.default.gameData.trailShowToday=!0,o.default.gameData.lastTrailShowTimestamp=Date.now(),this.box_trailShow.visible=!0,this.btn_trailUnlock.visible=!0,this.btn_trailSelect.visible=!1,this.btn_trailUnlock.on(Laya.Event.CLICK,this,this.onClick_rewardTemplate,[o.default.config.get_trail,i.RewardPos.Trail,function(){o.default.gameData.trailUnlockState[3]++,e.updateTrailUnlock()}]),this.btn_trailClose.on(Laya.Event.CLICK,this,function(){e.box_trailShow.visible=!1,e.btn_trailClose.offAll(Laya.Event.CLICK),e.btn_trailUnlock.offAll(Laya.Event.CLICK)})),1==this.missionIdx&&d.wxCreatInterstitialAd(o.default.config.uid_interstitial),f.default.instance.isTest||(6===this.missionIdx?(d.randomlyGetBanner("treasure"),this.box_gameIcon.visible=!0,Laya.Browser.onMiniGame&&o.default.config.allow_interstitial&&d.wxCreatInterstitialAd(o.default.config.uid_interstitial)):this.missionIdx>=1&&this.missionIdx<=5&&(this.navGame&&this.navGame.createGameIcons(),this.box_gameIcon.visible=!0,this.navGame&&this.navGame.createMoreGame(this.box_moreGame))),this.cleanStage(),this.label_rewardCannon.visible=!1,this.missionIdx>=1&&this.missionIdx<=5&&this.isRewardCannon&&(this.rewardCannonLeft--,this.rewardCannonLeft<0?(this.setCannon(o.default.gameData.cannonType),this.isRewardCannon=!1,this.rewardCannonLeft=-1,this.label_rewardCannon.visible=!1,g.default.instance&&(g.default.instance.isReward=!1)):(this.label_rewardCannon.changeText("剩余"+this.rewardCannonLeft+"小关"),this.label_rewardCannon.visible=!0)),this.box_passStage.visible=!1,this.missionWin.visible=!1,this.missionIdx>=1&&this.missionIdx<=5&&(this["level"+this.missionIdx].sizeGrid="0,64,0,0"),this.isRewardBullet=!1,this.scene3D.getChildByName("cannon_effect")&&this.scene3D.getChildByName("cannon_effect").destroy(),this.isRevive=!1,this.currBulletNum=0,this.winCheckCnt=0,this.flag_missionWin=!1,this.isStageStart=!1,this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime,this.bulletType=this.cannonType,this.cannon&&!this.cannon.destroyed&&this.turret&&this.turretInitRot&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone()),f.default.instance.isTest)this.rawIdx=f.default.instance.testStageIdx,this.MaxBulletNum=100,this.label_ballNum.changeText("x"+this.MaxBulletNum),this.label_test_lvl.changeText("关卡："+f.default.instance.testStageIdx);else if(this.missionIdx>=1&&this.missionIdx<=5){var t=y.Stage[f.default.instance.systemName][this.stageIdx>i.StageNum?i.StageNum:this.stageIdx][this.missionIdx];this.rawIdx=this.missionRawIdxList[0];for(var a=0;a<20&&this.missionRawIdxList.indexOf(this.rawIdx)>=0;)this.rawIdx=y.Map[f.default.instance.systemName][Math.round(Math.random()*(t.max-t.min))+t.min],a++;if(this.missionRawIdxList[this.missionIdx-1]=this.rawIdx,this.MaxBulletNum=t.ball_add+y.StageRaw[this.rawIdx].ball_num,this.label_ballNum.changeText("x"+this.MaxBulletNum),console.log("stage: "+this.stageIdx+"\tmission: "+this.missionIdx+"\traw stage index: "+this.rawIdx),console.log("max ball num: "+this.MaxBulletNum),this.ballBox)for(n=1;n<=10;n++)n<=this.MaxBulletNum?this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1:this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=0}else if(this.MaxBulletNum=999,this.label_ballNum.changeText("无限"),this.ballBox)for(var n=1;n<=10;n++)this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1;var r;r=this.missionIdx>=1&&this.missionIdx<=5?i.StageResUrl+this.rawIdx+".lh":i.treasureUrl,Laya.Sprite3D.load(r,Laya.Handler.create(this,function(t){console.log("load_stage"),s.default.traceEvent("load_stage"),e.scene3D.getChildByName("gameStage")&&e.scene3D.getChildByName("gameStage").destroy(),Laya.timer.frameOnce(15,e,function(){e.gameStage=e.scene3D.addChild(t.clone()),e.gameStage.name="gameStage",d.hideBanner(),e.label_level.changeText(""+e.stageIdx),e.gameStage.transform.localPosition=i.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=i.StageInitRot.clone(),e.gameStage.transform.localScale=i.StageInitScale.clone();var a=e.gameStage.getComponent(Laya.Animator);if(a&&a.destroy(),e.missionIdx>=1&&e.missionIdx<=5)for(var n,r=0;r<e.gameStage.numChildren;r++)if(n=e.gameStage.getChildAt(r),n.meshRenderer.castShadow=!1,n.meshRenderer.receiveShadow=!1,n.name.search("Obstacle")>=0){var l=n.addComponent(u.default);n.name.search("Glass")>=0?l.setType(2):n.name.search("TNT")>=0?l.setType(3):l.setType(1)}else if(n.name.search("Cube")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),m=n.meshFilter.sharedMesh.bounds,g=m.getMax().x-m.getMin().x,p=m.getMax().y-m.getMin().y,b=m.getMax().z-m.getMin().z;c.colliderShape=new Laya.BoxColliderShape(g,p,b),Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,n.meshRenderer.material=t}))}else if(n.name.search("Cylinder")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),v=new Laya.MeshColliderShape;v.mesh=n.meshFilter.sharedMesh,c.colliderShape=v,Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var t=new Laya.PBRSpecularMaterial;t.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,t.albedoTexture=e,n.meshRenderer.material=t}))}else if(n.name.search("Guard")>=0)n.addComponent(h.default);else n&&n.destroy();else{e.gameStage.name="treasure",e.gameStage.transform.localPositionZ+=.3,e.treasureHitCnt=0,e.treasureFrameCnt=0,e.treasureHitState=0,e.isTreasureAdOpen=!1,e.isTreasureHit=!1,e.isTreasureMoveStart=!1;var _=Math.random()<.6,w=-1,S=60,x=0;Laya.timer.frameLoop(1,e.gameStage,function(){if(e.isTreasureMoveStart){if(++w<=S)_?e.gameStage.transform.localPositionY+=.01:e.gameStage.transform.localPositionY-=.01;else{if(w=0,S=120,!e.isTreasureAdOpen&&!_&&o.default.gameData.treasureBannerHit<o.default.config.MaxTreasureBannerHit&&!o.default.config.deny_banner&&Math.random()<o.default.config.banner_show_treasure){e.label_extraDiamond.changeText(""+y.StageReward[e.stageIdx>39?39:e.stageIdx]),e.box_treasureAD.visible=!0,e.isTreasureAdOpen=!0;var t=e.btn_treasureGetExtra.centerY+e.btn_treasureGetExtra.height/2+Laya.stage.height/2+100;Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(t+=40),d.showBanner(!1,t),console.log("t_banner_show"),s.default.traceEvent("t_banner_show"),e.state=i.GameState.BANNER_TOUCH}_=!_}e.isTreasureHit&&(++x<=2?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):x<=6?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):x<=8?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):(e.isTreasureHit=!1,x=0))}})}if(f.default.instance.isTest){if(e.label_test_reTimes.changeText("reTimes："+e.reTimes+"/"+e.MaxReTimes),e.label_test_objs.changeText("objNum："+e.gameStage.numChildren),e.reTimes++,e.reTimes<=e.MaxReTimes)return void Laya.timer.frameOnce(10,e,function(){e.box_scene3D.off(Laya.Event.CLICK,e,e.onClick),e.clearStageTimer(),e.newStage()});e.btn_test_restart.visible=!0,e.btn_test_next.visible=!0}if(e.gameStage.frameLoop(1,e,e.stageLooping),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),1===e.stageIdx)if(1===e.missionIdx&&0===o.default.gameData.tutorialStep)o.default.gameData.tutorialStep=1,e.tutorial_shoot.visible=!0,e.tutorial_shoot.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_1"),s.default.traceEvent("newplayer_1"),e.onClick(),e.tutorial_shoot.visible=!1,e.tutorial_shoot.getChildByName("inputArea").offAll()});else if(2===e.missionIdx&&1===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=2,e.btn_rewardBullet.visible=!0,e.tutorial_bulletTry.visible=!0;(L=e.tutorial_bulletTry.getChildByName("finger")).timer.frameLoop(1,L,function(){L.centerY-=1,L.centerY<=450&&(L.centerY=480)}),e.tutorial_bulletTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_2"),s.default.traceEvent("newplayer_2"),e.onClick_rewardBullet(),e.tutorial_bulletTry.visible=!1,Laya.timer.clearAll(e.tutorial_bulletTry.getChildByName("finger")),e.tutorial_bulletTry.getChildByName("inputArea").offAll()})}else if(3===e.missionIdx&&2===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=3,e.btn_rewardBullet.visible=!0,e.btn_rewardCannon.visible=!0,e.tutorial_cannonTry.visible=!0;(L=e.tutorial_cannonTry.getChildByName("finger")).timer.frameLoop(1,L,function(){L.centerY-=1,L.centerY<=450&&(L.centerY=480)}),e.tutorial_cannonTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_3"),s.default.traceEvent("newplayer_3"),e.onClick_rewardCannon(),e.tutorial_cannonTry.visible=!1,Laya.timer.clearAll(e.tutorial_cannonTry.getChildByName("finger")),e.tutorial_cannonTry.getChildByName("inputArea").offAll()})}else 6===e.missionIdx&&3===o.default.gameData.tutorialStep&&(o.default.gameData.tutorialStep=4,e.tutorial_treasure.visible=!0,e.tutorial_treasure.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_4"),s.default.traceEvent("newplayer_4"),e.onClick(),e.tutorial_treasure.visible=!1,e.tutorial_treasure.getChildByName("inputArea").offAll()}));else if(2===e.stageIdx&&1===e.missionIdx&&4===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=5,e.btn_cannonOpen.visible=!0,e.tutorial_cannonSelect.visible=!0;var L=e.tutorial_cannonSelect.getChildByName("finger");L.timer.frameLoop(1,L,function(){L.bottom+=.5,L.bottom>=20&&(L.bottom=5)}),e.tutorial_cannonSelect.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_5"),s.default.traceEvent("newplayer_5"),e.onClick_cannonSelect(),e.tutorial_cannonSelect.visible=!1,Laya.timer.clearAll(e.tutorial_cannonSelect.getChildByName("finger")),e.tutorial_cannonSelect.getChildByName("inputArea").offAll()})}o.default.gameData.stageIndex>1&&e.missionIdx>=1&&e.missionIdx<=5?(e.btn_rewardCannon.visible=!0,e.btn_rewardBullet.visible=!0,e.btn_cannonOpen.visible=!0):1===o.default.gameData.stageIndex?(o.default.gameData.tutorialStep>=2&&(e.btn_rewardBullet.visible=!0),o.default.gameData.tutorialStep>=3&&(e.btn_rewardBullet.visible=!0,e.btn_rewardCannon.visible=!0)):(e.btn_rewardCannon.visible=!1,e.btn_rewardBullet.visible=!1,e.btn_cannonOpen.visible=!1)})}))}},t.prototype.stageLooping=function(){this.state!==i.GameState.START&&this.state!==i.GameState.BANNER_TOUCH||(f.default.instance.isTest?this.testWinCheck():this.missionIdx>=1&&this.missionIdx<=5?this.winCheck():this.isTreasureMoveStart&&this.winCheck_treasure(),this.isRecoil&&this.cannon&&(this.recoilTime<this.MaxRecoilTime?(this.recoilTime<this.MaxRecoilTime/4?(this.cannon.transform.localPositionX+=.01*this.bulletDirection.x,this.cannon.transform.localPositionY+=.01*this.bulletDirection.y,this.cannon.transform.localPositionZ+=.01*this.bulletDirection.z):(this.cannon.transform.localPositionX-=.006*this.bulletDirection.x,this.cannon.transform.localPositionY-=.006*this.bulletDirection.y,this.cannon.transform.localPositionZ-=.006*this.bulletDirection.z),this.recoilTime++):(this.cannon.transform.position=i.CannonInitPos.clone(),this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime)))},t.prototype.testWinCheck=function(){this.winCheckCnt++>=i.MaxWinCheckTime&&(console.log("player win"),this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.missionWin.visible=!0)},t.prototype.winCheck=function(){var e=this;if(this.winCheckCnt++>=i.MaxWinCheckTime){this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.box_moreGame.visible=!1,this["level"+this.missionIdx].sizeGrid="0,32,0,0";var t=this.currBulletNum-this.MaxBulletNum+4;t=(t=t<y.StageRaw[this.rawIdx].ball_num?0:t)>4?4:t,this.missionWin.skin="res/ui/game/grade_"+t+"_CN.png",this.missionWin.visible=!0,Laya.Browser.onMiniGame&&o.default.gameData.soundEnabled&&Laya.SoundManager.playSound(i.soundUrl[2]);var a=0;this.missionWin.centerY=30,this.missionWin.scaleX=1.5,this.missionWin.scaleY=1.5,this.missionWin.timer.frameLoop(1,this.missionWin,function(){++a<=13?(e.missionWin.scaleX+=.15,e.missionWin.scaleY+=.15,e.missionWin.centerY-=3):a<=40?(e.missionWin.scaleX-=.07,e.missionWin.scaleY-=.07,e.missionWin.centerY-=10):(Laya.timer.clearAll(e.missionWin),e.missionDiamondAdd=y.Stage[f.default.instance.systemName][e.stageIdx>i.StageNum?i.StageNum:e.stageIdx][e.missionIdx].reward,e.missionDiamondAdd-=Math.round(e.missionDiamondAdd/2/4*t))}),Laya.timer.frameOnce(90,this,this.passMission)}},t.prototype.winCheck_treasure=function(){var e=this;this.treasureFrameCnt++,this.treasureFrameCnt>=this.treasereMaxFrameCnt&&this.treasureHitCnt>=this.treasereMaxHitCnt&&!this.box_treasureAD.visible&&(this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.gameStage.transform.localPositionY=0,Laya.timer.clearAll(this.gameStage),Laya.timer.frameOnce(1,this.gameStage,function(){var t=!1;Laya.timer.frameLoop(1,e.gameStage,function(){t?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03),!t&&e.gameStage.transform.localRotationEulerZ>12?t=!0:t&&e.gameStage.transform.localRotationEulerZ<-12&&(t=!1)}),Laya.timer.frameOnce(40,e.gameStage,function(){e.gameStage.transform.localRotationEulerZ=0,e.gameStage.transform.localPositionX=0,Laya.timer.clearAll(e.gameStage);var t=0,a=e.gameStage.getChildByName("top");e.gameStage.getChildByName("bottom");e.gameStage.getChildByName("lock").transform.localRotationEulerX-=45,Laya.timer.frameLoop(1,e.gameStage,function(){if(t++,a.transform.localRotationEulerX>-100&&(a.transform.localRotationEulerX-=5),t<=20)e.gameStage.transform.localPositionY-=.005;else if(t<=60){t<=25?e.gameStage.transform.localPositionY+=.2:t<=35&&(e.gameStage.transform.localPositionY-=.1);for(var n=1;n<=9;n++){var o=e.gameStage.getChildByName("currency_"+n);o&&(t<=25?o.transform.localPositionY+=.003:t<=35?o.transform.localPositionY+=.004:t<=40?o.transform.localPositionY-=.001:t<=45?o.transform.localPositionY-=.002:t<=60&&(o.transform.localPositionY-=.003),o.transform.localPositionX+=.001*i.treasureAngleX[n],o.transform.localPositionZ+=-.002*i.treasureAngleZ[n],o.transform.localRotationEulerX+=30*i.treasureAngleX[n],o.transform.localRotationEulerZ+=30*i.treasureAngleZ[n])}}else Laya.timer.clearAll(e.gameStage),Laya.timer.frameOnce(90,e,e.nextStage)})})}))},t.prototype.restart=function(){this.newStage()},t.prototype.nextStage=function(){Laya.timer.clearAll(this.missionWin),this.missionIdx++,this.missionIdx>5+(o.default.config.hasTreasure?1:0)?this.passStage():this.newStage()},t.prototype.passMission=function(){this.state=i.GameState.START,this.passLabel.visible=!1,this.passTitle.visible=!1,this.label_winDiamond.changeText(""+this.missionDiamondAdd),this.box_passStage.visible=!0,this.showBanner(this.btn_passStage,0,!0)},t.prototype.passStage=function(){this.state=i.GameState.START,console.log("pass_stage"+this.stageIdx),this.stageIdx<=10?s.default.traceEvent("pass_stage"+this.stageIdx):s.default.traceEvent("pass_stage10");for(var e=0;e<this.scene3D.numChildren;e++){var t=this.scene3D.getChildAt(e);t&&"bullet"==t.name&&(t.getComponent(c.default)?t.getComponent(c.default).recover():t.destroy())}this.missionDiamondAdd=y.StageReward[this.stageIdx>39?39:this.stageIdx],this.missionWin.visible=!1,this.box_gameIcon.visible=!1,Laya.Browser.onMiniGame&&o.default.config.allow_interstitial&&d.showInterstitialAd(),this.passLabel.visible=!0,this.passTitle.visible=!0,this.label_stage.visible=!0,this.label_stage.changeText(""+this.stageIdx),this.label_winDiamond.changeText(""+this.missionDiamondAdd),this.box_passStage.visible=!0,this.showBanner(this.btn_passStage,o.default.config.banner_delay_pass,!0),this.navWin&&this.navWin.loadIconInfoList(!1),this.stageIdx++,o.default.gameData.stageIndex=this.stageIdx,this.missionIdx=0;for(var a=1;a<=5;a++)this.missionRawIdxList[a-1]=0,this["level"+a].sizeGrid="0, 96, 0, 0";var n=y.StageTexture[o.default.gameData.stageIndex>i.StageNum?i.StageNum:o.default.gameData.stageIndex];if(!n||n<3||n>9){for(n=this.textureIdx;n==this.textureIdx;)(n=Math.floor(7*Math.random())+3)>9&&(n=9)}this.textureIdx=n,o.default.gameData.stageIndex>2&&(this.bgIdx=(o.default.gameData.stageIndex-2)%4,this.newBackground())},t.prototype.stageFailCountDown=function(){this.state===i.GameState.START&&(this.countdown++,this.countdown>=240&&(this.clearStageTimer(),this.box_countdown.visible=!1,this.box_moreGame.visible=!1,this.btn_retry.bottom=150,o.default.config.online||(this.btn_retry.bottom=260),Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(this.btn_retry.bottom+=o.default.config.distance_iphonex||0),this.box_revive.visible=!0,this.navRevive&&this.navRevive.loadIconInfoList(!1),this.showBanner(this.btn_retry,o.default.config.banner_delay_ratio,!0),Laya.Browser.onMiniGame&&o.default.config.allow_interstitial&&d.showInterstitialAd()),this.label_failTimer.changeText(""+Math.floor(4-this.countdown/60%4)),this.failCircle.scaleX+=.015,this.failCircle.scaleY+=.015)},t.prototype.showBanner=function(e,t,a){void 0===a&&(a=!1),!o.default.config.deny_banner&&Math.random()<t?(e.bottom=150,Laya.timer.frameOnce(60*o.default.config.banner_delay,null,function(){e.bottom=260,Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(e.bottom+=o.default.config.distance_iphonex||0),d.showBanner(a)})):(e.bottom=260,Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(e.bottom+=o.default.config.distance_iphonex||0),d.showBanner(a))},t.prototype.onClick=function(){if(this.gameStage&&this.cannon){if(this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30,1,1))Laya.Vector3.subtract(this.hitResult.point,this.turretInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,this.turretInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}var a=this.bulletDirection.z<0;Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.physicsStartCheck(),this.createBullet(),this.turret&&this.cannon&&!this.cannon.destroyed&&this.turretInitRot&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone(),a&&(-1===this.cannon.name.indexOf("Anti")?this.turret.transform.localRotationEulerX-=90*this.bulletDirection.y:this.turret.transform.localRotationEulerX+=90*this.bulletDirection.y,this.turret.transform.localRotationEulerY-=90*this.bulletDirection.x)),this.isRecoil||(this.recoilTime=0),this.isRecoil=!0}},t.prototype.physicsStartCheck=function(){if(!this.isStageStart){var e=new Laya.SphereColliderShape(i.BulletRadius*i.BulletScale[+this.isRewardBullet][this.bulletType]*3),t=[],a=this.bulletDirection.clone();if(Laya.Vector3.scale(a,50,a),this.scene3D.physicsSimulation.shapeCastAll(e,this.turretInitPos,a,t))for(var n in t)if(t[n].collider.owner.name.indexOf("Obstacle")>=0){this.isStageStart=!0;break}}},t.prototype.bulletBombEff=function(e){var t=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(.5));this.scene3D.addChild(t),t.name="bomb";var a=t.addComponent(Laya.PhysicsCollider);a.colliderShape=new Laya.SphereColliderShape(.5/8),a.isTrigger=!0,a.collisionGroup=3,a.canCollideWith=1,t.transform.position=e.clone();var n=new Laya.UnlitMaterial;t.meshRenderer.material=n,n.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,n.albedoColor=new Laya.Vector4(1,.7,.3,.3);var i=0;t.timer.frameLoop(1,t,function(){if(i++>8)return t.timer.clearAll(t),void t.destroy();t.transform.localScaleX+=.1,t.transform.localScaleY+=.1,t.transform.localScaleZ+=.1;var e=t.meshRenderer.material;e.albedoColorA>.1&&(e.albedoColorA-=.1)})},t.prototype.createBullet=function(){var e=this;if(this.currBulletNum++,this.missionIdx>=1&&this.missionIdx<=5&&(this.label_ballNum.changeText("x"+(this.MaxBulletNum-this.currBulletNum)),f.default.instance.isTest||this.ballBox&&this.MaxBulletNum-this.currBulletNum+1>=1&&this.MaxBulletNum-this.currBulletNum+1<=10&&(this.ballBox.getChildByName("CannonBall"+(this.MaxBulletNum-this.currBulletNum+1)+"_0").meshRenderer.material.albedoColorA=0)),Laya.Browser.onMiniGame&&o.default.gameData.soundEnabled&&(this.isRewardBullet?Laya.SoundManager.playSound(i.soundUrl[1]):Laya.SoundManager.playSound(i.soundUrl[0])),Laya.Browser.onMiniGame&&o.default.gameData.vibrationEnabled&&l.default.vibrateShort(),this.currBulletNum>=this.MaxBulletNum&&!this.flag_missionWin&&(this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),Laya.timer.frameOnce(30,this,function(){e.box_countdown.visible=!0,e.failCircle.scaleX=1,e.failCircle.scaleY=1,e.countdown=0,e.isRevive?e.btn_revive.visible=!1:e.btn_revive.visible=!0,e.flag_missionWin||Laya.timer.frameLoop(1,e,e.stageFailCountDown)})),this.isRewardBullet)Laya.Sprite3D.load(i.BulletRewardResUrl[o.default.config.bulletRewardType],Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));a.name="bullet";a.addChild(t.clone()).name="effect";a.addComponent(c.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(a);var n=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));n.name="bulletTrigger";n.addComponent(c.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(n)})),this.isRewardBullet=!1,Laya.timer.frameOnce(30,this,function(){e.scene3D.getChildByName("cannon_effect")&&e.scene3D.getChildByName("cannon_effect").destroy()});else if(2===this.cannonType){t=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-t,0),this.createSingleBullet(t,0)}else if(4===this.cannonType){var t=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-t,-t),this.createSingleBullet(-t,t),this.createSingleBullet(t,-t),this.createSingleBullet(t,t)}else this.createSingleBullet()},t.prototype.createSingleBullet=function(e,t){var a=this;void 0===e&&(e=0),void 0===t&&(t=0);var n=Laya.Pool.getItem("bullet");if(n){(r=n.getComponent(c.default))?r.reset(this.bulletType):(r=n.addComponent(c.default)).reset(this.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=t,this.scene3D.addChild(n)}else{this._bullet||this.initBullet(),(n=this._bullet.clone()).name="bullet";var r=n.addComponent(c.default);r.reset(this.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=t,this.scene3D.addChild(n)}if(n){if(n.removeChildByName("effect"),n.removeChildByName("trail"),1!=o.default.gameData.trailType)if(this._trail){var l=this._trail.clone();l.name="trail",n.addChild(l)}else this.newTrail();6===this.cannonType&&Laya.Sprite3D.load(i.BulletEffectUrl[2],Laya.Handler.create(this,function(e){n.addChild(e.clone()).name="effect"}))}var s=Laya.Pool.getItem("bulletTrigger");if(s){var d=s.getComponent(c.default);d?d.reset(this.bulletType):(d=n.addComponent(c.default)).reset(this.bulletType),s.transform.localPositionX+=e,s.transform.localPositionY+=t,this.scene3D.addChild(s)}else Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(n){(s=new Laya.MeshSprite3D(n)).name="bulletTrigger";s.addComponent(c.default).reset(a.bulletType),s.transform.localPositionX+=e,s.transform.localPositionY+=t,a.scene3D.addChild(s)}))},t}(n.ui.game.GameSceneUI);a.default=p},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../StageConfig":5,"../component/Bullet":6,"../component/Guard":7,"../component/Reward":8,"../component/Target":9,"../utils/Ad":13,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./CannonSelect":10,"./HomeView":12}],12:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("./../../ui/layaMaxUI"),i=e("./GameScene"),o=e("./CannonSelect"),r=e("../Const"),l=e("../utils/wx"),s=e("../utils/ws.js"),d=e("../Global"),c=e("../utils/Ad"),u=e("../utils/Navigator"),h=e("../utils/Loader"),m=e("../component/Reward"),f=function(e){function t(){var a=e.call(this)||this;return a.iconInfosList=[],a.currentIconInfoList=[],a.isGameDataLoaded=!1,a.isTest=!1,console.log("HomeView constructor()"),t.instance=a,i.default.openInstance(),a.label_version.changeText("v"+r.VERSION),a}return __extends(t,e),t.openInstance=function(e){t.instance?(c.randomlyGetBanner("home"),c.showBanner(!0),t.instance.onOpened(e)):Laya.Scene.open(r.URL_HomeView,!1,e)},t.prototype.onOpened=function(e){console.log("HomeView onOpened()"),this.visible=!0,this.label_level.changeText("关卡："+d.default.gameData.stageIndex),this.nav&&this.nav.loadIconInfoList(!0),this.refreshUnlock(),this.text_diamond.changeText(""+d.default.gameData.diamond),this.icon_diamond.visible=!0,this.updateTrailUnlock()},t.prototype.onEnable=function(){var e=this;console.log("HomeView onEnable()"),Laya.Browser.onMiniGame?this.initWeixin():this.onGameDataLoaded(),h.default.loadZip(r.cdnUrl,"res",Laya.Handler.create(this,function(t){Laya.loader.load(r.StageTexUrl,Laya.Handler.create(e,function(){Laya.timer.frameLoop(1,e,e.onResEnable)}))}))},t.prototype.onResEnable=function(){i.default.instance&&i.default.instance.ballBox&&i.default.instance.cannon&&(i.default.instance&&1!=d.default.gameData.cannonType&&(i.default.instance.cannonType=d.default.gameData.cannonType,i.default.instance.newCannon()),this.refreshUnlock(),this.bindButtons(),Laya.timer.clear(this,this.onResEnable))},t.prototype.refresh_getDiamond=function(){var e=this;2==d.default.gameData.getDiamond?(this.finger_getDiamond.visible=!1,Laya.timer.clearAll(this.finger_getDiamond),this.btn_getDiamondYes.gray=!1,Laya.timer.clearAll(this.btn_getDiamondYes),Laya.timer.frameLoop(1,this.btn_getDiamondYes,function(){e.btn_getDiamondYes.scaleX+=.005,e.btn_getDiamondYes.scaleY+=.005,e.btn_getDiamondYes.scaleX>=1.1&&(e.btn_getDiamondYes.scaleX=1,e.btn_getDiamondYes.scaleY=1)}),this.btn_getDiamondYes.on(Laya.Event.MOUSE_DOWN,this,function(){d.default.gameData.diamond+=2e3,e.text_diamond.changeText(""+d.default.gameData.diamond),d.default.gameData.getDiamond=3,e.btn_getDiamond.offAll(),e.btn_getDiamondYes.offAll(),e.btn_getDiamondExit.offAll(),Laya.timer.clearAll(e.btn_getDiamondYes),e.box_getDiamond.visible=!1,e.btn_getDiamond.visible=!1,e.finger_getDiamond.visible=!1})):(this.btn_getDiamondYes.gray=!0,this.finger_getDiamond.visible=!0,Laya.timer.clearAll(this.finger_getDiamond),Laya.timer.clearAll(this.btn_getDiamondYes),Laya.timer.frameLoop(1,this.finger_getDiamond,function(){e.finger_getDiamond.right-=2,e.finger_getDiamond.right<=160&&(e.finger_getDiamond.right=220)}))},t.prototype.bindButton_getDiamond=function(){var e=this;3!==d.default.gameData.getDiamond?(this.box_getDiamond.visible&&this.refresh_getDiamond(),this.btn_getDiamond.visible=!0,this.btn_getDiamond.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_getDiamond.visible=!0,e.refresh_getDiamond()}),this.btn_getDiamondExit.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_getDiamond.visible=!1,e.finger_getDiamond.visible=!1,Laya.timer.clearAll(e.finger_getDiamond),Laya.timer.clearAll(e.btn_getDiamondYes)})):(this.box_getDiamond.visible=!1,this.btn_getDiamond.visible=!1,this.finger_getDiamond.visible=!1)},t.prototype.bindButtons=function(){var e=this;this.btn_start.on(Laya.Event.CLICK,this,function(){var t=e.btn_start.scaleX,a=e.btn_start.scaleY;Laya.Tween.to(e.btn_start,{alpha:.8,scaleX:.9*t,scaleY:.9*a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.btn_start,{alpha:1,scaleX:t,scaleY:a},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){i.default.instance&&i.default.instance.state!=r.GameState.START&&(console.log("click_startgame"),s.default.traceEvent("click_startgame"),e.hide(),i.default.instance.state=r.GameState.START,i.default.openInstance())}))}))}),this.btn_sound.on(Laya.Event.CLICK,this,function(){d.default.gameData.soundEnabled=!d.default.gameData.soundEnabled,e.btn_sound.gray=!d.default.gameData.soundEnabled,Laya.Browser.onMiniGame&&d.default.gameData.soundEnabled&&Laya.SoundManager.playSound(r.soundUrl[0])}),this.btn_vibration.on(Laya.Event.CLICK,this,function(){d.default.gameData.vibrationEnabled=!d.default.gameData.vibrationEnabled,e.btn_vibration.gray=!d.default.gameData.vibrationEnabled,Laya.Browser.onMiniGame&&d.default.gameData.vibrationEnabled&&l.default.vibrateShort()}),this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon),this.btn_trail.on(Laya.Event.CLICK,this,function(){e.box_trail.visible=!0,e.box_UI.visible=!1}),this.btn_trailBack.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_trail.visible=!1,e.box_UI.visible=!0});for(var t=function(t){a["btn_trailUnlock"+t].on(Laya.Event.MOUSE_DOWN,a,function(){1==d.default.config.get_trail?m.default.instance.isOverVideo()?m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[t]++,e.updateTrailUnlock()}}):(e.mouseEnabled=!1,m.default.instance.video({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[t]++,e.updateTrailUnlock()},fail:function(){m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[t]++,e.updateTrailUnlock()}})},complete:function(){e.mouseEnabled=!0}})):2==d.default.config.get_trail&&m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[t]++,e.updateTrailUnlock()}})})},a=this,n=1;n<=Object.keys(r.TrailUnlock).length;n++)t(n);this.btn_test.gray=!this.isTest,this.btn_test.on(Laya.Event.CLICK,this,function(){e.isTest=!e.isTest,e.btn_test.gray=!e.isTest,e.testStageIdx=1})},t.prototype.onclick_cannon=function(){o.default.openInstance(),this.hide()},t.prototype.hide=function(){c.hideBanner(),this.visible=!1},t.prototype.initWeixin=function(){l.default.showShareMenu({withShareTicket:!0}),l.default.onShareAppMessage(function(){var e=s.default.createShareOptions({pos:"ShareAppButton"});return{title:e.title,imageUrl:e.imageUrl,query:e.query}}),s.default.init({host:"ws.lesscool.cn",version:r.VERSION,appid:1124,secret:"79ce022eb0ca47bfde9bc7e753df2074",share:{title:"全民欢乐，天天游戏！",image:"http://oss.lesscool.cn/fcdh/96d172496dbafa4ab9c8335a7133476c.png"}}),this.loginWs()},t.prototype.loginWs=function(){l.default.showLoading({title:"登录中",mask:!0}),s.default.onLoginComplete(this.onLoginComplete.bind(this)),s.default.login()},t.prototype.onLoginComplete=function(e,t){"success"===s.default.getLoginStatus()?(console.log("login_succeed"),s.default.traceEvent("login_succeed"),l.default.hideLoading(),console.log("ws.conf",s.default.conf),console.log("ws.user",s.default.user),console.log("ws.data",s.default.data),l.default.getSystemInfoSync&&console.log("wx.getSystemInfoSync()",l.default.getSystemInfoSync()),this.loadConfig(),this.loadGameData(t),s.default.user.can_record&&(window.require("libs/common.js"),l.default.aldSendOpenid(s.default.user.openid))):"fail"===s.default.getLoginStatus()&&(console.log("login_failed"),s.default.traceEvent("login_failed"),l.default.hideLoading(),l.default.showModal({title:"登陆失败",content:"请允许授权",confirmText:"重新登陆",cancelText:"关闭",success:function(e){l.default.showLoading({title:"登录中",mask:!0}),s.default.login()}}))},t.prototype.loadConfig=function(){Object.assign(d.default.config,s.default.conf)},t.prototype.loadGameData=function(e){var t=this;e&&e.updateTimestamp?s.default.data&&s.default.data.updateTimestamp&&s.default.data.updateTimestamp>e.updateTimestamp?s.default.setAllData(s.default.data,!0):s.default.setAllData(e):s.default.data&&s.default.data.updateTimestamp||s.default.setAllData(d.default.gameData,!0),d.default.gameData=Object.assign(d.default.gameData,s.default.data),console.log("treasure banner hit from ws",d.default.gameData.treasureBannerHit),l.default.onHide(function(){t.updateGameData(!0)}),s.default.onShow(function(e){3!=d.default.gameData.getDiamond&&"1104"==e.scene&&(d.default.gameData.getDiamond=2),t.bindButton_getDiamond(),i.default.instance&&i.default.instance.state==r.GameState.BANNER_TOUCH&&(i.default.instance.state=r.GameState.START,d.default.gameData.treasureBannerHit++,d.default.gameData.lastTreasureBannerHitTimestamp=Date.now(),console.log("treasure banner hit",d.default.gameData.treasureBannerHit))}),this.box_drawer.visible=!0,this.onGameDataLoaded()},t.prototype.onGameDataLoaded=function(){if(console.log("onGameDataLoaded",d.default.gameData),Laya.Browser.onMiniGame){var e=l.default.getUpdateManager();e.onUpdateReady(function(){l.default.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(t){t.confirm&&e.applyUpdate()}})})}this.nav=new u.default(s.default),this.box_homeIcon.visible=!0,this.nav.createIcons(this.box_homeIcon,this.box_homeIcon),this.isGameDataLoaded=!0,c.randomlyGetBanner("home"),c.showBanner(!0),this.refreshUnlock();var t=new Date,a=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime();console.log("todayBeginTimestamp",a),console.log("lastTrailShowTimestamp",d.default.gameData.lastTrailShowTimestamp),(!d.default.gameData.lastTrailShowTimestamp||d.default.gameData.lastTrailShowTimestamp<a)&&(d.default.gameData.trailShowToday=!1,console.log("reset trail show")),console.log("lastTreasureBannerHitTimestamp",d.default.gameData.lastTreasureBannerHitTimestamp),(!d.default.gameData.lastTreasureBannerHitTimestamp||d.default.gameData.lastTreasureBannerHitTimestamp<a)&&(d.default.gameData.treasureBannerHit=0,console.log("reset banner hit")),this.updateTrailUnlock(),3!=d.default.gameData.getDiamond&&Laya.Browser.onMiniGame&&l.default.getLaunchOptionsSync&&"1104"==l.default.getLaunchOptionsSync().scene&&(d.default.gameData.getDiamond=2),this.bindButton_getDiamond(),this.systemName="Android",Laya.Browser.onMiniGame&&l.default.getSystemInfoSync().system.indexOf("iOS")>=0&&(this.systemName="IOS"),console.log(this.systemName),this.label_level.changeText("关卡："+d.default.gameData.stageIndex),this.label_level.visible=!0,this.text_diamond.changeText(""+d.default.gameData.diamond),this.icon_diamond.visible=!0},t.prototype.updateGameData=function(e){d.default.gameData.updateTimestamp=Date.now(),e&&console.log("updateGameData",d.default.gameData),Laya.Browser.onMiniGame&&s.default.setAllData(d.default.gameData,e)},t.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),s.default.tapGameAd({pos:e,ad:t,redirect:a})},t.prototype.refreshUnlock=function(){var e=this;(d.default.gameData.tutorialStep<6||1===d.default.gameData.stageIndex&&6===d.default.gameData.tutorialStep)&&(d.default.gameData.tutorialStep=0,this.lock_cannon.visible=!0,this.btn_cannon.visible=!1,this.btn_cannon.off(Laya.Event.CLICK,this,this.onclick_cannon)),(d.default.gameData.tutorialStep>=6||d.default.gameData.stageIndex>2)&&(this.lock_cannon.visible=!1,this.btn_cannon.visible=!0,this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon)),d.default.gameData.stageIndex<2?(this.lock_trail.visible=!0,this.btn_trail.visible=!1,this.btn_trail.offAll(Laya.Event.CLICK)):(this.lock_trail.visible=!1,this.btn_trail.visible=!0,this.btn_trail.on(Laya.Event.CLICK,this,function(){e.box_trail.visible=!0}))},t.prototype.updateTrailUnlock=function(){for(var e=this,t=function(t){void 0==d.default.gameData.trailUnlockState[t]&&(d.default.gameData.trailUnlockState[t]=0),-1==r.TrailUnlock[t]?(a["btn_trailUnlock"+t].visible=!1,a["btn_trailSelect"+t].visible=!1,a["trailUsing"+t].visible=!1,a["trailWait"+t].visible=!0):d.default.gameData.trailUnlockState[t]>=r.TrailUnlock[t]?(a["btn_trailUnlock"+t].visible=!1,a["trailWait"+t].visible=!1,d.default.gameData.trailType==t?(a["btn_trailSelect"+t].visible=!1,a["trailUsing"+t].visible=!0):(a["btn_trailSelect"+t].visible=!0,a["trailUsing"+t].visible=!1)):(a["label_trailUnlockMsg"+t].changeText("观看视频"+d.default.gameData.trailUnlockState[t]+"/"+r.TrailUnlock[t]),a["btn_trailUnlock"+t].visible=!0,a["btn_trailSelect"+t].visible=!1,a["trailUsing"+t].visible=!1,a["trailWait"+t].visible=!1),a["btn_trailSelect"+t].on(Laya.Event.MOUSE_DOWN,a,function(){e["btn_trailSelect"+d.default.gameData.trailType].visible=!0,e["trailUsing"+d.default.gameData.trailType].visible=!1,d.default.gameData.trailType=t,e["btn_trailSelect"+t].visible=!1,e["trailWait"+t].visible=!1,e["trailUsing"+t].visible=!0,i.default.instance&&i.default.instance.newTrail()})},a=this,n=1;n<=Object.keys(r.TrailUnlock).length;n++)t(n)},t}(n.ui.home.HomeViewUI);a.default=f},{"../Const":3,"../Global":4,"../component/Reward":8,"../utils/Ad":13,"../utils/Loader":14,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./../../ui/layaMaxUI":18,"./CannonSelect":10,"./GameScene":11}],13:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=e("./wx"),o=e("./ws.js"),r=e("../Global"),l=!0,s=null,d=0,c={},u={},h={},m={};a.randomlyGetBanner=function(e){if(Laya.Browser.onMiniGame&&i.default.createBannerAd){if(0===Object.keys(u).length)for(var t=1;t<=r.default.config.banner_number;t++)u[t]=r.default.config.banner[t],console.log("init uid: ",t,u[t]),c[t]=a.wxCreatBanner(u[t]),console.log("init bannerAD: ",t,c[t]),h[t]=0,m[t]=0,c[t].onError(function(e){console.log("banner onError :",e)});n=Math.ceil(Math.random()*r.default.config.banner_number),"home"==e?(h[n]>=r.default.config.show_number&&(c[n]&&c[n].destroy(),c[n]=a.wxCreatBanner(u[n]),h[n]=0),h[n]++):"treasure"==e&&(m[n]>=r.default.config.show_number_t&&(c[n]&&c[n].destroy(),c[n]=a.wxCreatBanner(u[n]),m[n]=0),m[n]++)}},a.wxCreatBanner=function(e){if(Laya.Browser.onMiniGame&&i.default.createBannerAd){var t=i.default.getSystemInfoSync(),a=t.screenHeight,n=t.screenWidth,o=Math.max(300,300*n/350),r=.348*o,l=a-r,s=(n-o)/2;return i.default.createBannerAd({adUnitId:e,style:{left:s,top:l,width:o,height:r}})}},a.setStyle=function(e,t,a){if(Laya.Browser.onMiniGame&&e){var n=i.default.getSystemInfoSync(),o=n.screenHeight,r=n.screenWidth,l=r;t&&(l=Math.max(300,300*r/350));var s=.348*l,d=o-s;-1!==a&&(d=a/Laya.stage.height*o);var c=(r-l)/2;e.style.left=c,e.style.top=d,e.style.width=l,e.style.height=s}},a.showBanner=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=-1),Laya.Browser.onMiniGame&&(a.setStyle(c[n],e,t),c[n]&&c[n].show(),console.log("show banner uid: ",n,"bannerAD: ",c[n]))},a.hideBanner=function(){if(Laya.Browser.onMiniGame)for(var e=1;e<=Object.keys(c).length;e++)c[e]&&c[e].hide()};var f=null;a.wxCreatInterstitialAd=function(e){if(i.default.createInterstitialAd)try{f=i.default.createInterstitialAd({adUnitId:e}),console.log("interstitialAd",f)}catch(e){console.log(e)}},a.showInterstitialAd=function(){if(f&&f.show)try{f.show().catch(function(e){console.log("showInterstitialAd error:",e)})}catch(e){console.log(e)}},a.refreshCurrentBanner=function(){d++,s&&d>=r.default.config.banner_click_time&&(d=0,a.posShowBanner(s,!0))},a.hasVideoAd=function(){return l},a.posShowBanner=function(e,t){if(void 0===t&&(t=!1),Laya.Browser.onMiniGame){var a=i.default.getSystemInfoSync(),n=a.screenHeight,r=a.screenWidth,l=Math.max(300,300*r/350),d=.348*l,c=n-d,u=(r-l)/2;return s=e,o.default.createBanner({pos:e,style:{left:u,top:c,width:l,height:d},force:t})}},a.posHideBanner=function(e){Laya.Browser.onMiniGame&&(s=null,o.default.closeBanner(e))},a.posShowVideo=function(e,t,a){Laya.Browser.onMiniGame&&o.default.createVideo?o.default.createVideo({pos:e,success:function(e){a&&a(e)},fail:function(e){l=!1,console.log("NO VIDEO AD"),console.log("error res: ",e),r.default.gameData.videoCount<=11?o.default.traceEvent("errVideoCnt_"+r.default.gameData.videoCount):o.default.traceEvent("errVideoCnt_11"),e&&e.errMsg&&(o.default.traceEvent("errCode_"+e.errCode),r.default.gameData.videoErr["errCode_"+e.errCode]=e.errMsg,console.log("errCode: "+e.errCode),console.log("errMsg: "+e.errMsg)),t&&t()}}):(l=!1,console.log("NO VIDEO AD"),t&&t())}},{"../Global":4,"./ws.js":16,"./wx":17}],14:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=window.wx,i=function(){function e(){this.debug=!0,this.failCount=0}return e.prototype.log=function(e){for(var t=[],a=1;a<arguments.length;a++)t[a-1]=arguments[a];this.debug&&console.log.apply(this,arguments)},e.prototype.stat=function(e,t){var a=n.getFileSystemManager().statSync(e);if(a.isDirectory())for(var i=0,o=n.getFileSystemManager().readdirSync(e);i<o.length;i++){var r=o[i];try{this.stat(e+"/"+r,t)}catch(t){this.log("stat fail: "+e+"/"+r,t)}}else t[e]=a},e.prototype.loadZip=function(e,t,a,n){Laya.Browser.onMiniGame&&e?(this.failCount=0,this.unzipFile(e,t,a,n)):a&&a.runWith(!1)},e.prototype.unzipFile=function(e,t,a,i){var o=this,r=e.split("/"),l=r[r.length-1],s=n.env.USER_DATA_PATH+"/zip/",d=s+l,c=Laya.MiniFileMgr.getFileNativePath("");n.getFileSystemManager().unzip({zipFilePath:d,targetPath:c,success:function(){o.log("unzip success");var e={};try{o.stat(c+t,e),o.log("stat success")}catch(e){return o.log("stat fail",e),o.cleanDir(c+t),void(a&&a.runWith(!1))}var n=[];for(var i in e){var r=i.replace(c,""),l=Laya.Utils.getFileExtension(r);-1===[].indexOf(l)&&n.push([i,r])}if(n.length){Laya.MiniFileMgr.filesListObj.fileUsedSize||(Laya.MiniFileMgr.filesListObj.fileUsedSize=0);for(var s=0;s<n.length;s++){var d=n[s],i=d[0],r=d[1],u=e[i].size||0,h=o.getEncoding(r);if(Laya.MiniFileMgr.filesListObj[r]){var m=parseInt(Laya.MiniFileMgr.filesListObj[r].size)||0;Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u-m}else Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u;Laya.MiniFileMgr.filesListObj[r]={md5:r,readyUrl:r,size:u,times:Laya.Browser.now(),encoding:h}}o.saveFileListObj(),a&&a.runWith(!0)}else a&&a.runWith(!1)},fail:function(r){if(o.log("unzip fail"),o.failCount++,o.failCount>=3)a&&a.runWith(!1);else{try{n.getFileSystemManager().accessSync(s),o.cleanDir(s,i),o.cleanDir(c+t)}catch(e){o.log("mkdir",s),n.getFileSystemManager().mkdir({dirPath:s})}n.downloadFile({url:e,filePath:d,success:function(){o.log("downloadFile success"),o.unzipFile(e,t,a,i)},fail:function(){o.log("downloadFile fail"),a&&a.runWith(!1)}})}}})},e.prototype.cleanDir=function(e,t){var a=this;"/"===e.charAt(e.length-1)&&(e=e.slice(0,e.length-1));var i={};try{this.stat(e,i),this.log("cleanDir stat success")}catch(e){this.log("cleanDir stat fail")}for(var o in i){if(t&&t.length){s=o.replace(e+"/","");if(-1!==t.indexOf(s))continue}n.getFileSystemManager().unlink({filePath:o,success:function(){a.log("unlink success")},fail:function(){a.log("unlink fail")}})}if(0===(e+"/").indexOf(Laya.MiniFileMgr.getFileNativePath(""))){var r=!1,l=(e+"/").replace(Laya.MiniFileMgr.getFileNativePath(""),"");this.log("cleanDir: ",l);for(var s in Laya.MiniFileMgr.filesListObj)if(0===s.indexOf(l)){r=!0;var d=Laya.MiniFileMgr.filesListObj[s];Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)-(parseInt(d.size)||0),delete Laya.MiniFileMgr.filesListObj[s]}r&&l&&this.saveFileListObj()}},e.prototype.saveFileListObj=function(){n.getFileSystemManager().writeFile({filePath:Laya.MiniFileMgr.fileNativeDir+"/"+Laya.MiniFileMgr.fileListName,encoding:"utf8",data:JSON.stringify(Laya.MiniFileMgr.filesListObj)}),this.log("filesListObj",Laya.MiniFileMgr.filesListObj)},e.prototype.getEncoding=function(e){var t,a=Laya.Loader.getTypeFromUrl(e);if(!a){switch(Laya.Utils.getFileExtension(e)){case"lh":case"ls":case"lmat":case"ltc":case"lav":t="json";break;case"lm":case"lani":t="arraybuffer"}if(t)return Laya.MiniAdpter.getUrlEncode(e,t)}switch(a){case"atlas":case"prefab":case"plf":t="json";break;case"font":t="xml";break;case"plfb":case"image":case"sound":t="arraybuffer";break;default:t=a}return Laya.MiniAdpter.getUrlEncode(e,t)},e}();a.default=new i},{}],15:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=e("../runtime/GameScene"),i=e("../Global"),o=function(){function e(e){this.IconPos=["first_step","mid_step"],this.iconList=[],this.moregameIconList=[],this.ws=e,this.SCALE=Laya.stage.width/720}return e.prototype.createIcons=function(e,t){var a=this;{if(Laya.Browser.onMiniGame){var n=new Laya.Box;n.width=720*this.SCALE,n.height=1280*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!0,e.addChild(n);var o=new Laya.List;o.width=720*this.SCALE,o.height=790*this.SCALE,o.x=0,o.y=240*this.SCALE,o.mouseThrough=!0,o.spaceY=45*this.SCALE,o.spaceX=468*this.SCALE,o.repeatY=5,o.repeatX=2,n.addChild(o);var r=this.SCALE,l=function(e){function t(){var t=e.call(this)||this;t.width=106*r,t.height=106*r,t.pivotX=53*r,t.pivotY=53*r,t.x=73*r,t.y=73*r,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*r,a.height=106*r,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.scaleX=-1,n.width=36*r,n.height=36*r,n.x=116*r,n.y=-10*r,n.loadImage("res/texture/navigator/tips2.png"),t.addChild(n);var i=new Laya.Label;return i.name="titleLabel",i.width=106*r,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*r),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*r,i.x=53*r,t.addChild(i),t}return __extends(t,e),t}(Laya.Box);return o.itemRender=l,o.renderHandler=Laya.Handler.create(this,function(e,t){var n=o.array[t];if(n.data&&n.pos){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,a,a.onIconClick,[n.pos,n.data]);var i=e.getChildByName("iconImage");i&&i.loadImage(n.data.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(n.data.title),r&&(r.visible=!1),a.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1),this.loadIconInfoList=function(e){void 0===e&&(e=!1),e||!a.iconList.length?(a.iconList=[],a.ws.fetchGameAd({data:[{pos:a.IconPos[0],count:i.default.config.first_step_count},{pos:a.IconPos[1],count:10*(10-i.default.config.first_step_count)}],success:function(e){var t=e.data;console.log("fetch icon",t),a.iconList=[],a.moregameIconList=[];for(r=0;t[a.IconPos[1]]&&r<t[a.IconPos[1]].length;r++){(n={}).data=t[a.IconPos[1]][r],n.pos=a.IconPos[1],a.moregameIconList.push(n)}for(r=0;t[a.IconPos[0]]&&r<t[a.IconPos[0]].length;r++){var n={};n.data=t[a.IconPos[0]][r],n.pos=a.IconPos[0],a.moregameIconList.push(n),r<10&&a.iconList.push(n)}for(var i=0,r=a.iconList.length;r<10;r++)a.moregameIconList[i]&&a.iconList.push(a.moregameIconList[i++]);o.array=a.iconList,o.refresh()}})):(o.array=a.iconList,o.refresh())},this.loadIconInfoList(!0),n}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createGameIcons=function(){var e=this;if(Laya.Browser.onMiniGame&&n.default.instance)if(this.iconList.length){console.log("show gameIcon");for(var t=0;t<Math.min(this.iconList.length,10);t++){var a=n.default.instance.box_gameIcon.getChildAt(t);if(this.iconList[t]&&this.iconList[t].data&&this.iconList[t].pos&&a){a.visible=!0,a.on(Laya.Event.MOUSE_DOWN,this,this.onIconClick,[this.iconList[t].pos,this.iconList[t].data]),a.loadImage(this.iconList[t].data.icon);var o=a.getChildByName("iconTitle");o&&o.changeText(this.iconList[t].data.title),o&&(o.visible=!1),this.shakeOnce(1e3*Math.random(),a)}else a.visible=!1}}else this.ws.fetchGameAd({data:[{pos:this.IconPos[0],count:i.default.config.first_step_count},{pos:this.IconPos[1],count:10*(10-i.default.config.first_step_count)}],success:function(t){var a=t.data;console.log("fetch icon in game",a),e.iconList=[],e.moregameIconList=[];for(r=0;a[e.IconPos[1]]&&r<a[e.IconPos[1]].length;r++){(i={}).data=a[e.IconPos[1]][r],i.pos=e.IconPos[1],e.moregameIconList.push(i)}for(r=0;a[e.IconPos[0]]&&r<a[e.IconPos[0]].length;r++){var i={};i.data=a[e.IconPos[0]][r],i.pos=e.IconPos[0],e.moregameIconList.push(i),r<10&&e.iconList.push(i)}for(var o=0,r=e.iconList.length;r<10;r++)e.moregameIconList[o]&&e.iconList.push(e.moregameIconList[o++]);for(r=0;r<10;r++){var l=n.default.instance.box_gameIcon.getChildAt(r);if(e.iconList[r]&&e.iconList[r].data&&e.iconList[r].pos&&l){l.visible=!0,l.on(Laya.Event.MOUSE_DOWN,e,e.onIconClick,[e.iconList[r].pos,e.iconList[r].data]),l.loadImage(e.iconList[r].data.icon);var s=l.getChildByName("iconTitle");s&&s.changeText(e.iconList[r].data.title),s&&(s.visible=!1),e.shakeOnce(1e3*Math.random(),l)}else l.visible=!1}}})},e.prototype.randomIconTap=function(e,t,a){if(this.iconList&&this.iconList.length){var n=Math.floor(Math.random()*this.iconList.length);this.ws.tapGameAd({pos:this.iconList[n].pos,ad:this.iconList[n].data,redirect:!0,success:t,fail:a})}else a&&a()},e.prototype.createMoreGame=function(e){var t=this;{if(Laya.Browser.onMiniGame){var a=new Laya.Box;a.width=720*this.SCALE,a.height=1280*this.SCALE,a.centerX=0,a.centerY=0,a.mouseThrough=!0,a.visible=!1,e.addChild(a);var n=new Laya.Box;n.width=720*this.SCALE,n.height=1280*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!0,a.addChild(n);var i=new Laya.Box;i.width=690*this.SCALE,i.height=900*this.SCALE,i.x=15*this.SCALE,i.top=220*this.SCALE,n.addChild(i);var o=new Laya.List;o.width=690*this.SCALE,o.height=1e3*this.SCALE,o.spaceX=10*this.SCALE,o.spaceY=80*this.SCALE,o.repeatX=4,i.addChild(o);var r=this.SCALE,l=function(e){function t(){var t=e.call(this)||this;t.width=165*r,t.height=165*r,t.x=0,t.y=0,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=165*r,a.height=165*r,a.x=0,a.y=-2*r,t.addChild(a);var n=new Laya.Sprite;n.name="tips",n.width=59*r,n.height=32*r,n.x=110*r,n.y=-10*r,n.loadImage("res/texture/navigator/tips.png"),t.addChild(n);var i=new Laya.Label;i.name="tipsLabel",i.width=42*r,i.height=18*r,i.valign="middle",i.align="center",i.fontSize=Math.round(18*r),i.font="Arial",i.color="#ffffff",i.x=9*r,i.y=6*r,n.addChild(i);var o=new Laya.Label;return o.name="titleLabel",o.width=165*r,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(22*r),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=66*r,o.y=170*r,t.addChild(o),t}return __extends(t,e),t}(Laya.Box);return o.itemRender=l,o.renderHandler=Laya.Handler.create(this,function(e,a){var n=o.array[a];if(n&&n.data&&n.pos){e.visible=!0,e.on(Laya.Event.CLICK,t,t.onIconClick,[n.pos,n.data]);var i=e.getChildByName("iconImage");i&&i.loadImage(n.data.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(n.data.title);var l=e.getChildByName("tips");if(l){var s=l.getChildByName("tipsLabel");s&&s.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1),this.moregameIconList.length&&(console.log("moregameIconList",this.moregameIconList),o.array=this.moregameIconList,o.refresh()),o.vScrollBarSkin="",a.visible=!0,a}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createGuessLikeIcons=function(e,t,a){var n=this;if(Laya.Browser.onMiniGame){if(a&&a.length){var i=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var l=new Laya.Sprite;l.width=560*this.SCALE,l.height=188*this.SCALE,l.y=670*this.SCALE,l.x=80*this.SCALE,l.loadImage("res/texture/navigator/guessyoulike.png"),r.addChild(l);var s=new Laya.List;s.width=500*this.SCALE,s.height=208*this.SCALE,s.x=60*this.SCALE,s.y=-20*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=18*this.SCALE,s.repeatY=1,s.repeatX=4,l.addChild(s);var d=this.SCALE,c=function(e){function t(){var t=e.call(this)||this;t.width=106*d,t.height=106*d,t.pivotX=53*d,t.pivotY=53*d,t.x=63*d,t.y=108*d,t.visible=!1;var a=new Laya.Sprite;a.name="iconImage",a.width=106*d,a.height=106*d,a.x=0,a.y=0,t.addChild(a);var n=new Laya.Label;return n.name="titleLabel",n.width=106*d,n.overflow="visible",n.valign="middle",n.align="center",n.fontSize=Math.round(18*d),n.font="Arial",n.color="#1d3b63",n.anchorY=0,n.anchorX=.5,n.y=110*d,n.x=53*d,t.addChild(n),t}return __extends(t,e),t}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,t){var a=s.array[t];if(a){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",a]);var i=e.getChildByName("iconImage");i&&i.loadImage(a.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(a.title),n.jumpeOnce(150*t,e)}else e.visible=!1},[],!1);var u=function(){if(r&&r.activeInHierarchy&&t&&t.visible){for(var e=0;e<i.length;e++){var a=i[e],l=n.getRandom(a);o[e]=l}s.array=o,s.refresh()}};return this.loadGuessLikeIconInfoList=function(){n.ws.getPromoGameAd({count:a.length,success:function(e){var t=e.data;i=[];for(var l=Math.max(t.length-a.length,0);l<t.length;l++){var s=t[l];i.push([s])}o=[],r.clearTimer(n,u),u(),r.timerLoop(3e3,n,u)}})},this.loadGuessLikeIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.onIconClick=function(e,t,a){void 0===a&&(a=!0),this.ws.tapGameAd({pos:e,ad:t,redirect:a})},e.prototype.shakeOnce=function(e,t){var a=this;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))}))}),this.blinkTips(e,t)},e.prototype.jumpeOnce=function(e,t){var a=this,n=t.y;t.timerOnce(e,this,function(){Laya.Tween.to(t,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.Tween.to(t,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(a,function(){Laya.timer.clearAll(t)}))}))}))}))})),Laya.Tween.to(t,{y:n-50},200,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(t,{y:n},200,Laya.Ease.sineIn)}))}),this.blinkTips(e,t)},e.prototype.blinkTips=function(e,t){var a=this,n=t.getChildByName("tips");n&&n.timerOnce(e,this,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(a,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(a,function(){Laya.timer.clearAll(n)}))}))}))}))}))}))})},e.prototype.randomIndex=function(e,t,a){void 0===t&&(t="weight"),void 0===a&&(a=0);var n=[],i=0;if(e&&e.length)for(s=0;s<e.length;s++){var o=e[s],r=Number(o[t])||a||0;n[s]=[i,i+r],i+=r}if(i>0)for(var l=Math.random()*i,s=0;s<n.length;s++){var d=n[s];if(d[0]<=l&&l<d[1])return s}return 0},e.prototype.getRandom=function(e,t,a){return void 0===t&&(t="weight"),void 0===a&&(a=0),e&&e.length?1===e.length?e[0]:e[this.randomIndex(e,t,a)]:null},e}();a.default=o},{"../Global":4,"../runtime/GameScene":11}],16:[function(e,t,a){t.exports.default=function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="",t(0)}([function(e,t,a){"use strict";var n,i=(n=a(1))&&n.__esModule?n:{default:n},o=a(4),r=a(5),l=a(6),s=a(7),d=a(8),c=a(9),u=a(10),h=a(11),m=a(12),f=a(13),g=a(2),y=a(14);(0,g.initUtil)(i.default),(0,o.initHTTP)(i.default),(0,r.initUser)(i.default),(0,l.initConfig)(i.default),(0,s.initData)(i.default),(0,d.initShare)(i.default),(0,c.initProcess)(i.default),(0,u.initPayment)(i.default),(0,h.initAD)(i.default),(0,m.initHook)(i.default),(0,f.initInvite)(i.default),(0,y.initEvent)(i.default),e.exports=window.ws=i.default},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},o=(n=a(2))&&n.__esModule?n:{default:n},r={tmp:{},options:{scheme:"https://",host:"api.websdk.cn",apiVersion:"v1",USER_KEY:"ws_user",CONF_KEY:"ws_conf",DATA_KEY:"ws_data",share10:!0,commonDuration:120,allowAld:!1},conf:{},user:{},data:{},version:"1.0.1",mode:"default",debug:!0,shareCallbackData:{},shareTempData:{},shareGiftTempData:{},_initCallbacks:[],_showCallbacks:[],_hideCallbacks:[],_afterHideCallbacks:[],_shareCallbacks:[],_openFromShareCallbacks:[],_openFromCodeCallbacks:[],_onInit:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=this._initCallbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o&&o()}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}},_onShow:function(e){if(console.log("onShow:",e,"mode:",this.mode),"default"!==this.mode)this.shareCallbackData&&this.shareCallbackData.callback&&"shareAppMessage"==this.mode&&(this.shareCallbackData.callback(e,Date.now()-this.shareCallbackData.ms),this.shareCallbackData={}),this.mode="default";else{var t=!0,a=!1,n=void 0;try{for(var i,o=this._showCallbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;l&&l(e)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}if(e.query&&"share"===e.query.type?r._openFromShare("onShow",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onShow",e.query.scene,e),this.user&&e.shareTicket&&e.query&&e.query.uid==this.user.id)for(var s in this.shareTempData)s==e.query.share_tid&&r._shareCallback(this.shareTempData[s],e)}},_onHide:function(e){if(console.log("onHide:",e,"mode:",this.mode),"default"===this.mode){var t=!0,a=!1,n=void 0;try{for(var i,o=this._hideCallbacks[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var r=i.value;r&&r(e)}}catch(e){a=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(a)throw n}}var l=!0,s=!1,d=void 0;try{for(var c,u=this._afterHideCallbacks[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var h=c.value;h&&h(e)}}catch(e){s=!0,d=e}finally{try{!l&&u.return&&u.return()}finally{if(s)throw d}}}},_openFromShare:function(e,t,a){var n=!0,i=!1,o=void 0;try{for(var r,l=this._openFromShareCallbacks[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=r.value;s&&s({from:e,query:t,options:a})}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}},_openFromCode:function(e,t,a){r.get({url:"/share/qrcode",data:{scene:t},success:function(n){var i=!0,o=!1,l=void 0;try{for(var s,d=r._openFromCodeCallbacks[Symbol.iterator]();!(i=(s=d.next()).done);i=!0){var c=s.value;c&&c({from:e,scene:t,options:a,query:n.data})}}catch(e){o=!0,l=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw l}}}})},_shareCallback:function(e,t){wx.getShareInfo({shareTicket:t.shareTicket,success:function(a){e.onShareTicketSuccess&&e.onShareTicketSuccess(a),r.shareLog(e,"click",t.shareTicket,a,t)}.bind(this),fail:function(a){e.onShareTicketFail&&e.onShareTicketFail(a),r.shareLog(e,"click",t.shareTicket,{},t)}.bind(this)})},onInit:function(e){this._initCallbacks.push(e)},onShow:function(e){this._showCallbacks.push(e)},onHide:function(e){this._hideCallbacks.push(e)},afterHide:function(e){this._afterHideCallbacks.push(e)},openFromShare:function(e){this._openFromShareCallbacks.push(e)},openFromCode:function(e){this._openFromCodeCallbacks.push(e)},init:function(e){this.options=i({},o.default.copy(e,this.options)),this.systemInfo=wx.getSystemInfoSync(),this.launchOptions=wx.getLaunchOptionsSync(),this.user=wx.getStorageSync(this.options.USER_KEY),this.conf=wx.getStorageSync(this.options.CONF_KEY),this.data=wx.getStorageSync(this.options.DATA_KEY),this.log("conf:",this.conf),wx.onShow(this._onShow.bind(this)),wx.onHide(this._onHide.bind(this))},onLogined:function(){var e=this.launchOptions;e.query&&"share"===e.query.type?r._openFromShare("onLaunch",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onLaunch",e.query.scene,e),this._onInit()}};t.default=r},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.initUtil=function(e){e.checkSDK=function(e,t){var a=this;return function(n,i){return a.requireSDK(e)?t.apply(a,[n]):(a.log("微信SDK版本过低："+a.systemInfo.SDKVersion+",需要更新至"+e),void(i&&"function"==typeof i&&i([a.systemInfo.SDKVersion,e])))}},e.requireSDK=function(e){return r.compareVersion(this.systemInfo.SDKVersion,e)},e.requireSystemVersion=function(e){return r.compareVersion(this.systemInfo.version,e)},e.isIPhoneX=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iPhone X")},e.isIOS=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iOS")},e.isAndroid=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("Android")},e.toFixed=function(e,t){for(var a=e.toFixed(t)+"";"0"===a[a.length-1];)if("."===(a=a.substring(0,a.length-1))[a.length-1]){a=a.substring(0,a.length-1);break}return a},e.log=function(){try{if(this.debug&&console&&console.log){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return console.log.apply(console,t)}}catch(e){}},e.setAlertCallback=function(t){e._alertCallback=t},e.alert=function(t){e._alertCallback?e._alertCallback(t):wx.showModal({content:t})},e.trace=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.post({url:"/log/trace",data:{key:e,pos:t,data:a}})},e.getServerTime=function(){return e.conf&&e.conf.server_time?e.conf.server_time:0}};var i,o=(i=a(3))&&i.__esModule?i:{default:i},r={sign:function(e,t){if("string"==typeof e)return r.signSort(e,t);if("object"==(void 0===e?"undefined":n(e))){var a=[];for(var i in e)a.push(i+"="+e[i]);return r.signSort(a.join("&"),t)}},signSort:function(e,t){var a=e.split("&").sort().join("&")+"&key="+t;return(0,o.default)(a).toUpperCase()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return Date.now()+"-"+r.S4()},compareVersion:function(e,t){var a=parseFloat(e),n=parseFloat(t),i=e.replace(a+".",""),o=t.replace(n+".","");return a>n||!(a<n)&&i>=o},copy:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(e&&e.push?[]:{});for(var a in e)t[a]="object"===n(e[a])?r.copy(e[a]):e[a];return t},randomSort:function(e){for(var t,a=0;a<e.length;a++){var n=parseInt(Math.random()*e.length+"");t=e[n],e[n]=e[a],e[a]=t}return e}};t.default=r},function(e,t,a){var n;"function"==typeof Symbol&&Symbol.iterator,function(i){"use strict";function o(e,t){var a=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(a>>16)<<16|65535&a}function r(e,t,a,n,i,r){return o((l=o(o(t,e),o(n,r)))<<(s=i)|l>>>32-s,a);var l,s}function l(e,t,a,n,i,o,l){return r(t&a|~t&n,e,t,i,o,l)}function s(e,t,a,n,i,o,l){return r(t&n|a&~n,e,t,i,o,l)}function d(e,t,a,n,i,o,l){return r(t^a^n,e,t,i,o,l)}function c(e,t,a,n,i,o,l){return r(a^(t|~n),e,t,i,o,l)}function u(e,t){var a,n,i,r,u;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var h=1732584193,m=-271733879,f=-1732584194,g=271733878;for(a=0;a<e.length;a+=16)n=h,i=m,r=f,u=g,h=l(h,m,f,g,e[a],7,-680876936),g=l(g,h,m,f,e[a+1],12,-389564586),f=l(f,g,h,m,e[a+2],17,606105819),m=l(m,f,g,h,e[a+3],22,-1044525330),h=l(h,m,f,g,e[a+4],7,-176418897),g=l(g,h,m,f,e[a+5],12,1200080426),f=l(f,g,h,m,e[a+6],17,-1473231341),m=l(m,f,g,h,e[a+7],22,-45705983),h=l(h,m,f,g,e[a+8],7,1770035416),g=l(g,h,m,f,e[a+9],12,-1958414417),f=l(f,g,h,m,e[a+10],17,-42063),m=l(m,f,g,h,e[a+11],22,-1990404162),h=l(h,m,f,g,e[a+12],7,1804603682),g=l(g,h,m,f,e[a+13],12,-40341101),f=l(f,g,h,m,e[a+14],17,-1502002290),h=s(h,m=l(m,f,g,h,e[a+15],22,1236535329),f,g,e[a+1],5,-165796510),g=s(g,h,m,f,e[a+6],9,-1069501632),f=s(f,g,h,m,e[a+11],14,643717713),m=s(m,f,g,h,e[a],20,-373897302),h=s(h,m,f,g,e[a+5],5,-701558691),g=s(g,h,m,f,e[a+10],9,38016083),f=s(f,g,h,m,e[a+15],14,-660478335),m=s(m,f,g,h,e[a+4],20,-405537848),h=s(h,m,f,g,e[a+9],5,568446438),g=s(g,h,m,f,e[a+14],9,-1019803690),f=s(f,g,h,m,e[a+3],14,-187363961),m=s(m,f,g,h,e[a+8],20,1163531501),h=s(h,m,f,g,e[a+13],5,-1444681467),g=s(g,h,m,f,e[a+2],9,-51403784),f=s(f,g,h,m,e[a+7],14,1735328473),h=d(h,m=s(m,f,g,h,e[a+12],20,-1926607734),f,g,e[a+5],4,-378558),g=d(g,h,m,f,e[a+8],11,-2022574463),f=d(f,g,h,m,e[a+11],16,1839030562),m=d(m,f,g,h,e[a+14],23,-35309556),h=d(h,m,f,g,e[a+1],4,-1530992060),g=d(g,h,m,f,e[a+4],11,1272893353),f=d(f,g,h,m,e[a+7],16,-155497632),m=d(m,f,g,h,e[a+10],23,-1094730640),h=d(h,m,f,g,e[a+13],4,681279174),g=d(g,h,m,f,e[a],11,-358537222),f=d(f,g,h,m,e[a+3],16,-722521979),m=d(m,f,g,h,e[a+6],23,76029189),h=d(h,m,f,g,e[a+9],4,-640364487),g=d(g,h,m,f,e[a+12],11,-421815835),f=d(f,g,h,m,e[a+15],16,530742520),h=c(h,m=d(m,f,g,h,e[a+2],23,-995338651),f,g,e[a],6,-198630844),g=c(g,h,m,f,e[a+7],10,1126891415),f=c(f,g,h,m,e[a+14],15,-1416354905),m=c(m,f,g,h,e[a+5],21,-57434055),h=c(h,m,f,g,e[a+12],6,1700485571),g=c(g,h,m,f,e[a+3],10,-1894986606),f=c(f,g,h,m,e[a+10],15,-1051523),m=c(m,f,g,h,e[a+1],21,-2054922799),h=c(h,m,f,g,e[a+8],6,1873313359),g=c(g,h,m,f,e[a+15],10,-30611744),f=c(f,g,h,m,e[a+6],15,-1560198380),m=c(m,f,g,h,e[a+13],21,1309151649),h=c(h,m,f,g,e[a+4],6,-145523070),g=c(g,h,m,f,e[a+11],10,-1120210379),f=c(f,g,h,m,e[a+2],15,718787259),m=c(m,f,g,h,e[a+9],21,-343485551),h=o(h,n),m=o(m,i),f=o(f,r),g=o(g,u);return[h,m,f,g]}function h(e){var t,a="",n=32*e.length;for(t=0;t<n;t+=8)a+=String.fromCharCode(e[t>>5]>>>t%32&255);return a}function m(e){var t,a=[];for(a[(e.length>>2)-1]=void 0,t=0;t<a.length;t+=1)a[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)a[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return a}function f(e){var t,a,n="";for(a=0;a<e.length;a+=1)t=e.charCodeAt(a),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function g(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return h(u(m(e),8*e.length))}(g(e))}function p(e,t){return function(e,t){var a,n,i=m(e),o=[],r=[];for(o[15]=r[15]=void 0,i.length>16&&(i=u(i,8*e.length)),a=0;a<16;a+=1)o[a]=909522486^i[a],r[a]=1549556828^i[a];return n=u(o.concat(m(t)),512+8*t.length),h(u(r.concat(n),640))}(g(e),g(t))}function b(e,t,a){return t?a?p(t,e):f(p(t,e)):a?y(e):f(y(e))}void 0===(n=function(){return b}.call(t,a,t,e))||(e.exports=n)}()},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.success,a=e.fail;return"GET"==e.method?e.url=d(e.url,e.data):e.url=d(e.url),e.header||(e.header={}),e.header.Authorization=c.default.isLogined()?c.default.user.token:"",e.success=function(n){"LOGIN_REQUIRED"===n.data.key?(c.default.log("login required:",e.url,e,n),c.default.doLogin()):0===n.data.code?(c.default.log("success:",e.url,e,n),t&&t(n.data)):a?(c.default.log("fail:",e.url,e,n),a(n.data)):c.default.log("unknown:",e.url,e,n)},e.fail=function(t){c.default.log("error:",e.url,e,t),a&&a(t)},wx.request(e)}function o(e){return e.method="GET",i(e)}function r(e){return e.method="POST",i(e)}function l(e){return e.method="PUT",i(e)}function s(e){return e.method="DELETE",i(e)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){-1==e.indexOf("?")&&(e+="?");var a=[];if(c.default.isLogined()&&a.push("user="+c.default.user.id),c.default.launchOptions){var n=c.default.launchOptions.query;n&&(n.uid&&a.push("uid="+n.uid),n.channel&&a.push("channel="+n.channel),n.share_id&&a.push("share_id="+n.share_id),n.share_tid&&a.push("share_tid="+n.share_tid),n.pos&&a.push("share_pos="+n.pos),n.scene&&a.push("scene="+decodeURIComponent(n.scene)))}a.push("v="+c.default.version),a.push("version="+c.default.options.version),a.push("appid="+c.default.options.appid),a.push("t="+Date.now()),"?"!==e.charAt(e.length-1)&&"&"!==e.charAt(e.length-1)&&(e+="&");var i=(e+=a.join("&")).split("?")[1];if(t){var o=[];for(var r in t)o.push(r+"="+t[r]);i+="&"+o.join("&")}if((e+="&sign="+u.default.sign(i,c.default.options.secret)).startsWith("/"))return c.default.options.scheme+c.default.options.host+"/"+c.default.options.apiVersion+e}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.initHTTP=function(e){e.request=i,e.get=o,e.post=r,e.put=l,e.delete=s,e.formatURL=d};var c=n(a(1)),u=n(a(2))},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initUser=function(e){e.isLogined=function(){return e.user&&e.user.token},e.getLoginStatus=function(){return e.isLogined()?"success":e.isCheckSession||e.isLogining?"logining":"fail"},e.login=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;t?e.doLogin(t):(e.isCheckSession=!0,wx.checkSession({success:function(){e.checkLogin(t),e.isCheckSession=!1}.bind(e),fail:function(){e.doLogin(t),e.isCheckSession=!1}.bind(e)}))},e.checkLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogined()?(e.loginSuccess(),!e.requireSDK("2.0.3")&&e.needUserInfo()&&e.getUserInfo()):e.doLogin(t)},e.checkCode2access=function(t){var a=t.session_key?t:null;e.post({url:"/oauth/code2access_token",data:t,success:function(t){e.isLogining=!1,e.saveUser(t.data),e.checkLogin(a)}.bind(e),fail:e.loginFail.bind(e)})},e.doLogin=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogining||(e.isLogining=!0,e.user=null,t?e.checkCode2access(t):wx.login({success:function(t){t.code?e.checkCode2access({code:t.code}):e.loginFail(t)}.bind(e),fail:e.loginFail.bind(e)}))},e.loginSuccess=function(t){var a=e.conf&&e.conf.last?e.conf.last:0;!a||Date.now()-a>1e3*e.options.commonDuration?e.getCommon(t):(e.doLoginSuccess(t),e.onLogined())},e.getCommon=function(t){e.get({url:"/common",success:function(a){e.conf=a.data.conf,e.conf.last=Date.now(),wx.setStorage({key:e.options.CONF_KEY,data:e.conf}),e.data||(e.data=a.data.data,wx.setStorage({key:e.options.DATA_KEY,data:e.data})),e.doLoginSuccess(t),e.onLogined()}.bind(e),fail:function(t){e.loginFail(t)}.bind(e)})},e.doLoginSuccess=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginSuccessCallback&&e.loginSuccessCallback(t)},e.loginFail=function(t){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(t),e.loginFailCallback&&e.loginFailCallback(t)},e.onLoginSuccess=function(t){e.loginSuccessCallback=t},e.onLoginFail=function(t){e.loginFailCallback=t},e.onLoginComplete=function(t){e.loginCompleteCallback=t},e.checkUserInfo=function(){e.needUserInfo()&&e.getUserInfo()},e.needUserInfo=function(){return!e.user||!e.user.nickname||!e.user.avatar},e.getUserInfo=function(){wx.getUserInfo({withCredentials:!0,success:function(t){return e.post({url:"/oauth/update_userinfo",data:t,success:function(t){e.saveUser(t.data),e.needUserInfo()?e.getUserInfoFail(t):e.getUserInfoSuccess()}.bind(e),fail:e.getUserInfoFail.bind(e)}),t}.bind(e),fail:e.getUserInfoFail.bind(e)})},e.getUserInfoSuccess=function(e){},e.getUserInfoFail=function(e){},e.saveUser=function(t){e.user=t,e.user.last=Date.parse(new Date),wx.setStorage({key:e.options.USER_KEY,data:e.user})}}},function(e,t,a){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.conf&&void 0!==o.default.conf[e]?o.default.conf[e]:t}Object.defineProperty(t,"__esModule",{value:!0}),t.initConfig=function(e){e.getConfig=n};var i,o=(i=a(1))&&i.__esModule?i:{default:i}},function(e,t,a){"use strict";function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.default.data&&void 0!==u.default.data[e]?u.default.data[e]:t}function i(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.default.data||(u.default.data={}),u.default.data[e]=t,a&&u.default.postData(e)}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.default.data=e,t&&u.default.postData()}function r(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=u.default.getData(e,n)+t;return u.default.setData(e,i,a),i}function l(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],wx.setStorage({key:u.default.options.DATA_KEY,data:u.default.data}),u.default.post({url:"/data",data:u.default.data})}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",o={};if(e instanceof Object){var r=e;o={id:r.id,score:r.score,time:r.time,version:u.default.options.version,data:r.data,key:r.key}}else o={id:e,score:t,time:a,version:u.default.options.version,data:n,key:i};u.default.post({url:"/score",data:o,success:function(e){u.default.log("提交分数成功：",t,e)},fail:function(e){u.default.log("提交分数失败：",t,e)}})}function d(e){var t=e.key,a=void 0===t?"default":t,n=e.scale,i=void 0===n?"week":n,o=e.skip,r=void 0===o?0:o,l=e.limit,s=void 0===l?10:l,d=e.success,c=void 0===d?null:d,h=e.fail,m=void 0===h?null:h;u.default.get({url:"/score",data:{score_key:a,scale:i,skip:r,limit:s},success:function(e){c&&c(e.data)},fail:function(e){m&&m(e)}})}Object.defineProperty(t,"__esModule",{value:!0}),t.initData=function(e){e.getData=n,e.setData=i,e.setAllData=o,e.incData=r,e.postData=l,e.postGameScore=s,e.getScoreRank=d};var c,u=(c=a(1))&&c.__esModule?c:{default:c}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initShare=function(e){e.share=function(t){e.options.allowAld?e.aldShareAppMessage(this.createShareOptions(t)):e.shareAppMessage(this.createShareOptions(t)),this.options.share10&&(this.log("share10"),this.shareLog(t,"share10","",{},{})),t.onShareBack&&(e.shareCallbackData={callback:t.onShareBack,ms:Date.now()})},e.createShareOptions=function(t){t.pos||(t.pos="default");var a=this.getShareInfo(t);t.shareId=a.shareId,t.title||(t.title=a.title),t.imageUrl||(t.imageUrl=a.imageUrl),t.success||(t.success=a.success),t.fail||(t.fail=a.fail),t.onHttpError||(t.onHttpError=a.onHttpError),t.tid||(t.tid=""+Date.now());var n="type=share&pos="+t.pos+"&share_id="+a.shareId+"&share_tid="+t.tid;return this.isLogined()&&(n+="&uid="+this.user.id),t.gift&&(n+="&gift="+t.gift),t.query?"&"==t.query.indexOf(0)?(t.query=n+t.query,e.log("new share query: "+t.query)):(t.query=n+"&"+t.query,e.log("new share query: "+t.query)):t.query=n,e.shareTempData[t.tid]=t,{title:t.title,imageUrl:t.imageUrl,query:t.query,success:this.shareSuccess(t),fail:this.shareFail(t),complete:t.complete}},e.getShareInfo=function(e){var t="",a="";this.options.share&&(t=this.options.share.title,a=this.options.share.imageUrl);var n,i=0;return e.defaultTitle&&(t=e.defaultTitle),this.conf&&this.conf.shares&&(this.conf.shares[e.pos]?n=this.conf.shares[e.pos]:this.conf.shares.default&&(n=this.conf.shares.default),n&&(n.title&&(t=n.title),n.image&&(a=n.image),n.id&&(i=n.id))),{title:t,imageUrl:a,shareId:i,success:function(){wx.showToast({title:"分享成功！",icon:"success"})},fail:function(){wx.showToast({title:"分享失败！",icon:"fail"})},onHttpError:function(){wx.showToast({title:"网络出错！",icon:"fail"})}}},e.shareSuccess=function(t){return function(a){console.log("shareSuccess"),delete e.shareTempData[t.tid];var n=!0;t.onShareSuccess&&(n=t.onShareSuccess(a)),n&&(a.shareTickets&&a.shareTickets.length>0?wx.getShareInfo({shareTicket:a.shareTickets[0],success:function(e){t.onShareTicketSuccess&&t.onShareTicketSuccess(e),this.shareLog(t,"success",a.shareTickets[0],e,a)}.bind(this),fail:function(e){t.onShareTicketFail&&t.onShareTicketFail(e),this.shareLog(t,"success",a.shareTickets[0],{},a)}.bind(this)}):(t.onShareTicketFail&&t.onShareTicketFail(),this.shareLog(t,"success","",{},a)))}.bind(this)},e.shareFail=function(e){return function(t){console.log("shareFail");var a=!0;e.onShareFail&&(a=e.onShareFail(t)),a&&this.shareLog(e,"fail","",{},t)}.bind(this)},e.shareLog=function(t,a,n,i,o){this.post({url:"/log/share",data:{share_id:t.shareId,title:t.title,query:t.query,image:t.imageUrl,pos:t.pos,tid:t.tid,status:a,shareTicket:n,info:i,error:o.errMsg,system_version:e.systemInfo.system,sdk_version:e.systemInfo.SDKVersion},success:function(n){"success"!==a&&"click"!==a||!t.success?"fail"===a&&t.fail&&t.fail(n,o):(t.success(n,o),delete e.shareTempData[t.tid])},fail:function(e){"success"!==a&&"click"!==a||!t.onHttpError?"fail"===a&&t.fail&&t.fail(e,o):t.onHttpError(e,o)}})},e.isEnableShare=function(){return!(!e.conf||!e.conf.allow_share||e.requireSystemVersion("6.7.0"))}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){"string"==typeof e?(d.process=e,d.processDuration=Date.now()-d.initStartAt):l.default.log("setProcess():  参数类型错误")}function o(e){l.default.post({url:"/log/process",data:e,success:function(e){l.default.log("提交游戏进度数据成功：",e)},fail:function(e){l.default.log("提交游戏进度数据失败：",e)}})}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initProcess=function(e){e.onShow(function(e){c=Date.now(),d.showOptions=JSON.stringify(e)}),e.afterHide(function(t){var a=Date.now(),n=d=r({},d,{times:d.times+1,showDuration:c?a-c:a-d.initStartAt,duration:a-d.initStartAt}),i=(n.hasInited,n.initStartAt,function(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}(n,["hasInited","initStartAt"]));d.hasInited?o(i):(d.hasInited=!0,o(r({systemInfo:JSON.stringify(e.systemInfo),launchOptions:JSON.stringify(e.launchOptions)},i)))}),e.setProcess=i};var l=n(a(1)),s=n(a(2)),d={hasInited:!1,initStartAt:Date.now(),showOptions:"",times:0,uuid:s.default.guid(),duration:0,showDuration:0,process:"init",processDuration:0},c=0},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.initPayment=function(e){e.getPaymentResult=function(e){var t=e.success,a=void 0===t?null:t,n=e.fail,i=void 0===n?null:n;this.get({url:"/payment/result",success:function(e){this.log("获取充值数据成功",e),a&&a(e.data)}.bind(this),fail:function(e){this.log("获取充值数据失败",e),i&&i(e)}.bind(this)})},e.requestMPPayment=function(t){var a=this,n=t.title,i=void 0===n?"点击充值链接进入充值":n,o=t.pos,r=void 0===o?"default":o,l=t.image,s=void 0===l?null:l,d=t.success,c=void 0===d?null:d,u=t.fail,h=void 0===u?null:u,m=t.complete,f=void 0===m?null:m;this.log("打开客服对话"),e.openCustomerServiceConversation({sessionFrom:r,showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"?type=message",sendMessageImg:s||e.conf.shares.default.image,success:function(e){a.log("打开充值会话成功",e),f&&f(),c&&c()},fail:function(e){a.log("打开充值会话fail",e),f&&f(),h&&h()}})},e.requestMPPayment=e.checkSDK("2.0.3",e.requestMPPayment)}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var t=e.pos,a=e.style,n=void 0===a?null:a,l=e.ms,s=void 0===l?0:l,d=e.force,c=void 0!==d&&d,u=e.forceTimeout,h=void 0===u?600:u,m=e.onResize,f=void 0===m?null:m;if(S.default.conf&&S.default.conf.banners&&S.default.conf.banners[t]){var g=S.default.conf.banners[t];if(g.enable){var y=void 0,p=L[t];p&&(y=C[p.adUnitId])&&(p.showed&&o(p),(c||Date.now()-y.created>1e3*h)&&function(e){var t=C[e.adUnitId];if(t)t.hide(),t.destroy(),delete C[e.adUnitId]}(p)),s||(s=S.default.getConfig("banner_ms",120)),p||(p={adUnitId:g.adUnitId,pos:t,count:0,ms:s,duration:0,style:n,width:g.width?g.width>1?1:g.width:1,window:"*",data:[],onResize:f,created:Date.now()},L[t]=p),p.count+=1,p.status="success",(y=C[p.adUnitId])||(y=C[p.adUnitId]=function(e){var t=e.banner,a=e.style,n=void 0===a?null:a,i=S.default.systemInfo.screenWidth*t.width,o=(S.default.systemInfo.screenHeight,wx.createBannerAd({adUnitId:t.adUnitId,style:w({left:0,top:0,width:i,height:180*i/750},n)}));return o.created=Date.now(),o.onError(function(e){t.status="error",t.error=e,t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,r(t,"error"),S.default.log("banner 创建失败",t),L[t.pos]&&delete L[t.pos]}),o.onResize(function(e){t.onResize&&t.onResize(e,o)}),o.onLoad(function(e){S.default.log("banner 加载完成",t),o.created=Date.now()}),o}({banner:p,style:n})),p.showed=Date.now(),setTimeout(function(){y.show()},.01),p.ms&&y&&(p.timeout&&clearTimeout(p.timeout),p.timeout=setTimeout(function(){i({pos:t,style:n,ms:s,force:!0,onResize:f})},1e3*s))}}else S.default.log("createBanner 没有配置: "+t)}function o(e){var t=L[e];if(t&&t.showed){var a=C[t.adUnitId];if(a){var n=a.style,i=n.realWidth,o=n.realHeight,r=Date.now()-t.showed;return a.hide(),t.duration+=r,t.data.push({created:a.created,showed:t.showed,duration:r}),t.timeout&&clearTimeout(t.timeout),t.timeout=null,t.showed=null,t.window=i+"*"+Math.round(o),!0}}return!1}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onHide",a={adUnitId:e.adUnitId,pos:e.pos,ms:e.ms,count:e.count,duration:e.duration,data:JSON.stringify(e.data),window:e.window,status:e.status,error:e.error,commit:t};e.count=0,e.duration=0,e.status="success",e.error="",e.data=[],S.default.log("postBannerData",a),S.default.post({url:"/log/ad/banner",data:a,success:function(e){S.default.log("提交banner数据成功：",e)},fail:function(e){S.default.log("提交banner数据失败：",e)}})}function l(e){return S.default.conf&&S.default.conf.videos&&S.default.conf.videos[e]?!!S.default.conf.videos[e].enable:(S.default.log("createVideo 没有配置: "+e),!1)}function s(e){function t(e){f.status="error",f.error=e,d(f),m&&m(e),u&&u(e),i()}function a(e){f.created=Date.now()}function n(e){m&&m(e),f.duration=Date.now()-f.created,e&&e.isEnded||void 0===e?s&&s({isEnded:!0,duration:f.duration}):(f.status="cancel",s&&s({isEnded:!1,duration:f.duration})),d(f),i()}function i(){g.offError(t),g.offLoad(a),g.offClose(n)}var o=e.pos,r=e.success,s=void 0===r?null:r,c=e.fail,u=void 0===c?null:c,h=e.complete,m=void 0===h?null:h;if(!l(o))return!1;var f={adUnitId:S.default.conf.videos[o].adUnitId,pos:o,status:"success",created:Date.now(),duration:0},g=wx.createRewardedVideoAd({adUnitId:f.adUnitId});return g.onError(t),g.onLoad(a),g.onClose(n),g.show().catch(function(e){console.log("ws.createVideo error:",e),g.load().then(function(){return g.show()})}),!0}function d(e){S.default.post({url:"/log/ad/rewardedvideo",data:e,success:function(e){S.default.log("提交激励视频数据成功：",e)},fail:function(e){S.default.log("提交激励视频数据失败：",e)}})}function c(e){var t;if(S.default.conf&&S.default.conf.games&&(S.default.conf.games[e]?t=S.default.conf.games[e]:S.default.conf.games.default&&(t=S.default.conf.games.default),t&&t.length>0)){S.default.tmp.getMoreGame||(S.default.tmp.getMoreGame={});var a=S.default.tmp.getMoreGame[e];return(!a||a>=t.length)&&(a=0),S.default.tmp.getMoreGame[e]=a+1,t[a]}}function u(e){var t;if(S.default.conf&&S.default.conf.games)if(S.default.conf.games[e]?t=S.default.conf.games[e]:S.default.conf.games.default&&(t=S.default.conf.games.default),t&&t.length>0){for(var a=[],n=0;n<t.length;n++)a.push(t[n].image);S.default.previewImage({urls:x.default.randomSort(a)})}else wx.showToast({title:"没有更多游戏！",icon:"info"});else wx.showToast({title:"没有更多游戏！",icon:"info"})}function h(e){return I&&I[e]?(I[e].showed&&p(e),I[e]):null}function m(e){for(var t in e)I[t]={pos:t,data:e[t]?e[t]:[],last:Date.now(),duration:0,total_ms:0,logs:[],showed:!0}}function f(e){var t=e.pos,a=void 0===t?"default":t,n=e.count,i=void 0===n?1:n,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=h(a);d?(I[a].showed=!0,r&&r({code:0,data:d.data,key:"SUCCESS"})):S.default.get({url:"/game/ad",data:{pos:a,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,m(t)}r&&r(e)}else s&&s(e)},fail:function(e){s&&s(e)}})}function g(e){var t=e.data,a=void 0===t?[{pos:"default",count:1}]:t,n=e.success,i=void 0===n?null:n,o=e.fail,r=void 0===o?null:o,l={},s=!1,d=!0,c=!1,u=void 0;try{for(var f,g=a[Symbol.iterator]();!(d=(f=g.next()).done);d=!0){h(f.value.pos)||(s=!0)}}catch(e){c=!0,u=e}finally{try{!d&&g.return&&g.return()}finally{if(c)throw u}}if(l&&_({ads:l}),s)S.default.post({url:"/game/ad",data:{pos:a},success:function(e){0==e.code?(e.data&&m(e.data),i&&i(e)):r&&r(e)},fail:function(e){r&&r(e)}});else{var y={},p=!0,b=!1,v=void 0;try{for(var w,x=a[Symbol.iterator]();!(p=(w=x.next()).done);p=!0){var L=w.value;I[L.pos].showed=!0,y[L.pos]=I[L.pos].data}}catch(e){b=!0,v=e}finally{try{!p&&x.return&&x.return()}finally{if(b)throw v}}i&&i({code:0,data:y,key:"SUCCESS"})}}function y(e){var t=e.pos,a=void 0===t?"default":t,n=e.count,i=void 0===n?1:n,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=e.force,c=void 0===d||d,u=h(a);!c&&u?(I[a].showed=!0,r&&r({code:0,data:u.data,key:"SUCCESS"})):S.default.get({url:"/game/ad/feature",data:{pos:a,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var t={};t[a]=e.data,m(t)}r&&r(e)}else s&&s(e)},fail:function(e){s&&s(e)}})}function p(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(){function e(e){var t=Date.now(),a=t-e.last;e.logs.push({ms:a,last:e.last,posted:!1}),e.total_ms+=a,e.last=t}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!t||I[t])if(t)e(I[t]);else for(var a in I)e(I[a])}(e),I[e]&&(I[e].showed=!1)}function b(e){function t(e){e.image?S.default.previewImage({urls:[e.image],success:function(e){S.default.log("tapGameAD, success"),d&&d(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD，ad参数内image属性缺失")}function a(e){S.default.requireSDK("2.2.0")?e.appid?wx.navigateToMiniProgram({appId:e.appid,path:e.path,success:function(e){S.default.log("tapGameAD, success"),d&&d(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD, ad参数内appid属性缺失"):e.image?t(e):S.default.alert("当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。")}var n=e.ad,i=e.pos,o=void 0===i?"default":i,r=e.redirect,l=void 0!==r&&r,s=e.success,d=void 0===s?null:s,c=e.fail,u=void 0===c?null:c,h=e.complete,m=void 0===h?null:h,f=n;I&&I[o]&&f?(function(e,t){if(!t||!t.cid||!t.id)return!1;v([{pos:e,tid:t.tid,commit:"click",data:[{cid:t.cid,id:t.id,action:t.action}]}])}(o,f),"code"==f.action?t(f):"navigate"==f.action?a(f):l?a(f):t(f)):S.default.log("tapGameAD pos无效，没有对应数据，或未传ad参数")}function v(e){S.default.post({url:"/game/ad/log",data:e,success:function(t){for(var a=0;a<e.length;a++){var n=e[a];"show"==n.commit&&n.pos in I&&(I[n.pos].logs=[])}S.default.log("广告数据提交成功！")},fail:function(e){S.default.log("广告数据提交失败！")}})}function _(e){function t(e){for(var t=[],a=0,n=null,i=0;i<e.logs.length;i++)e.logs[i].posted||(a+=e.logs[i].ms,n=e.logs[i].last);if(!a||!e.data)return t;for(var o={pos:e.pos,tid:e.data[0].tid,commit:"show",last:n,ms:a,data:[]},r=0;r<e.data.length;r++)o.data.push({id:e.data[r].id,cid:e.data[r].cid,action:e.data[r].action});return t.push(o),t}var a=e.ads,n=void 0===a?null:a,i=e.ad,o=void 0===i?null:i;if(!n&&!o)return!1;var r=[];if(n)for(var l in n)r=r.concat(t(n[l]));else o&&(r=t(o));r.length>0&&v(r)}Object.defineProperty(t,"__esModule",{value:!0});var w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initAD=function(e){e.onShow(function(){for(var t in L){var a=L[t];a.isShow&&(e.createBanner({pos:a.pos,style:a.style,ms:a.ms,onResize:a.onResize}),a.isShow=!1)}for(var n=0;n<T.length;n++){var i=T[n];I[i].showed=!0,I[i].last=Date.now()}T=[]}),e.afterHide(function(){for(var e in L){var t=L[e];t.isShow=t.showed,t.isShow&&o(t.pos),t.duration>0&&r(t)}for(var a in I)I[a].showed&&(p(a),T.push(a));_({ads:I})}),e.createBanner=e.checkSDK("2.0.4",i),e.closeBanner=e.checkSDK("2.0.4",o),e.createVideo=e.checkSDK("2.0.4",s),e.isEnableVideo=l,e.getMoreGame=c,e.showMoreGame=u,e.getGameAd=f,e.hideGameAd=p,e.tapGameAd=b,e.fetchGameAd=g,e.getPromoGameAd=y};var S=n(a(1)),x=n(a(2)),L={},C={},I={},T=[]},function(e,t,a){"use strict";function n(e,t){e[t]=function(){var a;return e.mode=t,"aldShareAppMessage"==t&&(e.mode="shareAppMessage"),(a=wx)[t].apply(a,arguments)}}Object.defineProperty(t,"__esModule",{value:!0}),t.initHook=function(e){e.setMode=function(t){e.mode=t},n(e,"previewImage"),n(e,"openCustomerServiceConversation"),n(e,"shareAppMessage"),n(e,"aldShareAppMessage")};var i;(i=a(1))&&i.__esModule},function(e,t,a){"use strict";function n(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function i(e){var t=e.pos,a=void 0===t?null:t,n=e.success,i=void 0===n?null:n,o=e.fail,r=void 0===o?null:o,l={};a&&(l.pos=a),b.default.get({url:"/invited/users/count",data:l,success:function(e){i&&i(e.data.count)},fail:function(e){r&&r(e)}})}function o(e){var t=e.pos,a=void 0===t?null:t,n=e.receive,i=void 0===n||n,o=e.skip,r=void 0===o?0:o,l=e.limit,s=void 0===l?-1:l,d=e.success,c=void 0===d?null:d,u=e.fail,h=void 0===u?null:u,m={skip:r,limit:s,receive:i};a&&(m.pos=a),b.default.get({url:"/invited/users",data:m,success:function(e){c&&c(e.data)},fail:function(e){h&&h(e)}})}function r(e){var t=e.user,a=e.pos,n=void 0===a?null:a,i=e.success,o=void 0===i?null:i,r=e.fail,l=void 0===r?null:r,s={users:[{id:t.id,gift:t.gift}]};n&&(s.pos=n),b.default.post({url:"/invited/gift/receive",data:s,success:function(e){o&&o(e.data.receive[0])},fail:function(e){l&&l(e)}})}function l(e){var t=e.users,a=e.pos,n=void 0===a?null:a,i=e.success,o=void 0===i?null:i,r=e.fail,l=void 0===r?null:r,s={users:[]},d=!0,c=!1,u=void 0;try{for(var h,m=t[Symbol.iterator]();!(d=(h=m.next()).done);d=!0){var f=h.value;s.users.push({id:f.id,gift:f.gift})}}catch(e){c=!0,u=e}finally{try{!d&&m.return&&m.return()}finally{if(c)throw u}}n&&(s.pos=n),b.default.post({url:"/invited/gift/receive",data:s,success:function(e){o&&o(e.data.receive)},fail:function(e){l&&l(e)}})}function s(e,t){if(t&&t.gift){var a={type:e,gift:t.gift,uid:t.uid,share_tid:t.share_tid},n=b.default.conf[t.gift];n&&(a.receive=!0),b.default.post({url:"/share/gift/log",data:a,success:function(e){if(n){var i=e.data;i.is_self&&n.not_allow_self?b.default.alert(n.not_allow_self_tip||"不能领取自己送出的礼物～"):i.user_count>=(n.date_limit||2)?b.default.alert(n.date_limit_tip||"今天已经领取太多次了～"):i.user_share_count>=(n.share_date_limit||1)?b.default.alert(n.share_date_limit_tip||"已经领取过该礼物了～"):i.count>=(n.limit||10)?b.default.alert(n.limit_tip||"该礼物被领光了～"):(e={gift:t.gift,query:t,conf:n,options:a,data:i},b.default._onGiftCallback&&b.default._onGiftCallback(e))}}})}}function d(e){e.from;var t=e.query;e.options,s("share",t)}function c(e){e.from,e.scene,e.options,s("code",e.query)}function u(e){b.default._onGiftCallback=e}function h(e){var t=e.gifts,a=e.users,n=void 0===a||a,i=e.receive,o=void 0===i||i,r=e.dateLimit,l=void 0===r?0:r,s=e.cache,d=void 0===s?60:s,c=e.limit,u=void 0===c?0:c,h=e.success,m=void 0===h?null:h,f=e.fail,g=void 0===f?null:f;if("boolean"==typeof n&&"boolean"==typeof o&&"number"==typeof l&&"number"==typeof d&&"number"==typeof u){var y=!0,p=[t.sort().toString(),n,o,l,u].join("-");b.default.shareGiftTempData&&b.default.shareGiftTempData[p]&&Date.now()-b.default.shareGiftTempData[p].ms<1e3*d&&(y=!1),y?b.default.post({url:"/share/gift/receive",data:{gifts:t,is_users:n,receive:o,date_limit:l,limit:u},success:function(e){b.default.shareGiftTempData[p]={data:e.data,ms:Date.now()},m&&m(e.data)},fail:g}):m&&m(b.default.shareGiftTempData[p].data)}else b.default.log("requestShareGift, 参数格式异常")}function m(e){var t=e.users,a=e.success,n=void 0===a?null:a,i=e.fail,o=void 0===i?null:i;Array.isArray(t)?b.default.post({url:"/share/gift/receive2",data:{users:t},success:function(e){n&&n(e)},fail:function(e){o&&o(e)}}):b.default.log("receiveShareGift, users参数格式错误")}function f(e){var t=e.pos,a=e.bg,i=void 0===a||a,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=n(e,["pos","bg","success","fail"]);b.default.post({url:"/share/qrcode",data:y({pos:t,bg:i,uid:b.default.user.id,share_tid:Date.now()+""},d),success:function(e){r&&r(e.data)},fail:s})}function g(e){var t=e.pos,a=e.bg,i=void 0===a||a,o=e.filePath,r=void 0===o?"":o,l=e.success,s=void 0===l?null:l,d=e.fail,c=void 0===d?null:d,u=e.complete,h=void 0===u?null:u,m=n(e,["pos","bg","filePath","success","fail","complete"]);f(y({pos:t,bg:i,success:function(e){!function(t){var a=e.codeUrl;wx.downloadFile({url:a,filePath:r,success:function(e){200==e.statusCode&&(b.default.alert("download success",e.tempFilePath),b.default.log("download success",e.tempFilePath),r||(r=e.tempFilePath,wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){s&&s(e)},fail:function(e){c&&c(e)},complete:function(e){h&&h(e)}})))},fail:function(e){c&&c(e)},complete:function(e){h&&h(e)}})}()},fail:c},m))}Object.defineProperty(t,"__esModule",{value:!0});var y=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.initInvite=function(e){e.getInviteCount=i,e.getInviteUsers=o,e.receiveInviteGift=r,e.receiveInviteGifts=l,e.openFromShare(d),e.openFromCode(c),e.onShareGift=u,e.requestShareGift=h,e.receiveShareGift=m,e.getWXACode=f,e.saveWXACode=g};var p,b=(p=a(1))&&p.__esModule?p:{default:p}},function(e,t,a){"use strict";function n(e,t){r.index+=1,r.events.push({event:e,data:t?JSON.stringify(t):null,tm:Date.now()})}Object.defineProperty(t,"__esModule",{value:!0}),t.initEvent=function(e){e.afterHide(function(){o.default.post({url:"/log/event",data:r,success:function(e){0==e.code&&(r.events=[]),o.default.log("事件日志提交成功！")},fail:function(e){o.default.log("事件日志提交失败！")}})}),e.traceEvent=n};var i,o=(i=a(1))&&i.__esModule?i:{default:i},r={index:0,events:[]}}])},{}],17:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.default=window.wx},{}],18:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=Laya.View,i=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("cannonSelect/CannonSelect")},t}(n);e.CannonSelectUI=t,i("ui.cannonSelect.CannonSelectUI",t)}(e.cannonSelect||(e.cannonSelect={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(n);e.GameSceneUI=t,i("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},t}(n);e.HomeViewUI=t,i("ui.home.HomeViewUI",t)}(e.home||(e.home={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},t}(n);e.OverViewUI=t,i("ui.over.OverViewUI",t)}(e.over||(e.over={}))}(a.ui||(a.ui={}))},{}]},{},[2]);