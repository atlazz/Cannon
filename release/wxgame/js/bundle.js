var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,a){e.__proto__=a}||function(e,a){for(var t in a)a.hasOwnProperty(t)&&(e[t]=a[t])};return function(a,t){function n(){this.constructor=a}e(a,t),a.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}}();!function(){function e(a,t,n){function i(r,l){if(!t[r]){if(!a[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var c=t[r]={exports:{}};a[r][0].call(c.exports,function(e){return i(a[r][1][e]||e)},c,c.exports,e,a,t,n)}return t[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)i(n[r]);return i}return e}()({1:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./script/runtime/CannonSelect"),i=e("./script/runtime/GameScene"),o=e("./script/runtime/HomeView"),r=e("./script/component/Reward"),l=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("script/runtime/CannonSelect.ts",n.default),e("script/runtime/GameScene.ts",i.default),e("script/runtime/HomeView.ts",o.default),e("script/component/Reward.ts",r.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="home/HomeView.scene",e.sceneRoot="",e.debug=!1,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();t.default=l,l.init()},{"./script/component/Reward":8,"./script/runtime/CannonSelect":10,"./script/runtime/GameScene":11,"./script/runtime/HomeView":12}],2:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./GameConfig"),i=e("./script/utils/wx");new(function(){function e(){if(Laya.Browser.onMiniGame){var e=i.default.getUpdateManager();e.onUpdateReady(function(){i.default.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success:function(a){a.confirm&&e.applyUpdate()}})})}window.Laya3D?Laya3D.init(n.default.width,n.default.height):Laya.init(n.default.width,n.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=n.default.scaleMode,Laya.stage.screenMode=n.default.screenMode,Laya.stage.alignV=n.default.alignV,Laya.stage.alignH=n.default.alignH,Laya.URL.exportSceneToJson=n.default.exportSceneToJson,(n.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),n.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),n.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION),Laya.stage.height=Math.round(n.default.width*Laya.Browser.height/Laya.Browser.width)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){n.default.startScene&&Laya.Scene.open(n.default.startScene)},e}())},{"./GameConfig":1,"./script/utils/wx":17}],3:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION="1.2.6",t.RewardPos={Cannon:"try_cannon",Bullet:"try_ball",Revive:"revive",Treasure:"reward_triple",Trail:"get_trail"},t.BannerPos={HomeView:"HomeView",StagePass:"missionpass",Revive:"revive"};!function(e){e[e.START=1]="START",e[e.PAUSE=2]="PAUSE",e[e.OVER=3]="OVER",e[e.BANNER_TOUCH=4]="BANNER_TOUCH"}(t.GameState||(t.GameState={})),t.URL_HomeView="home/HomeView.scene",t.URL_GameScene="game/GameScene.scene",t.URL_CannnonSelect="cannonSelect/CannonSelect.scene",t.URL_OverView="over/OverView.scene",t.CameraInitPos=new Laya.Vector3(0,.3,.2),t.CameraInitRotEuler=new Laya.Vector3(0,0,0),t.LightInitPos=new Laya.Vector3(0,5,0),t.LightInitRotEuler=new Laya.Vector3(-30,0,0),t.LightInitColor=new Laya.Vector3(1,1,1),t.StageTexUrl=["res/stage/out/materials/mutou_06.jpg","res/stage/out/materials/TNT.png","res/stage/out/materials/Glass.jpg","res/stage/out/materials/stack_texture.jpg","res/stage/out/materials/stack_texture1.jpg","res/stage/out/materials/stack_texture2.jpg","res/stage/out/materials/stack_texture3.jpg","res/stage/out/materials/stack_texture4.jpg","res/stage/out/materials/stack_texture5.jpg","res/stage/out/materials/stack_texture6.jpg"],t.StageResUrl="res/stage/out/",t.StageInitPos=new Laya.Vector3(0,0,0),t.StageInitRot=new Laya.Vector3(0,180,0),t.StageInitScale=new Laya.Vector3(20,20,20),t.StageNum=20,t.MaxWinCheckTime=30,t.SetKinematicWaitTime=10,t.BgResUrl=["res/scene/1/Scenes_02.lh","res/scene/2/Scenes_04.lh","res/scene/bg1.jpg","res/scene/bg2.jpg"],t.GlassBrokenVelocity=10,t.GlassFallingBrokenVelocity=1,t.PieceResUrl="res/cube_piece.lm",t.PiecesBrokenTime=120,t.CannonInitPos=new Laya.Vector3(0,.04,-.2),t.CannonInitRot=new Laya.Vector3(0,180,0),t.CannonInitScale=new Laya.Vector3(25,25,25),t.TurretInitLocalRot=new Laya.Vector3(0,0,0),t.CannonBallBoxUrl="res/ball_box/ball_box.lh",t.CannonBallInitPos=new Laya.Vector3(-.01,.05,-.13),t.CannonBallInitScale=new Laya.Vector3(25,25,25),t.cdnUrl="https://coolant.miniant.cn/cannon/res_v126.zip",t.soundUrl="res/audio/shoot.mp3",t.treasureUrl="res/treasure/treasure.lh",t.treasureAngleX=[-1.6,-1.4,-.8,.1,.6,1.2,1,-.8,-.45],t.treasureAngleZ=[0,.2,.5,.6,.3,.2,.1,0,.8],t.TrailUnlock={1:0,2:0,3:2,4:-1},t.BulletMeshUrl="res/bullet/bullet.lm",t.BulletEffectUrl={1:"res/bullet/boom/boomTrail.lh",2:"res/bullet/lightning/lightning.lh"},t.BulletRewardResUrl={1:"res/bullet/blackhole/blackhole.lh"},t.cannonEffectUrl={1:"res/cannon_effect/gunlightning.lh"},t.BulletRadius=.08,t.CannonSelectIconBgUrl="res/ui/cannonSelect/CannonIconBG.png",t.CannonSelectIconList=[{index:-1},{index:1,icon:"res/ui/cannonSelect/cannon_default.png"},{index:3,icon:"res/ui/cannonSelect/Cannon_10.png"},{index:7,icon:"res/ui/cannonSelect/cannon_dragon.png"},{index:2,icon:"res/ui/cannonSelect/Cannon_03.png"},{index:6,icon:"res/ui/cannonSelect/cannon_light.png"},{index:5,icon:"res/ui/cannonSelect/cannon_lion.png"},{index:4,icon:"res/ui/cannonSelect/Cannon_22.png"},{index:-1}],t.CannonSelectTextList={1:{name:"普通炮",feature:"普通的大炮，普通的威力，就很普通",unlockLvl:0,unlockDiamond:0},3:{name:"冰雪奇缘",feature:"更强的威力，将方块变成冰块",unlockLvl:5,unlockDiamond:1350},7:{name:"龙门大炮",feature:"威力超强，拥有它，你就是龙的传人",unlockLvl:11,unlockDiamond:3500},2:{name:"双重射击",feature:"两炮齐发，威力强大",unlockLvl:17,unlockDiamond:7500},6:{name:"闪电风暴",feature:"威力无比，一发入魂",unlockLvl:23,unlockDiamond:10500},5:{name:"黄金狮子头",feature:"河东狮吼，十分暴躁",unlockLvl:999,unlockDiamond:13500},4:{name:"无敌散弹炮",feature:"终极武器，用一次爽一次",unlockLvl:999,unlockDiamond:999999}},t.CannonResUrl={1:"res/cannon/Cannon_Default.lh",2:"res/cannon/Cannon_ShotgunX2.lh",3:"res/cannon/Cannon_Frozen.lh",4:"res/cannon/Cannon_Reward.lh",5:"res/cannon/Cannon_Lion.lh",6:"res/cannon/Cannon_Lightning.lh",7:"res/cannon/Cannon_Dragon.lh"},t.BulletTextureUrl={1:"res/bullet/ball_texture/ball_default.jpg",2:"res/bullet/ball_texture/shotgun.jpg",3:"res/bullet/ball_texture/ice.jpg",4:"res/bullet/ball_texture/shotgun.jpg",5:"res/bullet/ball_texture/boom.jpg",6:"res/bullet/ball_texture/lightning.jpg",7:"res/bullet/ball_texture/ball_default.jpg"},t.BulletScale={0:{1:1,2:1,3:1,4:1,5:1,6:1,7:1},1:{1:7}},t.BulletMass={0:{1:20,2:20,3:25,4:20,5:20,6:60,7:35},1:{1:100}},t.BulletVelocity={0:{1:30,2:30,3:30,4:30,5:30,6:30,7:30},1:{1:5}},t.BulletTrigger={0:{1:!1,2:!1,3:!1,4:!1,5:!1,6:!1,7:!1},1:{1:!0}},t.BulletOverrideGravity={0:{1:8,2:8,3:8,4:8,5:8,6:8,7:8},1:{1:0}}},{}],4:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={gameData:{musicEnabled:!0,soundEnabled:!0,vibrationEnabled:!0,updateTimestamp:0,videoCount:0,lastVideoTimestamp:0,shareCount:0,lastShareTimestamp:0,stageIndex:1,cannonType:1,cannonUnlockState:{},trailType:1,trailUnlockState:{},trailShowToday:!1,lastTrailShowTimestamp:0,diamond:0,tutorialStep:6,videoErr:{},getDiamond:1,treasureBannerHit:0,lastTreasureBannerHitTimestamp:0},config:{skin_block:!1,share_first:!1,allow_share:!0,allow_video:!0,share_number:5,video_number:6,share_time:30,banner_time:180,share_delay:4,online:!0,debug:!1,allow_pay:!1,allow_revive:!0,banner_delay:1,banner_delay_ratio:1,banner_delay_ratio1:.8,deny_banner:!1,share_fail:"'操作失败，请换个群'",distance_iphonex:50,banner_click_time:2,games:{},shares:{},videos:{},banners:{},try_cannon:1,try_ball:1,revive:1,get_trail:1,reward_triple:1,bulletRewardType:1,cannonRewardType:4,hasTreasure:!0,banner:"",banner_number:0,banner_delay_pass:1,banner_show_treasure:1,show_number:2,show_number_t:1,MaxTreasureBannerHit:2},user:{},audio:{volume:.5}}},{}],5:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Map={Android:{1:1,2:2,3:3,4:4,5:6,6:5,7:7,8:9,9:10,10:8,11:11,12:12,13:13,14:14,15:15,16:18,17:19,18:22,19:24,20:16,21:25,22:26,23:27,24:28,25:17,26:29,27:30,28:32,29:33,30:20,31:34,32:35,33:36,34:37,35:21,36:38,37:39,38:41,39:42,40:23,41:47,42:48,43:51,44:52,45:31,46:53,47:54,48:58,49:40,50:43,51:44,52:45,53:46,54:49,55:50,56:55,57:56,58:57,59:void 0},IOS:{1:1,2:2,3:5,4:7,5:6,6:9,7:10,8:3,9:12,10:8,11:14,12:16,13:19,14:23,15:11,16:25,17:26,18:27,19:29,20:30,21:30,22:3,23:4,24:32,25:16,26:25,27:26,28:27,29:29,30:20,31:3,32:4,33:37,34:39,35:17,36:41,37:42,38:45,39:48,40:18,41:6,42:8,43:11,44:30,45:38,46:48,47:51,48:52,49:31,50:53,51:38,52:58,53:40,54:43,55:18,56:45,57:46,58:49,59:void 0}},t.Stage={Android:{1:{1:{min:1,max:1,ball_add:10,reward:10},2:{min:2,max:2,ball_add:10,reward:10},3:{min:3,max:3,ball_add:10,reward:10},4:{min:4,max:4,ball_add:10,reward:10},5:{min:5,max:5,ball_add:8,reward:10}},2:{1:{min:6,max:6,ball_add:8,reward:15},2:{min:7,max:7,ball_add:8,reward:15},3:{min:8,max:8,ball_add:8,reward:15},4:{min:9,max:9,ball_add:8,reward:15},5:{min:10,max:10,ball_add:6,reward:15}},3:{1:{min:11,max:11,ball_add:7,reward:20},2:{min:12,max:12,ball_add:7,reward:20},3:{min:13,max:13,ball_add:7,reward:20},4:{min:14,max:14,ball_add:7,reward:20},5:{min:15,max:15,ball_add:5,reward:20}},4:{1:{min:1,max:19,ball_add:6,reward:25},2:{min:1,max:19,ball_add:6,reward:25},3:{min:1,max:19,ball_add:6,reward:25},4:{min:1,max:19,ball_add:6,reward:25},5:{min:20,max:20,ball_add:4,reward:25}},5:{1:{min:1,max:24,ball_add:5,reward:30},2:{min:1,max:24,ball_add:5,reward:30},3:{min:1,max:24,ball_add:5,reward:30},4:{min:1,max:24,ball_add:5,reward:30},5:{min:25,max:25,ball_add:3,reward:30}},6:{1:{min:5,max:29,ball_add:4,reward:35},2:{min:5,max:29,ball_add:4,reward:35},3:{min:5,max:29,ball_add:4,reward:35},4:{min:5,max:29,ball_add:4,reward:35},5:{min:30,max:30,ball_add:2,reward:35}},7:{1:{min:5,max:34,ball_add:4,reward:40},2:{min:5,max:34,ball_add:4,reward:40},3:{min:5,max:34,ball_add:4,reward:40},4:{min:5,max:34,ball_add:4,reward:40},5:{min:35,max:35,ball_add:2,reward:40}},8:{1:{min:5,max:39,ball_add:4,reward:45},2:{min:5,max:39,ball_add:4,reward:45},3:{min:5,max:39,ball_add:4,reward:45},4:{min:5,max:39,ball_add:4,reward:45},5:{min:40,max:40,ball_add:2,reward:45}},9:{1:{min:5,max:44,ball_add:3,reward:50},2:{min:5,max:44,ball_add:3,reward:50},3:{min:5,max:44,ball_add:3,reward:50},4:{min:5,max:44,ball_add:3,reward:50},5:{min:45,max:45,ball_add:1,reward:50}},10:{1:{min:5,max:48,ball_add:3,reward:55},2:{min:5,max:48,ball_add:3,reward:55},3:{min:5,max:48,ball_add:3,reward:55},4:{min:5,max:48,ball_add:3,reward:55},5:{min:49,max:49,ball_add:1,reward:55}},11:{1:{min:5,max:48,ball_add:3,reward:60},2:{min:5,max:48,ball_add:3,reward:60},3:{min:5,max:48,ball_add:3,reward:60},4:{min:5,max:48,ball_add:3,reward:60},5:{min:50,max:50,ball_add:1,reward:60}},12:{1:{min:5,max:48,ball_add:3,reward:65},2:{min:5,max:48,ball_add:3,reward:65},3:{min:5,max:48,ball_add:3,reward:65},4:{min:5,max:48,ball_add:3,reward:65},5:{min:51,max:51,ball_add:1,reward:65}},13:{1:{min:5,max:48,ball_add:2,reward:70},2:{min:5,max:48,ball_add:2,reward:70},3:{min:5,max:48,ball_add:2,reward:70},4:{min:5,max:48,ball_add:2,reward:70},5:{min:52,max:52,ball_add:1,reward:70}},14:{1:{min:5,max:48,ball_add:2,reward:75},2:{min:5,max:48,ball_add:2,reward:75},3:{min:5,max:48,ball_add:2,reward:75},4:{min:5,max:48,ball_add:2,reward:75},5:{min:53,max:53,ball_add:1,reward:75}},15:{1:{min:5,max:48,ball_add:2,reward:80},2:{min:5,max:48,ball_add:2,reward:80},3:{min:5,max:48,ball_add:2,reward:80},4:{min:5,max:48,ball_add:2,reward:80},5:{min:54,max:54,ball_add:1,reward:80}},16:{1:{min:10,max:48,ball_add:2,reward:85},2:{min:10,max:48,ball_add:2,reward:85},3:{min:10,max:48,ball_add:2,reward:85},4:{min:10,max:48,ball_add:2,reward:85},5:{min:55,max:55,ball_add:1,reward:85}},17:{1:{min:10,max:48,ball_add:2,reward:90},2:{min:10,max:48,ball_add:2,reward:90},3:{min:10,max:48,ball_add:2,reward:90},4:{min:10,max:48,ball_add:2,reward:90},5:{min:56,max:56,ball_add:1,reward:90}},18:{1:{min:10,max:48,ball_add:2,reward:95},2:{min:10,max:48,ball_add:2,reward:95},3:{min:10,max:48,ball_add:2,reward:95},4:{min:10,max:48,ball_add:2,reward:95},5:{min:57,max:57,ball_add:1,reward:95}},19:{1:{min:10,max:48,ball_add:2,reward:100},2:{min:10,max:48,ball_add:2,reward:100},3:{min:10,max:48,ball_add:2,reward:100},4:{min:10,max:48,ball_add:2,reward:100},5:{min:58,max:58,ball_add:1,reward:100}},20:{1:{min:10,max:48,ball_add:1,reward:105},2:{min:10,max:48,ball_add:1,reward:105},3:{min:10,max:48,ball_add:1,reward:105},4:{min:10,max:48,ball_add:1,reward:105},5:{min:49,max:58,ball_add:0,reward:105}}},IOS:{1:{1:{min:1,max:1,ball_add:10,reward:10},2:{min:2,max:2,ball_add:10,reward:10},3:{min:3,max:3,ball_add:10,reward:10},4:{min:4,max:4,ball_add:10,reward:10},5:{min:5,max:5,ball_add:8,reward:10}},2:{1:{min:6,max:6,ball_add:8,reward:15},2:{min:7,max:7,ball_add:8,reward:15},3:{min:8,max:8,ball_add:8,reward:15},4:{min:9,max:9,ball_add:8,reward:15},5:{min:10,max:10,ball_add:6,reward:15}},3:{1:{min:11,max:11,ball_add:7,reward:20},2:{min:12,max:12,ball_add:7,reward:20},3:{min:13,max:13,ball_add:7,reward:20},4:{min:14,max:14,ball_add:7,reward:20},5:{min:15,max:15,ball_add:5,reward:20}},4:{1:{min:1,max:19,ball_add:6,reward:25},2:{min:1,max:19,ball_add:6,reward:25},3:{min:1,max:19,ball_add:6,reward:25},4:{min:1,max:19,ball_add:6,reward:25},5:{min:20,max:20,ball_add:4,reward:25}},5:{1:{min:1,max:24,ball_add:5,reward:30},2:{min:1,max:24,ball_add:5,reward:30},3:{min:1,max:24,ball_add:5,reward:30},4:{min:1,max:24,ball_add:5,reward:30},5:{min:25,max:25,ball_add:3,reward:30}},6:{1:{min:5,max:29,ball_add:4,reward:35},2:{min:5,max:29,ball_add:4,reward:35},3:{min:5,max:29,ball_add:4,reward:35},4:{min:5,max:29,ball_add:4,reward:35},5:{min:30,max:30,ball_add:2,reward:35}},7:{1:{min:5,max:34,ball_add:4,reward:40},2:{min:5,max:34,ball_add:4,reward:40},3:{min:5,max:34,ball_add:4,reward:40},4:{min:5,max:34,ball_add:4,reward:40},5:{min:35,max:35,ball_add:2,reward:40}},8:{1:{min:5,max:39,ball_add:4,reward:45},2:{min:5,max:39,ball_add:4,reward:45},3:{min:5,max:39,ball_add:4,reward:45},4:{min:5,max:39,ball_add:4,reward:45},5:{min:40,max:40,ball_add:2,reward:45}},9:{1:{min:10,max:44,ball_add:3,reward:50},2:{min:10,max:44,ball_add:3,reward:50},3:{min:10,max:44,ball_add:3,reward:50},4:{min:10,max:44,ball_add:3,reward:50},5:{min:45,max:45,ball_add:1,reward:50}},10:{1:{min:10,max:49,ball_add:3,reward:55},2:{min:10,max:49,ball_add:3,reward:55},3:{min:10,max:49,ball_add:3,reward:55},4:{min:10,max:49,ball_add:3,reward:55},5:{min:50,max:50,ball_add:1,reward:55}},11:{1:{min:10,max:54,ball_add:3,reward:60},2:{min:10,max:54,ball_add:3,reward:60},3:{min:10,max:54,ball_add:3,reward:60},4:{min:10,max:54,ball_add:3,reward:60},5:{min:55,max:55,ball_add:1,reward:60}},12:{1:{min:10,max:54,ball_add:3,reward:65},2:{min:10,max:54,ball_add:3,reward:65},3:{min:10,max:54,ball_add:3,reward:65},4:{min:10,max:54,ball_add:3,reward:65},5:{min:35,max:58,ball_add:1,reward:65}},13:{1:{min:10,max:54,ball_add:2,reward:70},2:{min:10,max:54,ball_add:2,reward:70},3:{min:10,max:54,ball_add:2,reward:70},4:{min:10,max:54,ball_add:2,reward:70},5:{min:35,max:58,ball_add:1,reward:70}},14:{1:{min:10,max:54,ball_add:2,reward:75},2:{min:10,max:54,ball_add:2,reward:75},3:{min:10,max:54,ball_add:2,reward:75},4:{min:10,max:54,ball_add:2,reward:75},5:{min:35,max:58,ball_add:1,reward:75}},15:{1:{min:10,max:54,ball_add:2,reward:80},2:{min:10,max:54,ball_add:2,reward:80},3:{min:10,max:54,ball_add:2,reward:80},4:{min:10,max:54,ball_add:2,reward:80},5:{min:35,max:58,ball_add:1,reward:80}},16:{1:{min:10,max:54,ball_add:2,reward:85},2:{min:10,max:54,ball_add:2,reward:85},3:{min:10,max:54,ball_add:2,reward:85},4:{min:10,max:54,ball_add:2,reward:85},5:{min:35,max:58,ball_add:1,reward:85}},17:{1:{min:10,max:54,ball_add:2,reward:90},2:{min:10,max:54,ball_add:2,reward:90},3:{min:10,max:54,ball_add:2,reward:90},4:{min:10,max:54,ball_add:2,reward:90},5:{min:35,max:58,ball_add:1,reward:90}},18:{1:{min:10,max:54,ball_add:2,reward:95},2:{min:10,max:54,ball_add:2,reward:95},3:{min:10,max:54,ball_add:2,reward:95},4:{min:10,max:54,ball_add:2,reward:95},5:{min:35,max:58,ball_add:1,reward:95}},19:{1:{min:10,max:54,ball_add:2,reward:100},2:{min:10,max:54,ball_add:2,reward:100},3:{min:10,max:54,ball_add:2,reward:100},4:{min:10,max:54,ball_add:2,reward:100},5:{min:35,max:58,ball_add:1,reward:100}},20:{1:{min:10,max:54,ball_add:1,reward:105},2:{min:10,max:54,ball_add:1,reward:105},3:{min:10,max:54,ball_add:1,reward:105},4:{min:10,max:54,ball_add:1,reward:105},5:{min:35,max:58,ball_add:0,reward:105}}}},t.StageRaw={1:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},2:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},3:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},4:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},5:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},6:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},7:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},8:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},9:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},10:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},11:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},12:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},13:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},14:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},15:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},16:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},17:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},18:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},19:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},20:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},21:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},22:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},23:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},24:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},25:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},26:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},27:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},28:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},29:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},30:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},31:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},32:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},33:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},34:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},35:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},36:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},37:{ball_num:2,rotate:!0,move_x:!0,move_y:!0,move_z:!0},38:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},39:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},40:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},41:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},42:{ball_num:1,rotate:!0,move_x:!0,move_y:!0,move_z:!0},43:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},44:{ball_num:6,rotate:!0,move_x:!0,move_y:!0,move_z:!0},45:{ball_num:4,rotate:!0,move_x:!0,move_y:!0,move_z:!0},46:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},47:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},48:{ball_num:9,rotate:!0,move_x:!0,move_y:!0,move_z:!0},49:{ball_num:8,rotate:!0,move_x:!0,move_y:!0,move_z:!0},50:{ball_num:7,rotate:!0,move_x:!0,move_y:!0,move_z:!0},51:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},52:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0},53:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},54:{ball_num:5,rotate:!0,move_x:!0,move_y:!0,move_z:!0},55:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},56:{ball_num:14,rotate:!0,move_x:!0,move_y:!0,move_z:!0},57:{ball_num:15,rotate:!0,move_x:!0,move_y:!0,move_z:!0},58:{ball_num:3,rotate:!0,move_x:!0,move_y:!0,move_z:!0}},t.StageReward={1:150,2:200,3:250,4:300,5:350,6:400,7:450,8:500,9:550,10:600,11:650,12:700,13:750,14:800,15:850,16:900,17:950,18:1e3,19:1050,20:1100,21:1150,22:1200,23:1250,24:1300,25:1350,26:1400,27:1450,28:1500,29:1550,30:1600,31:1650,32:1700,33:1750,34:1800,35:1850,36:1900,37:1950,38:2e3,39:2050},t.StageTexture={1:3,2:4,3:5,4:6,5:7,6:8,7:9,8:999,9:999,10:999,11:999,12:999,13:999,14:999,15:999,16:999,17:999,18:999,19:999,20:999}},{}],6:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../runtime/GameScene"),i=e("../Const"),o=e("./Target"),r=e("./Guard"),l=function(e){function a(){var a=e.call(this)||this;return a.isReward=!1,a.collisionBlackList=["bullet","player"],a}return __extends(a,e),a.prototype.onAwake=function(){this.bullet||(this.bullet=this.owner)},a.prototype.init=function(){this.rigidbody=this.bullet.addComponent(Laya.Rigidbody3D),this.rigidbody.colliderShape=new Laya.SphereColliderShape(i.BulletRadius),this.material=new Laya.PBRSpecularMaterial,this.bullet.meshRenderer.material=this.material},a.prototype.reset=function(e,a){var t=this;void 0===a&&(a=!1),this.bullet=this.owner,this.isReward=a,this.type=e,this.effect=this.bullet.getChildByName("effect"),this.lifetime=120,this.isReward&&1===this.type&&(this.lifetime=300),this.flag_active=!1,void 0===this.rigidbody&&this.init(),this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_FADE,this.material.albedoColorA=0,this.isReward||Laya.Texture2D.load(i.BulletTextureUrl[this.type],Laya.Handler.create(this,function(e){t.material.albedoTexture=e})),this.effect&&(this.effect.active=!1),this.bullet.transform.localPosition=n.default.instance.turretInitPos.clone(),this.bullet.transform.localRotationEuler=i.StageInitRot.clone(),Laya.Vector3.scale(new Laya.Vector3(1,1,1),i.BulletScale[+this.isReward][this.type],this.bullet.transform.localScale),this.effect&&Laya.Vector3.scale(this.effect.transform.localScale,1/i.BulletScale[+this.isReward][this.type],this.effect.transform.localScale),this.rigidbody.isTrigger=i.BulletTrigger[+this.isReward][this.type],this.rigidbody.ccdMotionThreshold=.001,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type],this.rigidbody.mass=i.BulletMass[+this.isReward][this.type];var o=n.default.instance.bulletDirection.clone();Laya.Vector3.scale(o,i.BulletVelocity[+this.isReward][this.type],o),this.rigidbody.linearVelocity=o,this.rigidbody.overrideGravity=!0,this.rigidbody.gravity=new Laya.Vector3(0,-i.BulletOverrideGravity[+this.isReward][this.type],0),this.rigidbody.canCollideWith=1,this.rigidbody.collisionGroup=4,"bulletTrigger"===this.bullet.name&&(this.rigidbody.isTrigger=!0,this.rigidbody.collisionGroup=5,this.rigidbody.ccdMotionThreshold=1e-4,this.rigidbody.ccdSweptSphereRadius=i.BulletRadius*i.BulletScale[+this.isReward][this.type]/1e3)},a.prototype.onTriggerEnter=function(e){this.triggerHandler(e)},a.prototype.onTriggerExit=function(e){"bulletTrigger"===this.bullet.name&&this.recover()},a.prototype.triggerHandler=function(e){if("bottom"===e.owner.name){if(!n.default.instance)return;n.default.instance.treasureFrameCnt>=300&&(n.default.instance.treasureHitCnt=n.default.instance.treasereMaxHitCnt),0===n.default.instance.treasureHitState&&(n.default.instance.treasureHitState=1),n.default.instance.isTreasureMoveStart=!0,n.default.instance.isTreasureHit=!0,n.default.instance.treasureHitCnt++,this.recover()}if(this.isReward&&1===this.type){n.default.instance.isStageStart=!0;var a=e.owner;if("stand"===a.name||a.name.indexOf("Guard")>=0||a.name.indexOf("Obstacle")>=0){a.timer.frameOnce(1,this,function(){a.getComponent(Laya.PhysicsCollider)&&a.getComponent(Laya.PhysicsCollider).destroy(),a.getComponent(Laya.Rigidbody3D)&&a.getComponent(Laya.Rigidbody3D).destroy(),a.getComponent(o.default)&&a.getComponent(o.default).destroy(),a.getComponent(r.default)&&a.getComponent(r.default).destroy()});var t=0,i=a.transform.localScaleX/120,l=a.transform.localScaleY/120,s=a.transform.localScaleZ/120,d=(this.bullet.transform.position.x-a.transform.position.x)/120/n.default.instance.gameStage.transform.scale.x,c=(this.bullet.transform.position.y-a.transform.position.y)/120/n.default.instance.gameStage.transform.scale.y,u=(this.bullet.transform.position.z-a.transform.position.z)/120/n.default.instance.gameStage.transform.scale.z,h=5*Math.random(),m=5*Math.random(),f=5*Math.random();a.timer.frameLoop(1,a,function(){if(t++>60)return a.timer.clearAll(a),void a.destroy();a.transform.localScaleX-=i,a.transform.localScaleY-=l,a.transform.localScaleZ-=s,a.transform.localPositionX-=d,a.transform.localPositionY+=c,a.transform.localPositionZ-=u,a.transform.localRotationEulerX+=h,a.transform.localRotationEulerY+=m,a.transform.localRotationEulerZ+=f})}}},a.prototype.onUpdate=function(){this.lifetime--,this.lifetime<0&&this.recover(),"bullet"===this.bullet.name&&!this.flag_active&&this.bullet.transform.position.z<-1&&(this.flag_active=!0,this.refreshMaterial(),this.effect&&(this.effect.active=!0)),this.effect&&!this.rigidbody.isTrigger&&(this.effect.transform.localRotationEulerX=-this.bullet.transform.localRotationEulerX,this.effect.transform.localRotationEulerY=-this.bullet.transform.localRotationEulerY,this.effect.transform.localRotationEulerZ=-this.bullet.transform.localRotationEulerZ)},a.prototype.refreshMaterial=function(){this.isReward||(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,this.material.albedoColorA=1)},a.prototype.recover=function(){var e=this;this.isReward?Laya.timer.frameOnce(1,this,function(){e.bullet.destroy(),e.destroy()}):Laya.timer.frameOnce(1,this,function(){e.rigidbody.clearForces();var a=e.bullet.getChildByName("effect");a&&a.destroy&&a.destroy(),e.bullet.removeChildByName("effect");var t=e.bullet.getChildByName("trail");t&&t.destroy&&t.destroy(),e.bullet.removeChildByName("trail"),e.bullet.removeSelf(),"bulletTrigger"===e.bullet.name?Laya.Pool.recover("bulletTrigger",e.bullet):Laya.Pool.recover("bullet",e.bullet)})},a}(Laya.Script3D);t.default=l},{"../Const":3,"../runtime/GameScene":11,"./Guard":7,"./Target":9}],7:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../Const"),i=function(e){function a(){var a=e.call(this)||this;return a.moveTimes=0,a}return __extends(a,e),a.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.bounds;this.sizeX=e.getMax().x-e.getMin().x,this.sizeY=e.getMax().y-e.getMin().y,this.sizeZ=e.getMax().z-e.getMin().z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);var a=new Laya.PBRSpecularMaterial;if(Laya.Texture2D.load(n.StageTexUrl[0],Laya.Handler.create(this,function(e){a.albedoTexture=e})),a.specularColor=new Laya.Vector4(0,0,0,1),a.enableEmission=!0,a.emissionColor=new Laya.Vector4(.2,.2,.2,1),this.guard.meshRenderer.material=a,this.guard.name.search("move_x")>=0)this.MaxMoveTimes=120,this.moveStepY=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepX=2*this.guard.transform.localPositionY/this.MaxMoveTimes:this.moveStepX=2*this.guard.transform.localPositionX/this.MaxMoveTimes;else if(this.guard.name.search("move_y")>=0)this.MaxMoveTimes=120,this.moveStepX=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepY=2*this.guard.transform.localPositionX/this.MaxMoveTimes:this.moveStepY=2*this.guard.transform.localPositionY/this.MaxMoveTimes;else if(this.guard.name.search("move_")>=0){this.MaxMoveTimes=60;var t=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,i=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var o=t;t=i,i=o}this.guard.name.search("move_left")>=0?(this.moveStepX=-t,this.moveStepY=0):this.guard.name.search("move_right")>=0?(this.MaxMoveTimes=60,this.moveStepX=t,this.moveStepY=0):this.guard.name.search("move_up")>=0?(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=-i):this.guard.name.search("move_down")>=0&&(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=i)}},a.prototype.onUpdate=function(){this.guard.destroyed?this.destroy():this.guard.name.search("move")>=0?(this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes),this.flag_move=Math.floor(this.moveTimes/this.MaxMoveTimes%2)>0,this.flag_move?(this.guard.transform.localPositionX+=this.moveStepX,this.guard.transform.localPositionY+=this.moveStepY):(this.guard.transform.localPositionX-=this.moveStepX,this.guard.transform.localPositionY-=this.moveStepY)):this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)},a}(Laya.Script3D);t.default=i},{"../Const":3}],8:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../utils/wx"),i=e("../utils/ws.js"),o=e("../utils/Ad"),r=e("../Global"),l=function(e){function a(){var t=e.call(this)||this;return t.shareTimestampMap={},t.lastShareTimestamp=0,console.log("Reward constructor()"),a.instance=t,t}return __extends(a,e),a.prototype.onAwake=function(){var e=this;console.log("Reward onAwake()"),Laya.Browser.onMiniGame&&n.default.onShow(function(a){var t=e.shareArgs;if(t&&t.length){var i=t[0]||{},o=i.pos,l=i.success,s=i.fail,d=i.complete;try{var c=Date.now();l||s?c-e.lastShareTimestamp>1e3*(r.default.config.share_delay||5)?(r.default.gameData.shareCount++,r.default.gameData.lastShareTimestamp=c,e.shareTimestampMap[o]=c,l&&l(a),d&&d(a)):(e.shareTimestampMap[o]=0,n.default.showModal({title:"提示",content:r.default.config.share_fail,cancelText:"知道了",confirmText:"重新发送",success:function(n){n.confirm?e.share.apply(e,t):(s&&s(a),d&&d(a))}})):(e.shareTimestampMap[o]=0,d&&d(a))}finally{e.lastShareTimestamp=0,e.shareArgs=null}}})},a.prototype.reward=function(e){var a=e.pos,t=e.query,n=e.success,i=e.fail,o=e.complete;this.isShareState(a)?this.share({pos:a,query:t,success:n,fail:i,complete:o}):this.video({pos:a,success:n,fail:i,complete:o})},a.prototype.share=function(e){var a=e.pos,t=e.query,n=e.success,o=e.fail,l=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),o&&o(),void(l&&l());if(!this.isOnline()||!this.allowShare(a))return console.log("share not allowed"),o&&o(),void(l&&l());var s=Date.now(),d=Number(this.shareTimestampMap[a]);if(d&&s-d<1e3*r.default.config.share_time)return console.log("请稍等一会再操作"),o&&o(),void(l&&l());(n||o)&&(this.shareTimestampMap[a]=s),this.lastShareTimestamp=Date.now(),this.shareArgs=arguments,i.default.share({pos:a,query:t})},a.prototype.video=function(e){var a=e.pos,t=e.success,n=e.fail,i=e.complete;if(!Laya.Browser.onMiniGame)return console.log("Laya.Browser.onMiniGame = false"),n&&n(),void(i&&i());o.posShowVideo(a,function(){console.log("今日视频已看完"),n&&n(),i&&i()},function(e){e&&e.isEnded||void 0===e?(r.default.gameData.videoCount++,r.default.gameData.lastVideoTimestamp=Date.now(),t&&t()):e&&!e.isEnded||n&&n(),i&&i()})},a.prototype.allowShare=function(e){var a=r.default.config[e+"_allow_share"];return"boolean"==typeof a?a:r.default.config.allow_share},a.prototype.allowVideo=function(e){var a=r.default.config[e+"_allow_video"];return"boolean"==typeof a?a:r.default.config.allow_video},a.prototype.isOnline=function(){return r.default.config.online},a.prototype.isShareFirst=function(e){var a=r.default.config[e+"_share_first"];return"boolean"==typeof a?a:r.default.config.share_first},a.prototype.getShareCount=function(){var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastShareTimestamp||r.default.gameData.lastShareTimestamp<a)&&(r.default.gameData.shareCount=0),r.default.gameData.shareCount},a.prototype.isOverShare=function(){return r.default.config.share_number&&r.default.config.share_number<=this.getShareCount()},a.prototype.getVideoCount=function(){var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();return(!r.default.gameData.lastVideoTimestamp||r.default.gameData.lastVideoTimestamp<a)&&(r.default.gameData.videoCount=0),r.default.gameData.videoCount},a.prototype.isOverVideo=function(){return r.default.config.video_number&&r.default.config.video_number<=this.getVideoCount()},a.prototype.hasVideo=function(){return o.hasVideoAd()},a.prototype.isShareState=function(e){return!(!this.isOnline()||!this.allowShare(e))&&(!this.allowVideo(e)||!this.hasVideo()||(this.isShareFirst(e)?!this.isOverShare()||this.isOverVideo():this.isOverVideo()))},a}(Laya.Script);t.default=l},{"../Global":4,"../utils/Ad":13,"../utils/ws.js":16,"../utils/wx":17}],9:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../Const"),i=e("../runtime/HomeView"),o=e("../runtime/GameScene"),r=e("../component/Bullet"),l=function(e){function a(){var a=e.call(this)||this;return a.type=1,a.collisionWhiteList=["bullet","Obstacle"],a.jumpCnt=0,a.isOnGround=!1,a.isBroken=!1,a}return __extends(a,e),a.prototype.onAwake=function(){var e=this;this.target=this.owner,this.setRigidbody(),Laya.timer.frameOnce(n.SetKinematicWaitTime,this,function(){o.default.instance.isStageStart||(e.rigidbody.isKinematic=!0)})},a.prototype.onCollisionEnter=function(e){this.collisionHandler(e)},a.prototype.onCollisionStay=function(e){this.collisionHandler(e)},a.prototype.onCollisionExit=function(e){this.collisionHandler(e)},a.prototype.collisionHandler=function(e){for(var a=this,t=e.other.owner,i=!1,l=0,s=this.collisionWhiteList;l<s.length;l++){var d=s[l];if(t.name.indexOf(d)>=0){i=!0;break}}if(2===this.type){if(this.jumpCnt>60){(h=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)))>=n.GlassFallingBrokenVelocity&&this.broken()}if(i){var c=new Laya.Vector3(0,0,0),u=t.getComponent(Laya.Rigidbody3D);u&&(c=u.linearVelocity.clone());var h=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)),m=Laya.Vector3.distance(c,new Laya.Vector3(0,0,0));(h>=n.GlassBrokenVelocity||m>=n.GlassBrokenVelocity)&&this.broken()}else"ground"!==t.name&&"bomb"!==t.name||this.broken()}else if(3===this.type&&this.target.parent)if(t.name.indexOf("bullet")>=0||t.name.indexOf("bomb")>=0)this.TNTBomb();else{var f=t.getComponent(Laya.Rigidbody3D),c=new Laya.Vector3(0,0,0);f&&(c=f.linearVelocity.clone()),Laya.Vector3.distance(c,this.rigidbody.linearVelocity)>=10&&this.TNTBomb()}if("stand"===t.name||t.name.indexOf("Guard")>=0)this.isOnGround||(o.default.instance.winCheckCnt=0);else if("ground"===t.name)this.isOnGround=!0,Laya.timer.frameOnce(60,this,function(){a.destroy(),a.target&&a.target.destroy()});else if("bullet"===t.name||"bulletTrigger"===t.name)this.bulletHit(t.getComponent(r.default));else if("bomb"===t.name){var g=new Laya.Vector3;Laya.Vector3.subtract(this.target.transform.position,t.transform.position,g),Laya.Vector3.normalize(g,g),Laya.Vector3.scale(g,20/t.transform.localScaleX,g),Laya.Vector3.add(this.rigidbody.linearVelocity,g,g),this.rigidbody.linearVelocity=g}this.jumpCnt=0},a.prototype.TNTBomb=function(){var e=this,a=this.sizeX/2*this.target.transform.localScaleX*1,t=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(a));o.default.instance.scene3D.addChild(t),t.name="bomb";var n=t.addComponent(Laya.PhysicsCollider);n.colliderShape=new Laya.SphereColliderShape(a),n.isTrigger=!0,n.collisionGroup=3,n.canCollideWith=1,t.transform.position=this.target.transform.position.clone(),t.transform.scale=this.target.transform.scale.clone();var i=new Laya.UnlitMaterial;t.meshRenderer.material=i,i.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,i.albedoColor=new Laya.Vector4(1,.5,0,.2),this.target.removeSelf();var r=0,l=.4*t.transform.localScaleX,s=.4*t.transform.localScaleY,d=.4*t.transform.localScaleZ;t.timer.frameLoop(1,t,function(){if(r++>15)return t.timer.clearAll(t),t.destroy(),e.target&&e.target.destroy(),void e.destroy();t.transform.localScaleX+=l,t.transform.localScaleY+=s,t.transform.localScaleZ+=d})},a.prototype.bulletHit=function(e){e&&!e.isReward&&3===e.type&&2!==this.type&&this.setType(2)},a.prototype.onUpdate=function(){this.target.destroyed?this.destroy():(this.rigidbody.isKinematic&&o.default.instance.isStageStart&&(this.rigidbody.isKinematic=!1),this.jumpCnt++,this.refreshRenderMode(),!this.isOnGround&&this.jumpCnt<=60&&(this.distance=Laya.Vector3.distance(this.target.transform.position,o.default.instance.gameStage.transform.position),this.distance<15&&(o.default.instance.winCheckCnt=0)),this.rigidbody.destroyed||0!=this.rigidbody.isActive||(console.log("Physics_engine_bug_fixing: Reset rigidbody."),this.refreshRigidbody()))},a.prototype.refreshRenderMode=function(){2===this.type?this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT:this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE},a.prototype.refreshRigidbody=function(){this.rigidbody&&(console.log("refresh rigidbody"),this.rigidbody.destroy(),this.setRigidbody())},a.prototype.setType=function(e){var a=this;this.type=e,this.material=this.target.meshRenderer.material,this.material||(this.material=new Laya.PBRSpecularMaterial,this.target.meshRenderer.material=this.material),1===this.type?(Laya.Texture2D.load(n.StageTexUrl[o.default.instance.textureIdx],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)):2===this.type?(Laya.Texture2D.load(n.StageTexUrl[2],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.material.albedoColor=new Laya.Vector4(1,1,1,.7),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.2,.2,.2,1)):3===this.type&&(Laya.Texture2D.load(n.StageTexUrl[1],Laya.Handler.create(this,function(e){a.material.albedoTexture=e})),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)),this.refreshRenderMode()},a.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.bounds;if(this.sizeX=e.getMax().x-e.getMin().x,this.sizeY=e.getMax().y-e.getMin().y,this.sizeZ=e.getMax().z-e.getMin().z,this.rigidbody=this.target.addComponent(Laya.Rigidbody3D),this.target.name.search("Cube")>=0)this.rigidbody.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else if(this.target.name.search("Cylinder")>=0)this.rigidbody.colliderShape=new Laya.CylinderColliderShape(this.sizeX/2,this.sizeY);else{var a=new Laya.MeshColliderShape;a.mesh=this.target.meshFilter.sharedMesh,this.rigidbody.colliderShape=a}this.setPhysicsParam()},a.prototype.setPhysicsParam=function(){this.rigidbody.isKinematic=!1,1===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):2===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):3===this.type&&(this.rigidbody.mass=50,this.rigidbody.friction=100)},a.prototype.broken=function(){var e=this;this.isBroken||(this.isBroken=!0,this.effectPiecesBroken(),Laya.timer.frameOnce(2,this,function(){e.target.active=!1}))},a.prototype.effectPiecesBroken=function(){var e=this;Laya.Mesh.load(n.PieceResUrl,Laya.Handler.create(this,function(a){var t;t="IOS"==i.default.instance.systemName?3-Math.round(Math.random()):5-Math.round(3*Math.random());for(var r=function(t){var i=new Laya.MeshSprite3D(a);i.name="piece";var r=new Laya.PBRSpecularMaterial;r.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,r.albedoColor=new Laya.Vector4(1,1,1,.7),r.specularColor=new Laya.Vector4(0,0,0,1),r.enableEmission=!0,r.emissionColor=new Laya.Vector4(.2,.2,.2,1),i.meshRenderer.material=r,Laya.Texture2D.load(n.StageTexUrl[2],Laya.Handler.create(e,function(e){i.meshRenderer.material.albedoTexture=e}));var l=i.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=i.meshFilter.sharedMesh,l.colliderShape=s,l.collisionGroup=2,l.canCollideWith=1,o.default.instance.scene3D.addChild(i),o.default.instance.piecesList.push(i);var d=1.5*(.5*Math.random()+.5)*e.sizeX*e.target.transform.localScaleX*n.StageInitScale.x,c=1.5*(.5*Math.random()+.5)*e.sizeY*e.target.transform.localScaleY*n.StageInitScale.y,u=1.5*(.5*Math.random()+.5)*e.sizeZ*e.target.transform.localScaleZ*n.StageInitScale.z;i.transform.localScale=new Laya.Vector3(d,c,u),i.transform.localRotationEulerX=2*(Math.random()-.5)*90,i.transform.localRotationEulerY=2*(Math.random()-.5)*90,i.transform.localRotationEulerZ=2*(Math.random()-.5)*90;var h=new Laya.Vector3;h.x=(Math.random()-.5)*n.StageInitScale.x/80,h.y=(Math.random()-.5)*n.StageInitScale.y/80,h.z=(Math.random()-.5)*n.StageInitScale.z/80,i.transform.position=e.target.transform.position.clone(),Laya.Vector3.add(i.transform.localPosition,h,i.transform.localPosition),Laya.Vector3.scale(h,50,h),Laya.Vector3.add(h,e.rigidbody.linearVelocity,h),i.getComponent(Laya.Rigidbody3D).linearVelocity=h.clone(),Laya.Tween.to(i.transform.localScale,{x:d/2,y:c/2,z:u/2},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(i.meshRenderer.material,{albedoColorA:0},n.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(e,function(){i.destroy()}))},l=0;l<t;l++)r()}))},a}(Laya.Script3D);t.default=l},{"../Const":3,"../component/Bullet":6,"../runtime/GameScene":11,"../runtime/HomeView":12}],10:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),r=e("../utils/ws.js"),l=e("../component/Reward"),s=e("./HomeView"),d=e("./GameScene"),c=function(e){function a(){var t=e.call(this)||this;return t.isReward=!1,t.downFlag=!1,t.startIdx=0,t.selectedScaleAdd=.35,console.log("CannonSelect constructor()"),a.instance=t,t}return __extends(a,e),a.openInstance=function(e){a.instance?a.instance.onOpened(e):Laya.Scene.open(i.URL_CannnonSelect,!1,e)},a.prototype.onOpened=function(e){console.log("CannonSelect onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.isClick=!1,this.selectType&&d.default.instance&&d.default.instance.isRewardCannon?(d.default.instance&&d.default.instance.isRewardCannon||this.isReward)&&(this.selectType=d.default.instance.cannonType,this.isReward=!0):this.selectType=o.default.gameData.cannonType;for(var a=1;a<=i.CannonSelectIconList.length-2;a++)o.default.gameData.cannonUnlockState[i.CannonSelectIconList[a].index]||(o.default.gameData.cannonUnlockState[i.CannonSelectIconList[a].index]=!1,o.default.gameData.stageIndex>i.CannonSelectTextList[i.CannonSelectIconList[a].index].unlockLvl&&(o.default.gameData.cannonUnlockState[i.CannonSelectIconList[a].index]=!0)),i.CannonSelectIconList[a].index===this.selectType&&(this.list_Icon.selectedIndex=a);if(this.updateScroll(),this.updateUI(),d.default.instance&&2===d.default.instance.stageIdx&&1===d.default.instance.missionIdx&&5===o.default.gameData.tutorialStep){this.tutorial_slide.visible=!0;var t=this.tutorial_slide.getChildByName("finger");t.timer.frameLoop(1,t,function(){t.right+=3,t.alpha=1-(t.right-80)/210,t.right>=280&&(t.right=50,t.alpha=1)})}this.text_diamond.changeText(""+o.default.gameData.diamond),this.icon_diamond.visible=!0},a.prototype.onAwake=function(){this.initCannonList(),this.initScene3D(),this.scene3D.input.multiTouchEnabled=!1},a.prototype.onEnable=function(){this.bindButtons()},a.prototype.initCannonList=function(){var e=this;this.list_Icon.renderHandler=Laya.Handler.create(this,function(a,t){var n=e.list_Icon.array[t];if(n&&-1!==n.index){a.visible=!0;var o=a.getChildByName("iconBg");o&&(o.skin=i.CannonSelectIconBgUrl);var r=a.getChildByName("iconImage");r&&(r.skin=n.icon)}else a.visible=!1},[],!1),this.list_Icon.hScrollBarSkin="",this.list_Icon.array=i.CannonSelectIconList,this.list_Icon.refresh()},a.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=new Laya.Vector3(0,0,0),this.camera.transform.localRotationEuler=new Laya.Vector3(-30,0,0),this.camera.clearColor=new Laya.Vector4(239/255,169/255,171/255,1),this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},a.prototype.newCannon=function(){var e=this;this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[i.CannonSelectIconList[this.list_Icon.selectedIndex].index],Laya.Handler.create(this,function(a){e.cannon&&e.cannon.destroy(),e.scene3D.removeChildByName("cannon"),e.cannon=a.clone(),e.cannon.name="cannon",e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=new Laya.Vector3(0,-.23,-.5),e.cannon.transform.localRotationEuler=new Laya.Vector3(0,-135,0),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.box_scene3D.timer.frameLoop(1,e,e.cannonAniLoop)}))},a.prototype.refreshText=function(){var e;if(!((e=this.list_Icon.selectedIndex)<1||e>i.CannonSelectIconList.length-2)){var a=i.CannonSelectIconList[e].index;this.label_name.changeText(i.CannonSelectTextList[a].name),this.label_feature.changeText(i.CannonSelectTextList[a].feature),o.default.gameData.cannonUnlockState[a]?(this.label_unlockMsg.changeText("已解锁"),this.isReward||this.selectType!==a?this.btn_select.gray=!1:this.btn_select.gray=!0,this.btn_select.visible=!0,this.btn_unlock.visible=!1,this.btn_try.visible=!1):(i.CannonSelectTextList[a].unlockLvl>=999?(this.label_unlockMsg.changeText("敬请期待"),this.btn_try.visible=!1):(this.label_unlockMsg.changeText("完成关卡 "+(o.default.gameData.stageIndex-1)+"/"+i.CannonSelectTextList[a].unlockLvl+" 自动解锁"),this.btn_try.visible=!0),this.btn_select.visible=!1,this.btn_unlock.visible=!0,this.isReward&&this.selectType===a?(this.btn_try.gray=!0,this.label_try.changeText("正在试用")):(this.btn_try.gray=!1,this.label_try.changeText("免费试用")),this.icon_unlockDiamond.visible=!0,this.label_unlockDiamond.changeText(i.CannonSelectTextList[a].unlockDiamond+"解锁"),o.default.gameData.diamond>=i.CannonSelectTextList[a].unlockDiamond?this.btn_unlock.gray=!1:this.btn_unlock.gray=!0)}},a.prototype.refreshIcon=function(){var e,a,t,n=this.list_Icon.selectedIndex;if(!(n<1||n>i.CannonSelectIconList.length-2)){this.arrowLeft.visible=!0,this.arrowRight.visible=!0;for(var r=0;r<=2;r++)if(n+r-1<=0)this.arrowLeft.visible=!1;else if(n+r-1>=i.CannonSelectIconList.length-1)this.arrowRight.visible=!1;else if(!this.downFlag||this.list_Icon.startIndex!==this.startIdx){var l=i.CannonSelectIconList[n+r-1].index;(e=this.list_Icon.cells[r].getChildByName("iconImage"))&&!this.downFlag&&(1===r?(e.scaleX=1+this.selectedScaleAdd,e.scaleY=1+this.selectedScaleAdd):(e.scaleX=1,e.scaleY=1)),(a=this.list_Icon.cells[r].getChildByName("iconBg"))&&(l===this.selectType?a.gray=!1:a.gray=!0,this.downFlag||(1===r?(a.scaleX=1+this.selectedScaleAdd,a.scaleY=1+this.selectedScaleAdd):(a.scaleX=1,a.scaleY=1))),(t=this.list_Icon.cells[r].getChildByName("lock"))&&(t.visible=!0,o.default.gameData.cannonUnlockState[i.CannonSelectIconList[n+r-1].index]&&t&&(t.visible=!1),this.isReward&&this.selectType===l&&t&&(t.visible=!1),this.downFlag||(1===r?(t.scaleX=1+this.selectedScaleAdd,t.scaleY=1+this.selectedScaleAdd):(t.scaleX=1,t.scaleY=1)))}}},a.prototype.bindButtons=function(){var e=this;this.list_Icon.on(Laya.Event.MOUSE_DOWN,this,function(){d.default.instance&&2===d.default.instance.stageIdx&&1===d.default.instance.missionIdx&&5===o.default.gameData.tutorialStep&&(o.default.gameData.tutorialStep=6,console.log("newplayer_6"),r.default.traceEvent("newplayer_6")),e.downMouseX=e.mouseX,e.downFlag=!0,e.startIdx=e.list_Icon.startIndex}),this.list_Icon.on(Laya.Event.MOUSE_MOVE,this,function(){if(e.downFlag)if(e.downMouseX-e.mouseX>0&&e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2)e.downMouseX=e.mouseX,e.arrowRight.visible=!1;else if(e.downMouseX-e.mouseX<0&&e.list_Icon.selectedIndex<=1)e.downMouseX=e.mouseX,e.arrowLeft.visible=!1;else if(e.downMouseX-e.mouseX>0){var a=e.list_Icon.getCell(e.list_Icon.selectedIndex),t=e.list_Icon.getCell(e.list_Icon.selectedIndex+1);if(a&&t)for(r=0;r<a.numChildren;r++){var n=a.getChildAt(r),o=t.getChildAt(r);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowRight.visible=!0,e.downMouseX-e.mouseX>115&&(e.list_Icon.selectedIndex++,e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.downMouseX=e.mouseX-115,e.updateUI(),e.tutorial_slide.visible&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon(),e.openTutorial()))}else if(e.downMouseX-e.mouseX<0){var a=e.list_Icon.getCell(e.list_Icon.selectedIndex),t=e.list_Icon.getCell(e.list_Icon.selectedIndex-1);if(a&&t)for(var r=0;r<a.numChildren;r++){var n=a.getChildAt(r),o=t.getChildAt(r);n&&o&&(n.scaleX=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),n.scaleY=1+e.selectedScaleAdd*(1-Math.abs(e.downMouseX-e.mouseX)/230),o.scaleX=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230,o.scaleY=1+Math.abs(e.downMouseX-e.mouseX)*e.selectedScaleAdd/230)}e.arrowLeft.visible=!0,e.downMouseX-e.mouseX<-115&&(e.list_Icon.selectedIndex--,e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.downMouseX=e.mouseX+115,e.updateUI())}}),this.list_Icon.on(Laya.Event.MOUSE_UP,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.list_Icon.on(Laya.Event.MOUSE_OUT,this,function(){e.downFlag&&(e.downFlag=!1,e.updateScroll(),e.refreshIcon())}),this.arrowLeft.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex--,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex<=1&&(e.arrowLeft.visible=!1),e.arrowRight.visible=!0}),this.arrowRight.on(Laya.Event.CLICK,this,function(){e.downFlag=!1,e.list_Icon.selectedIndex++,e.updateScroll(),e.updateUI(),e.list_Icon.selectedIndex>=i.CannonSelectIconList.length-2&&(e.arrowRight.visible=!1),e.arrowLeft.visible=!0,e.tutorial_slide.visible&&e.openTutorial()}),this.btn_select.on(Laya.Event.CLICK,this,function(){(e.isReward||o.default.gameData.cannonType!==i.CannonSelectIconList[e.list_Icon.selectedIndex].index)&&(e.isClick=!0,e.btn_select.gray=!0,e.isReward=!1,e.selectType=i.CannonSelectIconList[e.list_Icon.selectedIndex].index,o.default.gameData.cannonType=e.selectType,e.refreshIcon())}),this.btn_unlock.on(Laya.Event.CLICK,this,function(){var a=i.CannonSelectIconList[e.list_Icon.selectedIndex].index;!o.default.gameData.cannonUnlockState[a]&&o.default.gameData.diamond>=i.CannonSelectTextList[a].unlockDiamond&&(o.default.gameData.diamond-=i.CannonSelectTextList[a].unlockDiamond,o.default.gameData.cannonUnlockState[a]=!0,e.refreshText(),e.refreshIcon())}),this.btn_try.on(Laya.Event.MOUSE_DOWN,this,function(){Laya.Browser.onMiniGame?(1==o.default.config.revive&&(l.default.instance.isOverVideo()?l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}}):(e.mouseEnabled=!1,l.default.instance.video({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()},fail:function(){l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})},complete:function(){e.mouseEnabled=!0}}))),2==o.default.config.try_cannon&&l.default.instance.share({pos:i.RewardPos.Cannon,success:function(){e.onClick_try()}})):e.onClick_try()}),this.btn_back.on(Laya.Event.CLICK,this,this.onClick_back)},a.prototype.onClick_back=function(){this.box_scene3D.timer.clear(this,this.cannonAniLoop),this.mouseEnabled=!1,this.visible=!1,this.isClick&&d.default.instance.cannonType!==this.selectType&&(this.isReward&&(d.default.instance.isRewardCannon=!0,d.default.instance.rewardCannonLeft=2,d.default.instance.label_rewardCannon.changeText("剩余"+d.default.instance.rewardCannonLeft+"小关"),d.default.instance.label_rewardCannon.visible=!0),d.default.instance.setCannon(this.selectType)),d.default.instance&&d.default.instance.state===i.GameState.PAUSE?d.default.openInstance():s.default.openInstance()},a.prototype.onClick_try=function(){this.isReward&&this.selectType===i.CannonSelectIconList[this.list_Icon.selectedIndex].index||(this.isClick=!0,this.isReward=!0,this.selectType=i.CannonSelectIconList[this.list_Icon.selectedIndex].index,this.btn_try.gray=!0,this.label_try.changeText("正在试用"),this.refreshIcon())},a.prototype.openTutorial=function(){var e=this;this.tutorial_slide.visible=!1,Laya.timer.clearAll(this.tutorial_slide.getChildByName("finger")),this.tutorial_try.visible=!0;var a=this.tutorial_try.getChildByName("finger");a.timer.frameLoop(1,a,function(){a.bottom+=.5,a.bottom>=20&&(a.bottom=10)}),this.tutorial_try.getChildByName("inputArea").on(Laya.Event.CLICK,this,function(){console.log("newplayer_7"),r.default.traceEvent("newplayer_7"),e.onClick_try(),e.tutorial_try.visible=!1,e.tutorial_try.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_try.getChildByName("finger")),e.tutorial_back.visible=!0;var a=e.tutorial_back.getChildByName("finger");a.timer.frameLoop(1,a,function(){a.top-=.5,a.top<=100&&(a.top=120)}),e.tutorial_back.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_8"),r.default.traceEvent("newplayer_8"),e.onClick_back(),e.tutorial_back.visible=!1,e.tutorial_back.getChildByName("inputArea").offAll(),Laya.timer.clearAll(e.tutorial_back.getChildByName("finger"))})})},a.prototype.updateScroll=function(){this.list_Icon.scrollBar.stopScroll(),this.list_Icon.scrollTo(this.list_Icon.selectedIndex-1)},a.prototype.updateUI=function(){this.refreshIcon(),this.refreshText(),this.newCannon()},a.prototype.cannonAniLoop=function(){this.cannon&&(this.cannon.transform.localRotationEulerY+=1)},a}(n.ui.cannonSelect.CannonSelectUI);t.default=c},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../component/Reward":8,"../utils/ws.js":16,"./GameScene":11,"./HomeView":12}],11:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../../ui/layaMaxUI"),i=e("../Const"),o=e("../Global"),r=e("../utils/Navigator"),l=e("../utils/wx"),s=e("../utils/ws.js"),d=e("../utils/Ad"),c=e("../component/Bullet"),u=e("../component/Target"),h=e("../component/Guard"),m=e("../component/Reward"),f=e("./HomeView"),g=e("./CannonSelect"),y=e("../StageConfig"),v=function(e){function a(){var t=e.call(this)||this;return t.bgIdx=0,t.missionRawIdxList=[0,0,0,0,0],t.MaxBulletNum=100,t.currBulletNum=0,t.isStageStart=!1,t.winCheckCnt=0,t.flag_missionWin=!1,t.textureIdx=3,t.treasureHitCnt=0,t.treasereMaxHitCnt=20,t.treasureFrameCnt=0,t.treasereMaxFrameCnt=90,t.treasureHitState=0,t.isTreasureHit=!1,t.isTreasureMoveStart=!1,t.isTreasureAdOpen=!1,t.cannonType=1,t.turretInitPos=i.CannonInitPos.clone(),t.isRecoil=!1,t.MaxRecoilTime=8,t.isRewardCannon=!1,t.rewardCannonLeft=-1,t.bulletType=1,t.bulletDirection=new Laya.Vector3,t.isRewardBullet=!1,t.mousePoint=new Laya.Vector2,t.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),t.hitResult=new Laya.HitResult,t.piecesList=[],t.state=0,t.reTimes=1,t.MaxReTimes=1,console.log("GameScene constructor()"),a.instance=t,t}return __extends(a,e),a.openInstance=function(e){a.instance?a.instance.onOpened(e):Laya.Scene.open(i.URL_GameScene,!1,e)},a.prototype.onOpened=function(e){if(console.log("GameScene onOpened()"),this.visible=!0,this.mouseEnabled=!0,this.text_diamond.changeText(""+o.default.gameData.diamond),this.icon_diamond.visible=!0,Laya.Browser.onMiniGame&&!this.navGame&&(this.navGame=new r.default(s.default)),this.state===i.GameState.START){this._bullet||this.initBullet(),o.default.gameData.stageIndex>2&&this.bgIdx!=(o.default.gameData.stageIndex-2)%4&&(this.bgIdx=(o.default.gameData.stageIndex-2)%4,this.newBackground()),this.isRewardCannon||this.cannonType===o.default.gameData.cannonType||this.setCannon(o.default.gameData.cannonType);var a=y.StageTexture[o.default.gameData.stageIndex>i.StageNum?i.StageNum:o.default.gameData.stageIndex];(!a||a<3||a>9)&&(a=Math.floor(7*Math.random())+3)>9&&(a=9),this.textureIdx=a,this.showUI(),this.stageIdx=o.default.gameData.stageIndex,this.missionIdx=1;for(var t=1;t<=5;t++)this.missionRawIdxList[t-1]=0,this["level"+t].sizeGrid="0, 96, 0, 0";this.newStage(),Laya.Browser.onMiniGame&&!this.navWin&&(this.navWin=new r.default(s.default),this.box_winIcon.visible=!0,this.navWin.createHomeIcons(this.box_winIcon,this.box_winIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.navRevive=new r.default(s.default),this.box_reviveIcon.visible=!0,this.navRevive.createHomeIcons(this.box_reviveIcon,this.box_reviveIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]))}else this.state===i.GameState.PAUSE&&(this.state=i.GameState.START);f.default.instance.isTest?(this.box_test.visible=!0,this.reTimes=1,this.MaxReTimes=1,Laya.Stat.show()):(this.box_test.visible=!1,Laya.Stat.hide())},a.prototype.onAwake=function(){this.initScene3D(),this.bgIdx=3,this.newBackground(),this.isRewardCannon=!1,this.cannonType=1,this.newCannon(),this.newBallBox(),this.newTrail(),this.initBullet(),this.scene3D.input.multiTouchEnabled=!1,this.scene3D.physicsSimulation.fixedTimeStep=.5/60},a.prototype.onEnable=function(){this.bindButtons(),Laya.timer.clear(this,this.rewardBtnAni),this.btnAniFrame=0,Laya.timer.frameLoop(1,this,this.rewardBtnAni)},a.prototype.initScene3D=function(){this.scene3D=this.box_scene3D.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=i.CameraInitPos.clone(),this.camera.transform.localRotationEuler=i.CameraInitRotEuler.clone(),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_SKY;var e=new Laya.BlinnPhongMaterial;e.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,e.albedoColor=new Laya.Vector4(1,1,1,0),this.camera.skyRenderer.material=e;var a=Laya.Browser.width/Laya.Browser.height;if(a<.5625){var t=2*Math.atan(.5625*Math.tan(.5235987));this.camera.fieldOfView=2*Math.atan(Math.tan(t/2)/a)*57.29578}this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=i.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=i.LightInitRotEuler.clone(),this.directionLight.color=i.LightInitColor.clone()},a.prototype.initBullet=function(){var e=this;Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(a){e._bullet=new Laya.MeshSprite3D(a)}))},a.prototype.newTrail=function(){var e=this;if(this._trail&&this._trail.destroy(),1==o.default.gameData.trailType)this._trail=null;else if(2==o.default.gameData.trailType){this._trail=new Laya.TrailSprite3D,this._trail.trailFilter.time=.8,this._trail.trailFilter.alignment=Laya.TrailFilter.ALIGNMENT_VIEW;var a=new Array;this._trail.trailFilter.widthMultiplier=.4;for(var t=0;t<=10;t++)a[t]=new Laya.FloatKeyframe,a[t].time=this._trail.trailFilter.time*t/10,a[t].value=this._trail.trailFilter.widthMultiplier*(1-t/10),a[t].inTangent=0,a[t].outTangent=0;this._trail.trailFilter.widthCurve=a,this._trail.trailFilter.colorGradient.updateColorAlpha(0,0,1),this._trail.trailFilter.colorGradient.updateColorAlpha(1,1,0);var n=new Laya.TrailMaterial;n.color=new Laya.Vector4(1,1,1,.4),n.renderMode=Laya.TrailMaterial.RENDERMODE_ADDTIVE,this._trail.trailRenderer.material=n}else 3==o.default.gameData.trailType&&Laya.Sprite3D.load(i.BulletEffectUrl[1],Laya.Handler.create(this,function(a){e._trail=a.clone()}))},a.prototype.newBackground=function(){var e=this;if(!this.ground){this.ground=new Laya.MeshSprite3D,this.scene3D.addChild(this.ground),this.ground.name="ground";this.ground.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.StaticPlaneColliderShape(new Laya.Vector3(0,1,0),-2.7688)}this.background&&(Laya.timer.clearAll(this.background),this.background.destroy()),this.bgIdx>1?(this.bgImg.skin=i.BgResUrl[this.bgIdx],this.scene3D.addChild(this.ground)):Laya.Sprite3D.load(i.BgResUrl[this.bgIdx],Laya.Handler.create(this,function(a){e.scene3D.removeChildByName("background"),e.background=e.scene3D.addChild(a),e.background.name="background",e.background.transform.localPosition=i.StageInitPos.clone(),e.background.transform.localRotationEuler=i.StageInitRot.clone(),e.background.transform.localScale=i.StageInitScale.clone();var t=e.background.getComponent(Laya.Animator);if(t&&t.destroy(),0===e.bgIdx){var n=e.background.getChildByName("Scenes_02").getChildByName("cloud01"),o=e.background.getChildByName("Scenes_02").getChildByName("cloud03");e.background.getChildByName("Scenes_02").getChildByName("Plane").getChildByName("Plane_0");e.scene3D.addChild(e.ground),e.background.frameLoop(1,e.background,function(){n&&(n.transform.localPositionX>.5&&(n.transform.localPositionX=-.5),n.transform.localPositionX+=7e-4),o&&(o.transform.localPositionX<-.5&&(o.transform.localPositionX=.5),o.transform.localPositionX-=5e-4)})}else if(1===e.bgIdx){e.ground.removeSelf();var r=e.background.getChildByName("_0012_Island1_0"),l=e.background.getChildByName("_0014_Island3_0"),s=e.background.getChildByName("_0019_Island8_0"),d=e.background.getChildByName("_0006_Plant01_0 1"),c=e.background.getChildByName("_0022_Sky_0");r&&(r.meshRenderer.castShadow=!1,r.meshRenderer.receiveShadow=!1),l&&(l.meshRenderer.castShadow=!1,l.meshRenderer.receiveShadow=!1),s&&(s.meshRenderer.castShadow=!1,s.meshRenderer.receiveShadow=!1),c&&(c.meshRenderer.castShadow=!1,c.meshRenderer.receiveShadow=!1);var u=0,h=0;e.background.frameLoop(1,e.background,function(){h++,++u>180&&(u=0),h>300&&(h=0),r&&(u<=90?r.transform.localPositionY+=5e-4:r.transform.localPositionY-=5e-4),l&&(h<=150?l.transform.localPositionY-=2e-4:l.transform.localPositionY+=2e-4),s&&(u<=90?s.transform.localPositionY+=5e-4:s.transform.localPositionY-=5e-4),d&&(u<=90?(d.transform.localRotationEulerX-=.2,d.transform.localPositionX+=18e-5):(d.transform.localRotationEulerX+=.2,d.transform.localPositionX-=18e-5))})}}))},a.prototype.newBallBox=function(){var e=this;Laya.Sprite3D.load(i.CannonBallBoxUrl,Laya.Handler.create(this,function(a){e.ballBox=e.scene3D.addChild(a.clone()),e.ballBox.name="ball_box",e.ballBox.transform.localPosition=i.CannonBallInitPos.clone(),e.ballBox.transform.localRotationEuler=i.CannonInitRot.clone(),e.ballBox.transform.localScale=i.CannonBallInitScale.clone();for(n=1;n<=10;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT);for(n=1;n<=5;n++)n<=e.MaxBulletNum&&(e.ballBox.getChildByName("chest_wooden_"+n+"_0").meshRenderer.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE);for(var t=e.scene3D.addChild(e.ballBox.clone()),n=1;n<=10;n++)if(n<=e.MaxBulletNum){var o=t.getChildByName("CannonBall"+n+"_0");o&&o.destroy()}t.transform.localPositionX=.11,t.transform.localPositionY-=.008,t.transform.localPositionZ+=.012,t.transform.localRotationEulerY=150}))},a.prototype.setCannon=function(e){this.cannonType=e,this.bulletType=this.cannonType,this.newCannon()},a.prototype.newCannon=function(){var e=this;this.cannon&&this.cannon.destroy(),Laya.Sprite3D.load(i.CannonResUrl[this.cannonType],Laya.Handler.create(this,function(a){e.cannon&&e.cannon.destroy(),e.cannon=a.clone(),e.scene3D.addChild(e.cannon),e.cannon.transform.localPosition=i.CannonInitPos.clone(),e.cannon.transform.localRotationEuler=i.CannonInitRot.clone(),e.cannon.transform.localScale=i.CannonInitScale.clone(),e.turret=e.cannon.getChildByName("Turret_0"),e.turret&&(e.turretInitPos=e.turret.transform.position.clone(),e.turretInitRot=e.turret.transform.localRotationEuler.clone())}))},a.prototype.showUI=function(){this.box_UI.visible=!0},a.prototype.hideUI=function(){this.box_UI.visible=!1,this.box_passStage.visible=!1,this.box_gameIcon.visible=!1,this.hideReviveUI()},a.prototype.hideReviveUI=function(){d.hideBanner(),this.box_revive.visible=!1},a.prototype.onClick_rewardTemplate=function(e,a,t){var n=this;Laya.Browser.onMiniGame?1==e?m.default.instance.isOverVideo()?m.default.instance.share({pos:a,success:function(){console.log("share succeed:",e,a),t()}}):(this.mouseEnabled=!1,m.default.instance.video({pos:a,success:function(){console.log("video succeed:",e,a),t()},fail:function(){console.log("video failed:",e,a),m.default.instance.share({pos:a,success:function(){console.log("share succeed:",e,a),t()}})},complete:function(){n.mouseEnabled=!0}})):2==e?m.default.instance.share({pos:a,success:function(){console.log("share succeed:",e,a),t()}}):3==e&&this.navWin.randomIconTap("default",function(){t()},function(){m.default.instance.isOverVideo()?m.default.instance.share({pos:a,success:function(){console.log("share succeed:",e,a),t()}}):(n.mouseEnabled=!1,m.default.instance.video({pos:a,success:function(){console.log("video succeed:",e,a),t()},fail:function(){console.log("video failed:",e,a),m.default.instance.share({pos:a,success:function(){console.log("share succeed:",e,a),t()}})},complete:function(){n.mouseEnabled=!0}}))}):t()},a.prototype.bindButtons=function(){var e=this;this.btn_test_next.on(Laya.Event.CLICK,this,function(){f.default.instance.testStageIdx++,e.input_test_lvl.text&&(f.default.instance.testStageIdx=parseInt(e.input_test_lvl.text),e.input_test_lvl.text=""),e.reTimes=1,e.MaxReTimes=1,e.btn_test_restart.visible=!1,e.btn_test_next.visible=!1,e.newStage()}),this.btn_test_restart.on(Laya.Event.CLICK,this,function(){e.input_test_reTimes.text?(e.MaxReTimes=parseInt(e.input_test_reTimes.text),e.input_test_lvl.text=""):e.MaxReTimes=1,e.reTimes=1,e.btn_test_restart.visible=!1,e.btn_test_next.visible=!1,e.newStage()}),this.onClick_cannonSelect=function(){e.state=i.GameState.PAUSE,e.mouseEnabled=!1,g.default.openInstance()},this.onClick_rewardBullet=function(){e.isRewardBullet=!0,e.bulletType=o.default.config.bulletRewardType,e.scene3D.getChildByName("cannon_effect")||Laya.Sprite3D.load(i.cannonEffectUrl[1],Laya.Handler.create(e,function(a){e.scene3D.addChild(a).name="cannon_effect"}))},this.onClick_rewardCannon=function(){e.isRewardCannon=!0,e.rewardCannonLeft=2,e.label_rewardCannon.changeText("剩余"+e.rewardCannonLeft+"小关"),e.label_rewardCannon.visible=!0,e.setCannon(o.default.config.cannonRewardType)},this.btn_back.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!0}),this.btn_backReturn.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1}),this.btn_backExit.on(Laya.Event.CLICK,this,function(){e.backCheck.visible=!1,e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.mouseEnabled=!1,e.turret&&e.cannon&&!e.cannon.destroyed&&e.turretInitRot&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1,e.rewardCannonLeft=-1,e.label_rewardCannon.visible=!1),e.clearStageTimer(),f.default.openInstance()}),this.btn_cannonOpen.on(Laya.Event.CLICK,this,function(){e.onClick_cannonSelect()}),this.btn_rewardBullet.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.try_ball,i.RewardPos.Bullet,this.onClick_rewardBullet]),this.btn_rewardCannon.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.try_cannon,i.RewardPos.Cannon,this.onClick_rewardCannon]),this.btn_passStage.on(Laya.Event.CLICK,this,function(){o.default.gameData.diamond+=y.StageReward[e.stageIdx-1>39?39:e.stageIdx-1],e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_passStage.visible=!1,e.nextStage()}),this.btn_passStagex3.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.reward_triple,i.RewardPos.Treasure,function(){o.default.gameData.diamond+=3*y.StageReward[e.stageIdx-1>39?39:e.stageIdx-1],e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_passStage.visible=!1,e.nextStage()}]),this.btn_revive.on(Laya.Event.MOUSE_DOWN,this,this.onClick_rewardTemplate,[o.default.config.revive,i.RewardPos.Revive,function(){if(e.isRevive=!0,e.hideReviveUI(),e.currBulletNum-=3,e.label_ballNum.changeText("x3"),e.ballBox)for(var a=1;a<=3;a++)a<=e.MaxBulletNum&&(e.ballBox.getChildByName("CannonBall"+a+"_0").meshRenderer.material.albedoColorA=1);e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),e.gameStage.frameLoop(1,e,e.stageLooping)}]),this.btn_retry.on(Laya.Event.CLICK,this,function(){e.state=i.GameState.OVER,e.cleanStage(),e.hideUI(),e.turret&&e.cannon&&!e.cannon.destroyed&&e.turretInitRot&&(e.turret.transform.localRotationEuler=e.turretInitRot.clone()),e.isRewardCannon&&(e.setCannon(o.default.gameData.cannonType),e.isRewardCannon=!1,e.rewardCannonLeft=-1,e.label_rewardCannon.visible=!1),e.clearStageTimer(),e.mouseEnabled=!1,f.default.openInstance()}),this.btn_treasureGetExtra.on(Laya.Event.CLICK,this,function(){o.default.gameData.diamond+=y.StageReward[e.stageIdx>39?39:e.stageIdx],e.text_diamond.changeText(""+o.default.gameData.diamond),d.hideBanner(),e.box_treasureAD.visible=!1})},a.prototype.rewardBtnAni=function(){this.btnAniFrame++,this.btnAniFrame<=60?(this.btn_rewardCannon.scaleX+=.00625,this.btn_rewardCannon.scaleY+=.00625,this.btn_rewardBullet.scaleX+=.00625,this.btn_rewardBullet.scaleY+=.00625):this.btnAniFrame<=120?(this.btn_rewardCannon.scaleX-=.00625,this.btn_rewardCannon.scaleY-=.00625,this.btn_rewardBullet.scaleX-=.00625,this.btn_rewardBullet.scaleY-=.00625):(this.btnAniFrame=1,this.btn_rewardCannon.scaleX=1.5,this.btn_rewardCannon.scaleY=1.5,this.btn_rewardBullet.scaleX=1.5,this.btn_rewardBullet.scaleY=1.5)},a.prototype.cleanStage=function(){this.gameStage&&(this.gameStage.destroy(),this.gameStage.removeSelf(),this.clearStageTimer(),Laya.Browser.onMiniGame&&l.default.triggerGC&&l.default.triggerGC());for(var e=0;e<this.scene3D.numChildren;e++){var a=this.scene3D.getChildAt(e);a&&"bullet"==a.name&&(a.getComponent(c.default)?a.getComponent(c.default).recover():a.destroy())}for(;this.piecesList&&0!==this.piecesList.length;){var t=this.piecesList.pop();t.destroy(),t.removeSelf()}},a.prototype.clearStageTimer=function(){Laya.timer.clear(this,this.stageLooping),Laya.timer.clear(this,this.stageFailCountDown),Laya.timer.clear(this,this.nextStage),this.box_countdown.visible=!1},a.prototype.updateTrailUnlock=function(){var e=this;o.default.gameData.trailUnlockState[3]<i.TrailUnlock[3]?this.label_trailUnlockMsg.changeText("观看视频"+o.default.gameData.trailUnlockState[3]+"/"+i.TrailUnlock[3]):(this.btn_trailUnlock.visible=!1,this.btn_trailSelect.visible=!0,this.btn_trailSelect.on(Laya.Event.CLICK,this,function(){o.default.gameData.trailType=3,e.newTrail(),e.box_trailShow.visible=!1,e.btn_trailClose.offAll(Laya.Event.CLICK),e.btn_trailUnlock.offAll(Laya.Event.CLICK),e.btn_trailSelect.offAll(Laya.Event.CLICK)}))},a.prototype.newStage=function(){var e=this;if(!(this.missionIdx<1||this.missionIdx>6)){if(o.default.gameData.trailUnlockState[3]<i.TrailUnlock[3]&&!o.default.gameData.trailShowToday&&(o.default.gameData.stageIndex>2||2==o.default.gameData.stageIndex&&2==this.missionIdx)&&(this.label_trailUnlockMsg.changeText("观看视频"+o.default.gameData.trailUnlockState[3]+"/"+i.TrailUnlock[3]),o.default.gameData.trailShowToday=!0,o.default.gameData.lastTrailShowTimestamp=Date.now(),this.box_trailShow.visible=!0,this.btn_trailUnlock.visible=!0,this.btn_trailSelect.visible=!1,this.btn_trailUnlock.on(Laya.Event.CLICK,this,this.onClick_rewardTemplate,[o.default.config.get_trail,i.RewardPos.Trail,function(){o.default.gameData.trailUnlockState[3]++,e.updateTrailUnlock()}]),this.btn_trailClose.on(Laya.Event.CLICK,this,function(){e.box_trailShow.visible=!1,e.btn_trailClose.offAll(Laya.Event.CLICK),e.btn_trailUnlock.offAll(Laya.Event.CLICK)})),f.default.instance.isTest||(6===this.missionIdx?(d.randomlyGetBanner("treasure"),this.box_gameIcon.visible=!0):this.missionIdx>=1&&this.missionIdx<=5&&(this.navGame&&this.navGame.createGameIcons(),this.box_gameIcon.visible=!0)),this.cleanStage(),this.label_rewardCannon.visible=!1,this.missionIdx>=1&&this.missionIdx<=5&&this.isRewardCannon&&(this.rewardCannonLeft--,this.rewardCannonLeft<0?(this.setCannon(o.default.gameData.cannonType),this.isRewardCannon=!1,this.rewardCannonLeft=-1,this.label_rewardCannon.visible=!1,g.default.instance&&(g.default.instance.isReward=!1)):(this.label_rewardCannon.changeText("剩余"+this.rewardCannonLeft+"小关"),this.label_rewardCannon.visible=!0)),this.box_passStage.visible=!1,this.missionWin.visible=!1,this.missionIdx>=1&&this.missionIdx<=5&&(this["level"+this.missionIdx].sizeGrid="0,64,0,0"),this.isRewardBullet=!1,this.scene3D.getChildByName("cannon_effect")&&this.scene3D.getChildByName("cannon_effect").destroy(),this.isRevive=!1,this.currBulletNum=0,this.winCheckCnt=0,this.flag_missionWin=!1,this.isStageStart=!1,this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime,this.bulletType=this.cannonType,this.cannon&&!this.cannon.destroyed&&this.turret&&this.turretInitRot&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone()),f.default.instance.isTest)this.rawIdx=f.default.instance.testStageIdx,this.MaxBulletNum=100,this.label_ballNum.changeText("x"+this.MaxBulletNum),this.label_test_lvl.changeText("关卡："+f.default.instance.testStageIdx);else if(this.missionIdx>=1&&this.missionIdx<=5){var a=y.Stage[f.default.instance.systemName][this.stageIdx>i.StageNum?i.StageNum:this.stageIdx][this.missionIdx];this.rawIdx=this.missionRawIdxList[0];for(var t=0;t<20&&this.missionRawIdxList.indexOf(this.rawIdx)>=0;)this.rawIdx=y.Map[f.default.instance.systemName][Math.round(Math.random()*(a.max-a.min))+a.min],t++;if(this.missionRawIdxList[this.missionIdx-1]=this.rawIdx,this.MaxBulletNum=a.ball_add+y.StageRaw[this.rawIdx].ball_num,this.label_ballNum.changeText("x"+this.MaxBulletNum),console.log("stage: "+this.stageIdx+"\tmission: "+this.missionIdx+"\traw stage index: "+this.rawIdx),console.log("max ball num: "+this.MaxBulletNum),this.ballBox)for(n=1;n<=10;n++)n<=this.MaxBulletNum?this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1:this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=0}else if(this.MaxBulletNum=999,this.label_ballNum.changeText("无限"),this.ballBox)for(var n=1;n<=10;n++)this.ballBox.getChildByName("CannonBall"+n+"_0").meshRenderer.material.albedoColorA=1;var r;r=this.missionIdx>=1&&this.missionIdx<=5?i.StageResUrl+this.rawIdx+".lh":i.treasureUrl,Laya.Sprite3D.load(r,Laya.Handler.create(this,function(a){console.log("load_stage"),s.default.traceEvent("load_stage"),e.scene3D.getChildByName("gameStage")&&e.scene3D.getChildByName("gameStage").destroy(),Laya.timer.frameOnce(15,e,function(){e.gameStage=e.scene3D.addChild(a.clone()),e.gameStage.name="gameStage",d.hideBanner(),e.label_level.changeText(""+e.stageIdx),e.gameStage.transform.localPosition=i.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=i.StageInitRot.clone(),e.gameStage.transform.localScale=i.StageInitScale.clone();var t=e.gameStage.getComponent(Laya.Animator);if(t&&t.destroy(),e.missionIdx>=1&&e.missionIdx<=5)for(var n,r=0;r<e.gameStage.numChildren;r++)if(n=e.gameStage.getChildAt(r),n.meshRenderer.castShadow=!1,n.meshRenderer.receiveShadow=!1,n.name.search("Obstacle")>=0){var l=n.addComponent(u.default);n.name.search("Glass")>=0?l.setType(2):n.name.search("TNT")>=0?l.setType(3):l.setType(1)}else if(n.name.search("Cube")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),m=n.meshFilter.sharedMesh.bounds,g=m.getMax().x-m.getMin().x,v=m.getMax().y-m.getMin().y,p=m.getMax().z-m.getMin().z;c.colliderShape=new Laya.BoxColliderShape(g,v,p),Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var a=new Laya.PBRSpecularMaterial;a.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,a.albedoTexture=e,n.meshRenderer.material=a}))}else if(n.name.search("Cylinder")>=0){n.name="stand";var c=n.addComponent(Laya.PhysicsCollider),b=new Laya.MeshColliderShape;b.mesh=n.meshFilter.sharedMesh,c.colliderShape=b,Laya.Texture2D.load(i.StageTexUrl[0],Laya.Handler.create(e,function(e){var a=new Laya.PBRSpecularMaterial;a.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,a.albedoTexture=e,n.meshRenderer.material=a}))}else if(n.name.search("Guard")>=0)n.addComponent(h.default);else n&&n.destroy();else{e.gameStage.name="treasure",e.gameStage.transform.localPositionZ+=.3,e.treasureHitCnt=0,e.treasureFrameCnt=0,e.treasureHitState=0,e.isTreasureAdOpen=!1,e.isTreasureHit=!1,e.isTreasureMoveStart=!1;var _=Math.random()<.6,w=-1,S=60,L=0;Laya.timer.frameLoop(1,e.gameStage,function(){if(e.isTreasureMoveStart){if(++w<=S)_?e.gameStage.transform.localPositionY+=.01:e.gameStage.transform.localPositionY-=.01;else{if(w=0,S=120,!e.isTreasureAdOpen&&!_&&o.default.gameData.treasureBannerHit<o.default.config.MaxTreasureBannerHit&&!o.default.config.deny_banner&&Math.random()<o.default.config.banner_show_treasure){e.label_extraDiamond.changeText(""+y.StageReward[e.stageIdx>39?39:e.stageIdx]),e.box_treasureAD.visible=!0,e.isTreasureAdOpen=!0;var a=e.btn_treasureGetExtra.centerY+e.btn_treasureGetExtra.height/2+Laya.stage.height/2+100;Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(a+=40),d.showBanner(!1,a),console.log("t_banner_show"),s.default.traceEvent("t_banner_show"),e.state=i.GameState.BANNER_TOUCH}_=!_}e.isTreasureHit&&(++L<=2?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):L<=6?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):L<=8?(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03):(e.isTreasureHit=!1,L=0))}})}if(f.default.instance.isTest){if(e.label_test_reTimes.changeText("reTimes："+e.reTimes+"/"+e.MaxReTimes),e.label_test_objs.changeText("objNum："+e.gameStage.numChildren),e.reTimes++,e.reTimes<=e.MaxReTimes)return void Laya.timer.frameOnce(10,e,function(){e.box_scene3D.off(Laya.Event.CLICK,e,e.onClick),e.clearStageTimer(),e.newStage()});e.btn_test_restart.visible=!0,e.btn_test_next.visible=!0}if(e.gameStage.frameLoop(1,e,e.stageLooping),e.box_scene3D.on(Laya.Event.CLICK,e,e.onClick),1===e.stageIdx)if(1===e.missionIdx&&0===o.default.gameData.tutorialStep)o.default.gameData.tutorialStep=1,e.tutorial_shoot.visible=!0,e.tutorial_shoot.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_1"),s.default.traceEvent("newplayer_1"),e.onClick(),e.tutorial_shoot.visible=!1,e.tutorial_shoot.getChildByName("inputArea").offAll()});else if(2===e.missionIdx&&1===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=2,e.btn_rewardBullet.visible=!0,e.tutorial_bulletTry.visible=!0;(x=e.tutorial_bulletTry.getChildByName("finger")).timer.frameLoop(1,x,function(){x.centerY-=1,x.centerY<=450&&(x.centerY=480)}),e.tutorial_bulletTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_2"),s.default.traceEvent("newplayer_2"),e.onClick_rewardBullet(),e.tutorial_bulletTry.visible=!1,Laya.timer.clearAll(e.tutorial_bulletTry.getChildByName("finger")),e.tutorial_bulletTry.getChildByName("inputArea").offAll()})}else if(3===e.missionIdx&&2===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=3,e.btn_rewardBullet.visible=!0,e.btn_rewardCannon.visible=!0,e.tutorial_cannonTry.visible=!0;(x=e.tutorial_cannonTry.getChildByName("finger")).timer.frameLoop(1,x,function(){x.centerY-=1,x.centerY<=450&&(x.centerY=480)}),e.tutorial_cannonTry.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_3"),s.default.traceEvent("newplayer_3"),e.onClick_rewardCannon(),e.tutorial_cannonTry.visible=!1,Laya.timer.clearAll(e.tutorial_cannonTry.getChildByName("finger")),e.tutorial_cannonTry.getChildByName("inputArea").offAll()})}else 6===e.missionIdx&&3===o.default.gameData.tutorialStep&&(o.default.gameData.tutorialStep=4,e.tutorial_treasure.visible=!0,e.tutorial_treasure.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_4"),s.default.traceEvent("newplayer_4"),e.onClick(),e.tutorial_treasure.visible=!1,e.tutorial_treasure.getChildByName("inputArea").offAll()}));else if(2===e.stageIdx&&1===e.missionIdx&&4===o.default.gameData.tutorialStep){o.default.gameData.tutorialStep=5,e.btn_cannonOpen.visible=!0,e.tutorial_cannonSelect.visible=!0;var x=e.tutorial_cannonSelect.getChildByName("finger");x.timer.frameLoop(1,x,function(){x.bottom+=.5,x.bottom>=20&&(x.bottom=5)}),e.tutorial_cannonSelect.getChildByName("inputArea").on(Laya.Event.CLICK,e,function(){console.log("newplayer_5"),s.default.traceEvent("newplayer_5"),e.onClick_cannonSelect(),e.tutorial_cannonSelect.visible=!1,Laya.timer.clearAll(e.tutorial_cannonSelect.getChildByName("finger")),e.tutorial_cannonSelect.getChildByName("inputArea").offAll()})}o.default.gameData.stageIndex>1&&e.missionIdx>=1&&e.missionIdx<=5?(e.btn_rewardCannon.visible=!0,e.btn_rewardBullet.visible=!0,e.btn_cannonOpen.visible=!0):1===o.default.gameData.stageIndex?(o.default.gameData.tutorialStep>=2&&(e.btn_rewardBullet.visible=!0),o.default.gameData.tutorialStep>=3&&(e.btn_rewardBullet.visible=!0,e.btn_rewardCannon.visible=!0)):(e.btn_rewardCannon.visible=!1,e.btn_rewardBullet.visible=!1,e.btn_cannonOpen.visible=!1)})}))}},a.prototype.stageLooping=function(){this.state!==i.GameState.START&&this.state!==i.GameState.BANNER_TOUCH||(f.default.instance.isTest?this.testWinCheck():this.missionIdx>=1&&this.missionIdx<=5?this.winCheck():this.isTreasureMoveStart&&this.winCheck_treasure(),this.isRecoil&&this.cannon&&(this.recoilTime<this.MaxRecoilTime?(this.recoilTime<this.MaxRecoilTime/4?(this.cannon.transform.localPositionX+=.01*this.bulletDirection.x,this.cannon.transform.localPositionY+=.01*this.bulletDirection.y,this.cannon.transform.localPositionZ+=.01*this.bulletDirection.z):(this.cannon.transform.localPositionX-=.006*this.bulletDirection.x,this.cannon.transform.localPositionY-=.006*this.bulletDirection.y,this.cannon.transform.localPositionZ-=.006*this.bulletDirection.z),this.recoilTime++):(this.cannon.transform.position=i.CannonInitPos.clone(),this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime)))},a.prototype.testWinCheck=function(){this.winCheckCnt++>=i.MaxWinCheckTime&&(console.log("player win"),this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.missionWin.visible=!0)},a.prototype.winCheck=function(){var e=this;if(this.winCheckCnt++>=i.MaxWinCheckTime){console.log("player win"),this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this["level"+this.missionIdx].sizeGrid="0,32,0,0";var a=this.currBulletNum-this.MaxBulletNum+4;a=(a=a<y.StageRaw[this.rawIdx].ball_num?0:a)>4?4:a,this.missionWin.skin="res/ui/game/grade_"+a+"_CN.png",this.missionWin.visible=!0;var t=0;this.missionWin.centerY=30,this.missionWin.scaleX=1.5,this.missionWin.scaleY=1.5,this.missionWin.timer.frameLoop(1,this.missionWin,function(){if(++t<=13)e.missionWin.scaleX+=.15,e.missionWin.scaleY+=.15,e.missionWin.centerY-=3;else if(t<=40)e.missionWin.scaleX-=.07,e.missionWin.scaleY-=.07,e.missionWin.centerY-=10;else{Laya.timer.clearAll(e.missionWin);var n=y.Stage[f.default.instance.systemName][e.stageIdx>i.StageNum?i.StageNum:e.stageIdx][e.missionIdx].reward;n-=Math.round(n/2/4*a),o.default.gameData.diamond+=n,e.text_diamond.changeText(""+o.default.gameData.diamond)}}),Laya.timer.frameOnce(90,this,this.nextStage)}},a.prototype.winCheck_treasure=function(){var e=this;this.treasureFrameCnt++,this.treasureFrameCnt>=this.treasereMaxFrameCnt&&this.treasureHitCnt>=this.treasereMaxHitCnt&&!this.box_treasureAD.visible&&(this.flag_missionWin=!0,this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),this.clearStageTimer(),this.box_countdown.visible=!1,this.hideReviveUI(),this.gameStage.transform.localPositionY=0,Laya.timer.clearAll(this.gameStage),Laya.timer.frameOnce(1,this.gameStage,function(){var a=!1;Laya.timer.frameLoop(1,e.gameStage,function(){a?(e.gameStage.transform.localRotationEulerZ-=4,e.gameStage.transform.localPositionX-=.03):(e.gameStage.transform.localRotationEulerZ+=4,e.gameStage.transform.localPositionX+=.03),!a&&e.gameStage.transform.localRotationEulerZ>12?a=!0:a&&e.gameStage.transform.localRotationEulerZ<-12&&(a=!1)}),Laya.timer.frameOnce(40,e.gameStage,function(){e.gameStage.transform.localRotationEulerZ=0,e.gameStage.transform.localPositionX=0,Laya.timer.clearAll(e.gameStage);var a=0,t=e.gameStage.getChildByName("top");e.gameStage.getChildByName("bottom");e.gameStage.getChildByName("lock").transform.localRotationEulerX-=45,Laya.timer.frameLoop(1,e.gameStage,function(){if(a++,t.transform.localRotationEulerX>-100&&(t.transform.localRotationEulerX-=5),a<=20)e.gameStage.transform.localPositionY-=.005;else if(a<=60){a<=25?e.gameStage.transform.localPositionY+=.2:a<=35&&(e.gameStage.transform.localPositionY-=.1);for(var n=1;n<=9;n++){var o=e.gameStage.getChildByName("currency_"+n);o&&(a<=25?o.transform.localPositionY+=.003:a<=35?o.transform.localPositionY+=.004:a<=40?o.transform.localPositionY-=.001:a<=45?o.transform.localPositionY-=.002:a<=60&&(o.transform.localPositionY-=.003),o.transform.localPositionX+=.001*i.treasureAngleX[n],o.transform.localPositionZ+=-.002*i.treasureAngleZ[n],o.transform.localRotationEulerX+=30*i.treasureAngleX[n],o.transform.localRotationEulerZ+=30*i.treasureAngleZ[n])}}else Laya.timer.clearAll(e.gameStage),Laya.timer.frameOnce(90,e,e.nextStage)})})}))},a.prototype.restart=function(){this.newStage()},a.prototype.nextStage=function(){Laya.timer.clearAll(this.missionWin),this.missionIdx++,this.missionIdx>5+(o.default.config.hasTreasure?1:0)?this.passStage():this.newStage()},a.prototype.passStage=function(){this.state=i.GameState.START,console.log("pass_stage"+this.stageIdx),this.stageIdx<=10?s.default.traceEvent("pass_stage"+this.stageIdx):s.default.traceEvent("pass_stage10");for(a=0;a<this.scene3D.numChildren;a++){var e=this.scene3D.getChildAt(a);"bullet"!==e.name&&"bulletTrigger"!==e.name||e.destroy()}this.missionWin.visible=!1,this.box_gameIcon.visible=!1,this.label_stage.changeText(""+this.stageIdx),this.label_winDiamond.changeText(""+y.StageReward[this.stageIdx>39?39:this.stageIdx]),this.box_passStage.visible=!0,this.showBanner(this.btn_passStage,o.default.config.banner_delay_pass,!0),this.navWin&&this.navWin.loadHomeIconInfoList(),this.stageIdx++,o.default.gameData.stageIndex=this.stageIdx,this.missionIdx=0;for(var a=1;a<=5;a++)this.missionRawIdxList[a-1]=0,this["level"+a].sizeGrid="0, 96, 0, 0";var t=y.StageTexture[o.default.gameData.stageIndex>i.StageNum?i.StageNum:o.default.gameData.stageIndex];if(!t||t<3||t>9){for(t=this.textureIdx;t==this.textureIdx;)(t=Math.floor(7*Math.random())+3)>9&&(t=9)}this.textureIdx=t,o.default.gameData.stageIndex>2&&(this.bgIdx=(o.default.gameData.stageIndex-2)%4,this.newBackground())},a.prototype.stageFailCountDown=function(){this.state===i.GameState.START&&(this.countdown++,this.countdown>=240&&(this.clearStageTimer(),this.box_countdown.visible=!1,this.btn_retry.bottom=150,o.default.config.online||(this.btn_retry.bottom=260),Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(this.btn_retry.bottom+=o.default.config.distance_iphonex||0),this.box_revive.visible=!0,this.navRevive&&this.navRevive.loadHomeIconInfoList(),this.showBanner(this.btn_retry,o.default.config.banner_delay_ratio,!0)),this.label_failTimer.changeText(""+Math.floor(4-this.countdown/60%4)),this.failCircle.scaleX+=.015,this.failCircle.scaleY+=.015)},a.prototype.showBanner=function(e,a,t){void 0===t&&(t=!1),!o.default.config.deny_banner&&Math.random()<a?(e.bottom=150,Laya.timer.frameOnce(60*o.default.config.banner_delay,null,function(){e.bottom=260,Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(e.bottom+=o.default.config.distance_iphonex||0),d.showBanner(t)})):(e.bottom=260,Laya.Browser.onMiniGame&&s.default.isIPhoneX()&&(e.bottom+=o.default.config.distance_iphonex||0),d.showBanner(t))},a.prototype.onClick=function(){if(this.gameStage&&this.cannon){if(this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30,1,1))Laya.Vector3.subtract(this.hitResult.point,this.turretInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var a=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,this.turretInitPos,a),Laya.Vector3.add(e,a,this.bulletDirection)}var t=this.bulletDirection.z<0;Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.physicsStartCheck(),this.createBullet(),this.turret&&this.cannon&&!this.cannon.destroyed&&this.turretInitRot&&(this.turret.transform.localRotationEuler=this.turretInitRot.clone(),t&&(-1===this.cannon.name.indexOf("Anti")?this.turret.transform.localRotationEulerX-=90*this.bulletDirection.y:this.turret.transform.localRotationEulerX+=90*this.bulletDirection.y,this.turret.transform.localRotationEulerY-=90*this.bulletDirection.x)),this.isRecoil=!0,this.recoilTime=0}},a.prototype.physicsStartCheck=function(){if(!this.isStageStart){var e=new Laya.SphereColliderShape(i.BulletRadius*i.BulletScale[+this.isRewardBullet][this.bulletType]*3),a=[],t=this.bulletDirection.clone();if(Laya.Vector3.scale(t,50,t),this.scene3D.physicsSimulation.shapeCastAll(e,this.turretInitPos,t,a))for(var n in a)if(a[n].collider.owner.name.indexOf("Obstacle")>=0){this.isStageStart=!0;break}}},a.prototype.createBullet=function(){var e=this;if(this.currBulletNum++,this.missionIdx>=1&&this.missionIdx<=5&&(this.label_ballNum.changeText("x"+(this.MaxBulletNum-this.currBulletNum)),f.default.instance.isTest||this.ballBox&&this.MaxBulletNum-this.currBulletNum+1>=1&&this.MaxBulletNum-this.currBulletNum+1<=10&&(this.ballBox.getChildByName("CannonBall"+(this.MaxBulletNum-this.currBulletNum+1)+"_0").meshRenderer.material.albedoColorA=0)),Laya.Browser.onMiniGame&&o.default.gameData.soundEnabled&&Laya.SoundManager.playSound(i.soundUrl),Laya.Browser.onMiniGame&&o.default.gameData.vibrationEnabled&&l.default.vibrateShort(),this.currBulletNum>=this.MaxBulletNum&&!this.flag_missionWin&&(this.box_scene3D.off(Laya.Event.CLICK,this,this.onClick),Laya.timer.frameOnce(30,this,function(){e.box_countdown.visible=!0,e.failCircle.scaleX=1,e.failCircle.scaleY=1,e.countdown=0,e.isRevive?e.btn_revive.visible=!1:e.btn_revive.visible=!0,e.flag_missionWin||Laya.timer.frameLoop(1,e,e.stageFailCountDown)})),this.isRewardBullet)Laya.Sprite3D.load(i.BulletRewardResUrl[o.default.config.bulletRewardType],Laya.Handler.create(this,function(a){var t=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));t.name="bullet";t.addChild(a.clone()).name="effect";t.addComponent(c.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(t);var n=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(i.BulletRadius));n.name="bulletTrigger";n.addComponent(c.default).reset(o.default.config.bulletRewardType,!0),e.scene3D.addChild(n)})),this.isRewardBullet=!1,Laya.timer.frameOnce(30,this,function(){e.scene3D.getChildByName("cannon_effect")&&e.scene3D.getChildByName("cannon_effect").destroy()});else if(2===this.cannonType){a=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-a,0),this.createSingleBullet(a,0)}else if(4===this.cannonType){var a=.1/i.BulletScale[0][this.cannonType];this.createSingleBullet(-a,-a),this.createSingleBullet(-a,a),this.createSingleBullet(a,-a),this.createSingleBullet(a,a)}else this.createSingleBullet()},a.prototype.createSingleBullet=function(e,a){var t=this;void 0===e&&(e=0),void 0===a&&(a=0);var n=Laya.Pool.getItem("bullet");if(n){(r=n.getComponent(c.default))?r.reset(this.bulletType):(r=n.addComponent(c.default)).reset(this.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=a,this.scene3D.addChild(n)}else{this._bullet||this.initBullet(),(n=this._bullet.clone()).name="bullet";var r=n.addComponent(c.default);r.reset(this.bulletType),n.transform.localPositionX+=e,n.transform.localPositionY+=a,this.scene3D.addChild(n)}if(n){if(n.removeChildByName("effect"),n.removeChildByName("trail"),1!=o.default.gameData.trailType)if(this._trail){var l=this._trail.clone();l.name="trail",n.addChild(l)}else this.newTrail();6===this.cannonType&&Laya.Sprite3D.load(i.BulletEffectUrl[2],Laya.Handler.create(this,function(e){n.addChild(e.clone()).name="effect"}))}var s=Laya.Pool.getItem("bulletTrigger");if(s){var d=s.getComponent(c.default);d?d.reset(this.bulletType):(d=n.addComponent(c.default)).reset(this.bulletType),s.transform.localPositionX+=e,s.transform.localPositionY+=a,this.scene3D.addChild(s)}else Laya.Mesh.load(i.BulletMeshUrl,Laya.Handler.create(this,function(n){(s=new Laya.MeshSprite3D(n)).name="bulletTrigger";s.addComponent(c.default).reset(t.bulletType),s.transform.localPositionX+=e,s.transform.localPositionY+=a,t.scene3D.addChild(s)}))},a}(n.ui.game.GameSceneUI);t.default=v},{"../../ui/layaMaxUI":18,"../Const":3,"../Global":4,"../StageConfig":5,"../component/Bullet":6,"../component/Guard":7,"../component/Reward":8,"../component/Target":9,"../utils/Ad":13,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./CannonSelect":10,"./HomeView":12}],12:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("./../../ui/layaMaxUI"),i=e("./GameScene"),o=e("./CannonSelect"),r=e("../Const"),l=e("../utils/wx"),s=e("../utils/ws.js"),d=e("../Global"),c=e("../utils/Ad"),u=e("../utils/Navigator"),h=e("../utils/Loader"),m=e("../component/Reward"),f=function(e){function a(){var t=e.call(this)||this;return t.iconInfosList=[],t.currentIconInfoList=[],t.isGameDataLoaded=!1,t.isTest=!1,console.log("HomeView constructor()"),a.instance=t,i.default.openInstance(),t.label_version.changeText("v"+r.VERSION),t}return __extends(a,e),a.openInstance=function(e){a.instance?(c.randomlyGetBanner("home"),c.showBanner(!0),a.instance.onOpened(e)):Laya.Scene.open(r.URL_HomeView,!1,e)},a.prototype.onOpened=function(e){console.log("HomeView onOpened()"),this.visible=!0,this.label_level.changeText("关卡："+d.default.gameData.stageIndex),this.nav&&this.nav.loadHomeIconInfoList(),this.refreshUnlock(),this.text_diamond.changeText(""+d.default.gameData.diamond),this.icon_diamond.visible=!0,this.updateTrailUnlock()},a.prototype.onEnable=function(){var e=this;console.log("HomeView onEnable()"),Laya.Browser.onMiniGame?this.initWeixin():this.onGameDataLoaded(),h.default.loadZip(r.cdnUrl,"res",Laya.Handler.create(this,function(a){Laya.loader.load(r.StageTexUrl,Laya.Handler.create(e,function(){Laya.timer.frameLoop(1,e,e.onResEnable)}))}))},a.prototype.onResEnable=function(){i.default.instance&&i.default.instance.ballBox&&i.default.instance.cannon&&(i.default.instance&&1!=d.default.gameData.cannonType&&(i.default.instance.cannonType=d.default.gameData.cannonType,i.default.instance.newCannon()),this.refreshUnlock(),this.bindButtons(),Laya.timer.clear(this,this.onResEnable))},a.prototype.refresh_getDiamond=function(){var e=this;2==d.default.gameData.getDiamond?(this.finger_getDiamond.visible=!1,Laya.timer.clearAll(this.finger_getDiamond),this.btn_getDiamondYes.gray=!1,Laya.timer.clearAll(this.btn_getDiamondYes),Laya.timer.frameLoop(1,this.btn_getDiamondYes,function(){e.btn_getDiamondYes.scaleX+=.005,e.btn_getDiamondYes.scaleY+=.005,e.btn_getDiamondYes.scaleX>=1.1&&(e.btn_getDiamondYes.scaleX=1,e.btn_getDiamondYes.scaleY=1)}),this.btn_getDiamondYes.on(Laya.Event.MOUSE_DOWN,this,function(){d.default.gameData.diamond+=2e3,e.text_diamond.changeText(""+d.default.gameData.diamond),d.default.gameData.getDiamond=3,e.btn_getDiamond.offAll(),e.btn_getDiamondYes.offAll(),e.btn_getDiamondExit.offAll(),Laya.timer.clearAll(e.btn_getDiamondYes),e.box_getDiamond.visible=!1,e.btn_getDiamond.visible=!1,e.finger_getDiamond.visible=!1})):(this.btn_getDiamondYes.gray=!0,this.finger_getDiamond.visible=!0,Laya.timer.clearAll(this.finger_getDiamond),Laya.timer.clearAll(this.btn_getDiamondYes),Laya.timer.frameLoop(1,this.finger_getDiamond,function(){e.finger_getDiamond.right-=2,e.finger_getDiamond.right<=160&&(e.finger_getDiamond.right=220)}))},a.prototype.bindButton_getDiamond=function(){var e=this;3!==d.default.gameData.getDiamond?(this.box_getDiamond.visible&&this.refresh_getDiamond(),this.btn_getDiamond.visible=!0,this.btn_getDiamond.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_getDiamond.visible=!0,e.refresh_getDiamond()}),this.btn_getDiamondExit.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_getDiamond.visible=!1,e.finger_getDiamond.visible=!1,Laya.timer.clearAll(e.finger_getDiamond),Laya.timer.clearAll(e.btn_getDiamondYes)})):(this.box_getDiamond.visible=!1,this.btn_getDiamond.visible=!1,this.finger_getDiamond.visible=!1)},a.prototype.bindButtons=function(){var e=this;this.btn_start.on(Laya.Event.CLICK,this,function(){var a=e.btn_start.scaleX,t=e.btn_start.scaleY;Laya.Tween.to(e.btn_start,{alpha:.8,scaleX:.9*a,scaleY:.9*t},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){Laya.Tween.to(e.btn_start,{alpha:1,scaleX:a,scaleY:t},50,Laya.Ease.linearInOut,Laya.Handler.create(e,function(){i.default.instance&&i.default.instance.state!=r.GameState.START&&(console.log("click_startgame"),s.default.traceEvent("click_startgame"),e.hide(),i.default.instance.state=r.GameState.START,i.default.openInstance())}))}))}),this.btn_sound.on(Laya.Event.CLICK,this,function(){d.default.gameData.soundEnabled=!d.default.gameData.soundEnabled,e.btn_sound.gray=!d.default.gameData.soundEnabled,Laya.Browser.onMiniGame&&d.default.gameData.soundEnabled&&Laya.SoundManager.playSound(r.soundUrl)}),this.btn_vibration.on(Laya.Event.CLICK,this,function(){d.default.gameData.vibrationEnabled=!d.default.gameData.vibrationEnabled,e.btn_vibration.gray=!d.default.gameData.vibrationEnabled,Laya.Browser.onMiniGame&&d.default.gameData.vibrationEnabled&&l.default.vibrateShort()}),this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon),this.btn_trail.on(Laya.Event.CLICK,this,function(){e.box_trail.visible=!0,e.box_UI.visible=!1}),this.btn_trailBack.on(Laya.Event.MOUSE_DOWN,this,function(){e.box_trail.visible=!1,e.box_UI.visible=!0});for(var a=function(a){t["btn_trailUnlock"+a].on(Laya.Event.MOUSE_DOWN,t,function(){1==d.default.config.get_trail?m.default.instance.isOverVideo()?m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[a]++,e.updateTrailUnlock()}}):(e.mouseEnabled=!1,m.default.instance.video({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[a]++,e.updateTrailUnlock()},fail:function(){m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[a]++,e.updateTrailUnlock()}})},complete:function(){e.mouseEnabled=!0}})):2==d.default.config.get_trail&&m.default.instance.share({pos:r.RewardPos.Trail,success:function(){d.default.gameData.trailUnlockState[a]++,e.updateTrailUnlock()}})})},t=this,n=1;n<=Object.keys(r.TrailUnlock).length;n++)a(n);this.btn_test.gray=!this.isTest,this.btn_test.on(Laya.Event.CLICK,this,function(){e.isTest=!e.isTest,e.btn_test.gray=!e.isTest,e.testStageIdx=1})},a.prototype.onclick_cannon=function(){o.default.openInstance(),this.hide()},a.prototype.hide=function(){c.hideBanner(),this.visible=!1},a.prototype.initWeixin=function(){l.default.showShareMenu({withShareTicket:!0}),l.default.onShareAppMessage(function(){var e=s.default.createShareOptions({pos:"ShareAppButton"});return{title:e.title,imageUrl:e.imageUrl,query:e.query}}),s.default.init({host:"ws.lesscool.cn",version:r.VERSION,appid:1124,secret:"79ce022eb0ca47bfde9bc7e753df2074",share:{title:"全民欢乐，天天游戏！",image:"http://oss.lesscool.cn/fcdh/96d172496dbafa4ab9c8335a7133476c.png"}}),this.loginWs()},a.prototype.loginWs=function(){l.default.showLoading({title:"登录中",mask:!0}),s.default.onLoginComplete(this.onLoginComplete.bind(this)),s.default.login()},a.prototype.onLoginComplete=function(e,a){"success"===s.default.getLoginStatus()?(console.log("login_succeed"),s.default.traceEvent("login_succeed"),l.default.hideLoading(),console.log("ws.conf",s.default.conf),console.log("ws.user",s.default.user),console.log("ws.data",s.default.data),this.loadConfig(),this.loadGameData(a),s.default.user.can_record&&(window.require("libs/ald-game.js"),l.default.aldSendOpenid(s.default.user.openid))):"fail"===s.default.getLoginStatus()&&(console.log("login_failed"),s.default.traceEvent("login_failed"),l.default.hideLoading(),l.default.showModal({title:"登陆失败",content:"请允许授权",confirmText:"重新登陆",cancelText:"关闭",success:function(e){l.default.showLoading({title:"登录中",mask:!0}),s.default.login()}}))},a.prototype.loadConfig=function(){Object.assign(d.default.config,s.default.conf)},a.prototype.loadGameData=function(e){var a=this;e&&e.updateTimestamp?s.default.data&&s.default.data.updateTimestamp&&s.default.data.updateTimestamp>e.updateTimestamp?s.default.setAllData(s.default.data,!0):s.default.setAllData(e):s.default.data&&s.default.data.updateTimestamp||s.default.setAllData(d.default.gameData,!0),d.default.gameData=Object.assign(d.default.gameData,s.default.data),console.log("treasure banner hit from ws",d.default.gameData.treasureBannerHit),l.default.onHide(function(){a.updateGameData(!0)}),s.default.onShow(function(e){3!=d.default.gameData.getDiamond&&"1104"==e.scene&&(d.default.gameData.getDiamond=2),a.bindButton_getDiamond(),i.default.instance&&i.default.instance.state==r.GameState.BANNER_TOUCH&&(i.default.instance.state=r.GameState.START,d.default.gameData.treasureBannerHit++,d.default.gameData.lastTreasureBannerHitTimestamp=Date.now(),console.log("treasure banner hit",d.default.gameData.treasureBannerHit))}),this.nav=new u.default(s.default),this.box_homeIcon.visible=!0,this.nav.createHomeIcons(this.box_homeIcon,this.box_homeIcon,["home_icon_1","home_icon_2","home_icon_3","home_icon_4","home_icon_5","home_icon_6","home_icon_7","home_icon_8","home_icon_9","home_icon_10"]),this.box_drawer.visible=!0,this.onGameDataLoaded()},a.prototype.onGameDataLoaded=function(){console.log("onGameDataLoaded",d.default.gameData),this.isGameDataLoaded=!0,c.randomlyGetBanner("home"),c.showBanner(!0),this.refreshUnlock();var e=new Date,a=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();console.log("todayBeginTimestamp",a),console.log("lastTrailShowTimestamp",d.default.gameData.lastTrailShowTimestamp),(!d.default.gameData.lastTrailShowTimestamp||d.default.gameData.lastTrailShowTimestamp<a)&&(d.default.gameData.trailShowToday=!1,console.log("reset trail show")),console.log("lastTreasureBannerHitTimestamp",d.default.gameData.lastTreasureBannerHitTimestamp),(!d.default.gameData.lastTreasureBannerHitTimestamp||d.default.gameData.lastTreasureBannerHitTimestamp<a)&&(d.default.gameData.treasureBannerHit=0,console.log("reset banner hit")),this.updateTrailUnlock(),3!=d.default.gameData.getDiamond&&Laya.Browser.onMiniGame&&l.default.getLaunchOptionsSync&&"1104"==l.default.getLaunchOptionsSync().scene&&(d.default.gameData.getDiamond=2),this.bindButton_getDiamond(),this.systemName="Android",Laya.Browser.onMiniGame&&l.default.getSystemInfoSync().system.indexOf("iOS")>=0&&(this.systemName="IOS"),console.log(this.systemName),this.label_level.changeText("关卡："+d.default.gameData.stageIndex),this.label_level.visible=!0,this.text_diamond.changeText(""+d.default.gameData.diamond),this.icon_diamond.visible=!0},a.prototype.updateGameData=function(e){d.default.gameData.updateTimestamp=Date.now(),e&&console.log("updateGameData",d.default.gameData),Laya.Browser.onMiniGame&&s.default.setAllData(d.default.gameData,e)},a.prototype.onIconClick=function(e,a,t){void 0===t&&(t=!0),s.default.tapGameAd({pos:e,ad:a,redirect:t})},a.prototype.refreshUnlock=function(){var e=this;(d.default.gameData.tutorialStep<6||1===d.default.gameData.stageIndex&&6===d.default.gameData.tutorialStep)&&(d.default.gameData.tutorialStep=0,this.lock_cannon.visible=!0,this.btn_cannon.visible=!1,this.btn_cannon.off(Laya.Event.CLICK,this,this.onclick_cannon)),(d.default.gameData.tutorialStep>=6||d.default.gameData.stageIndex>2)&&(this.lock_cannon.visible=!1,this.btn_cannon.visible=!0,this.btn_cannon.on(Laya.Event.CLICK,this,this.onclick_cannon)),d.default.gameData.stageIndex<2?(this.lock_trail.visible=!0,this.btn_trail.visible=!1,this.btn_trail.offAll(Laya.Event.CLICK)):(this.lock_trail.visible=!1,this.btn_trail.visible=!0,this.btn_trail.on(Laya.Event.CLICK,this,function(){e.box_trail.visible=!0}))},a.prototype.updateTrailUnlock=function(){for(var e=this,a=function(a){void 0==d.default.gameData.trailUnlockState[a]&&(d.default.gameData.trailUnlockState[a]=0),-1==r.TrailUnlock[a]?(t["btn_trailUnlock"+a].visible=!1,t["btn_trailSelect"+a].visible=!1,t["trailUsing"+a].visible=!1,t["trailWait"+a].visible=!0):d.default.gameData.trailUnlockState[a]>=r.TrailUnlock[a]?(t["btn_trailUnlock"+a].visible=!1,t["trailWait"+a].visible=!1,d.default.gameData.trailType==a?(t["btn_trailSelect"+a].visible=!1,t["trailUsing"+a].visible=!0):(t["btn_trailSelect"+a].visible=!0,t["trailUsing"+a].visible=!1)):(t["label_trailUnlockMsg"+a].changeText("观看视频"+d.default.gameData.trailUnlockState[a]+"/"+r.TrailUnlock[a]),t["btn_trailUnlock"+a].visible=!0,t["btn_trailSelect"+a].visible=!1,t["trailUsing"+a].visible=!1,t["trailWait"+a].visible=!1),t["btn_trailSelect"+a].on(Laya.Event.MOUSE_DOWN,t,function(){e["btn_trailSelect"+d.default.gameData.trailType].visible=!0,e["trailUsing"+d.default.gameData.trailType].visible=!1,d.default.gameData.trailType=a,e["btn_trailSelect"+a].visible=!1,e["trailWait"+a].visible=!1,e["trailUsing"+a].visible=!0,i.default.instance&&i.default.instance.newTrail()})},t=this,n=1;n<=Object.keys(r.TrailUnlock).length;n++)a(n)},a}(n.ui.home.HomeViewUI);t.default=f},{"../Const":3,"../Global":4,"../component/Reward":8,"../utils/Ad":13,"../utils/Loader":14,"../utils/Navigator":15,"../utils/ws.js":16,"../utils/wx":17,"./../../ui/layaMaxUI":18,"./CannonSelect":10,"./GameScene":11}],13:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=e("./wx"),o=e("./ws.js"),r=e("../Global"),l=!0,s=null,d=0,c={},u={},h={},m={};t.randomlyGetBanner=function(e){if(Laya.Browser.onMiniGame&&i.default.createBannerAd){if(0===Object.keys(u).length)for(var a=1;a<=r.default.config.banner_number;a++)u[a]=r.default.config.banner[a],console.log("init uid: ",a,u[a]),c[a]=t.wxCreatBanner(u[a]),console.log("init bannerAD: ",a,c[a]),h[a]=0,m[a]=0,c[a].onError(function(e){console.log("banner onError :",e)});n=Math.ceil(Math.random()*r.default.config.banner_number),"home"==e?(h[n]>=r.default.config.show_number&&(c[n]&&c[n].destroy(),c[n]=t.wxCreatBanner(u[n]),h[n]=0),h[n]++):"treasure"==e&&(m[n]>=r.default.config.show_number_t&&(c[n]&&c[n].destroy(),c[n]=t.wxCreatBanner(u[n]),m[n]=0),m[n]++)}},t.wxCreatBanner=function(e){if(Laya.Browser.onMiniGame&&i.default.createBannerAd){var a=i.default.getSystemInfoSync(),t=a.screenHeight,n=a.screenWidth,o=Math.max(300,300*n/350),r=.348*o,l=t-r,s=(n-o)/2;return i.default.createBannerAd({adUnitId:e,style:{left:s,top:l,width:o,height:r}})}},t.setStyle=function(e,a,t){if(Laya.Browser.onMiniGame&&e){var n=i.default.getSystemInfoSync(),o=n.screenHeight,r=n.screenWidth,l=r;a&&(l=Math.max(300,300*r/350));var s=.348*l,d=o-s;-1!==t&&(d=t/Laya.stage.height*o);var c=(r-l)/2;e.style.left=c,e.style.top=d,e.style.width=l,e.style.height=s}},t.showBanner=function(e,a){void 0===e&&(e=!1),void 0===a&&(a=-1),Laya.Browser.onMiniGame&&(t.setStyle(c[n],e,a),c[n]&&c[n].show(),console.log("show banner uid: ",n,"bannerAD: ",c[n]))},t.hideBanner=function(){if(Laya.Browser.onMiniGame)for(var e=1;e<=Object.keys(c).length;e++)c[e]&&c[e].hide()},t.refreshCurrentBanner=function(){d++,s&&d>=r.default.config.banner_click_time&&(d=0,t.posShowBanner(s,!0))},t.hasVideoAd=function(){return l},t.posShowBanner=function(e,a){if(void 0===a&&(a=!1),Laya.Browser.onMiniGame){var t=i.default.getSystemInfoSync(),n=t.screenHeight,r=t.screenWidth,l=Math.max(300,300*r/350),d=.348*l,c=n-d,u=(r-l)/2;return s=e,o.default.createBanner({pos:e,style:{left:u,top:c,width:l,height:d},force:a})}},t.posHideBanner=function(e){Laya.Browser.onMiniGame&&(s=null,o.default.closeBanner(e))},t.posShowVideo=function(e,a,t){Laya.Browser.onMiniGame&&o.default.createVideo?o.default.createVideo({pos:e,success:function(e){t&&t(e)},fail:function(e){l=!1,console.log("NO VIDEO AD"),console.log("error res: ",e),r.default.gameData.videoCount<=11?o.default.traceEvent("errVideoCnt_"+r.default.gameData.videoCount):o.default.traceEvent("errVideoCnt_11"),e&&e.errMsg&&(o.default.traceEvent("errCode_"+e.errCode),r.default.gameData.videoErr["errCode_"+e.errCode]=e.errMsg,console.log("errCode: "+e.errCode),console.log("errMsg: "+e.errMsg)),a&&a()}}):(l=!1,console.log("NO VIDEO AD"),a&&a())}},{"../Global":4,"./ws.js":16,"./wx":17}],14:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.wx,i=function(){function e(){this.debug=!0,this.failCount=0}return e.prototype.log=function(e){for(var a=[],t=1;t<arguments.length;t++)a[t-1]=arguments[t];this.debug&&console.log.apply(this,arguments)},e.prototype.stat=function(e,a){var t=n.getFileSystemManager().statSync(e);if(t.isDirectory())for(var i=0,o=n.getFileSystemManager().readdirSync(e);i<o.length;i++){var r=o[i];try{this.stat(e+"/"+r,a)}catch(a){this.log("stat fail: "+e+"/"+r,a)}}else a[e]=t},e.prototype.loadZip=function(e,a,t,n){Laya.Browser.onMiniGame&&e?(this.failCount=0,this.unzipFile(e,a,t,n)):t&&t.runWith(!1)},e.prototype.unzipFile=function(e,a,t,i){var o=this,r=e.split("/"),l=r[r.length-1],s=n.env.USER_DATA_PATH+"/zip/",d=s+l,c=Laya.MiniFileMgr.getFileNativePath("");n.getFileSystemManager().unzip({zipFilePath:d,targetPath:c,success:function(){o.log("unzip success");var e={};try{o.stat(c+a,e),o.log("stat success")}catch(e){return o.log("stat fail",e),o.cleanDir(c+a),void(t&&t.runWith(!1))}var n=[];for(var i in e){var r=i.replace(c,""),l=Laya.Utils.getFileExtension(r);-1===[].indexOf(l)&&n.push([i,r])}if(n.length){Laya.MiniFileMgr.filesListObj.fileUsedSize||(Laya.MiniFileMgr.filesListObj.fileUsedSize=0);for(var s=0;s<n.length;s++){var d=n[s],i=d[0],r=d[1],u=e[i].size||0,h=o.getEncoding(r);if(Laya.MiniFileMgr.filesListObj[r]){var m=parseInt(Laya.MiniFileMgr.filesListObj[r].size)||0;Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u-m}else Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)+u;Laya.MiniFileMgr.filesListObj[r]={md5:r,readyUrl:r,size:u,times:Laya.Browser.now(),encoding:h}}o.saveFileListObj(),t&&t.runWith(!0)}else t&&t.runWith(!1)},fail:function(r){if(o.log("unzip fail"),o.failCount++,o.failCount>=3)t&&t.runWith(!1);else{try{n.getFileSystemManager().accessSync(s),o.cleanDir(s,i),o.cleanDir(c+a)}catch(e){o.log("mkdir",s),n.getFileSystemManager().mkdir({dirPath:s})}n.downloadFile({url:e,filePath:d,success:function(){o.log("downloadFile success"),o.unzipFile(e,a,t,i)},fail:function(){o.log("downloadFile fail"),t&&t.runWith(!1)}})}}})},e.prototype.cleanDir=function(e,a){var t=this;"/"===e.charAt(e.length-1)&&(e=e.slice(0,e.length-1));var i={};try{this.stat(e,i),this.log("cleanDir stat success")}catch(e){this.log("cleanDir stat fail")}for(var o in i){if(a&&a.length){s=o.replace(e+"/","");if(-1!==a.indexOf(s))continue}n.getFileSystemManager().unlink({filePath:o,success:function(){t.log("unlink success")},fail:function(){t.log("unlink fail")}})}if(0===(e+"/").indexOf(Laya.MiniFileMgr.getFileNativePath(""))){var r=!1,l=(e+"/").replace(Laya.MiniFileMgr.getFileNativePath(""),"");this.log("cleanDir: ",l);for(var s in Laya.MiniFileMgr.filesListObj)if(0===s.indexOf(l)){r=!0;var d=Laya.MiniFileMgr.filesListObj[s];Laya.MiniFileMgr.filesListObj.fileUsedSize=parseInt(Laya.MiniFileMgr.filesListObj.fileUsedSize)-(parseInt(d.size)||0),delete Laya.MiniFileMgr.filesListObj[s]}r&&l&&this.saveFileListObj()}},e.prototype.saveFileListObj=function(){n.getFileSystemManager().writeFile({filePath:Laya.MiniFileMgr.fileNativeDir+"/"+Laya.MiniFileMgr.fileListName,encoding:"utf8",data:JSON.stringify(Laya.MiniFileMgr.filesListObj)}),this.log("filesListObj",Laya.MiniFileMgr.filesListObj)},e.prototype.getEncoding=function(e){var a,t=Laya.Loader.getTypeFromUrl(e);if(!t){switch(Laya.Utils.getFileExtension(e)){case"lh":case"ls":case"lmat":case"ltc":case"lav":a="json";break;case"lm":case"lani":a="arraybuffer"}if(a)return Laya.MiniAdpter.getUrlEncode(e,a)}switch(t){case"atlas":case"prefab":case"plf":a="json";break;case"font":a="xml";break;case"plfb":case"image":case"sound":a="arraybuffer";break;default:a=t}return Laya.MiniAdpter.getUrlEncode(e,a)},e}();t.default=new i},{}],15:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=e("../runtime/GameScene"),i=function(){function e(e){this.iconData=[],this.ws=e,this.SCALE=Laya.stage.width/720}return e.prototype.createHomeIcons=function(e,a,t){var n=this;if(Laya.Browser.onMiniGame){if(t&&t.length){var i=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var l=new Laya.List;l.width=720*this.SCALE,l.height=790*this.SCALE,l.x=0,l.y=240*this.SCALE,l.mouseThrough=!0,l.spaceY=45*this.SCALE,l.spaceX=468*this.SCALE,l.repeatY=5,l.repeatX=2,r.addChild(l);var s=this.SCALE,d=function(e){function a(){var a=e.call(this)||this;a.width=106*s,a.height=106*s,a.pivotX=53*s,a.pivotY=53*s,a.x=73*s,a.y=73*s,a.visible=!1;var t=new Laya.Sprite;t.name="iconImage",t.width=106*s,t.height=106*s,t.x=0,t.y=0,a.addChild(t);var n=new Laya.Sprite;n.name="tips",n.scaleX=-1,n.width=36*s,n.height=36*s,n.x=116*s,n.y=-10*s,n.loadImage("res/texture/navigator/tips2.png"),a.addChild(n);var i=new Laya.Label;return i.name="titleLabel",i.width=106*s,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*s),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*s,i.x=53*s,a.addChild(i),a}return __extends(a,e),a}(Laya.Box);l.itemRender=d,l.renderHandler=Laya.Handler.create(this,function(e,a){var t=l.array[a];if(t){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",t]);var i=e.getChildByName("iconImage");i&&i.loadImage(t.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(t.title),n.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var c=function(){if(r&&r.activeInHierarchy&&a&&a.visible){for(var e=0;e<i.length;e++){var t=i[e],s=n.getRandom(t);o[e]=s}l.array=o,l.refresh()}};return this.loadHomeIconInfoList=function(){n.ws.getPromoGameAd({count:t.length,success:function(e){var a=e.data;i=[];for(var l=0;l<Math.min(a.length,t.length);l++){var s=a[l];i.push([s])}o=[],r.clearTimer(n,c),c(),r.timer.frameLoop(180,n,c)}})},this.loadHomeIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createGameIcons=function(){var e=this;Laya.Browser.onMiniGame&&n.default.instance&&this.ws.getPromoGameAd({count:10,success:function(a){var t=a.data;e.iconData=a.data;for(var i=0;i<10;i++){var o=n.default.instance.box_gameIcon.getChildAt(i);if(i<t.length&&t[i]&&o){o.visible=!0,o.on(Laya.Event.MOUSE_DOWN,e,e.onIconClick,["default",t[i]]),o.loadImage(t[i].icon);var r=o.getChildByName("iconTitle");r&&r.changeText(t[i].title),e.shakeOnce(1e3*Math.random(),o)}else o.visible=!1}}})},e.prototype.randomIconTap=function(e,a,t){var n=this;this.iconData&&0!=this.iconData.length?this.ws.tapGameAd({pos:e,ad:this.iconData[Math.floor(Math.random()*this.iconData.length)],redirect:!0,success:a,fail:t}):this.ws.getPromoGameAd({count:10,success:function(i){n.iconData=i.data,n.ws.tapGameAd({pos:e,ad:n.iconData[Math.floor(Math.random()*n.iconData.length)],redirect:!0,success:a,fail:t})}})},e.prototype.createDrawer=function(e,a){var t=this;{if(Laya.Browser.onMiniGame){var n=new Laya.Box;n.width=720*this.SCALE,n.height=1280*this.SCALE,n.centerX=0,n.centerY=0,n.mouseThrough=!0,e.addChild(n);var i=new Laya.Image;i.width=720*this.SCALE,i.height=1600*this.SCALE,i.centerX=0,i.centerY=0,i.mouseThrough=!1,i.mouseEnabled=!0,i.visible=!1,i.skin="res/texture/navigator/blank.png",i.sizeGrid="1,1,1,1",n.addChild(i);var o=new Laya.Box;o.width=720*this.SCALE,o.height=1280*this.SCALE,o.centerX=-480*this.SCALE,o.centerY=0,o.mouseThrough=!0,n.addChild(o);var r=new Laya.Sprite;r.width=480*this.SCALE,r.height=665*this.SCALE,r.x=0,r.y=120*this.SCALE,r.loadImage("res/texture/navigator/drawer_panel.png"),o.addChild(r);var l=new Laya.List;l.width=380*this.SCALE,l.height=540*this.SCALE,l.x=40*this.SCALE,l.y=85*this.SCALE,l.mouseThrough=!0,l.spaceY=40*this.SCALE,l.spaceX=30*this.SCALE,l.repeatX=3,r.addChild(l);var s=this.SCALE,d=function(e){function a(){var a=e.call(this)||this;a.width=106*s,a.height=106*s,a.x=0,a.y=0,a.visible=!1;var t=new Laya.Sprite;t.name="iconImage",t.width=106*s,t.height=106*s,t.x=0,t.y=0,a.addChild(t);var n=new Laya.Sprite;n.name="tips",n.width=59*s,n.height=32*s,n.x=60*s,n.y=-10*s,n.loadImage("res/texture/navigator/tips.png"),a.addChild(n);var i=new Laya.Label;i.name="tipsLabel",i.width=42*s,i.height=18*s,i.valign="middle",i.align="center",i.fontSize=Math.round(18*s),i.font="Arial",i.color="#ffffff",i.x=9*s,i.y=6*s,n.addChild(i);var o=new Laya.Label;return o.name="titleLabel",o.width=106*s,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(18*s),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=53*s,o.y=110*s,a.addChild(o),a}return __extends(a,e),a}(Laya.Box);l.itemRender=d,l.renderHandler=Laya.Handler.create(this,function(e,n){var i=l.array[n];if(i){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,t,t.onIconClick,[a,i]);var o=e.getChildByName("iconImage");o&&o.loadImage(i.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(i.title);var s=e.getChildByName("tips");if(s){var d=s.getChildByName("tipsLabel");d&&d.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1);var c=new Laya.Sprite;c.width=88*this.SCALE,c.height=74*this.SCALE,c.x=480*this.SCALE,c.y=40*this.SCALE,c.loadImage("res/texture/navigator/drawer_button.png"),c.visible=!1,r.addChild(c);var u=new Laya.Sprite;u.width=39*this.SCALE,u.height=49*this.SCALE,u.scaleX=-1,u.x=55*this.SCALE,u.y=12*this.SCALE,u.loadImage("res/texture/navigator/arrow.png"),c.addChild(u);var h=new Laya.Sprite;h.width=88*this.SCALE,h.height=74*this.SCALE,h.x=480*this.SCALE,h.y=40*this.SCALE,h.loadImage("res/texture/navigator/drawer_button.png"),h.visible=!0,r.addChild(h);var m=new Laya.Sprite;m.width=39*this.SCALE,m.height=49*this.SCALE,m.x=23*this.SCALE,m.y=12*this.SCALE,m.loadImage("res/texture/navigator/arrow.png"),h.addChild(m),h.on(Laya.Event.MOUSE_DOWN,this,function(){t.ws.getGameAd({pos:a,count:t.ws.conf.games[a].length,success:function(e){var a=e.data;l.array=a,l.refresh()}}),i.visible=!0,Laya.Tween.to(o,{centerX:0},300,Laya.Ease.linearNone,Laya.Handler.create(t,function(){h.visible=!1,c.visible=!0}))}),c.on(Laya.Event.MOUSE_DOWN,this,function(){t.ws.hideGameAd(a),Laya.Tween.to(o,{centerX:-480*s},300,Laya.Ease.linearNone,Laya.Handler.create(t,function(){h.visible=!0,c.visible=!1,i.visible=!1}))});var f=Math.round(13*this.SCALE),g=Math.round(28*this.SCALE),y=!1;return n.timerLoop(500,this,function(){y?(m.x=g,y=!1):(m.x=f,y=!0)}),n}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createMoreGame=function(e,a,t){var n=this;{if(Laya.Browser.onMiniGame){var i=new Laya.Box;i.width=720*this.SCALE,i.height=1280*this.SCALE,i.centerX=0,i.centerY=0,i.mouseThrough=!0,i.visible=!1,e.addChild(i);var o=new Laya.Image;o.width=720*this.SCALE,o.height=1600*this.SCALE,o.centerX=0,o.centerY=0,o.mouseThrough=!1,o.mouseEnabled=!0,o.skin="res/texture/navigator/blank.png",o.sizeGrid="1,1,1,1",i.addChild(o);var r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,i.addChild(r);var l=new Laya.Sprite;l.width=586*this.SCALE,l.height=806*this.SCALE,l.loadImage("res/texture/navigator/moregame_panel.png"),l.x=67*this.SCALE,l.y=137*this.SCALE,r.addChild(l);var s=new Laya.Sprite;s.x=538*this.SCALE,s.y=-12*this.SCALE,s.width=59*this.SCALE,s.height=62*this.SCALE,s.loadImage("res/texture/navigator/close_button.png"),l.addChild(s);var d=new Laya.Image;d.width=110*this.SCALE,d.height=110*this.SCALE,d.pivotY=55*this.SCALE,d.pivotX=55*this.SCALE,d.centerX=285*this.SCALE,d.centerY=-465*this.SCALE,d.loadImage("res/texture/navigator/more_game_button.png",Laya.Handler.create(this,function(){i.timerLoop(1005,n,function(){Laya.Tween.to(d,{scaleX:.9*u,scaleY:.9*u},500,Laya.Ease.linearNone,Laya.Handler.create(n,function(){Laya.Tween.to(d,{scaleX:u,scaleY:u},500,Laya.Ease.linearNone)}))})})),a.addChild(d);var c=new Laya.List;c.width=500*this.SCALE,c.height=640*this.SCALE,c.centerX=10*this.SCALE,c.centerY=5*this.SCALE,c.spaceY=50*this.SCALE,c.spaceX=40*this.SCALE,c.repeatX=3,l.addChild(c);var u=this.SCALE,h=function(e){function a(){var a=e.call(this)||this;a.width=132*u,a.height=132*u,a.x=0,a.y=0,a.visible=!1;var t=new Laya.Sprite;t.name="iconImage",t.width=132*u,t.height=132*u,t.x=0,t.y=-2*u,a.addChild(t);var n=new Laya.Sprite;n.name="tips",n.width=59*u,n.height=32*u,n.x=90*u,n.y=-10*u,n.loadImage("res/texture/navigator/tips.png"),a.addChild(n);var i=new Laya.Label;i.name="tipsLabel",i.width=42*u,i.height=18*u,i.valign="middle",i.align="center",i.fontSize=Math.round(18*u),i.font="Arial",i.color="#ffffff",i.x=9*u,i.y=6*u,n.addChild(i);var o=new Laya.Label;return o.name="titleLabel",o.width=132*u,o.overflow="visible",o.valign="middle",o.align="center",o.fontSize=Math.round(22*u),o.font="Arial",o.color="#1d3b63",o.anchorY=0,o.anchorX=.5,o.x=66*u,o.y=138*u,a.addChild(o),a}return __extends(a,e),a}(Laya.Box);return c.itemRender=h,c.renderHandler=Laya.Handler.create(this,function(e,a){var i=c.array[a];if(i){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,[t,i]);var o=e.getChildByName("iconImage");o&&o.loadImage(i.icon);var r=e.getChildByName("titleLabel");r&&r.changeText(i.title);var l=e.getChildByName("tips");if(l){var s=l.getChildByName("tipsLabel");s&&s.changeText(Math.random()>.5?"热门":"NEW")}}else e.visible=!1},[],!1),d.on(Laya.Event.MOUSE_DOWN,this,function(){n.ws.getGameAd({pos:t,count:n.ws.conf.games[t].length,success:function(e){var a=e.data;c.array=a,c.refresh()}}),i.visible=!0,d.visible=!1}),s.on(Laya.Event.MOUSE_DOWN,this,function(){n.ws.hideGameAd(t),d.visible=!0,i.visible=!1}),i}console.log("Laya.Browser.onMiniGame is false!")}},e.prototype.createOverIcons=function(e,a,t){var n=this;if(Laya.Browser.onMiniGame){if(t&&t.length){var i=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var l=new Laya.List;l.width=720*this.SCALE,l.height=470*this.SCALE,l.x=0,l.y=180*this.SCALE,l.mouseThrough=!0,l.spaceY=45*this.SCALE,l.spaceX=468*this.SCALE,l.repeatY=3,l.repeatX=2,r.addChild(l);var s=this.SCALE,d=function(e){function a(){var a=e.call(this)||this;a.width=106*s,a.height=106*s,a.pivotX=53*s,a.pivotY=53*s,a.x=73*s,a.y=73*s,a.visible=!1;var t=new Laya.Sprite;t.name="iconImage",t.width=106*s,t.height=106*s,t.x=0,t.y=0,a.addChild(t);var n=new Laya.Sprite;n.name="tips",n.scaleX=-1,n.width=36*s,n.height=36*s,n.x=116*s,n.y=-10*s,n.loadImage("res/texture/navigator/tips2.png"),a.addChild(n);var i=new Laya.Label;return i.name="titleLabel",i.width=106*s,i.overflow="visible",i.valign="middle",i.align="center",i.fontSize=Math.round(18*s),i.font="Arial",i.color="#1d3b63",i.anchorY=0,i.anchorX=.5,i.y=110*s,i.x=53*s,a.addChild(i),a}return __extends(a,e),a}(Laya.Box);l.itemRender=d,l.renderHandler=Laya.Handler.create(this,function(e,a){var t=l.array[a];if(t){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",t]);var i=e.getChildByName("iconImage");i&&i.loadImage(t.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(t.title),n.shakeOnce(1e3*Math.random(),e)}else e.visible=!1},[],!1);var c=function(){if(r&&r.activeInHierarchy&&a&&a.visible){for(var e=0;e<i.length;e++){var t=i[e],s=n.getRandom(t);o[e]=s}l.array=o,l.refresh()}};return this.loadOverIconInfoList=function(){n.ws.getPromoGameAd({count:t.length,success:function(e){var a=e.data;i=[];for(var l=0;l<Math.min(a.length,t.length);l++){var s=a[l];i.push([s])}o=[],r.clearTimer(n,c),c(),r.timerLoop(3e3,n,c)}})},this.loadOverIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.createGuessLikeIcons=function(e,a,t){var n=this;if(Laya.Browser.onMiniGame){if(t&&t.length){var i=[],o=[],r=new Laya.Box;r.width=720*this.SCALE,r.height=1280*this.SCALE,r.centerX=0,r.centerY=0,r.mouseThrough=!0,e.addChild(r);var l=new Laya.Sprite;l.width=560*this.SCALE,l.height=188*this.SCALE,l.y=670*this.SCALE,l.x=80*this.SCALE,l.loadImage("res/texture/navigator/guessyoulike.png"),r.addChild(l);var s=new Laya.List;s.width=500*this.SCALE,s.height=208*this.SCALE,s.x=60*this.SCALE,s.y=-20*this.SCALE,s.mouseThrough=!0,s.spaceY=45*this.SCALE,s.spaceX=18*this.SCALE,s.repeatY=1,s.repeatX=4,l.addChild(s);var d=this.SCALE,c=function(e){function a(){var a=e.call(this)||this;a.width=106*d,a.height=106*d,a.pivotX=53*d,a.pivotY=53*d,a.x=63*d,a.y=108*d,a.visible=!1;var t=new Laya.Sprite;t.name="iconImage",t.width=106*d,t.height=106*d,t.x=0,t.y=0,a.addChild(t);var n=new Laya.Label;return n.name="titleLabel",n.width=106*d,n.overflow="visible",n.valign="middle",n.align="center",n.fontSize=Math.round(18*d),n.font="Arial",n.color="#1d3b63",n.anchorY=0,n.anchorX=.5,n.y=110*d,n.x=53*d,a.addChild(n),a}return __extends(a,e),a}(Laya.Box);s.itemRender=c,s.renderHandler=Laya.Handler.create(this,function(e,a){var t=s.array[a];if(t){e.visible=!0,e.on(Laya.Event.MOUSE_DOWN,n,n.onIconClick,["default",t]);var i=e.getChildByName("iconImage");i&&i.loadImage(t.icon);var o=e.getChildByName("titleLabel");o&&o.changeText(t.title),n.jumpeOnce(150*a,e)}else e.visible=!1},[],!1);var u=function(){if(r&&r.activeInHierarchy&&a&&a.visible){for(var e=0;e<i.length;e++){var t=i[e],l=n.getRandom(t);o[e]=l}s.array=o,s.refresh()}};return this.loadGuessLikeIconInfoList=function(){n.ws.getPromoGameAd({count:t.length,success:function(e){var a=e.data;i=[];for(var l=Math.max(a.length-t.length,0);l<a.length;l++){var s=a[l];i.push([s])}o=[],r.clearTimer(n,u),u(),r.timerLoop(3e3,n,u)}})},this.loadGuessLikeIconInfoList(),r}console.log("posList is empty!")}else console.log("Laya.Browser.onMiniGame is false!")},e.prototype.onIconClick=function(e,a,t){void 0===t&&(t=!0),this.ws.tapGameAd({pos:e,ad:a,redirect:t})},e.prototype.shakeOnce=function(e,a){var t=this;a.timerOnce(e,this,function(){Laya.Tween.to(a,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.timer.clearAll(a)}))}))}))}))}))}),this.blinkTips(e,a)},e.prototype.jumpeOnce=function(e,a){var t=this,n=a.y;a.timerOnce(e,this,function(){Laya.Tween.to(a,{rotation:-10},100,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:10},200,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:-5},150,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:5},100,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.Tween.to(a,{rotation:0},50,Laya.Ease.linearNone,Laya.Handler.create(t,function(){Laya.timer.clearAll(a)}))}))}))}))})),Laya.Tween.to(a,{y:n-50},200,Laya.Ease.sineOut,Laya.Handler.create(t,function(){Laya.Tween.to(a,{y:n},200,Laya.Ease.sineIn)}))}),this.blinkTips(e,a)},e.prototype.blinkTips=function(e,a){var t=this,n=a.getChildByName("tips");n&&n.timerOnce(e,this,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(t,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(t,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(t,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(t,function(){Laya.Tween.to(n,{alpha:0},500,Laya.Ease.sineIn,Laya.Handler.create(t,function(){Laya.Tween.to(n,{alpha:1},500,Laya.Ease.sineOut,Laya.Handler.create(t,function(){Laya.timer.clearAll(n)}))}))}))}))}))}))})},e.prototype.randomIndex=function(e,a,t){void 0===a&&(a="weight"),void 0===t&&(t=0);var n=[],i=0;if(e&&e.length)for(s=0;s<e.length;s++){var o=e[s],r=Number(o[a])||t||0;n[s]=[i,i+r],i+=r}if(i>0)for(var l=Math.random()*i,s=0;s<n.length;s++){var d=n[s];if(d[0]<=l&&l<d[1])return s}return 0},e.prototype.getRandom=function(e,a,t){return void 0===a&&(a="weight"),void 0===t&&(t=0),e&&e.length?1===e.length?e[0]:e[this.randomIndex(e,a,t)]:null},e}();t.default=i},{"../runtime/GameScene":11}],16:[function(e,a,t){a.exports.default=function(e){function a(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,a),i.loaded=!0,i.exports}var t={};return a.m=e,a.c=t,a.p="",a(0)}([function(e,a,t){"use strict";var n,i=(n=t(1))&&n.__esModule?n:{default:n},o=t(4),r=t(5),l=t(6),s=t(7),d=t(8),c=t(9),u=t(10),h=t(11),m=t(12),f=t(13),g=t(2),y=t(14);(0,g.initUtil)(i.default),(0,o.initHTTP)(i.default),(0,r.initUser)(i.default),(0,l.initConfig)(i.default),(0,s.initData)(i.default),(0,d.initShare)(i.default),(0,c.initProcess)(i.default),(0,u.initPayment)(i.default),(0,h.initAD)(i.default),(0,m.initHook)(i.default),(0,f.initInvite)(i.default),(0,y.initEvent)(i.default),e.exports=window.ws=i.default},function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n,i=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o=(n=t(2))&&n.__esModule?n:{default:n},r={tmp:{},options:{scheme:"https://",host:"api.websdk.cn",apiVersion:"v1",USER_KEY:"ws_user",CONF_KEY:"ws_conf",DATA_KEY:"ws_data",share10:!0,commonDuration:120,allowAld:!1},conf:{},user:{},data:{},version:"1.0.1",mode:"default",debug:!0,shareCallbackData:{},shareTempData:{},shareGiftTempData:{},_initCallbacks:[],_showCallbacks:[],_hideCallbacks:[],_afterHideCallbacks:[],_shareCallbacks:[],_openFromShareCallbacks:[],_openFromCodeCallbacks:[],_onInit:function(){var e=!0,a=!1,t=void 0;try{for(var n,i=this._initCallbacks[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var o=n.value;o&&o()}}catch(e){a=!0,t=e}finally{try{!e&&i.return&&i.return()}finally{if(a)throw t}}},_onShow:function(e){if(console.log("onShow:",e,"mode:",this.mode),"default"!==this.mode)this.shareCallbackData&&this.shareCallbackData.callback&&"shareAppMessage"==this.mode&&(this.shareCallbackData.callback(e,Date.now()-this.shareCallbackData.ms),this.shareCallbackData={}),this.mode="default";else{var a=!0,t=!1,n=void 0;try{for(var i,o=this._showCallbacks[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var l=i.value;l&&l(e)}}catch(e){t=!0,n=e}finally{try{!a&&o.return&&o.return()}finally{if(t)throw n}}if(e.query&&"share"===e.query.type?r._openFromShare("onShow",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onShow",e.query.scene,e),this.user&&e.shareTicket&&e.query&&e.query.uid==this.user.id)for(var s in this.shareTempData)s==e.query.share_tid&&r._shareCallback(this.shareTempData[s],e)}},_onHide:function(e){if(console.log("onHide:",e,"mode:",this.mode),"default"===this.mode){var a=!0,t=!1,n=void 0;try{for(var i,o=this._hideCallbacks[Symbol.iterator]();!(a=(i=o.next()).done);a=!0){var r=i.value;r&&r(e)}}catch(e){t=!0,n=e}finally{try{!a&&o.return&&o.return()}finally{if(t)throw n}}var l=!0,s=!1,d=void 0;try{for(var c,u=this._afterHideCallbacks[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var h=c.value;h&&h(e)}}catch(e){s=!0,d=e}finally{try{!l&&u.return&&u.return()}finally{if(s)throw d}}}},_openFromShare:function(e,a,t){var n=!0,i=!1,o=void 0;try{for(var r,l=this._openFromShareCallbacks[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var s=r.value;s&&s({from:e,query:a,options:t})}}catch(e){i=!0,o=e}finally{try{!n&&l.return&&l.return()}finally{if(i)throw o}}},_openFromCode:function(e,a,t){r.get({url:"/share/qrcode",data:{scene:a},success:function(n){var i=!0,o=!1,l=void 0;try{for(var s,d=r._openFromCodeCallbacks[Symbol.iterator]();!(i=(s=d.next()).done);i=!0){var c=s.value;c&&c({from:e,scene:a,options:t,query:n.data})}}catch(e){o=!0,l=e}finally{try{!i&&d.return&&d.return()}finally{if(o)throw l}}}})},_shareCallback:function(e,a){wx.getShareInfo({shareTicket:a.shareTicket,success:function(t){e.onShareTicketSuccess&&e.onShareTicketSuccess(t),r.shareLog(e,"click",a.shareTicket,t,a)}.bind(this),fail:function(t){e.onShareTicketFail&&e.onShareTicketFail(t),r.shareLog(e,"click",a.shareTicket,{},a)}.bind(this)})},onInit:function(e){this._initCallbacks.push(e)},onShow:function(e){this._showCallbacks.push(e)},onHide:function(e){this._hideCallbacks.push(e)},afterHide:function(e){this._afterHideCallbacks.push(e)},openFromShare:function(e){this._openFromShareCallbacks.push(e)},openFromCode:function(e){this._openFromCodeCallbacks.push(e)},init:function(e){this.options=i({},o.default.copy(e,this.options)),this.systemInfo=wx.getSystemInfoSync(),this.launchOptions=wx.getLaunchOptionsSync(),this.user=wx.getStorageSync(this.options.USER_KEY),this.conf=wx.getStorageSync(this.options.CONF_KEY),this.data=wx.getStorageSync(this.options.DATA_KEY),this.log("conf:",this.conf),wx.onShow(this._onShow.bind(this)),wx.onHide(this._onHide.bind(this))},onLogined:function(){var e=this.launchOptions;e.query&&"share"===e.query.type?r._openFromShare("onLaunch",e.query,e):e.query&&e.query.scene&&"code_"===e.query.scene.substring(0,5)&&r._openFromCode("onLaunch",e.query.scene,e),this._onInit()}};a.default=r},function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a.initUtil=function(e){e.checkSDK=function(e,a){var t=this;return function(n,i){return t.requireSDK(e)?a.apply(t,[n]):(t.log("微信SDK版本过低："+t.systemInfo.SDKVersion+",需要更新至"+e),void(i&&"function"==typeof i&&i([t.systemInfo.SDKVersion,e])))}},e.requireSDK=function(e){return r.compareVersion(this.systemInfo.SDKVersion,e)},e.requireSystemVersion=function(e){return r.compareVersion(this.systemInfo.version,e)},e.isIPhoneX=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iPhone X")},e.isIOS=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("iOS")},e.isAndroid=function(){return this.systemInfo&&-1!=this.systemInfo.model.indexOf("Android")},e.toFixed=function(e,a){for(var t=e.toFixed(a)+"";"0"===t[t.length-1];)if("."===(t=t.substring(0,t.length-1))[t.length-1]){t=t.substring(0,t.length-1);break}return t},e.log=function(){try{if(this.debug&&console&&console.log){for(var e=arguments.length,a=Array(e),t=0;t<e;t++)a[t]=arguments[t];return console.log.apply(console,a)}}catch(e){}},e.setAlertCallback=function(a){e._alertCallback=a},e.alert=function(a){e._alertCallback?e._alertCallback(a):wx.showModal({content:a})},e.trace=function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.post({url:"/log/trace",data:{key:e,pos:a,data:t}})},e.getServerTime=function(){return e.conf&&e.conf.server_time?e.conf.server_time:0}};var i,o=(i=t(3))&&i.__esModule?i:{default:i},r={sign:function(e,a){if("string"==typeof e)return r.signSort(e,a);if("object"==(void 0===e?"undefined":n(e))){var t=[];for(var i in e)t.push(i+"="+e[i]);return r.signSort(t.join("&"),a)}},signSort:function(e,a){var t=e.split("&").sort().join("&")+"&key="+a;return(0,o.default)(t).toUpperCase()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},guid:function(){return Date.now()+"-"+r.S4()},compareVersion:function(e,a){var t=parseFloat(e),n=parseFloat(a),i=e.replace(t+".",""),o=a.replace(n+".","");return t>n||!(t<n)&&i>=o},copy:function(e){var a=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||(e&&e.push?[]:{});for(var t in e)a[t]="object"===n(e[t])?r.copy(e[t]):e[t];return a},randomSort:function(e){for(var a,t=0;t<e.length;t++){var n=parseInt(Math.random()*e.length+"");a=e[n],e[n]=e[t],e[t]=a}return e}};a.default=r},function(e,a,t){var n;"function"==typeof Symbol&&Symbol.iterator,function(i){"use strict";function o(e,a){var t=(65535&e)+(65535&a);return(e>>16)+(a>>16)+(t>>16)<<16|65535&t}function r(e,a,t,n,i,r){return o((l=o(o(a,e),o(n,r)))<<(s=i)|l>>>32-s,t);var l,s}function l(e,a,t,n,i,o,l){return r(a&t|~a&n,e,a,i,o,l)}function s(e,a,t,n,i,o,l){return r(a&n|t&~n,e,a,i,o,l)}function d(e,a,t,n,i,o,l){return r(a^t^n,e,a,i,o,l)}function c(e,a,t,n,i,o,l){return r(t^(a|~n),e,a,i,o,l)}function u(e,a){var t,n,i,r,u;e[a>>5]|=128<<a%32,e[14+(a+64>>>9<<4)]=a;var h=1732584193,m=-271733879,f=-1732584194,g=271733878;for(t=0;t<e.length;t+=16)n=h,i=m,r=f,u=g,h=l(h,m,f,g,e[t],7,-680876936),g=l(g,h,m,f,e[t+1],12,-389564586),f=l(f,g,h,m,e[t+2],17,606105819),m=l(m,f,g,h,e[t+3],22,-1044525330),h=l(h,m,f,g,e[t+4],7,-176418897),g=l(g,h,m,f,e[t+5],12,1200080426),f=l(f,g,h,m,e[t+6],17,-1473231341),m=l(m,f,g,h,e[t+7],22,-45705983),h=l(h,m,f,g,e[t+8],7,1770035416),g=l(g,h,m,f,e[t+9],12,-1958414417),f=l(f,g,h,m,e[t+10],17,-42063),m=l(m,f,g,h,e[t+11],22,-1990404162),h=l(h,m,f,g,e[t+12],7,1804603682),g=l(g,h,m,f,e[t+13],12,-40341101),f=l(f,g,h,m,e[t+14],17,-1502002290),h=s(h,m=l(m,f,g,h,e[t+15],22,1236535329),f,g,e[t+1],5,-165796510),g=s(g,h,m,f,e[t+6],9,-1069501632),f=s(f,g,h,m,e[t+11],14,643717713),m=s(m,f,g,h,e[t],20,-373897302),h=s(h,m,f,g,e[t+5],5,-701558691),g=s(g,h,m,f,e[t+10],9,38016083),f=s(f,g,h,m,e[t+15],14,-660478335),m=s(m,f,g,h,e[t+4],20,-405537848),h=s(h,m,f,g,e[t+9],5,568446438),g=s(g,h,m,f,e[t+14],9,-1019803690),f=s(f,g,h,m,e[t+3],14,-187363961),m=s(m,f,g,h,e[t+8],20,1163531501),h=s(h,m,f,g,e[t+13],5,-1444681467),g=s(g,h,m,f,e[t+2],9,-51403784),f=s(f,g,h,m,e[t+7],14,1735328473),h=d(h,m=s(m,f,g,h,e[t+12],20,-1926607734),f,g,e[t+5],4,-378558),g=d(g,h,m,f,e[t+8],11,-2022574463),f=d(f,g,h,m,e[t+11],16,1839030562),m=d(m,f,g,h,e[t+14],23,-35309556),h=d(h,m,f,g,e[t+1],4,-1530992060),g=d(g,h,m,f,e[t+4],11,1272893353),f=d(f,g,h,m,e[t+7],16,-155497632),m=d(m,f,g,h,e[t+10],23,-1094730640),h=d(h,m,f,g,e[t+13],4,681279174),g=d(g,h,m,f,e[t],11,-358537222),f=d(f,g,h,m,e[t+3],16,-722521979),m=d(m,f,g,h,e[t+6],23,76029189),h=d(h,m,f,g,e[t+9],4,-640364487),g=d(g,h,m,f,e[t+12],11,-421815835),f=d(f,g,h,m,e[t+15],16,530742520),h=c(h,m=d(m,f,g,h,e[t+2],23,-995338651),f,g,e[t],6,-198630844),g=c(g,h,m,f,e[t+7],10,1126891415),f=c(f,g,h,m,e[t+14],15,-1416354905),m=c(m,f,g,h,e[t+5],21,-57434055),h=c(h,m,f,g,e[t+12],6,1700485571),g=c(g,h,m,f,e[t+3],10,-1894986606),f=c(f,g,h,m,e[t+10],15,-1051523),m=c(m,f,g,h,e[t+1],21,-2054922799),h=c(h,m,f,g,e[t+8],6,1873313359),g=c(g,h,m,f,e[t+15],10,-30611744),f=c(f,g,h,m,e[t+6],15,-1560198380),m=c(m,f,g,h,e[t+13],21,1309151649),h=c(h,m,f,g,e[t+4],6,-145523070),g=c(g,h,m,f,e[t+11],10,-1120210379),f=c(f,g,h,m,e[t+2],15,718787259),m=c(m,f,g,h,e[t+9],21,-343485551),h=o(h,n),m=o(m,i),f=o(f,r),g=o(g,u);return[h,m,f,g]}function h(e){var a,t="",n=32*e.length;for(a=0;a<n;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function m(e){var a,t=[];for(t[(e.length>>2)-1]=void 0,a=0;a<t.length;a+=1)t[a]=0;var n=8*e.length;for(a=0;a<n;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function f(e){var a,t,n="";for(t=0;t<e.length;t+=1)a=e.charCodeAt(t),n+="0123456789abcdef".charAt(a>>>4&15)+"0123456789abcdef".charAt(15&a);return n}function g(e){return unescape(encodeURIComponent(e))}function y(e){return function(e){return h(u(m(e),8*e.length))}(g(e))}function v(e,a){return function(e,a){var t,n,i=m(e),o=[],r=[];for(o[15]=r[15]=void 0,i.length>16&&(i=u(i,8*e.length)),t=0;t<16;t+=1)o[t]=909522486^i[t],r[t]=1549556828^i[t];return n=u(o.concat(m(a)),512+8*a.length),h(u(r.concat(n),640))}(g(e),g(a))}function p(e,a,t){return a?t?v(a,e):f(v(a,e)):t?y(e):f(y(e))}void 0===(n=function(){return p}.call(a,t,a,e))||(e.exports=n)}()},function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var a=e.success,t=e.fail;return"GET"==e.method?e.url=d(e.url,e.data):e.url=d(e.url),e.header||(e.header={}),e.header.Authorization=c.default.isLogined()?c.default.user.token:"",e.success=function(n){"LOGIN_REQUIRED"===n.data.key?(c.default.log("login required:",e.url,e,n),c.default.doLogin()):0===n.data.code?(c.default.log("success:",e.url,e,n),a&&a(n.data)):t?(c.default.log("fail:",e.url,e,n),t(n.data)):c.default.log("unknown:",e.url,e,n)},e.fail=function(a){c.default.log("error:",e.url,e,a),t&&t(a)},wx.request(e)}function o(e){return e.method="GET",i(e)}function r(e){return e.method="POST",i(e)}function l(e){return e.method="PUT",i(e)}function s(e){return e.method="DELETE",i(e)}function d(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){-1==e.indexOf("?")&&(e+="?");var t=[];if(c.default.isLogined()&&t.push("user="+c.default.user.id),c.default.launchOptions){var n=c.default.launchOptions.query;n&&(n.uid&&t.push("uid="+n.uid),n.channel&&t.push("channel="+n.channel),n.share_id&&t.push("share_id="+n.share_id),n.share_tid&&t.push("share_tid="+n.share_tid),n.pos&&t.push("share_pos="+n.pos),n.scene&&t.push("scene="+decodeURIComponent(n.scene)))}t.push("v="+c.default.version),t.push("version="+c.default.options.version),t.push("appid="+c.default.options.appid),t.push("t="+Date.now()),"?"!==e.charAt(e.length-1)&&"&"!==e.charAt(e.length-1)&&(e+="&");var i=(e+=t.join("&")).split("?")[1];if(a){var o=[];for(var r in a)o.push(r+"="+a[r]);i+="&"+o.join("&")}if((e+="&sign="+u.default.sign(i,c.default.options.secret)).startsWith("/"))return c.default.options.scheme+c.default.options.host+"/"+c.default.options.apiVersion+e}return e}Object.defineProperty(a,"__esModule",{value:!0}),a.initHTTP=function(e){e.request=i,e.get=o,e.post=r,e.put=l,e.delete=s,e.formatURL=d};var c=n(t(1)),u=n(t(2))},function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.initUser=function(e){e.isLogined=function(){return e.user&&e.user.token},e.getLoginStatus=function(){return e.isLogined()?"success":e.isCheckSession||e.isLogining?"logining":"fail"},e.login=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a?e.doLogin(a):(e.isCheckSession=!0,wx.checkSession({success:function(){e.checkLogin(a),e.isCheckSession=!1}.bind(e),fail:function(){e.doLogin(a),e.isCheckSession=!1}.bind(e)}))},e.checkLogin=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogined()?(e.loginSuccess(),!e.requireSDK("2.0.3")&&e.needUserInfo()&&e.getUserInfo()):e.doLogin(a)},e.checkCode2access=function(a){var t=a.session_key?a:null;e.post({url:"/oauth/code2access_token",data:a,success:function(a){e.isLogining=!1,e.saveUser(a.data),e.checkLogin(t)}.bind(e),fail:e.loginFail.bind(e)})},e.doLogin=function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e.isLogining||(e.isLogining=!0,e.user=null,a?e.checkCode2access(a):wx.login({success:function(a){a.code?e.checkCode2access({code:a.code}):e.loginFail(a)}.bind(e),fail:e.loginFail.bind(e)}))},e.loginSuccess=function(a){var t=e.conf&&e.conf.last?e.conf.last:0;!t||Date.now()-t>1e3*e.options.commonDuration?e.getCommon(a):(e.doLoginSuccess(a),e.onLogined())},e.getCommon=function(a){e.get({url:"/common",success:function(t){e.conf=t.data.conf,e.conf.last=Date.now(),wx.setStorage({key:e.options.CONF_KEY,data:e.conf}),e.data||(e.data=t.data.data,wx.setStorage({key:e.options.DATA_KEY,data:e.data})),e.doLoginSuccess(a),e.onLogined()}.bind(e),fail:function(a){e.loginFail(a)}.bind(e)})},e.doLoginSuccess=function(a){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(a),e.loginSuccessCallback&&e.loginSuccessCallback(a)},e.loginFail=function(a){e.isLogining=!1,e.loginCompleteCallback&&e.loginCompleteCallback(a),e.loginFailCallback&&e.loginFailCallback(a)},e.onLoginSuccess=function(a){e.loginSuccessCallback=a},e.onLoginFail=function(a){e.loginFailCallback=a},e.onLoginComplete=function(a){e.loginCompleteCallback=a},e.checkUserInfo=function(){e.needUserInfo()&&e.getUserInfo()},e.needUserInfo=function(){return!e.user||!e.user.nickname||!e.user.avatar},e.getUserInfo=function(){wx.getUserInfo({withCredentials:!0,success:function(a){return e.post({url:"/oauth/update_userinfo",data:a,success:function(a){e.saveUser(a.data),e.needUserInfo()?e.getUserInfoFail(a):e.getUserInfoSuccess()}.bind(e),fail:e.getUserInfoFail.bind(e)}),a}.bind(e),fail:e.getUserInfoFail.bind(e)})},e.getUserInfoSuccess=function(e){},e.getUserInfoFail=function(e){},e.saveUser=function(a){e.user=a,e.user.last=Date.parse(new Date),wx.setStorage({key:e.options.USER_KEY,data:e.user})}}},function(e,a,t){"use strict";function n(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.conf&&void 0!==o.default.conf[e]?o.default.conf[e]:a}Object.defineProperty(a,"__esModule",{value:!0}),a.initConfig=function(e){e.getConfig=n};var i,o=(i=t(1))&&i.__esModule?i:{default:i}},function(e,a,t){"use strict";function n(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.default.data&&void 0!==u.default.data[e]?u.default.data[e]:a}function i(e,a){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];u.default.data||(u.default.data={}),u.default.data[e]=a,t&&u.default.postData(e)}function o(e){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];u.default.data=e,a&&u.default.postData()}function r(e,a){var t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=u.default.getData(e,n)+a;return u.default.setData(e,i,t),i}function l(){arguments.length>0&&void 0!==arguments[0]&&arguments[0],wx.setStorage({key:u.default.options.DATA_KEY,data:u.default.data}),u.default.post({url:"/data",data:u.default.data})}function s(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"default",o={};if(e instanceof Object){var r=e;o={id:r.id,score:r.score,time:r.time,version:u.default.options.version,data:r.data,key:r.key}}else o={id:e,score:a,time:t,version:u.default.options.version,data:n,key:i};u.default.post({url:"/score",data:o,success:function(e){u.default.log("提交分数成功：",a,e)},fail:function(e){u.default.log("提交分数失败：",a,e)}})}function d(e){var a=e.key,t=void 0===a?"default":a,n=e.scale,i=void 0===n?"week":n,o=e.skip,r=void 0===o?0:o,l=e.limit,s=void 0===l?10:l,d=e.success,c=void 0===d?null:d,h=e.fail,m=void 0===h?null:h;u.default.get({url:"/score",data:{score_key:t,scale:i,skip:r,limit:s},success:function(e){c&&c(e.data)},fail:function(e){m&&m(e)}})}Object.defineProperty(a,"__esModule",{value:!0}),a.initData=function(e){e.getData=n,e.setData=i,e.setAllData=o,e.incData=r,e.postData=l,e.postGameScore=s,e.getScoreRank=d};var c,u=(c=t(1))&&c.__esModule?c:{default:c}},function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.initShare=function(e){e.share=function(a){e.options.allowAld?e.aldShareAppMessage(this.createShareOptions(a)):e.shareAppMessage(this.createShareOptions(a)),this.options.share10&&(this.log("share10"),this.shareLog(a,"share10","",{},{})),a.onShareBack&&(e.shareCallbackData={callback:a.onShareBack,ms:Date.now()})},e.createShareOptions=function(a){a.pos||(a.pos="default");var t=this.getShareInfo(a);a.shareId=t.shareId,a.title||(a.title=t.title),a.imageUrl||(a.imageUrl=t.imageUrl),a.success||(a.success=t.success),a.fail||(a.fail=t.fail),a.onHttpError||(a.onHttpError=t.onHttpError),a.tid||(a.tid=""+Date.now());var n="type=share&pos="+a.pos+"&share_id="+t.shareId+"&share_tid="+a.tid;return this.isLogined()&&(n+="&uid="+this.user.id),a.gift&&(n+="&gift="+a.gift),a.query?"&"==a.query.indexOf(0)?(a.query=n+a.query,e.log("new share query: "+a.query)):(a.query=n+"&"+a.query,e.log("new share query: "+a.query)):a.query=n,e.shareTempData[a.tid]=a,{title:a.title,imageUrl:a.imageUrl,query:a.query,success:this.shareSuccess(a),fail:this.shareFail(a),complete:a.complete}},e.getShareInfo=function(e){var a="",t="";this.options.share&&(a=this.options.share.title,t=this.options.share.imageUrl);var n,i=0;return e.defaultTitle&&(a=e.defaultTitle),this.conf&&this.conf.shares&&(this.conf.shares[e.pos]?n=this.conf.shares[e.pos]:this.conf.shares.default&&(n=this.conf.shares.default),n&&(n.title&&(a=n.title),n.image&&(t=n.image),n.id&&(i=n.id))),{title:a,imageUrl:t,shareId:i,success:function(){wx.showToast({title:"分享成功！",icon:"success"})},fail:function(){wx.showToast({title:"分享失败！",icon:"fail"})},onHttpError:function(){wx.showToast({title:"网络出错！",icon:"fail"})}}},e.shareSuccess=function(a){return function(t){console.log("shareSuccess"),delete e.shareTempData[a.tid];var n=!0;a.onShareSuccess&&(n=a.onShareSuccess(t)),n&&(t.shareTickets&&t.shareTickets.length>0?wx.getShareInfo({shareTicket:t.shareTickets[0],success:function(e){a.onShareTicketSuccess&&a.onShareTicketSuccess(e),this.shareLog(a,"success",t.shareTickets[0],e,t)}.bind(this),fail:function(e){a.onShareTicketFail&&a.onShareTicketFail(e),this.shareLog(a,"success",t.shareTickets[0],{},t)}.bind(this)}):(a.onShareTicketFail&&a.onShareTicketFail(),this.shareLog(a,"success","",{},t)))}.bind(this)},e.shareFail=function(e){return function(a){console.log("shareFail");var t=!0;e.onShareFail&&(t=e.onShareFail(a)),t&&this.shareLog(e,"fail","",{},a)}.bind(this)},e.shareLog=function(a,t,n,i,o){this.post({url:"/log/share",data:{share_id:a.shareId,title:a.title,query:a.query,image:a.imageUrl,pos:a.pos,tid:a.tid,status:t,shareTicket:n,info:i,error:o.errMsg,system_version:e.systemInfo.system,sdk_version:e.systemInfo.SDKVersion},success:function(n){"success"!==t&&"click"!==t||!a.success?"fail"===t&&a.fail&&a.fail(n,o):(a.success(n,o),delete e.shareTempData[a.tid])},fail:function(e){"success"!==t&&"click"!==t||!a.onHttpError?"fail"===t&&a.fail&&a.fail(e,o):a.onHttpError(e,o)}})},e.isEnableShare=function(){return!(!e.conf||!e.conf.allow_share||e.requireSystemVersion("6.7.0"))}}},function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){"string"==typeof e?(d.process=e,d.processDuration=Date.now()-d.initStartAt):l.default.log("setProcess():  参数类型错误")}function o(e){l.default.post({url:"/log/process",data:e,success:function(e){l.default.log("提交游戏进度数据成功：",e)},fail:function(e){l.default.log("提交游戏进度数据失败：",e)}})}Object.defineProperty(a,"__esModule",{value:!0});var r=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};a.initProcess=function(e){e.onShow(function(e){c=Date.now(),d.showOptions=JSON.stringify(e)}),e.afterHide(function(a){var t=Date.now(),n=d=r({},d,{times:d.times+1,showDuration:c?t-c:t-d.initStartAt,duration:t-d.initStartAt}),i=(n.hasInited,n.initStartAt,function(e,a){var t={};for(var n in e)a.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}(n,["hasInited","initStartAt"]));d.hasInited?o(i):(d.hasInited=!0,o(r({systemInfo:JSON.stringify(e.systemInfo),launchOptions:JSON.stringify(e.launchOptions)},i)))}),e.setProcess=i};var l=n(t(1)),s=n(t(2)),d={hasInited:!1,initStartAt:Date.now(),showOptions:"",times:0,uuid:s.default.guid(),duration:0,showDuration:0,process:"init",processDuration:0},c=0},function(e,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.initPayment=function(e){e.getPaymentResult=function(e){var a=e.success,t=void 0===a?null:a,n=e.fail,i=void 0===n?null:n;this.get({url:"/payment/result",success:function(e){this.log("获取充值数据成功",e),t&&t(e.data)}.bind(this),fail:function(e){this.log("获取充值数据失败",e),i&&i(e)}.bind(this)})},e.requestMPPayment=function(a){var t=this,n=a.title,i=void 0===n?"点击充值链接进入充值":n,o=a.pos,r=void 0===o?"default":o,l=a.image,s=void 0===l?null:l,d=a.success,c=void 0===d?null:d,u=a.fail,h=void 0===u?null:u,m=a.complete,f=void 0===m?null:m;this.log("打开客服对话"),e.openCustomerServiceConversation({sessionFrom:r,showMessageCard:!0,sendMessageTitle:i,sendMessagePath:"?type=message",sendMessageImg:s||e.conf.shares.default.image,success:function(e){t.log("打开充值会话成功",e),f&&f(),c&&c()},fail:function(e){t.log("打开充值会话fail",e),f&&f(),h&&h()}})},e.requestMPPayment=e.checkSDK("2.0.3",e.requestMPPayment)}},function(e,a,t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e){var a=e.pos,t=e.style,n=void 0===t?null:t,l=e.ms,s=void 0===l?0:l,d=e.force,c=void 0!==d&&d,u=e.forceTimeout,h=void 0===u?600:u,m=e.onResize,f=void 0===m?null:m;if(S.default.conf&&S.default.conf.banners&&S.default.conf.banners[a]){var g=S.default.conf.banners[a];if(g.enable){var y=void 0,v=x[a];v&&(y=C[v.adUnitId])&&(v.showed&&o(v),(c||Date.now()-y.created>1e3*h)&&function(e){var a=C[e.adUnitId];if(a)a.hide(),a.destroy(),delete C[e.adUnitId]}(v)),s||(s=S.default.getConfig("banner_ms",120)),v||(v={adUnitId:g.adUnitId,pos:a,count:0,ms:s,duration:0,style:n,width:g.width?g.width>1?1:g.width:1,window:"*",data:[],onResize:f,created:Date.now()},x[a]=v),v.count+=1,v.status="success",(y=C[v.adUnitId])||(y=C[v.adUnitId]=function(e){var a=e.banner,t=e.style,n=void 0===t?null:t,i=S.default.systemInfo.screenWidth*a.width,o=(S.default.systemInfo.screenHeight,wx.createBannerAd({adUnitId:a.adUnitId,style:w({left:0,top:0,width:i,height:180*i/750},n)}));return o.created=Date.now(),o.onError(function(e){a.status="error",a.error=e,a.timeout&&clearTimeout(a.timeout),a.timeout=null,a.showed=null,r(a,"error"),S.default.log("banner 创建失败",a),x[a.pos]&&delete x[a.pos]}),o.onResize(function(e){a.onResize&&a.onResize(e,o)}),o.onLoad(function(e){S.default.log("banner 加载完成",a),o.created=Date.now()}),o}({banner:v,style:n})),v.showed=Date.now(),setTimeout(function(){y.show()},.01),v.ms&&y&&(v.timeout&&clearTimeout(v.timeout),v.timeout=setTimeout(function(){i({pos:a,style:n,ms:s,force:!0,onResize:f})},1e3*s))}}else S.default.log("createBanner 没有配置: "+a)}function o(e){var a=x[e];if(a&&a.showed){var t=C[a.adUnitId];if(t){var n=t.style,i=n.realWidth,o=n.realHeight,r=Date.now()-a.showed;return t.hide(),a.duration+=r,a.data.push({created:t.created,showed:a.showed,duration:r}),a.timeout&&clearTimeout(a.timeout),a.timeout=null,a.showed=null,a.window=i+"*"+Math.round(o),!0}}return!1}function r(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"onHide",t={adUnitId:e.adUnitId,pos:e.pos,ms:e.ms,count:e.count,duration:e.duration,data:JSON.stringify(e.data),window:e.window,status:e.status,error:e.error,commit:a};e.count=0,e.duration=0,e.status="success",e.error="",e.data=[],S.default.log("postBannerData",t),S.default.post({url:"/log/ad/banner",data:t,success:function(e){S.default.log("提交banner数据成功：",e)},fail:function(e){S.default.log("提交banner数据失败：",e)}})}function l(e){return S.default.conf&&S.default.conf.videos&&S.default.conf.videos[e]?!!S.default.conf.videos[e].enable:(S.default.log("createVideo 没有配置: "+e),!1)}function s(e){function a(e){f.status="error",f.error=e,d(f),m&&m(e),u&&u(e),i()}function t(e){f.created=Date.now()}function n(e){m&&m(e),f.duration=Date.now()-f.created,e&&e.isEnded||void 0===e?s&&s({isEnded:!0,duration:f.duration}):(f.status="cancel",s&&s({isEnded:!1,duration:f.duration})),d(f),i()}function i(){g.offError(a),g.offLoad(t),g.offClose(n)}var o=e.pos,r=e.success,s=void 0===r?null:r,c=e.fail,u=void 0===c?null:c,h=e.complete,m=void 0===h?null:h;if(!l(o))return!1;var f={adUnitId:S.default.conf.videos[o].adUnitId,pos:o,status:"success",created:Date.now(),duration:0},g=wx.createRewardedVideoAd({adUnitId:f.adUnitId});return g.onError(a),g.onLoad(t),g.onClose(n),g.show().catch(function(e){console.log("ws.createVideo error:",e),g.load().then(function(){return g.show()})}),!0}function d(e){S.default.post({url:"/log/ad/rewardedvideo",data:e,success:function(e){S.default.log("提交激励视频数据成功：",e)},fail:function(e){S.default.log("提交激励视频数据失败：",e)}})}function c(e){var a;if(S.default.conf&&S.default.conf.games&&(S.default.conf.games[e]?a=S.default.conf.games[e]:S.default.conf.games.default&&(a=S.default.conf.games.default),a&&a.length>0)){S.default.tmp.getMoreGame||(S.default.tmp.getMoreGame={});var t=S.default.tmp.getMoreGame[e];return(!t||t>=a.length)&&(t=0),S.default.tmp.getMoreGame[e]=t+1,a[t]}}function u(e){var a;if(S.default.conf&&S.default.conf.games)if(S.default.conf.games[e]?a=S.default.conf.games[e]:S.default.conf.games.default&&(a=S.default.conf.games.default),a&&a.length>0){for(var t=[],n=0;n<a.length;n++)t.push(a[n].image);S.default.previewImage({urls:L.default.randomSort(t)})}else wx.showToast({title:"没有更多游戏！",icon:"info"});else wx.showToast({title:"没有更多游戏！",icon:"info"})}function h(e){return I&&I[e]?(I[e].showed&&v(e),I[e]):null}function m(e){for(var a in e)I[a]={pos:a,data:e[a]?e[a]:[],last:Date.now(),duration:0,total_ms:0,logs:[],showed:!0}}function f(e){var a=e.pos,t=void 0===a?"default":a,n=e.count,i=void 0===n?1:n,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=h(t);d?(I[t].showed=!0,r&&r({code:0,data:d.data,key:"SUCCESS"})):S.default.get({url:"/game/ad",data:{pos:t,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var a={};a[t]=e.data,m(a)}r&&r(e)}else s&&s(e)},fail:function(e){s&&s(e)}})}function g(e){var a=e.data,t=void 0===a?[{pos:"default",count:1}]:a,n=e.success,i=void 0===n?null:n,o=e.fail,r=void 0===o?null:o,l={},s=!1,d=!0,c=!1,u=void 0;try{for(var f,g=t[Symbol.iterator]();!(d=(f=g.next()).done);d=!0){h(f.value.pos)||(s=!0)}}catch(e){c=!0,u=e}finally{try{!d&&g.return&&g.return()}finally{if(c)throw u}}if(l&&_({ads:l}),s)S.default.post({url:"/game/ad",data:{pos:t},success:function(e){0==e.code?(e.data&&m(e.data),i&&i(e)):r&&r(e)},fail:function(e){r&&r(e)}});else{var y={},v=!0,p=!1,b=void 0;try{for(var w,L=t[Symbol.iterator]();!(v=(w=L.next()).done);v=!0){var x=w.value;I[x.pos].showed=!0,y[x.pos]=I[x.pos].data}}catch(e){p=!0,b=e}finally{try{!v&&L.return&&L.return()}finally{if(p)throw b}}i&&i({code:0,data:y,key:"SUCCESS"})}}function y(e){var a=e.pos,t=void 0===a?"default":a,n=e.count,i=void 0===n?1:n,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=e.force,c=void 0===d||d,u=h(t);!c&&u?(I[t].showed=!0,r&&r({code:0,data:u.data,key:"SUCCESS"})):S.default.get({url:"/game/ad/feature",data:{pos:t,count:i},success:function(e){if(0==e.code){if(!Array.isArray(e.data)||Array.isArray(e.data)&&0!=e.data.length){var a={};a[t]=e.data,m(a)}r&&r(e)}else s&&s(e)},fail:function(e){s&&s(e)}})}function v(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default";!function(){function e(e){var a=Date.now(),t=a-e.last;e.logs.push({ms:t,last:e.last,posted:!1}),e.total_ms+=t,e.last=a}var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!a||I[a])if(a)e(I[a]);else for(var t in I)e(I[t])}(e),I[e]&&(I[e].showed=!1)}function p(e){function a(e){e.image?S.default.previewImage({urls:[e.image],success:function(e){S.default.log("tapGameAD, success"),d&&d(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD，ad参数内image属性缺失")}function t(e){S.default.requireSDK("2.2.0")?e.appid?wx.navigateToMiniProgram({appId:e.appid,path:e.path,success:function(e){S.default.log("tapGameAD, success"),d&&d(e)},fail:function(e){S.default.log("tapGameAD, fail"),u&&u(e)},complete:function(e){S.default.log("tapGameAD, complete"),m&&m(e)}}):S.default.log("tapGameAD, ad参数内appid属性缺失"):e.image?a(e):S.default.alert("当前微信版本过低，无法使用该功能，请升级到最新微信版本后重试。")}var n=e.ad,i=e.pos,o=void 0===i?"default":i,r=e.redirect,l=void 0!==r&&r,s=e.success,d=void 0===s?null:s,c=e.fail,u=void 0===c?null:c,h=e.complete,m=void 0===h?null:h,f=n;I&&I[o]&&f?(function(e,a){if(!a||!a.cid||!a.id)return!1;b([{pos:e,tid:a.tid,commit:"click",data:[{cid:a.cid,id:a.id,action:a.action}]}])}(o,f),"code"==f.action?a(f):"navigate"==f.action?t(f):l?t(f):a(f)):S.default.log("tapGameAD pos无效，没有对应数据，或未传ad参数")}function b(e){S.default.post({url:"/game/ad/log",data:e,success:function(a){for(var t=0;t<e.length;t++){var n=e[t];"show"==n.commit&&n.pos in I&&(I[n.pos].logs=[])}S.default.log("广告数据提交成功！")},fail:function(e){S.default.log("广告数据提交失败！")}})}function _(e){function a(e){for(var a=[],t=0,n=null,i=0;i<e.logs.length;i++)e.logs[i].posted||(t+=e.logs[i].ms,n=e.logs[i].last);if(!t||!e.data)return a;for(var o={pos:e.pos,tid:e.data[0].tid,commit:"show",last:n,ms:t,data:[]},r=0;r<e.data.length;r++)o.data.push({id:e.data[r].id,cid:e.data[r].cid,action:e.data[r].action});return a.push(o),a}var t=e.ads,n=void 0===t?null:t,i=e.ad,o=void 0===i?null:i;if(!n&&!o)return!1;var r=[];if(n)for(var l in n)r=r.concat(a(n[l]));else o&&(r=a(o));r.length>0&&b(r)}Object.defineProperty(a,"__esModule",{value:!0});var w=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};a.initAD=function(e){e.onShow(function(){for(var a in x){var t=x[a];t.isShow&&(e.createBanner({pos:t.pos,style:t.style,ms:t.ms,onResize:t.onResize}),t.isShow=!1)}for(var n=0;n<T.length;n++){var i=T[n];I[i].showed=!0,I[i].last=Date.now()}T=[]}),e.afterHide(function(){for(var e in x){var a=x[e];a.isShow=a.showed,a.isShow&&o(a.pos),a.duration>0&&r(a)}for(var t in I)I[t].showed&&(v(t),T.push(t));_({ads:I})}),e.createBanner=e.checkSDK("2.0.4",i),e.closeBanner=e.checkSDK("2.0.4",o),e.createVideo=e.checkSDK("2.0.4",s),e.isEnableVideo=l,e.getMoreGame=c,e.showMoreGame=u,e.getGameAd=f,e.hideGameAd=v,e.tapGameAd=p,e.fetchGameAd=g,e.getPromoGameAd=y};var S=n(t(1)),L=n(t(2)),x={},C={},I={},T=[]},function(e,a,t){"use strict";function n(e,a){e[a]=function(){var t;return e.mode=a,"aldShareAppMessage"==a&&(e.mode="shareAppMessage"),(t=wx)[a].apply(t,arguments)}}Object.defineProperty(a,"__esModule",{value:!0}),a.initHook=function(e){e.setMode=function(a){e.mode=a},n(e,"previewImage"),n(e,"openCustomerServiceConversation"),n(e,"shareAppMessage"),n(e,"aldShareAppMessage")};var i;(i=t(1))&&i.__esModule},function(e,a,t){"use strict";function n(e,a){var t={};for(var n in e)a.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}function i(e){var a=e.pos,t=void 0===a?null:a,n=e.success,i=void 0===n?null:n,o=e.fail,r=void 0===o?null:o,l={};t&&(l.pos=t),p.default.get({url:"/invited/users/count",data:l,success:function(e){i&&i(e.data.count)},fail:function(e){r&&r(e)}})}function o(e){var a=e.pos,t=void 0===a?null:a,n=e.receive,i=void 0===n||n,o=e.skip,r=void 0===o?0:o,l=e.limit,s=void 0===l?-1:l,d=e.success,c=void 0===d?null:d,u=e.fail,h=void 0===u?null:u,m={skip:r,limit:s,receive:i};t&&(m.pos=t),p.default.get({url:"/invited/users",data:m,success:function(e){c&&c(e.data)},fail:function(e){h&&h(e)}})}function r(e){var a=e.user,t=e.pos,n=void 0===t?null:t,i=e.success,o=void 0===i?null:i,r=e.fail,l=void 0===r?null:r,s={users:[{id:a.id,gift:a.gift}]};n&&(s.pos=n),p.default.post({url:"/invited/gift/receive",data:s,success:function(e){o&&o(e.data.receive[0])},fail:function(e){l&&l(e)}})}function l(e){var a=e.users,t=e.pos,n=void 0===t?null:t,i=e.success,o=void 0===i?null:i,r=e.fail,l=void 0===r?null:r,s={users:[]},d=!0,c=!1,u=void 0;try{for(var h,m=a[Symbol.iterator]();!(d=(h=m.next()).done);d=!0){var f=h.value;s.users.push({id:f.id,gift:f.gift})}}catch(e){c=!0,u=e}finally{try{!d&&m.return&&m.return()}finally{if(c)throw u}}n&&(s.pos=n),p.default.post({url:"/invited/gift/receive",data:s,success:function(e){o&&o(e.data.receive)},fail:function(e){l&&l(e)}})}function s(e,a){if(a&&a.gift){var t={type:e,gift:a.gift,uid:a.uid,share_tid:a.share_tid},n=p.default.conf[a.gift];n&&(t.receive=!0),p.default.post({url:"/share/gift/log",data:t,success:function(e){if(n){var i=e.data;i.is_self&&n.not_allow_self?p.default.alert(n.not_allow_self_tip||"不能领取自己送出的礼物～"):i.user_count>=(n.date_limit||2)?p.default.alert(n.date_limit_tip||"今天已经领取太多次了～"):i.user_share_count>=(n.share_date_limit||1)?p.default.alert(n.share_date_limit_tip||"已经领取过该礼物了～"):i.count>=(n.limit||10)?p.default.alert(n.limit_tip||"该礼物被领光了～"):(e={gift:a.gift,query:a,conf:n,options:t,data:i},p.default._onGiftCallback&&p.default._onGiftCallback(e))}}})}}function d(e){e.from;var a=e.query;e.options,s("share",a)}function c(e){e.from,e.scene,e.options,s("code",e.query)}function u(e){p.default._onGiftCallback=e}function h(e){var a=e.gifts,t=e.users,n=void 0===t||t,i=e.receive,o=void 0===i||i,r=e.dateLimit,l=void 0===r?0:r,s=e.cache,d=void 0===s?60:s,c=e.limit,u=void 0===c?0:c,h=e.success,m=void 0===h?null:h,f=e.fail,g=void 0===f?null:f;if("boolean"==typeof n&&"boolean"==typeof o&&"number"==typeof l&&"number"==typeof d&&"number"==typeof u){var y=!0,v=[a.sort().toString(),n,o,l,u].join("-");p.default.shareGiftTempData&&p.default.shareGiftTempData[v]&&Date.now()-p.default.shareGiftTempData[v].ms<1e3*d&&(y=!1),y?p.default.post({url:"/share/gift/receive",data:{gifts:a,is_users:n,receive:o,date_limit:l,limit:u},success:function(e){p.default.shareGiftTempData[v]={data:e.data,ms:Date.now()},m&&m(e.data)},fail:g}):m&&m(p.default.shareGiftTempData[v].data)}else p.default.log("requestShareGift, 参数格式异常")}function m(e){var a=e.users,t=e.success,n=void 0===t?null:t,i=e.fail,o=void 0===i?null:i;Array.isArray(a)?p.default.post({url:"/share/gift/receive2",data:{users:a},success:function(e){n&&n(e)},fail:function(e){o&&o(e)}}):p.default.log("receiveShareGift, users参数格式错误")}function f(e){var a=e.pos,t=e.bg,i=void 0===t||t,o=e.success,r=void 0===o?null:o,l=e.fail,s=void 0===l?null:l,d=n(e,["pos","bg","success","fail"]);p.default.post({url:"/share/qrcode",data:y({pos:a,bg:i,uid:p.default.user.id,share_tid:Date.now()+""},d),success:function(e){r&&r(e.data)},fail:s})}function g(e){var a=e.pos,t=e.bg,i=void 0===t||t,o=e.filePath,r=void 0===o?"":o,l=e.success,s=void 0===l?null:l,d=e.fail,c=void 0===d?null:d,u=e.complete,h=void 0===u?null:u,m=n(e,["pos","bg","filePath","success","fail","complete"]);f(y({pos:a,bg:i,success:function(e){!function(a){var t=e.codeUrl;wx.downloadFile({url:t,filePath:r,success:function(e){200==e.statusCode&&(p.default.alert("download success",e.tempFilePath),p.default.log("download success",e.tempFilePath),r||(r=e.tempFilePath,wx.saveImageToPhotosAlbum({filePath:e.tempFilePath,success:function(e){s&&s(e)},fail:function(e){c&&c(e)},complete:function(e){h&&h(e)}})))},fail:function(e){c&&c(e)},complete:function(e){h&&h(e)}})}()},fail:c},m))}Object.defineProperty(a,"__esModule",{value:!0});var y=Object.assign||function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e};a.initInvite=function(e){e.getInviteCount=i,e.getInviteUsers=o,e.receiveInviteGift=r,e.receiveInviteGifts=l,e.openFromShare(d),e.openFromCode(c),e.onShareGift=u,e.requestShareGift=h,e.receiveShareGift=m,e.getWXACode=f,e.saveWXACode=g};var v,p=(v=t(1))&&v.__esModule?v:{default:v}},function(e,a,t){"use strict";function n(e,a){r.index+=1,r.events.push({event:e,data:a?JSON.stringify(a):null,tm:Date.now()})}Object.defineProperty(a,"__esModule",{value:!0}),a.initEvent=function(e){e.afterHide(function(){o.default.post({url:"/log/event",data:r,success:function(e){0==e.code&&(r.events=[]),o.default.log("事件日志提交成功！")},fail:function(e){o.default.log("事件日志提交失败！")}})}),e.traceEvent=n};var i,o=(i=t(1))&&i.__esModule?i:{default:i},r={index:0,events:[]}}])},{}],17:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.wx},{}],18:[function(e,a,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Laya.View,i=Laya.ClassUtils.regClass;!function(e){!function(e){var a=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("cannonSelect/CannonSelect")},a}(n);e.CannonSelectUI=a,i("ui.cannonSelect.CannonSelectUI",a)}(e.cannonSelect||(e.cannonSelect={}))}(t.ui||(t.ui={})),function(e){!function(e){var a=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},a}(n);e.GameSceneUI=a,i("ui.game.GameSceneUI",a)}(e.game||(e.game={}))}(t.ui||(t.ui={})),function(e){!function(e){var a=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},a}(n);e.HomeViewUI=a,i("ui.home.HomeViewUI",a)}(e.home||(e.home={}))}(t.ui||(t.ui={})),function(e){!function(e){var a=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},a}(n);e.OverViewUI=a,i("ui.over.OverViewUI",a)}(e.over||(e.over={}))}(t.ui||(t.ui={}))},{}]},{},[2]);