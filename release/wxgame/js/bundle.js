var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();!function(){function e(t,a,i){function o(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=a[r]={exports:{}};t[r][0].call(h.exports,function(e){return o(t[r][1][e]||e)},h,h.exports,e,t,a,i)}return a[r].exports}for(var n="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./script/runtime/GameScene"),o=function(){function e(){}return e.init=function(){(0,Laya.ClassUtils.regClass)("script/runtime/GameScene.ts",i.default)},e.width=720,e.height=1280,e.scaleMode="showall",e.screenMode="vertical",e.alignV="middle",e.alignH="center",e.startScene="game/GameScene.scene",e.sceneRoot="",e.debug=!1,e.stat=!0,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=o,o.init()},{"./script/runtime/GameScene":7}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./GameConfig");new(function(){function e(){window.Laya3D?Laya3D.init(i.default.width,i.default.height):Laya.init(i.default.width,i.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=i.default.scaleMode,Laya.stage.screenMode=i.default.screenMode,Laya.URL.exportSceneToJson=i.default.exportSceneToJson,(i.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),i.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),i.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){i.default.startScene&&Laya.Scene.open(i.default.startScene)},e}())},{"./GameConfig":1}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.0.0",a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_OverView="over/OverView.scene",a.URL_ReviveView="dialog/ReviveView.scene",a.CameraInitPos=new Laya.Vector3(0,.3,.2),a.CameraInitRotEuler=new Laya.Vector3(0,0,0),a.LightInitPos=new Laya.Vector3(0,5,0),a.LightInitRotEuler=new Laya.Vector3(-30,0,0),a.LightInitColor=new Laya.Vector3(1,1,1),a.StageTexUrl=["res/stage/out/materials/mutou_06.jpg","res/stage/out/materials/box 13.png","res/stage/out/materials/TNT.png"],a.StageResUrl="res/stage/out/",a.StageInitPos=new Laya.Vector3(0,0,0),a.StageInitRot=new Laya.Vector3(0,180,0),a.StageInitScale=new Laya.Vector3(20,20,20),a.StageNum=74,a.MaxWinCheckTime=30,a.SetKinematicWaitTime=10,a.BgResUrl=["res/scene/Scenes_02.lh","res/scene/Scenes_04.lh","res/scene/Scenes_07.lh"],a.GlassBrokenVelocity=12.5,a.GlassFallingBrokenVelocity=1,a.PieceResUrl="res/cube_piece.lm",a.PiecesNum=3,a.PiecesBrokenTime=120,a.CannonResUrl=["res/cannon/Cannon_01.lh","res/cannon/Cannon_22.lh"],a.CannonInitPos=new Laya.Vector3(0,.05,-.2),a.CannonInitRot=new Laya.Vector3(0,180,0),a.CannonInitScale=new Laya.Vector3(25,25,25),a.TurretInitLocalRot=new Laya.Vector3(0,0,0),a.BulletResUrl="res/bullet.lh",a.BulletRadius=.08,a.BulletScale=[1,1.2],a.BulletMass=[40,10],a.BulletVelocity=[40,40]},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../runtime/GameScene"),o=function(e){function t(){var t=e.call(this)||this;return t.type=0,t.lifetime=120,t.collisionBlackList=["bullet","player"],t.flag_active=!1,t}return __extends(t,e),t.prototype.onAwake=function(){this.bullet=this.owner,this.rigidbody=this.bullet.getComponent(Laya.Rigidbody3D),this.material=new Laya.PBRSpecularMaterial,this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_FADE,this.material.albedoColorA=0,this.bullet.meshRenderer.material=this.material},t.prototype.onCollisionExit=function(e){var t=this;999===this.type&&Laya.timer.frameOnce(1,this,function(){t.destroy(),t.bullet.destroy(),console.log("hidden bullet destroyed")})},t.prototype.onUpdate=function(){var e=this;this.bullet.destroyed?this.destroy():(this.lifetime--,this.lifetime<0&&Laya.timer.frameOnce(1,this,function(){i.default.instance.currBulletNum++,e.destroy(),e.bullet.destroy()}),999!=this.type&&!this.flag_active&&this.bullet.transform.position.z<-1&&(this.refreshMaterial(),this.flag_active=!0))},t.prototype.refreshMaterial=function(){0===this.type?(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,this.material.albedoColor=new Laya.Vector4(1,0,0,1)):1===this.type&&(this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,this.material.albedoColor=new Laya.Vector4(.2,.2,1,.7))},t}(Laya.Script3D);a.default=o},{"../runtime/GameScene":7}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../Const"),o=function(e){function t(){var t=e.call(this)||this;return t.moveTimes=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.boundingBox.clone();this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);var t=new Laya.PBRSpecularMaterial;if(t.albedoTexture=Laya.loader.getRes(i.StageTexUrl[0]),t.specularColor=new Laya.Vector4(0,0,0,1),t.enableEmission=!0,t.emissionColor=new Laya.Vector4(.2,.2,.2,1),this.guard.meshRenderer.material=t,this.guard.name.search("move_x")>=0)this.MaxMoveTimes=120,this.moveStepY=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepX=2*this.guard.transform.localPositionY/this.MaxMoveTimes:this.moveStepX=2*this.guard.transform.localPositionX/this.MaxMoveTimes;else if(this.guard.name.search("move_y")>=0)this.MaxMoveTimes=120,this.moveStepX=0,0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)?this.moveStepY=2*this.guard.transform.localPositionX/this.MaxMoveTimes:this.moveStepY=2*this.guard.transform.localPositionY/this.MaxMoveTimes;else if(this.guard.name.search("move_")>=0){this.MaxMoveTimes=60;var a=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,o=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var n=a;a=o,o=n}this.guard.name.search("move_left")>=0?(this.moveStepX=-a,this.moveStepY=0):this.guard.name.search("move_right")>=0?(this.MaxMoveTimes=60,this.moveStepX=a,this.moveStepY=0):this.guard.name.search("move_up")>=0?(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=-o):this.guard.name.search("move_down")>=0&&(this.MaxMoveTimes=60,this.moveStepX=0,this.moveStepY=o)}},t.prototype.onUpdate=function(){this.guard.destroyed?this.destroy():this.guard.name.search("move")>=0?(this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes),this.flag_move=Math.floor(this.moveTimes/this.MaxMoveTimes%2)>0,this.flag_move?(this.guard.transform.localPositionX+=this.moveStepX,this.guard.transform.localPositionY+=this.moveStepY):(this.guard.transform.localPositionX-=this.moveStepX,this.guard.transform.localPositionY-=this.moveStepY)):this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)},t}(Laya.Script3D);a.default=o},{"../Const":3}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../Const"),o=e("../runtime/GameScene"),n=e("../component/Bullet"),r=function(e){function t(){var t=e.call(this)||this;return t.type=0,t.collisionWhiteList=["bullet","Obstacle"],t.piecesList=[],t.jumpCnt=0,t}return __extends(t,e),t.prototype.onAwake=function(){var e=this;this.target=this.owner,this.setRigidbody(),Laya.timer.frameOnce(i.SetKinematicWaitTime,this,function(){o.default.instance.isStageStart||(e.rigidbody.isKinematic=!0)}),this.initPieces()},t.prototype.onCollisionEnter=function(e){this.collisionHandler(e)},t.prototype.onCollisionStay=function(e){this.collisionHandler(e)},t.prototype.onCollisionExit=function(e){this.collisionHandler(e)},t.prototype.collisionHandler=function(e){for(var t=this,a=e.other.owner,r=!1,s=0,l=this.collisionWhiteList;s<l.length;s++){var c=l[s];if(a.name.indexOf(c)>=0){r=!0;break}}if("stand"===a.name||a.name.indexOf("Guard")>=0)o.default.instance.winCheckCnt=0;else if("ground"===a.name)Laya.timer.frameOnce(60,this,function(){t.destroy(),t.target.destroy()});else if("bullet"===a.name||"bulletTrigger"===a.name){1===a.getComponent(n.default).type&&1!==this.type&&this.setType(1)}else if("bomb"===a.name){var h=new Laya.Vector3;Laya.Vector3.subtract(this.target.transform.position,a.transform.position,h),Laya.Vector3.normalize(h,h),Laya.Vector3.scale(h,3/a.transform.localScaleX,h),Laya.Vector3.add(this.rigidbody.linearVelocity,h,h),this.rigidbody.linearVelocity=h}if(1===this.type){if(this.jumpCnt>60){(u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)))>=i.GlassFallingBrokenVelocity&&this.broken()}if(r){var d=a.getComponent(Laya.Rigidbody3D).linearVelocity.clone(),u=Laya.Vector3.distance(this.rigidbody.linearVelocity,new Laya.Vector3(0,0,0)),m=Laya.Vector3.distance(d,new Laya.Vector3(0,0,0));(u>=i.GlassBrokenVelocity||m>=i.GlassBrokenVelocity)&&this.broken()}else"ground"!==a.name&&"bomb"!==a.name||this.broken()}else if(2===this.type&&(a.name.indexOf("bullet")>=0||a.name.indexOf("bomb")>=0)&&this.target.parent){console.log("hit by"),console.log(a.name);var y=this.sizeX/2*this.target.transform.localScaleX*1,f=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(y));this.target.parent.addChild(f),f.name="bomb";var g=f.addComponent(Laya.PhysicsCollider);g.colliderShape=new Laya.SphereColliderShape(y),g.isTrigger=!0,g.canCollideWith=1,f.transform.localPosition=this.target.transform.localPosition.clone(),f.transform.localScale=this.target.transform.localScale.clone();var p=new Laya.UnlitMaterial;f.meshRenderer.material=p,p.renderMode=Laya.UnlitMaterial.RENDERMODE_TRANSPARENT,p.albedoColor=new Laya.Vector4(1,.5,0,.2),Laya.timer.frameOnce(1,this,function(){t.target.removeSelf()});var L=0;f.timer.frameLoop(1,f,function(){if(L++>12)return f.timer.clearAll(f),f.destroy(),t.target.destroy(),void t.destroy();f.transform.localScaleX*=1.2,f.transform.localScaleY*=1.2,f.transform.localScaleZ*=1.2})}this.jumpCnt=0},t.prototype.onUpdate=function(){this.target.destroyed?this.destroy():(this.rigidbody.isKinematic&&o.default.instance.isStageStart&&(this.rigidbody.isKinematic=!1),this.jumpCnt++,this.refreshRenderMode(),this.distance=Laya.Vector3.distance(this.target.transform.position,o.default.instance.gameStage.transform.position),this.distance<20&&(o.default.instance.winCheckCnt=0),this.rigidbody&&0==this.rigidbody.isActive&&(console.log("Physics_engine_bug_fixing: Reset rigidbody."),this.refreshRigidbody()))},t.prototype.refreshRenderMode=function(){1===this.type?this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT:this.material.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE},t.prototype.refreshRigidbody=function(){this.rigidbody&&(console.log("refresh rigidbody"),this.rigidbody.destroy(),this.setRigidbody())},t.prototype.setType=function(e){this.type=e,this.material=this.target.meshRenderer.material,this.material||(this.material=new Laya.PBRSpecularMaterial,this.target.meshRenderer.material=this.material),0===this.type?(this.material.albedoTexture=Laya.loader.getRes(i.StageTexUrl[1]),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)):1===this.type?(this.material.albedoTexture=null,this.material.albedoColor=new Laya.Vector4(.7,.7,1,.7),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.2,.2,.2,1)):2===this.type&&(this.material.albedoTexture=Laya.loader.getRes(i.StageTexUrl[2]),this.material.specularColor=new Laya.Vector4(0,0,0,1),this.material.enableEmission=!0,this.material.emissionColor=new Laya.Vector4(.1,.1,.1,1)),this.refreshRenderMode()},t.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.boundingBox.clone();if(this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z,this.rigidbody=this.target.addComponent(Laya.Rigidbody3D),this.target.name.search("Cube")>=0)this.rigidbody.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else if(this.target.name.search("Cylinder")>=0)this.rigidbody.colliderShape=new Laya.CylinderColliderShape(this.sizeX/2,this.sizeY);else{var t=new Laya.MeshColliderShape;t.mesh=this.target.meshFilter.sharedMesh,this.rigidbody.colliderShape=t}this.setPhysicsParam()},t.prototype.setPhysicsParam=function(){this.rigidbody.isKinematic=!1,0===this.type?(this.rigidbody.mass=10,this.rigidbody.friction=10):1===this.type&&(this.rigidbody.mass=.1,this.rigidbody.friction=2)},t.prototype.broken=function(){var e=this;this.effectPiecesBroken(),Laya.timer.frameOnce(2,this,function(){e.target.active=!1})},t.prototype.initPieces=function(){var e=this;Laya.Mesh.load(i.PieceResUrl,Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(t);a.active=!1,a.name="piece";var n=new Laya.PBRSpecularMaterial;n.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_TRANSPARENT,n.albedoTexture=null,n.albedoColor=new Laya.Vector4(.7,.7,1,.7),n.specularColor=new Laya.Vector4(0,0,0,1),n.enableEmission=!0,n.emissionColor=new Laya.Vector4(.2,.2,.2,1),a.meshRenderer.material=n;var r=a.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=a.meshFilter.sharedMesh,r.colliderShape=s,r.collisionGroup=2;for(var l=0;l<i.PiecesNum;l++)e.piecesList.push(a.clone()),o.default.instance.scene3D.addChild(e.piecesList[l])}))},t.prototype.effectPiecesBroken=function(){var e=this,t=function(t){a.piecesList[t].active=!0;var o=1.5*(.5*Math.random()+.5)*a.sizeX*a.target.transform.localScaleX*i.StageInitScale.x,n=1.5*(.5*Math.random()+.5)*a.sizeY*a.target.transform.localScaleY*i.StageInitScale.y,r=1.5*(.5*Math.random()+.5)*a.sizeZ*a.target.transform.localScaleZ*i.StageInitScale.z;a.piecesList[t].transform.localScale=new Laya.Vector3(o,n,r),a.piecesList[t].transform.localRotationEulerX=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerY=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerZ=2*(Math.random()-.5)*90;var s=new Laya.Vector3;s.x=(Math.random()-.5)*i.StageInitScale.x/80,s.y=(Math.random()-.5)*i.StageInitScale.y/80,s.z=(Math.random()-.5)*i.StageInitScale.z/80,a.piecesList[t].transform.position=a.target.transform.position.clone(),Laya.Vector3.add(a.piecesList[t].transform.localPosition,s,a.piecesList[t].transform.localPosition),Laya.Vector3.scale(s,50,s),Laya.Vector3.add(s,a.rigidbody.linearVelocity,s),a.piecesList[t].getComponent(Laya.Rigidbody3D).linearVelocity=s.clone(),Laya.Tween.to(a.piecesList[t].transform.localScale,{x:o/2,y:n/2,z:r/2},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(a.piecesList[t].meshRenderer.material,{albedoColorA:0},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(a,function(){e.piecesList[+t].destroy()}))},a=this;for(var o in this.piecesList)t(o)},t}(Laya.Script3D);a.default=r},{"../Const":3,"../component/Bullet":4,"../runtime/GameScene":7}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./../../ui/layaMaxUI"),o=e("../Const"),n=e("../component/Bullet"),r=e("../component/Target"),s=e("../component/Guard"),l=function(e){function t(){var a=e.call(this)||this;return a.bgIdx=0,a.MaxBulletNum=100,a.currBulletNum=0,a.winCheckCnt=0,a.isStageStart=!1,a.cannonType=0,a.isRecoil=!1,a.MaxRecoilTime=8,a.bulletDirection=new Laya.Vector3,a.mousePoint=new Laya.Vector2,a.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),a.hitResult=new Laya.HitResult,a.state=0,t.instance=a,a.initScene3D(),a.initCannon(),a.initBullet(),Laya.loader.load(o.StageTexUrl,Laya.Handler.create(a,function(){a.stageIdx=1,a.loadGameStage()})),a.bindButton(),a.scene3D.physicsSimulation.fixedTimeStep=.5/60,a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(o.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){this.visible=!0},t.prototype.initScene3D=function(){var e=this;this.scene3D=this.scene3DBox.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=o.CameraInitPos.clone(),this.camera.transform.localRotationEuler=o.CameraInitRotEuler.clone(),this.camera.clearColor=null,this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=o.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=o.LightInitRotEuler.clone(),this.directionLight.color=o.LightInitColor.clone(),Laya.Sprite3D.load(o.BgResUrl[this.bgIdx],Laya.Handler.create(this,function(t){e.background=e.scene3D.addChild(t),e.background.transform.localPosition=o.StageInitPos.clone(),e.background.transform.localRotationEuler=o.StageInitRot.clone(),e.background.transform.localScale=o.StageInitScale.clone();var a=e.background.getComponent(Laya.Animator);if(a&&a.destroy(),0===e.bgIdx){e.cloud0=e.background.getChildByName("Scenes_02").getChildByName("cloud01"),e.cloud1=e.background.getChildByName("Scenes_02").getChildByName("cloud03");var i=e.background.getChildByName("Scenes_02").getChildByName("Plane").getChildByName("Plane_0");i.name="ground";i.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.StaticPlaneColliderShape(new Laya.Vector3(0,1,0),0)}}))},t.prototype.initCannon=function(){var e=this;Laya.Sprite3D.load(o.CannonResUrl[0],Laya.Handler.create(this,function(t){e.cannon=t,e.scene3D.addChild(e.cannon),e.cannon.name="player",e.cannon.transform.localPosition=o.CannonInitPos.clone(),e.cannon.transform.localRotationEuler=o.CannonInitRot.clone(),e.cannon.transform.localScale=o.CannonInitScale.clone(),e.turret=e.cannon.getChildByName("Turret_0"),e.turretInitPos=e.turret.transform.position.clone()}))},t.prototype.initBullet=function(){var e=o.BulletRadius;this._bullet=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(e)),this._bullet.name="_bullet";this._bullet.addComponent(Laya.Rigidbody3D).colliderShape=new Laya.SphereColliderShape(e)},t.prototype.bindButton=function(){var e=this;this.restartBtn.on(Laya.Event.MOUSE_DOWN,this,function(){e.restartMask.visible=!0}),this.restartBtn.on(Laya.Event.MOUSE_UP,this,function(){e.restartMask.visible=!1,e.restart()}),this.restartBtn.on(Laya.Event.MOUSE_OUT,this,function(){e.restartMask.visible=!1}),this.nextBtn.on(Laya.Event.MOUSE_DOWN,this,function(){e.nextMask.visible=!0}),this.nextBtn.on(Laya.Event.MOUSE_UP,this,function(){e.nextMask.visible=!1,e.lvlSelect.text&&(e.stageIdx=+e.lvlSelect.text-1),e.nextStage()}),this.nextBtn.on(Laya.Event.MOUSE_OUT,this,function(){e.nextMask.visible=!1})},t.prototype.loadGameStage=function(){var e=this;this.gameStage&&(this.gameStage.destroyChildren(),this.gameStage.destroy(),Laya.stage.off(Laya.Event.CLICK,this,this.onClick)),this.currBulletNum=0,this.winCheckCnt=0,this.isStageStart=!1,this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime,this.winLabel.visible=!1;var t=o.StageResUrl+this.stageIdx+".lh";Laya.Sprite3D.load(t,Laya.Handler.create(this,function(t){e.gameStage=e.scene3D.addChild(t),e.lvlLabel.changeText("Level "+e.stageIdx),e.gameStage.transform.localPosition=o.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=o.StageInitRot.clone(),e.gameStage.transform.localScale=o.StageInitScale.clone();var a=e.gameStage.getComponent(Laya.Animator);a&&a.destroy();for(var i,n=0;n<e.gameStage.numChildren;n++)if(i=e.gameStage.getChildAt(n),i.meshRenderer.castShadow=!1,i.name.search("Obstacle")>=0){var l=i.addComponent(r.default);i.name.search("Glass")>=0?l.setType(1):i.name.search("TNT")>=0?l.setType(2):l.setType(0)}else if(i.name.search("Cube")>=0){i.name="stand";var c=i.addComponent(Laya.PhysicsCollider),h=i.meshFilter.sharedMesh.boundingBox.clone(),d=h.max.x-h.min.x,u=h.max.y-h.min.y,m=h.max.z-h.min.z;c.colliderShape=new Laya.BoxColliderShape(d,u,m);(f=new Laya.PBRSpecularMaterial).renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,f.albedoTexture=Laya.loader.getRes(o.StageTexUrl[0]),i.meshRenderer.material=f}else if(i.name.search("Cylinder")>=0){i.name="stand";var c=i.addComponent(Laya.PhysicsCollider),y=new Laya.MeshColliderShape;y.mesh=i.meshFilter.sharedMesh,c.colliderShape=y;var f=new Laya.PBRSpecularMaterial;f.renderMode=Laya.PBRSpecularMaterial.RENDERMODE_OPAQUE,f.albedoTexture=Laya.loader.getRes(o.StageTexUrl[0]),i.meshRenderer.material=f}else if(i.name.search("Guard")>=0)i.addComponent(s.default);else i.destroy();Laya.timer.frameLoop(1,e,e.stageLooping),Laya.stage.on(Laya.Event.CLICK,e,e.onClick)}))},t.prototype.stageLooping=function(){this.winCheckCnt++>=o.MaxWinCheckTime&&(console.log("You win. Stage: "+this.stageIdx),this.winLabel.visible=!0,Laya.stage.off(Laya.Event.CLICK,this,this.onClick),Laya.timer.clear(this,this.stageLooping)),this.isRecoil&&(this.recoilTime<this.MaxRecoilTime?(this.recoilTime<this.MaxRecoilTime/4?(this.turret.transform.localPositionX+=5e-4*this.bulletDirection.x,this.turret.transform.localPositionY+=5e-4*this.bulletDirection.y,this.turret.transform.localPositionZ+=5e-4*this.bulletDirection.z):(this.turret.transform.localPositionX-=3e-4*this.bulletDirection.x,this.turret.transform.localPositionY-=3e-4*this.bulletDirection.y,this.turret.transform.localPositionZ-=3e-4*this.bulletDirection.z),this.recoilTime++):(this.turret.transform.position=this.turretInitPos.clone(),this.isRecoil=!1,this.recoilTime=this.MaxRecoilTime)),this.background&&this.bgMoving()},t.prototype.restart=function(){this.loadGameStage()},t.prototype.nextStage=function(){this.stageIdx++,this.stageIdx<=o.StageNum?this.loadGameStage():console.log("通关")},t.prototype.onClick=function(){if(this.gameStage&&this.cannon&&this._bullet){if(this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30))Laya.Vector3.subtract(this.hitResult.point,this.turretInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,this.turretInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.createBullet(0,this.bulletDirection),this.turret.transform.localRotationEuler=o.TurretInitLocalRot.clone(),this.turret.transform.localRotationEulerX-=90*this.bulletDirection.y,this.turret.transform.localRotationEulerY-=90*this.bulletDirection.x,this.isRecoil=!0,this.recoilTime=0}},t.prototype.createBullet=function(e,t){this.cannonType=e;var a=this._bullet.clone();a.name="bullet",this.scene3D.addChild(a),a.transform.localPosition=this.turretInitPos.clone(),Laya.Vector3.scale(a.transform.localScale,o.BulletScale[this.cannonType],a.transform.localScale);var i=a.getComponent(Laya.Rigidbody3D);i.ccdMotionThreshold=.001,i.ccdSweptSphereRadius=o.BulletRadius*o.BulletScale[this.cannonType],i.mass=o.BulletMass[this.cannonType];var r=t.clone();Laya.Vector3.scale(r,o.BulletVelocity[this.cannonType],r),i.linearVelocity=r.clone();var s=a.clone();s.name="bulletTrigger",this.scene3D.addChild(s),s.getComponent(Laya.Rigidbody3D).isTrigger=!0,s.getComponent(Laya.Rigidbody3D).ccdMotionThreshold=.001,s.getComponent(Laya.Rigidbody3D).ccdSweptSphereRadius=o.BulletRadius*o.BulletScale[this.cannonType]/1e3;s.addComponent(n.default).type=999;if(a.addComponent(n.default).type=this.cannonType,!this.isStageStart){var l=new Laya.SphereColliderShape(3*o.BulletRadius),c=[];if(this.scene3D.physicsSimulation.shapeCastAll(l,this.turretInitPos,r,c))for(var h in c)"stand"!==c[h].collider.owner.name&&(this.isStageStart=!0)}},t.prototype.bgMoving=function(){0===this.bgIdx&&(this.cloud0.transform.localPositionX>.5&&(this.cloud0.transform.localPositionX=-.5),this.cloud0.transform.localPositionX+=7e-4,this.cloud1.transform.localPositionX<-.5&&(this.cloud1.transform.localPositionX=.5),this.cloud1.transform.localPositionX-=5e-4)},t}(i.ui.game.GameSceneUI);a.default=l},{"../Const":3,"../component/Bullet":4,"../component/Guard":5,"../component/Target":6,"./../../ui/layaMaxUI":8}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=Laya.View,o=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(i);e.GameSceneUI=t,o("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("home/HomeView")},t}(i);e.HomeViewUI=t,o("ui.home.HomeViewUI",t)}(e.home||(e.home={}))}(a.ui||(a.ui={})),function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("over/OverView")},t}(i);e.OverViewUI=t,o("ui.over.OverViewUI",t)}(e.over||(e.over={}))}(a.ui||(a.ui={}))},{}]},{},[2]);