var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();!function(){function e(t,i,a){function o(s,r){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!r&&c)return c(s,!0);if(n)return n(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){return o(t[s][1][e]||e)},u,u.exports,e,t,i,a)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}return e}()({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("./script/runtime/GameScene"),o=function(){function e(){}return e.init=function(){(0,Laya.ClassUtils.regClass)("script/runtime/GameScene.ts",a.default)},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="game/GameScene.scene",e.sceneRoot="",e.debug=!1,e.stat=!0,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();i.default=o,o.init()},{"./script/runtime/GameScene":6}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("./GameConfig");new(function(){function e(){window.Laya3D?Laya3D.init(a.default.width,a.default.height):Laya.init(a.default.width,a.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=a.default.scaleMode,Laya.stage.screenMode=a.default.screenMode,Laya.URL.exportSceneToJson=a.default.exportSceneToJson,(a.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),a.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),a.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){a.default.startScene&&Laya.Scene.open(a.default.startScene)},e}())},{"./GameConfig":1}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VERSION="1.0.0",i.URL_HomeView="home/HomeView.scene",i.URL_GameScene="game/GameScene.scene",i.URL_OverView="over/OverView.scene",i.URL_ReviveView="dialog/ReviveView.scene",i.CameraInitPos=new Laya.Vector3(0,0,0),i.CameraInitRotEuler=new Laya.Vector3(0,0,0),i.LightInitPos=new Laya.Vector3(0,5,0),i.LightInitRotEuler=new Laya.Vector3(-45,0,0),i.PlatformInitPos=new Laya.Vector3(0,-3,-15),i.PlatformInitRot=new Laya.Vector3(0,37,0),i.PlatformWidth=5,i.PlatformHeight=.3,i.PlatformStandRadius=.3,i.PlatformStandHeight=10,i.WinCheckTime=180,i.CubePieceResUrl="res/cube_piece.lm",i.CubePiecesNum=3,i.CubeBrokenTime=90,i.BulletResUrl="res/bullet.lh",i.BulletInitPos=new Laya.Vector3(-.1,-1,-4),i.BulletInitRot=new Laya.Vector3(180,0,0),i.BulletRadius=.15,i.PlayerResUrl="res/human.lh",i.PlayerInitPos=new Laya.Vector3(0,-.6,-1),i.PlayerInitRot=new Laya.Vector3(90,168,0),i.PlayerInitScale=new Laya.Vector3(20,20,20),i.PlayerShootLifeTime=10},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("../Const"),o=e("../runtime/GameScene"),n=function(e){function t(){var t=e.call(this)||this;return t._type=1,t.isHit=!1,t.velocityBroken=5,t.collisionWhiteList=["bullet","cube"],t.cubePiecesList=[],t.cubePiecesPosList=[],t.cubePiecesRotList=[],t.cubePiecesFrameIdx=a.CubeBrokenTime,t}return __extends(t,e),t.prototype.onAwake=function(){this.cube=this.owner,this.initCubePieces()},Object.defineProperty(t.prototype,"type",{get:function(){return this._type},set:function(e){this._type=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!0,configurable:!0}),t.prototype.onCollisionEnter=function(e){var t=e.other.owner;if(this.collisionWhiteList.indexOf(t.name)>=0&&2===this.type){var i=t.getComponent(Laya.Rigidbody3D).linearVelocity.clone();Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2)+Math.pow(i.z,2))>=this.velocityBroken&&(this.isHit=!0,this.hitPoint=e.other.owner.transform.localPosition.clone())}},t.prototype.onUpdate=function(){this.isHit&&2===this.type&&this.broken()},t.prototype.broken=function(){var e=this;this.effectCubeBroken(this.cube.transform.position.clone()),Laya.timer.frameOnce(1,this,function(){e.cube.removeSelf()})},t.prototype.initCubePieces=function(){var e=this;Laya.Mesh.load(a.CubePieceResUrl,Laya.Handler.create(this,function(t){var i=new Laya.MeshSprite3D(t);i.meshRenderer.material=new Laya.BlinnPhongMaterial,i.meshRenderer.material.albedoColor=new Laya.Vector4(.5,.5,1,.5),i.active=!1;var n=i.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=i.meshFilter.sharedMesh,n.colliderShape=s;for(var r=0;r<a.CubePiecesNum;r++)e.cubePiecesList.push(i.clone()),o.default.instance.scene3D.addChild(e.cubePiecesList[r]),e.cubePiecesPosList.push(new Laya.Vector3),e.cubePiecesRotList.push(new Laya.Vector3)}))},t.prototype.effectCubeBroken=function(e){for(var t in this.cubePiecesList){this.cubePiecesList[t].active=!0,this.cubePiecesList[t].transform.position=e.clone(),this.cubePiecesPosList[t].x=2*(Math.random()-.5),this.cubePiecesPosList[t].y=2*(Math.random()-.5),this.cubePiecesPosList[t].z=2*(Math.random()-.5),Laya.Vector3.scale(this.cubePiecesPosList[t],1,this.cubePiecesPosList[t]),this.cubePiecesRotList[t].x=2*(Math.random()-.5),this.cubePiecesRotList[t].y=2*(Math.random()-.5),this.cubePiecesRotList[t].z=2*(Math.random()-.5),Laya.Vector3.scale(this.cubePiecesRotList[t],90,this.cubePiecesRotList[t]);var i=(.3*Math.random()+.5)*this.width*2;this.cubePiecesList[t].transform.localScale=new Laya.Vector3(i,i,i),this.cubePiecesList[t].getComponent(Laya.Rigidbody3D).linearVelocity=this.cubePiecesPosList[t].clone()}this.cubePiecesFrameIdx=0,Laya.timer.frameLoop(1,this,this.cubePiecesLoop)},t.prototype.cubePiecesLoop=function(){var e=!1;for(var t in this.cubePiecesList)this.cubePiecesFrameIdx>=a.CubeBrokenTime&&(e=!0,this.cubePiecesList[+t].active=!1);this.cubePiecesFrameIdx++,e&&Laya.timer.clear(this,this.cubePiecesLoop)},t}(Laya.Script3D);i.default=n},{"../Const":3,"../runtime/GameScene":6}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("../Const"),o=function(e){function t(){var t=e.call(this)||this;return t.winCount=0,t.collisionWhiteList=["cube"],t}return __extends(t,e),t.prototype.onAwake=function(){this.platform=this.owner},t.prototype.onUpdate=function(){this.winCount++,this.winCount>a.WinCheckTime&&console.log("You win.")},t.prototype.onCollisionStay=function(e){this.collisionWhiteList.indexOf(e.other.owner.name)>=0&&(this.winCount=0)},t}(Laya.Script3D);i.default=o},{"../Const":3}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=e("./../../ui/layaMaxUI"),o=e("../Const"),n=e("../component/Platform"),s=e("../component/Cube"),r=function(e){function t(){var i=e.call(this)||this;return i.cubeList=[],i.cubeNumX=5,i.cubeNumY=5,i.cubeNumZ=5,i.cubePiecesList=[],i.cubePiecesPosList=[],i.cubePiecesRotList=[],i.cubePiecesFrameIdx=o.CubeBrokenTime,i.bulletRadius=.02,i.bulletVelocity=1,i.bulletDirection=new Laya.Vector3,i.shootTime=-1,i.mousePoint=new Laya.Vector2,i.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),i.hitResult=new Laya.HitResult,t.instance=i,i.initScene3D(),i.initGameStage(),i.initPlayer(),i.initBullet(),i}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(o.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){this.visible=!0},t.prototype.initScene3D=function(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=o.CameraInitPos.clone(),this.camera.transform.localRotationEuler=o.CameraInitRotEuler.clone(),this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=o.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=o.LightInitRotEuler.clone()},t.prototype.initGameStage=function(){this.initPlatfrom(),this._cube=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(1,1,1)),this._cube.name="cube";var e=this._cube.addComponent(Laya.Rigidbody3D);e.colliderShape=new Laya.BoxColliderShape(1,1,1),e.mass=1;this.cubeNumX,this.cubeNumY,this.cubeNumZ;var t=this.cubeNumX>this.cubeNumY?this.cubeNumX:this.cubeNumY;t=this.cubeNumZ>this.cubeNumY?this.cubeNumZ:this.cubeNumY;this.cubeWidth=(o.PlatformWidth-2)/t;for(var i=this.cubeNumX%2==1?-Math.floor(this.cubeNumX/2)*this.cubeWidth:this.cubeWidth/2-this.cubeNumX/2*this.cubeWidth,a=(o.PlatformHeight+this.cubeWidth)/2,n=this.cubeNumZ%2==1?-Math.floor(this.cubeNumZ/2)*this.cubeWidth:this.cubeWidth/2-this.cubeNumZ/2*this.cubeWidth,r=0;r<this.cubeNumX;r++)for(var c=0;c<this.cubeNumY;c++)for(var l=0;l<this.cubeNumZ;l++){var u=this._cube.clone();u.transform.localScale=new Laya.Vector3(this.cubeWidth,this.cubeWidth,this.cubeWidth),u.transform.localPosition=new Laya.Vector3(i+this.cubeWidth*r,a+this.cubeWidth*c,n+this.cubeWidth*l),this.platform.addChild(u);var h=u.addComponent(s.default);h.type=2,h.width=this.cubeWidth,this.cubeList.push(h)}},t.prototype.initPlatfrom=function(){this.platform=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(o.PlatformWidth,o.PlatformHeight,o.PlatformWidth)),this.scene3D.addChild(this.platform),this.platform.addComponent(n.default),this.platform.transform.localPosition=o.PlatformInitPos.clone(),this.platform.transform.localRotationEuler=o.PlatformInitRot.clone();this.platform.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(o.PlatformWidth,o.PlatformHeight,o.PlatformWidth),this.platform_stand=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createCylinder(o.PlatformStandRadius,o.PlatformStandHeight)),this.platform.addChild(this.platform_stand),this.platform_stand.transform.localPosition=new Laya.Vector3(0,-o.PlatformStandHeight/2,0);this.platform_stand.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.CylinderColliderShape(o.PlatformStandRadius,o.PlatformStandHeight)},t.prototype.initPlayer=function(){var e=this;Laya.Sprite3D.load(o.PlayerResUrl,Laya.Handler.create(this,function(t){e.player=t,e.scene3D.addChild(e.player),e.playerAni=e.player.getComponent(Laya.Animator),e.player.transform.localPosition=o.PlayerInitPos.clone(),e.player.transform.localRotationEuler=o.PlayerInitRot.clone(),e.player.transform.localScale=o.PlayerInitScale.clone(),e.player.name="player";var i=e.player.getChildByName("shadow_0").meshRenderer.material;i.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,i.albedoColorA=.2,Laya.stage.on(Laya.Event.CLICK,e,e.onClick),e.gameStart()}))},t.prototype.initBullet=function(){this._bullet=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(o.BulletRadius));var e=this._bullet.addComponent(Laya.Rigidbody3D);e.colliderShape=new Laya.SphereColliderShape(o.BulletRadius),e.ccdMotionThreshold=1e-4,e.ccdSweptSphereRadius=o.BulletRadius,e.mass=1,this._bullet.transform.localPosition=o.BulletInitPos.clone(),this._bullet.transform.localRotationEuler=o.BulletInitRot.clone(),this._bullet.name="_bullet"},t.prototype.gameStart=function(){var e=this;this.playerAni.getDefaultState().clip.islooping=!0,this.playerAni.play(),Laya.timer.frameLoop(1,this,function(){e.shootTime--,e.shootTime<0&&(e.playerAni.speed=0)})},t.prototype.onClick=function(){if(this.shootTime=o.PlayerShootLifeTime,this.playerAni.speed=1,this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30))Laya.Vector3.subtract(this.hitResult.point,o.BulletInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;12,Laya.Vector3.scale(this.ray.direction,12,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,o.BulletInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.bulletVelocity=50,Laya.Vector3.scale(this.bulletDirection,this.bulletVelocity,this.bulletDirection);var i=this._bullet.clone();i.name="bullet",this.scene3D.addChild(i);i.getComponent(Laya.Rigidbody3D).linearVelocity=this.bulletDirection.clone()},t}(a.ui.game.GameSceneUI);i.default=r},{"../Const":3,"../component/Cube":4,"../component/Platform":5,"./../../ui/layaMaxUI":7}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=Laya.Scene,o=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(a);e.GameSceneUI=t,o("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(i.ui||(i.ui={}))},{}]},{},[2]);