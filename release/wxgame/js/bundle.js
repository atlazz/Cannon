var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();!function(){function e(t,a,i){function o(r,s){if(!a[r]){if(!t[r]){var l="function"==typeof require&&require;if(!s&&l)return l(r,!0);if(n)return n(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var h=a[r]={exports:{}};t[r][0].call(h.exports,function(e){return o(t[r][1][e]||e)},h,h.exports,e,t,a,i)}return a[r].exports}for(var n="function"==typeof require&&require,r=0;r<i.length;r++)o(i[r]);return o}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./script/runtime/GameScene"),o=function(){function e(){}return e.init=function(){(0,Laya.ClassUtils.regClass)("script/runtime/GameScene.ts",i.default)},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="game/GameScene.scene",e.sceneRoot="",e.debug=!1,e.stat=!0,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a.default=o,o.init()},{"./script/runtime/GameScene":7}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./GameConfig");new(function(){function e(){window.Laya3D?Laya3D.init(i.default.width,i.default.height):Laya.init(i.default.width,i.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=i.default.scaleMode,Laya.stage.screenMode=i.default.screenMode,Laya.URL.exportSceneToJson=i.default.exportSceneToJson,(i.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),i.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),i.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){i.default.startScene&&Laya.Scene.open(i.default.startScene)},e}())},{"./GameConfig":1}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.VERSION="1.0.0",a.URL_HomeView="home/HomeView.scene",a.URL_GameScene="game/GameScene.scene",a.URL_OverView="over/OverView.scene",a.URL_ReviveView="dialog/ReviveView.scene",a.CameraInitPos=new Laya.Vector3(0,.5,0),a.CameraInitRotEuler=new Laya.Vector3(0,0,0),a.LightInitPos=new Laya.Vector3(-3,5,0),a.LightInitRotEuler=new Laya.Vector3(-45,-30,0),a.StageResUrl="res/stage/out/",a.StageInitPos=new Laya.Vector3(0,0,0),a.StageInitRot=new Laya.Vector3(0,180,0),a.StageInitScale=new Laya.Vector3(40,40,40),a.StageNum=30,a.MaxWinCheckTime=90,a.GlassBrokenVelocity=3,a.PieceResUrl="res/cube_piece.lm",a.PiecesNum=3,a.PiecesBrokenTime=120,a.BulletResUrl="res/bullet.lh",a.BulletInitPos=new Laya.Vector3(0,-.5,-5),a.BulletInitRot=new Laya.Vector3(180,0,0),a.BulletRadius=.15,a.PlayerResUrl="res/human.lh",a.PlayerInitPos=new Laya.Vector3(0,-.1,-1),a.PlayerInitRot=new Laya.Vector3(90,168,0),a.PlayerInitScale=new Laya.Vector3(20,20,20),a.PlayerShootLifeTime=10},{}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../runtime/GameScene"),o=function(e){function t(){var t=e.call(this)||this;return t.lifetime=120,t.collisionBlackList=["bullet","player"],t}return __extends(t,e),t.prototype.onAwake=function(){this.bullet=this.owner},t.prototype.onUpdate=function(){var e=this;this.bullet.destroyed?this.destroy():(this.lifetime--,this.lifetime<0&&Laya.timer.frameOnce(1,this,function(){i.default.instance.currBulletNum++,e.bullet.removeSelf(),e.destroy()}))},t}(Laya.Script3D);a.default=o},{"../runtime/GameScene":7}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.MaxMoveTimes=60,t.moveTimes=0,t}return __extends(t,e),t.prototype.onAwake=function(){this.guard=this.owner;var e=this.guard.meshFilter.sharedMesh.boundingBox.clone();this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z;this.guard.addComponent(Laya.PhysicsCollider).colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ),this.initPos=this.guard.transform.localPosition.clone()},t.prototype.onUpdate=function(){if(this.guard.destroyed)this.destroy();else{this.moveTimes=(this.moveTimes+1)%(2*this.MaxMoveTimes);var e=Math.floor(this.moveTimes/this.MaxMoveTimes%2),t=this.sizeX*this.guard.transform.localScaleX/2/this.MaxMoveTimes,a=this.sizeY*this.guard.transform.localScaleY/2/this.MaxMoveTimes;if(0===Math.floor((Math.abs(this.guard.transform.localRotationEulerZ)+90.5)%180)){var i=t;t=a,a=i}this.guard.name.search("move_x")>=0?(this.MaxMoveTimes=120,t=2*this.initPos.x/this.MaxMoveTimes,(e=Math.floor(this.moveTimes/this.MaxMoveTimes%2))?this.guard.transform.localPositionX+=t:this.guard.transform.localPositionX-=t):this.guard.name.search("move_y")>=0?(this.MaxMoveTimes=120,a=2*this.initPos.y/this.MaxMoveTimes,(e=Math.floor(this.moveTimes/this.MaxMoveTimes%2))?this.guard.transform.localPositionY+=a:this.guard.transform.localPositionY-=a):this.guard.name.search("move_left")>=0?e?this.guard.transform.localPositionX-=t:this.guard.transform.localPositionX+=t:this.guard.name.search("move_right")>=0?e?this.guard.transform.localPositionX+=t:this.guard.transform.localPositionX-=t:this.guard.name.search("move_up")>=0?e?this.guard.transform.localPositionY-=a:this.guard.transform.localPositionY+=a:this.guard.name.search("move_down")>=0?e?this.guard.transform.localPositionY+=a:this.guard.transform.localPositionY-=a:this.guard.name.search("rotate_left")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY+1)%360:this.guard.name.search("rotate_right")>=0?this.guard.transform.localRotationEulerY=(this.guard.transform.localRotationEulerY-1)%360:this.guard.name.search("rotate_up")>=0?this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX+1)%360:this.guard.name.search("rotate_down")>=0&&(this.guard.transform.localRotationEulerX=(this.guard.transform.localRotationEulerX-1)%360)}},t}(Laya.Script3D);a.default=i},{}],6:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("../Const"),o=e("../runtime/GameScene"),n=function(e){function t(){var t=e.call(this)||this;return t.type=1,t.collisionBlackList=["stand","Guard"],t.piecesList=[],t}return __extends(t,e),t.prototype.onAwake=function(){this.target=this.owner,this.setRigidbody(),this.initPieces()},t.prototype.onCollisionEnter=function(e){"stand"===e.other.owner.name&&(o.default.instance.winCheckCnt=0);var t=e.other.owner;if(2===this.type){var a=this.target.getComponent(Laya.Rigidbody3D).linearVelocity.clone(),n=new Laya.Vector3(0,0,0);this.collisionBlackList.indexOf(t.name)<0&&t.name.indexOf("Guard")<0&&(n=t.getComponent(Laya.Rigidbody3D).linearVelocity.clone()),Laya.Vector3.subtract(a,n,a);Math.sqrt(Math.pow(a.x,2)+Math.pow(a.y,2)+Math.pow(a.z,2))>=i.GlassBrokenVelocity&&this.broken()}},t.prototype.onCollisionStay=function(e){"stand"===e.other.owner.name&&(o.default.instance.winCheckCnt=0)},t.prototype.onCollisionExit=function(e){"stand"===e.other.owner.name&&(o.default.instance.winCheckCnt=0)},t.prototype.onUpdate=function(){if(this.target.destroyed)this.destroy();else{Laya.Vector3.distance(this.target.transform.position,o.default.instance.gameStage.transform.position)<20&&(o.default.instance.winCheckCnt=0),this.physics_engine_bug_fixing()}},t.prototype.physics_engine_bug_fixing=function(){var e=this.target.getComponent(Laya.Rigidbody3D);0==e.isActive&&(e.destroy(),this.setRigidbody(),console.log("Physics_engine_bug_fixing: Reset rigidbody."))},t.prototype.setType=function(e){if(this.type=e,2===this.type){var t=new Laya.BlinnPhongMaterial;t.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,t.albedoColor=new Laya.Vector4(.7,.7,1,.7),this.target.meshRenderer.material=t}},t.prototype.setRigidbody=function(){var e=this.target.meshFilter.sharedMesh.boundingBox.clone();this.sizeX=e.max.x-e.min.x,this.sizeY=e.max.y-e.min.y,this.sizeZ=e.max.z-e.min.z;var t=this.target.addComponent(Laya.Rigidbody3D);if(this.target.name.search("Cube")>=0)t.colliderShape=new Laya.BoxColliderShape(this.sizeX,this.sizeY,this.sizeZ);else{var a=new Laya.MeshColliderShape;a.mesh=this.target.meshFilter.sharedMesh,t.colliderShape=a}this.setPhysicsParam()},t.prototype.setPhysicsParam=function(){var e=this.target.getComponent(Laya.Rigidbody3D);e.isKinematic=!1,1===this.type?(e.mass=10,e.friction=10):2===this.type&&(e.mass=.1,e.friction=2)},t.prototype.broken=function(){var e=this;this.effectPiecesBroken(),Laya.timer.frameOnce(1,this,function(){e.target.active=!1})},t.prototype.initPieces=function(){var e=this;Laya.Mesh.load(i.PieceResUrl,Laya.Handler.create(this,function(t){var a=new Laya.MeshSprite3D(t);a.active=!1,a.name="piece";var n=new Laya.BlinnPhongMaterial;n.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,n.albedoColor=new Laya.Vector4(.7,.7,1,.7),a.meshRenderer.material=n;var r=a.addComponent(Laya.Rigidbody3D),s=new Laya.MeshColliderShape;s.mesh=a.meshFilter.sharedMesh,r.colliderShape=s;for(var l=0;l<i.PiecesNum;l++)e.piecesList.push(a.clone()),o.default.instance.scene3D.addChild(e.piecesList[l])}))},t.prototype.effectPiecesBroken=function(){var e=this,t=function(t){a.piecesList[t].active=!0;var o=1.5*(.5*Math.random()+.5)*a.sizeX*a.target.transform.localScaleX*i.StageInitScale.x,n=1.5*(.5*Math.random()+.5)*a.sizeY*a.target.transform.localScaleY*i.StageInitScale.y,r=1.5*(.5*Math.random()+.5)*a.sizeZ*a.target.transform.localScaleZ*i.StageInitScale.z;a.piecesList[t].transform.localScale=new Laya.Vector3(o,n,r),a.piecesList[t].transform.localRotationEulerX=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerY=2*(Math.random()-.5)*90,a.piecesList[t].transform.localRotationEulerZ=2*(Math.random()-.5)*90;var s=new Laya.Vector3;s.x=(Math.random()-.5)*i.BulletRadius,s.y=(Math.random()-.5)*i.BulletRadius,s.z=(Math.random()-.5)*i.BulletRadius,a.piecesList[t].transform.position=a.target.transform.position.clone(),Laya.Vector3.add(a.piecesList[t].transform.localPosition,s,a.piecesList[t].transform.localPosition),Laya.Vector3.scale(s,50,s),a.piecesList[t].getComponent(Laya.Rigidbody3D).linearVelocity=s.clone(),Laya.Tween.to(a.piecesList[t].transform.localScale,{x:o/2,y:n/2,z:r/2},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone),Laya.Tween.to(a.piecesList[t].meshRenderer.material,{albedoColorA:0},i.PiecesBrokenTime/60*1e3,Laya.Ease.linearNone,Laya.Handler.create(a,function(){e.piecesList[+t].destroy()}))},a=this;for(var o in this.piecesList)t(o)},t}(Laya.Script3D);a.default=n},{"../Const":3,"../runtime/GameScene":7}],7:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=e("./../../ui/layaMaxUI"),o=e("../Const"),n=e("../component/Bullet"),r=e("../component/Target"),s=e("../component/Guard"),l=function(e){function t(){var a=e.call(this)||this;return a.MaxBulletNum=20,a.currBulletNum=0,a.winCheckCnt=0,a.bulletRadius=.02,a.bulletVelocity=1,a.bulletDirection=new Laya.Vector3,a.shootTime=-1,a.mousePoint=new Laya.Vector2,a.ray=new Laya.Ray(new Laya.Vector3(0,0,0),new Laya.Vector3(0,0,0)),a.hitResult=new Laya.HitResult,a.state=0,t.instance=a,a.initScene3D(),a.initPlayer(),a.initBullet(),a.stageIdx=1,a.loadGameStage(),a}return __extends(t,e),t.openInstance=function(e){t.instance?t.instance.onOpened(e):Laya.Scene.open(o.URL_GameScene,!1,e)},t.prototype.onOpened=function(e){this.visible=!0},t.prototype.initScene3D=function(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.camera=this.scene3D.addChild(new Laya.Camera),this.camera.transform.localPosition=o.CameraInitPos.clone(),this.camera.transform.localRotationEuler=o.CameraInitRotEuler.clone(),this.directionLight=this.scene3D.addChild(new Laya.DirectionLight),this.directionLight.transform.localPosition=o.LightInitPos.clone(),this.directionLight.transform.localRotationEuler=o.LightInitRotEuler.clone()},t.prototype.initPlayer=function(){var e=this;Laya.Sprite3D.load(o.PlayerResUrl,Laya.Handler.create(this,function(t){e.player=t,e.scene3D.addChild(e.player),e.playerAni=e.player.getComponent(Laya.Animator),e.player.transform.localPosition=o.PlayerInitPos.clone(),e.player.transform.localRotationEuler=o.PlayerInitRot.clone(),e.player.transform.localScale=o.PlayerInitScale.clone(),e.player.name="player";var a=e.player.getChildByName("shadow_0").meshRenderer.material;a.renderMode=Laya.BlinnPhongMaterial.RENDERMODE_TRANSPARENT,a.albedoColorA=.2,e.playerAni.getDefaultState().clip.islooping=!0,e.playerAni.play(),Laya.timer.frameLoop(1,e,function(){e.shootTime--,e.shootTime<0&&(e.playerAni.speed=0)})}))},t.prototype.initBullet=function(){this._bullet=new Laya.MeshSprite3D(Laya.PrimitiveMesh.createSphere(o.BulletRadius));var e=this._bullet.addComponent(Laya.Rigidbody3D);e.colliderShape=new Laya.SphereColliderShape(o.BulletRadius),e.mass=10,e.overrideGravity=!0,e.gravity=new Laya.Vector3(0,-5,0),e.ccdMotionThreshold=1e-4,e.ccdSweptSphereRadius=o.BulletRadius,this._bullet.transform.localPosition=o.BulletInitPos.clone(),this._bullet.transform.localRotationEuler=o.BulletInitRot.clone(),this._bullet.name="_bullet"},t.prototype.loadGameStage=function(){var e=this;this.gameStage&&this.gameStage.destroyChildren(),this.gameStage&&this.gameStage.destroy(),this.currBulletNum=0,this.winCheckCnt=0;var t=o.StageResUrl+this.stageIdx+".lh";Laya.Sprite3D.load(t,Laya.Handler.create(this,function(t){e.gameStage=e.scene3D.addChild(t),e.gameStage.transform.localPosition=o.StageInitPos.clone(),e.gameStage.transform.localRotationEuler=o.StageInitRot.clone(),e.gameStage.transform.localScale=o.StageInitScale.clone(),e.gameStage.getComponent(Laya.Animator).destroy();for(var a,i=0;i<e.gameStage.numChildren;i++)if((a=e.gameStage.getChildAt(i)).name.search("Obstacle")>=0){console.log(a.name+" to target");var n=a.addComponent(r.default);a.name.search("Glass")>=0?n.setType(2):n.setType(1)}else if(a.name.search("Cube")>=0){console.log(a.name+" to stand"),a.name="stand";var l=a.addComponent(Laya.PhysicsCollider),c=a.meshFilter.sharedMesh.boundingBox.clone(),h=c.max.x-c.min.x,u=c.max.y-c.min.y,d=c.max.z-c.min.z;l.colliderShape=new Laya.BoxColliderShape(h,u,d)}else if(a.name.search("Cylinder")>=0){console.log(a.name+" to stand"),a.name="stand";var l=a.addComponent(Laya.PhysicsCollider),m=new Laya.MeshColliderShape;m.mesh=a.meshFilter.sharedMesh,l.colliderShape=m}else if(a.name.search("Guard")>=0){console.log(a.name+" to guard");a.addComponent(s.default)}else a.destroy();Laya.timer.frameLoop(1,e,e.stageListener),Laya.stage.on(Laya.Event.CLICK,e,e.onClick)}))},t.prototype.stageListener=function(){this.winCheckCnt++>=o.MaxWinCheckTime?(console.log("You win. Stage: "+this.stageIdx),this.nextStage(),Laya.timer.clear(this,this.stageListener)):this.currBulletNum>=this.MaxBulletNum&&(console.log("out of ammo"),this.restart(),Laya.timer.clear(this,this.stageListener))},t.prototype.restart=function(){this.loadGameStage()},t.prototype.nextStage=function(){this.stageIdx++,this.stageIdx<=o.StageNum?this.loadGameStage():console.log("通关")},t.prototype.onClick=function(){if(this.shootTime=o.PlayerShootLifeTime,this.playerAni.speed=1,this.mousePoint.x=Laya.MouseManager.instance.mouseX,this.mousePoint.y=Laya.MouseManager.instance.mouseY,this.camera.viewportPointToRay(this.mousePoint,this.ray),this.scene3D.physicsSimulation.rayCast(this.ray,this.hitResult,30))Laya.Vector3.subtract(this.hitResult.point,o.BulletInitPos,this.bulletDirection);else{var e=new Laya.Vector3;this.camera.farPlane;20,Laya.Vector3.scale(this.ray.direction,20,e);var t=new Laya.Vector3;Laya.Vector3.subtract(this.camera.transform.position,o.BulletInitPos,t),Laya.Vector3.add(e,t,this.bulletDirection)}Laya.Vector3.normalize(this.bulletDirection,this.bulletDirection),this.bulletVelocity=50,Laya.Vector3.scale(this.bulletDirection,this.bulletVelocity,this.bulletDirection);var a=this._bullet.clone();a.name="bullet",this.scene3D.addChild(a);a.getComponent(Laya.Rigidbody3D).linearVelocity=this.bulletDirection.clone(),a.addComponent(n.default)},t}(i.ui.game.GameSceneUI);a.default=l},{"../Const":3,"../component/Bullet":4,"../component/Guard":5,"../component/Target":6,"./../../ui/layaMaxUI":8}],8:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var i=Laya.Scene,o=Laya.ClassUtils.regClass;!function(e){!function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),this.loadScene("game/GameScene")},t}(i);e.GameSceneUI=t,o("ui.game.GameSceneUI",t)}(e.game||(e.game={}))}(a.ui||(a.ui={}))},{}]},{},[2]);